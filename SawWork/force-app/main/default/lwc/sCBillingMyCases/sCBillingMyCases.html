<!--=====================================================================================================+
    Component name      :   sCBillingMyCases
    Author              :   Sharath Prasanna
    Created             :   24 Jun 2020
    Purpose             :  lwc component for Cases in Home page

    Last Modified Developer                 Purpose            
    ============= ========================  =======
    24 Jun 2020     Sharath Prasanna                    Initial Development
    22 Feb 2021     Sharath Prasanna                    Added new update field

+=====================================================================================================-->
<template>    

    <!-- ********************************* NOTIFICATION CENTER ********************************* -->
           <div class="sidenav">
               <div class="slds-panel__header">
                       <a onclick={closeNav}>
                           <lightning-icon icon-name="utility:chevronright" alternative-text="close"
                           title="close" size="x-small">
                       </lightning-icon></a><br />
                       <h2 class="slds-panel__header-title slds-text-heading_small" style="color:#005fb2; text-align: center; cursor: pointer !important">
                             <b onclick={navigateToCaseListView} style="cursor:pointer !important">{notificationCenterHeader}</b>
                       </h2>
               </div>
   
               <div class="slds-panel__body">
                       <template for:each={notificationlist} for:item="eachItem">
                           <p class="slds-p-horizontal_small" key={eachItem.akamId}>
                               <button class="slds-button slds-button_outline-brand" value={eachItem.recUrl} onclick={openNewTab}>
                               {eachItem.Body}!
                               </button>
                           </p>
                           <br key={eachItem.akamId} />
                       </template>
               </div>
           </div>
   
           <!-- ********************************* END of NOTIFICATION CENTER ********************************* -->        
          
           <!-- **************************** SUMMARY DASHBOARD **************************** -->
           <div class="slds-m-bottom_small">
       
               <!-- Lightning card for summary-->
               <lightning-card
                       variant="narrow"
                       icon-name="standard:case" class="slds-icon_medium">
                   <h1 slot="title">Summary Dashboard</h1>
                   <div>
                       <template if:true={loadHeaderSpinner}>
                           <div style="opacity: 0.7;" class="slds-spinner_container">
                               <lightning-spinner alternative-text="Loading" variant="brand" size="medium">
                               </lightning-spinner>
                           </div>
                       </template>
                   </div>
   
                   <!-- The footer contains the summary values-->
                   <div slot="footer" class="slds-text-align_left">
                       
                       <!-- Unassigned Cases-->
                       <lightning-layout class = "slds-m-left_x-small">
                           
                           <lightning-layout-item size="2"> 
                               <div class="slds-media slds-col" style="padding-left: 0px;align-items: center">
                                   <lightning-icon icon-name="standard:queue" alternative-text="Unassigned Cases"
                                   variant="warning" title="Unassigned Cases" size="small"></lightning-icon>
                                   <span title="Unassigned Cases" class="summaryDashboard">Unassigned Cases&nbsp;
                                       <button style="color: #006dcc" value="unassigned" title="Click to view Unassigned Cases"
                                           onclick={getNavRecords}>
                                           {iQCount}
                                       </button>
                                   </span>
                               </div>
                           </lightning-layout-item>
                           
                           <!-- Unassigned Cases > 24 Hours-->
                           <lightning-layout-item size="2"> 
                               <div class="slds-media slds-col" style="padding-left: 0px;align-items: center ">
                                   <lightning-icon icon-name="utility:warning" alternative-text="Unassigned Cases > 24 Hours"
                                       variant="warning" title="Unassigned Cases > 24 Hours" size="small"></lightning-icon>
                                   <span title="Unassigned Cases > 24 Hours" class="summaryDashboard">Unassigned > 24 Hours&nbsp;
                                       <button style="color: #006dcc" value="unassigned24" title="Click to view Unassigned Cases > 24 Hours"
                                           onclick={getNavRecords}>
                                           {iQ24Count}
                                       </button>
                                   </span>
                               </div>                                        
                           </lightning-layout-item>
                           
                           <!-- Open Cases-->                                
                           <lightning-layout-item size="2" class="slds-p-left_xx-large"> 
                               <div class="slds-media slds-col" style="padding-left: 2px;align-items: center ">
                                   <lightning-icon icon-name="standard:work_queue" alternative-text="Open Cases"
                                       variant="inverse" title="Open Cases" size="small"></lightning-icon>
                                   <span title="Open Cases" class="summaryDashboard">My Open Cases&nbsp;
                                       <button style="color: #006dcc" value="open" title="Click to view Open Cases" onclick={navigateToCaseListView}>
                                           {openCount}
                                       </button>
                                   </span>
                               </div>                                        
                           </lightning-layout-item>
   
                           <!-- IR Miss-->
                           <lightning-layout-item size="2" class="slds-p-left_xx-large"> 
                               <div class="slds-media slds-col" style="padding-left: 0px;align-items: center ">
                                   <lightning-icon icon-name="utility:alert" alternative-text="IR Violation"
                                       variant="error" title="IR Violation" size="medium"></lightning-icon>
                                   <span title="IR Violation" class="summaryDashboard">IR Miss&nbsp;
                                       <button style="color: #006dcc" value="IR" title="Click to view IR Violation Cases"
                                           onclick={getNavRecords}>
                                           {iRCount}
                                       </button>
                                   </span>
                               </div>                                        
                           </lightning-layout-item>
   
                           <!-- Resolution Miss-->
                           <lightning-layout-item size="2" class="slds-p-left_large"> 
                               <div class="slds-media slds-col" style="padding-left: 0px;align-items: center ">
                                   <lightning-icon icon-name="utility:alert" alternative-text="Revolution Violation"
                                       variant="error" title="Revolution Violation" size="medium"></lightning-icon>
                                   <span class="summaryDashboard" title="Revolution Violation">Resolution Miss&nbsp;
                                       <button style="color: #006dcc" value="revolution" title="Click to view Revolution Violation Cases"
                                           onclick={getNavRecords}>
                                           {resCount}
                                       </button>
                                   </span>
                               </div>                                        
                           </lightning-layout-item>
   
                           <!-- Closed Cases-->
                           <lightning-layout-item size="2" class="slds-p-left_large"> 
                               <div class="slds-media slds-col" style="padding-left: 0px;align-items: center ">
                                   <lightning-icon icon-name="utility:success" alternative-text="Closed Cases" variant="success"
                                       title="Closed Cases" size="medium">
                                   </lightning-icon>
                                   <span class="summaryDashboard" title="Closed Cases">
                                       My Closed Cases&nbsp;
                                       <button style="color: #006dcc" value="closed" title="Closed Cases" onclick={navigateToCaseListView}>
                                           {closedCount}
                                       </button>
                                   </span>
                               </div>
                           </lightning-layout-item>
                       
                       </lightning-layout>        
   
                   </div>
   
                   <div slot="actions">
                       
                       <lightning-layout>
                           
                           <lightning-layout-item size = "8">
   
                               <lightning-combobox
                               name="dateFilters"
                               label="dateFilters"
                               value={summaryFilter}
                               placeholder="This Month"
                               options={dateFiltersOptions}
                               onchange={summaryFilterClick} variant="label-hidden" class="dateFilterOption">
                               </lightning-combobox>
   
                           </lightning-layout-item>
   
                           <lightning-layout-item size = "4">
                           
                               <lightning-button-icon icon-name="utility:refresh"  
                               alternative-text="Refresh" class="slds-m-left_medium slds-float_right slds-m-right_none" 
                               title="Refresh" onclick={getSummaryData} variant="brand"> 
                               </lightning-button-icon>        
                                   
                           
                           </lightning-layout-item>
                       </lightning-layout> 
                           
   
                   </div>
               </lightning-card>
           </div>
           <!-- **************************** End of SUMMARY DASHBOARD **************************** -->
           
           <template if:true={sortSearchConfirm}>
            <!-- Modal/Popup Box LWC starts here -->
            <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open applyCustomModalClass">
                <div class="slds-modal__container" >
                    <!-- Modal/Popup Box LWC header here -->
                    <header class="slds-modal__header">
                        <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick={closeSortSearchConfirm}>
                            <lightning-icon icon-name="utility:close"
                                alternative-text="close"
                                variant="inverse"
                                size="small" onclick={closeRecordType}></lightning-icon>
                            <span class="slds-assistive-text">Close</span>
                        </button>
                        <h2 id="modal-heading-02" class="slds-text-heading_medium slds-hyphenate">Confirm</h2>
                    </header>
                    <!-- Modal/Popup Box LWC body starts here -->
                    <div class="slds-modal__content slds-p-top_x-small slds-p-left_x-small slds-p-bottom_x-small slds-p-right_x-small" id="modal-content-id-1">
                        <p class="slds-text-heading_small slds-text-align_center"> Are you sure? The Selected Records will be discarded!</p>
                    </div>
                    <!-- Modal/Popup Box LWC footer starts here -->
                    <footer class="slds-modal__footer">
                        <button class="slds-button slds-button_neutral" onclick={closeSortSearchConfirm} title="Cancel">Cancel</button>
                        <button class="slds-button slds-button_brand" onclick={discardSortSearchConfirm} type="submit" title="OK">Yes!</button>
                    </footer>
                </div>
            </section>
            <div class="slds-backdrop slds-backdrop_open"></div>
        </template> 
        
        
           <!-- **************************** MODAL **************************** -->
       
           <template if:true={isModalOpen}>
   
               <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open applyCustomModalClass">
                   <div class={modalClass} >
                      <!--The Header-->
                       <header class="slds-modal__header">
                           <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick={closeModal}>
                               <lightning-icon icon-name="utility:close"
                                   alternative-text="close"
                                   variant="inverse"
                                   size="small" onclick={toggleModal}></lightning-icon>
                               <span class="slds-assistive-text">Close</span>
                           </button>
                           <h2 id="modal-heading-01" class="slds-text-heading_medium slds-hyphenate">{modalTitle}</h2>
                       </header>
   
                       <!--The Body-->
                       <div class="slds-modal__content slds-p-top_x-small slds-p-left_x-small slds-p-bottom_x-small slds-p-right_x-small" id="modal-content-id-2">
                           
                           <template if:false={editForm}> 
                               
                               <!-- For Self Assign-->
                               <template if:true={confirmModal}>
                                   <p class="slds-text-heading_small slds-text-align_center">
                                       Are you sure you want to Assign <b>{selectedAkamCaseId}</b> to yourself?  
                                   </p>
           
                               </template>
                               
                               <!-- For External Dependency-->
                               <template if:false={confirmModal}>
                                   <div class= "widthFull">
                                       <lightning-datatable
                                       key-field="Id"
                                       data={externalDependancies}
                                       columns={edColumns}
                                       hide-checkbox-column=false
                                       > 
                                       </lightning-datatable> 
                                   </div>
                               </template>
                           
                           </template>
   
                           <!--For Case Updates-->
                           <template if:true={editForm}> 
                               <lightning-record-edit-form record-id=""
                                   object-api-name="Case" onsubmit={dummySubmit} record-type-id={billingRecordTypeId} class="updateFormClass">
   
                                   <template if:true={toggleValue}>
                                       
                                       <label for="AccountId" class="slds-form-element__label slds-m-left_xxx-small">Account</label>
                                       <lightning-input-field id="AccountId" field-name="AccountId" data-id="AccountId" class="recordFormInput" variant="label-hidden">
                                       </lightning-input-field>
   
                                       <lightning-input-field field-name="Origin" data-id="Origin" id="Origin" class="recordFormInput">
                                       </lightning-input-field>
   
                                       <lightning-input-field field-name="Solution_Summary__c" data-id="Solution_Summary__c" id="Solution_Summary__c" class="recordFormInput">
                                       </lightning-input-field>
                                               
                                       <lightning-input-field field-name="Service__c" data-id="Service__c" id="Service__c" class="recordFormInput">
                                       </lightning-input-field>                                                                
                                       
                                       <lightning-input-field field-name="Request_Type__c" data-id="Request_Type__c" id="Request_Type__c" class="recordFormInput">
                                       </lightning-input-field>
       
                                       <lightning-input-field field-name="Status" data-id="Status" id="Status" class="recordFormInput">
                                       </lightning-input-field>
                                </template>
   
                                   <template if:false={toggleValue}>
                                       
                                       <div style="height: 70vh !important">
                                           <label for="ownerId" class="slds-form-element__label slds-m-left_xxx-small" >Owner</label>
                                           <lightning-input-field id="OwnerId" field-name="IR_Manual_Invoice_Approved_by__c" variant="label-hidden" data-id="OwnerId" class="recordFormInput">
                                           </lightning-input-field>                                    
                                       </div>    
                                   
                                   </template>
   
                               </lightning-record-edit-form>    
                           </template>
                       </div>
   
                       <!-- The Footer-->
                       <template if:true={confirmModal}>
                           
                           <footer class="slds-modal__footer">
                               <template if:false={toggleValue}>
                                   <button class="slds-button slds-button_neutral" onclick={cashAppsOwner} title="Assign To Cash Apps">Assign To Cash Apps</button>    
                               </template>
                               <button class="slds-button slds-button_neutral" onclick={toggleModal} title="Cancel">Cancel</button>
                               <button class="slds-button slds-button_brand" onclick={updateRecord} type="submit" title="OK">{actionLabel}</button>
                           </footer>
       
                       </template>
                   </div>
               </section>
               <div class="slds-backdrop slds-backdrop_open"></div>
           </template> 
        
       
           
           <!-- **************************** Cases View **************************** -->    
           
           <div class="slds-card cardStyle" style="zoom: 90% !important">  
               <!-- Spinner -->
               <div>
                   <template if:true={loadSpinner}>
                       <div style="opacity: 0.7; " class="slds-spinner_container">
                           <lightning-spinner alternative-text="Loading" variant="brand" size="medium">
                           </lightning-spinner>
                       </div>
                   </template>
               </div>
   
               <!-- The Header -->
               <div class="slds-card__header slds-grid ">
                   
                   <header class="slds-media slds-media_center slds-has-flexi-truncate">
                       <div class="slds-media__figure slds-p-left_xx-small">
                           <lightning-icon icon-name="standard:case" size="medium" alternative-text="Cases" title="Cases">
                           </lightning-icon>
                       </div>
               
                       <div class="slds-media__body">
                           <div class="slds-card__header-title widthFull">
                               <lightning-layout class="widthFull">
                                   <!--The Title-->
                                   <lightning-layout-item size="3"> 
                                       <h1 class="slds-m-top_x-small titleFont" >{tableTitle}</h1>
                                   </lightning-layout-item>                        
                                   
                                   <!--Toggle Button-->
                                   <lightning-layout-item size="2" class="slds-p-left_medium customToggleButton"> 
                                       <lightning-input type="toggle" label="My Cases" checked
                                       onchange={toggleView}>
                                       </lightning-input>
                                   </lightning-layout-item>
                                   
                                   <!--Update Button-->
                                   <template if:true={toggleValue}>
                                       <lightning-layout-item size="4" class="slds-p-left_small slds-text-align_center"> 
                                           <lightning-button variant="brand" label="Update" onclick={performAction}></lightning-button>
                                       </lightning-layout-item>
                                   </template>
                                   
                                   <!--Change Owner-->
                                   <template if:false={toggleValue}>
                                       <lightning-layout-item size="4" class="slds-p-left_small slds-text-align_center"> 
                                           <lightning-button variant="brand" label="Change Owner" onclick={performAction}></lightning-button>
                                       </lightning-layout-item>
                                   </template>
                                   
                                   <!--New Button-->
                                   <lightning-layout-item size="4" class="slds-p-left_medium">
                                       <lightning-button variant="brand" label="New" onclick={openNewCase}></lightning-button>
                                   </lightning-layout-item>
                               
                               </lightning-layout>                        
                           </div>                
                       </div>
   
                       <!--Card Actions-->
                       <div class="slds-no-flex">                
                           <lightning-layout class = "slds-m-left_x-small">
                               
                               <lightning-layout-item size="3"> 
                                   <lightning-combobox
                                   name="columns"
                                   label="columns"
                                   value={columnToSearch}
                                   placeholder="All"
                                   options={options}
                                   onchange={handleChange} variant="label-hidden" class="columnToSearch">
                                   </lightning-combobox>
                               </lightning-layout-item>
                               
                               <lightning-layout-item size="7" > 
                                       <lightning-input value={caseSearchText} class="caseSearchText" placeholder="Search Cases..." type="search"
                                       name="Case Search" variant="label-hidden" onchange={searchCaseEvent}>
                                       </lightning-input>                                    
                               </lightning-layout-item>
                               
   
                               <lightning-layout-item size="2"> 
                                   <lightning-button-icon icon-name="utility:refresh"  
                                   alternative-text="Refresh" class="slds-m-left_x-small slds-float_right" 
                                   title="Refresh" onclick={refreshView} variant="brand"> 
                                   </lightning-button-icon>
                               
                               </lightning-layout-item>
                           </lightning-layout>
                       </div>
                   </header>
                   <!--End of Header-->
               </div>
               
               <div class="slds-card__body slds-card__body_inner" >
                   
                   <!-- THE TABLE-->
                   <div class={tableHeight} >
                       <lightning-datatable
                           key-field="Id"
                           data={pageData}
                           columns={columns}                    
                           default-sort-direction={defaultSortDirection} 
                           sorted-direction={sortDirection}
                           sorted-by={sortedBy}
                           onrowaction={handleRowAction}
                           onsort={onHandleSort}
                           max-row-selection="50"
                           selected-rows={selectedRows}
                           onrowselection={onSelection} 
                           enable-infinite-loading={enableLoading}
                           onloadmore={loadMoreData}                   
                           >
                       </lightning-datatable>
                   </div>    
   
                   <!-- THe Pagenation Buttons-->
                   <!-- <lightning-layout multiple-rows="true">
                       
                       <lightning-layout-item size="12" margin="around-small">
                       
                           <div class="slds-align_absolute-center">
                               <ul class="slds-button-group-row">
                                   <template if:true={hasPrev}>
                                       <li class="slds-button-group-item" >
                                           <button class="slds-button slds-button_neutral" onclick ={onPrev}> prev
                                           </button>
                                       </li>
                                   </template>
                                   <template for:each={pages} for:item= "pageNumber">
                                       <li class="slds-button-group-item" key={pageNumber}>
                                           <button data-id={pageNumber} class="slds-button slds-button_neutral pagenationButton"
                                               onclick={onPageClick}>{pageNumber}</button>
                                       </li>
                                   </template>
                                   <template if:true={hasNext}>
                                       <li class="slds-button-group-item" >
                                           <button class="slds-button slds-button_neutral" onclick={onNext}
                                               >next</button>
                                       </li>
                                   </template>
                               </ul>
                           </div>
                       
                       </lightning-layout-item>
           
                   </lightning-layout> -->
               </div>
           </div> 
   
   </template>