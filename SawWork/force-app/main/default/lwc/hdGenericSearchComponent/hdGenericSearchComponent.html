<template>
    <lightning-card variant="Narrow" title={componentTitle} icon-name="utility:record_lookup">
        <lightning-button-stateful slot="actions" label-when-off="Advanced Search" label-when-on="Advanced Search"
            icon-name-when-off="utility:search" icon-name-when-on="utility:search" onclick={handleAdvancedSearch}>
        </lightning-button-stateful>
        <div class="slds-m-around_small">
            <div class="slds-notify slds-notify_alert slds-alert_error" role="alert" if:true={isError}>
                <h2>{errorMessage}</h2>
            </div>
            <template if:false={showAdvancedSearch}>
                <c-hd-lookup id="input" search-placeholder={searchPlaceholder} onrecordsretrieved={handleSearchResults}
                    object-name={objectName} search-field={searchField} iconname={iconname}
                    metadata-fields={metadataFields}>
                </c-hd-lookup>
                <slot name="additionalSection"></slot>
            </template>
            <div>
                <template if:true={error}>
                    <template if:true={error.details}>
                        <template if:true={error.details.body}>
                            {error.details.body.message}
                        </template>
                    </template>
                </template>
            </div>
            <c-hd-advanced-search object-name={objectName} if:true={showAdvancedSearch} size={size}
                onsearchcriteriadecoded={handleSearchCriteriaDecoding}></c-hd-advanced-search>
            <div class="slds-panel slds-m-top_small" style="max-height: 300px;position:relative">
                <lightning-spinner alternative-text="Loading" size="medium" if:true={isLoading}></lightning-spinner>
                <lightning-tabset variant="scoped" active-tab-value={selectedTab}>
                    <lightning-tab label="Favourites" icon-name="utility:favorite" value="1">
                        <template if:true={displayFavNoDataImage}>
                            <c-hd-no-data-image></c-hd-no-data-image>
                        </template>
                        <template if:true={favourites}>
                            <ul class="slds-grid slds-wrap " data-id="container">
                                <template for:each={favourites} for:item="record">
                                    <li key={record.Id} class={lookupItemGridClass}>
                                        <c-hd-lookup-record-list key={record.Id} record={record} onselect={handleSelect}
                                            iconname={iconname} advanced-template="true" size={size}
                                            meta-data-fields={metadataFields} fieldname={searchField}>
                                        </c-hd-lookup-record-list>
                                    </li>
                                </template>
                            </ul>
                        </template>
                    </lightning-tab>
                    <lightning-tab label="Recent Items" icon-name="utility:clock" value="2">
                        <template if:true={displayMRUNoDataImage}>
                            <c-hd-no-data-image></c-hd-no-data-image>
                        </template>
                        <template if:true={mru}>
                            <ul class="slds-grid slds-wrap" data-id="container">
                                <template for:each={mru} for:item="record">
                                    <li key={record.Id} class={lookupItemGridClass}>
                                        <c-hd-lookup-record-list key={record.Id} record={record} onselect={handleSelect}
                                            iconname={iconname} advanced-template="true" size={size}
                                            meta-data-fields={metadataFields} fieldname={searchField}>
                                        </c-hd-lookup-record-list>
                                    </li>
                                </template>
                            </ul>
                        </template>
                    </lightning-tab>
                    <lightning-tab label="Search Results" icon-name="utility:search" value="3">
                        <template if:true={displayNoDataImage}>
                            <c-hd-no-data-image></c-hd-no-data-image>
                        </template>
                        <template if:false={selectedRecord}>
                            <template if:true={records}>
                                <ul class="slds-grid slds-wrap" data-id="container">
                                    <template for:each={records} for:item="record">
                                        <li key={record.Id} class={lookupItemGridClass}>
                                            <c-hd-lookup-record-list key={record.Id} record={record} size={size}
                                                advanced-template="true" onselect={handleSelect} iconname={iconname}
                                                meta-data-fields={metadataFields} fieldname={searchField}>
                                            </c-hd-lookup-record-list>
                                        </li>
                                    </template>
                                </ul>
                            </template>
                        </template>
                    </lightning-tab>
                </lightning-tabset>
            </div>
            <div>
                <template if:true={selectedRecord}>
                    <lightning-layout>
                        <lightning-layout-item>
                            <lightning-pill-container items={linkedItems}>
                            </lightning-pill-container>
                        </lightning-layout-item>
                    </lightning-layout>
                </template>
            </div>
        </div>
    </lightning-card>
</template>