<template>
    <div class={itemClass}>
        <div class="slds-media">
            <div class="slds-media__figure">
                <lightning-button-icon icon-name={stateIcon} size="small" variant="bare" onclick={toggleState}>
                </lightning-button-icon>
                <div class="slds-icon_container slds-icon-standard-task slds-timeline__icon" title="task">
                    <lightning-icon icon-name='standard:approval' size="medium">
                    </lightning-icon>
                </div>
            </div>
            <div class="slds-media__body">
                <div class="slds-grid slds-grid_align-spread slds-timeline__trigger">
                    <div class="slds-grid slds-grid_vertical-align-center slds-truncate_container_75 slds-no-space">
                        <h3 class="slds-truncate" title={itemTemplate.action_History_Description}>
                            <a href={itemTemplate.whoId}>
                                <strong>{itemTemplate.who} </strong>
                            </a>{itemTemplate.title}
                        </h3>
                        <span class="slds-p-horizontal_x-small">
                            <lightning-dynamic-icon if:true={itemTemplate.highlightActivity} type="eq">
                            </lightning-dynamic-icon>
                            <lightning-icon if:false={itemTemplate.highlightActivity} icon-name="utility:clock"
                                size="x-small">
                            </lightning-icon>
                        </span> <b>{itemTemplate.daysAgo}</b>
                    </div>
                    <div class="slds-timeline__actions slds-timeline__actions_inline">
                        <p class="slds-timeline__date">
                            <lightning-formatted-date-time value={itemTemplate.when} year="numeric" month="short"
                                day="2-digit" hour="numeric" minute="numeric">
                            </lightning-formatted-date-time>
                        </p>
                        <lightning-button-icon if:true={pastApprovalsExist} onclick={onShowPastApprovalsClicked}
                            alternative-text={expandCollapseText} icon-name={expandCollapseIcon} size="small">
                        </lightning-button-icon>
                    </div>
                </div>
                <article if:true={isExpanded} class="slds-box slds-timeline__item_details slds-theme_shade"
                    aria-hidden="false">
                    <template iterator:it={itemTemplate.approvals}>
                        <lightning-datatable key={it.value.incident_History_ID} hide-checkbox-column
                            show-row-number-column columns={columns} data={it.value.data} key-field="id">
                        </lightning-datatable>
                    </template>
                    <lightning-card if:true={showPastApprovals} title="Approval history">
                        <lightning-button-stateful slot="actions" selected label-when-off="Expand All"
                            label-when-on="Collapse All" icon-name-when-off="utility:expand_all"
                            icon-name-when-on="utility:collapse_all" onclick={handleExpandCollapseHistory}>
                        </lightning-button-stateful>
                        <lightning-accordion active-section-name={activeSections} allow-multiple-sections-open>
                            <template iterator:it={approvals}>
                                <lightning-accordion-section name={it.value.title} label={it.value.title}
                                    key={it.value.incident_History_ID}>
                                    <lightning-datatable key={it.value.incident_History_ID} hide-checkbox-column
                                        show-row-number-column columns={columns} data={it.value.data} key-field="id">
                                    </lightning-datatable>
                                </lightning-accordion-section>
                            </template>
                        </lightning-accordion>
                    </lightning-card>
                </article>
            </div>
        </div>
    </div>
</template>