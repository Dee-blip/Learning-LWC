<!--
  @description       : 
  @author            : apyati
  @team              : GSM
  @last modified on  : 02-09-2022
  @last modified by  : apyati
  Modifications Log
  Ver   Date         Author   Modification
  1.0   09-14-2021   apyati   SFDC-8036 added partneraccount
-->
<template>


    <template if:true={showSuccessCriteriaPopUp}>
        <c-success-criteria-component record-id={recordId} onclose={handleCloseSuccessCriteria}
            disable-save={disableBusinessGoals}></c-success-criteria-component>
    </template>

    <template if:true={showProductLinkPopUp}>
        <c-l2q_-chime-products-link onclose={handleClose}></c-l2q_-chime-products-link>
    </template>

    <template if:true={showContacts}>
        <c-l2q-chime-view-edit-contacts parent-id={recordId} account-id={accId}
            onclose={handleContactsClose} onclosecontacts={handleContactsClose} disable-buttons={responseDisable}>
        </c-l2q-chime-view-edit-contacts>
        <!--<c-l2q-chime-contact-list-component parent-id={recordId} account-id={chimedata.Account__c} onclose={handleContactsClose} onclosecontacts={handleContactsClose}></c-l2q-chime-contact-list-component>-->
    </template>

    <!--Submit for review modal-->
    <template if:true={showCaseView}>
        <c-l2q_-chime-view-case is-review-case-present={viewReviewCase}
            is-integration-case-present={viewIntegrationCase} integration-case-id={chimedata.Integration_Case_ID__c}
            review-case-id={chimedata.Review_Case_Id__c} oncancel={hideViewCase}>
        </c-l2q_-chime-view-case>
    </template>
    

    <!-- View all Std POC cases Modal.... Added By Ashin. @JIRA:- ESESP-6647 -->
    <!-- ********************************
    @Added By     Ashin Louis
    @Date         7/FEB/2022
    @Description  Here another component(child component : l2q_ChimeViewAllStdPstCases) is called
    @Parameters   ChimeID -{recordId} 
    ************************************* -->
     <template if:true={showCaseViewstdPOC}>
       <c-l2q_-chime-view-all-std-pst-cases oncancel={hideStdPocCaseView} chime-id={recordId}>
       </c-l2q_-chime-view-all-std-pst-cases>
    </template>
    

    <!--View Case modal-->
    <template if:true={showSubmitModal}>
        <c-l2q_-chime-submit-for-review record-id={recordId} oncancel={hideSubmitForReview}>
        </c-l2q_-chime-submit-for-review>
    </template>

    <!-- Product approval modal-->
    <template if:true={showProductApprovalModal}>
        <c-l2q_-chime-view-approvals chime-rec={chimedata} products={prolexicproducts} oncancel={hideProductApproval}>
        </c-l2q_-chime-view-approvals>
    </template>

    <!-- CLONE  modal-->
    <template if:true={showCloneModalPopup}>
        <c-l2q_-clone-chime-form chime-id={recordId} acc-id={accId} oncancel={hideCloneModal}>
        </c-l2q_-clone-chime-form>
    </template>

    <!-- POC DSRS  modal-->
    <template if:true={showPOCDSRModal}>
        <c-l2q_-chime-view-poc-dsrs chime-id={recordId} oppty-id={oppId}
            acc-id={accId} disable-actions={disableDSRActions} oncancel={hidePOCDSRs}>
        </c-l2q_-chime-view-poc-dsrs>
    </template>

    <!-- Complete History   modal-->
    <template if:true={showHistoryModal}>
        <c-l2q_-chime-view-history chime-id={recordId} oncancel={hideHistory}>
        </c-l2q_-chime-view-history>
    </template>


    <!--Submit for Case modal-->
    <template if:true={showCaseComponent}>
        <c-l2q_-chime-case-create chime-id={recordId} header-label={caseButtonLabel} button-label={caseButtonLabel}
            description={chimedata.Case_Description_UI__c} oncancel={hideCaseCreate}></c-l2q_-chime-case-create>
    </template>

    <template if:true={showPSTCaseComponent}>
        <!-- <c-l2q_-chime-case-create chime-id={recordId} header-label={caseButtonLabel} button-label={caseButtonLabel}
            description={chimedata.Case_Description_UI__c} oncancel={hideCaseCreate}></c-l2q_-chime-case-create> -->
        <c-l2q_-chime-p-s-t-case-create chime-id={recordId} header-label={caseButtonLabel}
            button-label={caseButtonLabel} description={chimedata.Case_Description_UI__c} oncancel={hidePSTCaseCreate}>
        </c-l2q_-chime-p-s-t-case-create>
    </template>

    <template if:true={showPSCaseComponent}>
        <!-- <c-l2q_-create-p-s-case-create chime-id={recordId} header-label={caseButtonLabel} button-label={caseButtonLabel}
        description={chimedata.Case_Description_UI__c} oncancel={hidePSCaseCreate}>
        </c-l2q_-create-p-s-case-create> -->
        <c-l2q_-chime-submit-for-review record-id={recordId} oncancel={hidePSCaseCreate}>
        </c-l2q_-chime-submit-for-review>
    </template>


    <!--Edit CHIME-->
    <template if:true={showEditForm}>
        <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true"
            aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open">
            <div class="slds-modal__container">
                <header class="slds-modal__header">
                    <div class="slds-text-heading_small">Edit CHIME</div>
                </header>
                <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1">
                    <p class="slds-var-p-horizontal_small">
                        <c-l2-q_-create-chime-form parentrecid={parentId}
                            implementaton-type={chimedata.Implementation_Type__c} chime-id={chimedata.Id}
                            partneraccountid={partneraccountid} partneraccountname={partneraccountname}
                            chime-form-name={chimedata.CHIME_Name__c} is-emergency={chimedata.Is_Emergency__c}
                            ispoc={chimedata.Is_POC_Demo__c} onclose={closeQA} is-p-o-c-disabled={POCDisable}
                            is-emergency-disabled={EmergencyDisabled} poc-type-value={chimedata.POC_Type__c}
                            is-work-at-risk={chimedata.Is_Work_At_Risk_Investment_Work__c} is-work-at-risk-disabled={WorkAtRiskDisabled}>
                        </c-l2-q_-create-chime-form>
                    </p>
                </div>
            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open"></div>
    </template>

    <!--div>
        &nbsp;&nbsp;
    </div-->

    <!--New header-->
    <template if:true={chimedata}>
        <div class="slds-page-header slds-page-header_record-home">
            <div class="slds-page-header__row">
                <div class="slds-page-header__col-title">
                    <div class="slds-media">
                        <div class="slds-media__figure">
                            <span class="slds-icon_container slds-icon-standard-opportunity">

                                <lightning-icon class="slds-icon slds-page-header__icon" icon-name="action:new_note"
                                    alternative-text="New Form" title="New Form"></lightning-icon>
                            </span>
                        </div>
                        <div class="slds-media__body">
                            <div class="slds-page-header__name">
                                <div class="slds-page-header__name-title">
                                    <div>
                                        <h3>
                                            <span class="slds-page-header__title slds-truncate"
                                                title="CHIME">{chimedata.CHIME_Name__c}</span>
                                        </h3>
                                    </div>

                                </div>
                                <template if:true={chimeReopened}>
                                    <div style="margin-left: 5px">
                                        <span class="slds-badge slds-theme_error slds-badge__icon slds-badge__icon_left"
                                            aria-describedby="int" onmouseover={mouseOver}
                                            onmouseout={mouseOut}>Reopened</span>
                                        <lightning-helptext content={Tooltiptext}></lightning-helptext>
                                    </div>
                                </template>
                                <template if:true={chimeAccepted}>
                                    <div style="margin-left: 5px;">
                                        <span
                                            class="slds-badge slds-theme_success slds-badge__icon slds-badge__icon_left">Accepted</span>
                                    </div>
                                </template>
                                <template if:true={isPOC}>
                                    <div style="margin-left: 5px;">
                                        <lightning-badge label="POC"></lightning-badge>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="slds-page-header__col-actions">
                    <div class="slds-page-header__controls">
                        <div class="slds-page-header__control">

                            <ul class="slds-button-group-list">
                                <template if:false={disableArchiveButton}>
                                    <li>
                                        <template if:true={ArchiveDisabled}> 
                                            <button class="slds-button slds-button_neutral"
                                            onclick={handleUnarchiveButton}>Unarchive/Show</button>
                                        </template>
                                        <template if:false={ArchiveDisabled}> 
                                            <button class="slds-button slds-button_neutral"
                                            onclick={handleArchiveButton}>Archive/Hide</button>
                                        </template>
                                    </li>
                                </template>
                                <template if:false={isPOC}>
                                    <li>
                                        <span>
                                            <c-chime-transition statusvalue={chimeStatus} chimeid={recordId}
                                                userpermission={permission} stage={formStage} onupdate={childUpdated}
                                                onreopenform={reopentext} onacceptedform={formAccepted}>
                                            </c-chime-transition>
                                        </span>
                                    </li>
                                </template>

                                <!--ESESP-5649 - Hiding Case creatio buttons for POC chime form-->
                                <template if:false={isPOC}>
                                    <li>
                                        <template if:true={disableSubmitReview}>
                                            <button class="slds-button slds-button_neutral"
                                                onclick={showSubmitForReview} disabled>Submit LOE Review Case</button>
                                        </template>
                                        <template if:false={disableSubmitReview}>
                                            <button class="slds-button slds-button_neutral"
                                                onclick={showSubmitForReview}>Submit LOE Review Case</button>
                                        </template>
                                    </li>
                                    <li>
                                        <template if:true={prolexicandApproval}>
                                            <template if:true={showCaseButton}>

                                                <button class="slds-button slds-button_neutral"
                                                    onclick={showCaseComponentModal}>Submit Integration Case</button>
                                            </template>
                                            <template if:false={showCaseButton}>
    
                                                <button class="slds-button slds-button_neutral"
                                                    onclick={showCaseComponentModal} disabled>Submit Integration
                                                    Case</button>
                                            </template>
                                        </template>
                                    </li>
                                    <li>
                                        <template if:true={showProductApprovalButton}>
                                            <button class="slds-button slds-button_neutral"
                                                onclick={showProductApproval}>Product Approvals</button>
                                        </template>

                                    </li>

                                </template>
                                <li>
                                    <template if:true={isPOC}>
                                        <template if:true={standardPoc}>
                                            <template if:true={pstStage}>
                                                <button class="slds-button slds-button_neutral"
                                                    onclick={showPSTCase}>Create PST Case</button>
                                            </template>
                                        </template>
                                        <template if:true={customPoc}>
                                            <template if:false={standImplEnter}>
                                                <!-- <button class="slds-button slds-button_neutral"
                                                    onclick={showPSCase}>Create PS Case</button> -->

                                                <template if:true={disableSubmitReview}>
                                                    <button class="slds-button slds-button_neutral"
                                                        onclick={showPSCase} disabled>Submit LOE Review Case</button>
                                                </template>
                                                <template if:false={disableSubmitReview}>
                                                    <button class="slds-button slds-button_neutral"
                                                        onclick={showPSCase}>Submit LOE Review Case</button>
                                                </template>
                                                    
                                                <template if:true={showCaseButton}>
                                                    <button class="slds-button slds-button_neutral"
                                                        onclick={showCaseComponentModal}>Submit Integration Case</button>
                                                </template>
                                                <template if:false={showCaseButton}>
        
                                                    <button class="slds-button slds-button_neutral"
                                                        onclick={showCaseComponentModal} disabled>Submit Integration
                                                        Case</button>
                                                </template>
                                            </template>
                                        </template>
                                        
                                        
                                    </template>
                                </li>

                                <li>
                                    <button data-id="btnId" disabled={disableEditButton}
                                        class="slds-button slds-button_neutral button-class" onclick={editChime}>Edit
                                    </button>
                                </li>

                                <template if:true={viewCase}>
                                    <li>
                                        <button class="slds-button slds-button_neutral" onclick={showViewCaseModal}>View
                                            Case</button>
                                    </li>
                                </template>

                                <!-- ********** @JIRA:- ESESP-6647 - Added by Ashin (7/FEB/2022): 'View Cases' button on the header component, to view all PST cases of current std POC chime-->
                                <template if:true={isPOC}>
                                        <template if:true={standardPoc}>
                                            <template if:true={isIntegrationStage}>
                                                <li>
                                                    <button class="slds-button slds-button_neutral" onclick={showViewCaseModalstdPOC}>View Cases</button>
                                                </li>
                                            </template>
                                        </template>
                                </template>
                                <!-- ********** @JIRA:- ESESP-6647 - Added by Ashin (7/FEB/2022): 'View Cases' button on the header component, to view all PST cases of current std POC chime-->

                                <!-- ********** @JIRA:- ESESP-6647 - Added by Ashin (7/FEB/2022): 'View Cases' button on the header component, to view all PST cases of current std POC chime, added on Apr 20, 2022--> 
                                <template if:true={isPOC}>
                                    <template if:true={standardPoc}>
                                        <template if:true={isStageClosed}>
                                            <li>
                                                <button class="slds-button slds-button_neutral" onclick={showViewCaseModalstdPOC}>View Cases</button>
                                            </li>
                                        </template>
                                    </template>
                            </template>
                            <!-- ********** @JIRA:- ESESP-6647 - Added by Ashin (7/FEB/2022): 'View Cases' button on the header component, to view all PST cases of current std POC chime, added on Apr 20, 2022-->
                                
                                <template if:true={showReviewCompleteButton}>
                                    <li>
                                        <button class="slds-button slds-button_neutral"
                                            onclick={confirmReviewCompletion}>Confirm review completion</button>
                                    </li>
                                </template>
                                <template if:true={showPOCDSRsButton}>
                                    <li>
                                        <button class="slds-button slds-button_neutral"
                                            onclick={showCloneModal}>Clone</button>
                                    </li>
                                    <li>
                                        <button class="slds-button slds-button_neutral" onclick={showPOCDSRs}> Manage
                                            DSRs</button>
                                    </li>
                                </template>
                                <li>
                                    <button class="slds-button slds-button_neutral"
                                        onclick={handleContactsOpen}>View/Edit Contacts</button>
                                </li>
                                <li>
                                    <button class="slds-button slds-button_neutral" onclick={showHistory}>View
                                        History</button>
                                </li>

                                <!--li>
                                    <div class="slds-dropdown-trigger slds-dropdown-trigger_click">
                                        <button class="slds-button slds-button_icon slds-button_icon-border-filled"
                                            aria-haspopup="true" title="More Actions">
                                            <svg class="slds-button__icon" aria-hidden="true">
                                                <use xlink:href="/assets/icons/utility-sprite/svg/symbols.svg#down">
                                                </use>
                                            </svg>
                                            <span class="slds-assistive-text">More Actions</span>
                                        </button>
                                    </div>
                                </li-->
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="slds-page-header__row slds-page-header__row_gutters">
                <div class="slds-page-header__col-details">
                    <div class="slds-grid slds-gutters slds-wrap">
                        <div class="slds-col">
                            <div class="slds-text-title slds-truncate" title="Account Name">Account Name</div>
                            <div class="slds-text-title slds-truncate" style="word-wrap: break-word; width:150px;"
                                title={accName}>
                                <a href={accountLink} target="_blank">{accName}</a>
                            </div>
                        </div>
                        <div class="slds-col">
                            <div class="slds-text-title slds-truncate" title="Opportunity Name">Opportunity Name</div>
                            <template if:true={oppId}>
                                <div class="slds-text-title slds-truncate" title={oppName}
                                    style="word-wrap: break-word; width:150px;">
                                    <a href={opportunityLink} target="_blank">{oppName}</a>
                                </div>
                            </template>
                        </div>
                        <div class="slds-col">
                            <div class="slds-text-title slds-truncate" title="Opportunity Name">Partner Involved</div>
                            <template if:true={chimedata.Partner_Involved__c}>
                                <div class="slds-text-title slds-truncate" title={chimedata.Partner_Involved__r.Name}
                                    style="word-wrap: break-word; width:150px;">
                                    <a href={partnerAccountLink}
                                        target="_blank">{chimedata.Partner_Involved__r.Name}</a>
                                </div>
                            </template>
                        </div>
                        <div class="slds-col">
                            <div class="slds-text-title slds-truncate" title="Implementation Type">Implementation Type
                            </div>
                            <div class="slds-truncate" title={chimedata.Implementation_Type__c}>
                                {chimedata.Implementation_Type__c}</div>
                        </div>
                        <template if:false={isPOC}>
                            <div class="slds-col">
                                <div class="slds-text-title slds-truncate" title="Is Emergency?">Is Emergency?</div>
                                <div class="slds-truncate" title={chimedata.Implementation_Type__c}>
                                    <template if:true={chimedata.Is_Emergency__c}>Yes</template>
                                    <template if:false={chimedata.Is_Emergency__c}>No</template>
                                </div>
                            </div>
                        </template>
                        <template if:false={isPOC}>
                            <div class="slds-col">
                                <div class="slds-text-title slds-truncate" title="Is Work At Risk (Investment Work)?">Is Work At Risk (Investment Work)?</div>
                                <div class="slds-truncate" title={chimedata.Implementation_Type__c}>
                                    <template if:true={chimedata.Is_Work_At_Risk_Investment_Work__c}>Yes</template>
                                    <template if:false={chimedata.Is_Work_At_Risk_Investment_Work__c}>No</template>
                                </div>
                            </div>
                        </template>
                        <div class="slds-col">
                            <div class="slds-text-title slds-truncate" title="Success Criteria">Business Goals</div>
                            <div class="slds-truncate" title="Hyperlink">
                                <a onclick={handleOpenSuccessCriteria} href="#">Click to view</a>
                            </div>
                        </div>
                        <div class="slds-col">
                            <div class="slds-text-title slds-truncate" title="Created By">Created By</div>
                            <div class="slds-truncate" title={accName}>
                                <a href={userLink} target="_blank">{chimedata.CreatedBy.Name}</a>
                            </div>
                        </div>
                        <!--ESESP-5649 Hiding LOE review Status column for POC Chime-->
                        <template if:false={isPOC}>
                            <div class="slds-col">
                                <div class="slds-text-title slds-truncate" title="LOE Review Status">LOE Review Status
                                </div>
                                <div class="slds-truncate" title={chimedata.LOE_Review_Status__c}>
                                    {chimedata.LOE_Review_Status__c}
                                </div>
                            </div>
                        </template>
                        <template if:true={isPOC}>
                            <template if:false={standardPoc}>
                                <template if:false={standImplEnter}>
                                    <div class="slds-col">
                                        <div class="slds-text-title slds-truncate" title="LOE Review Status">LOE Review Status
                                        </div>
                                        <div class="slds-truncate" title={chimedata.LOE_Review_Status__c}>
                                            {chimedata.LOE_Review_Status__c}
                                        </div>
                                    </div>
                                </template>
                            </template>
                        </template>


                        <!--div class="slds-col">
                            <c-chime-transition statusvalue={chimeStatus} chimeid={recordId} userpermission={permission}
                                stage={formStage} onupdate={childUpdated}></c-chime-transition>
                        </div-->
                        <template if:false={hideLOE}>
                            <div class="slds-col">
                                <div class="slds-text-title slds-truncate" title="Quick LOEs">Quick LOEs</div>
                                <div class="slds-truncate" title="Hyperlink">
                                    <a onclick={handleLinksOpen} href="#">Click to view all</a>
                                </div>
                            </div>
                            <div class="slds-col">
                                <div class="slds-text-title slds-truncate" title="LOE Value">LOE Value</div>
                                <div class="slds-truncate" title={chimedata.Total_LoE__c}>{chimedata.Total_LoE__c}</div>
                            </div>
                        </template>



                        <!--<template if:true={viewCase}>
                            
                            <div class="slds-col">
                                <div class="slds-text-title slds-truncate" title="View Case">View Case</div>
                                <template if:true={viewIntegrationCase}>
                                    <div title="Hyperlink">
                                        <a class="slds-float_right" target="_blank" onclick={handleViewCase}>View
                                            Integration Case</a>
                                    </div>
                                </template>
                                <template if:true={viewReviewCase}>
                                    <div title="Hyperlink">
                                        <a class="slds-float_right" target="_blank" onclick={handleViewReviewCase}>View
                                            Review Case</a>
                                    </div>
                                </template>
                            </div>
                        </template>-->

                        <div class="slds-col">
                            <div class="slds-text-title slds-truncate" title="Sign Off">Sign Off</div>
                            <div class="slds-truncate" title={chimedata.Sign_Off__c}>
                                <lightning-input data-id="signOff" type="checkbox" checked={chimedata.Sign_Off__c}
                                    disabled>
                                </lightning-input>
                            </div>
                        </div>

                        <template if:true={showApprovalStatus}>
                            <div class="slds-col">
                                <div class="slds-text-title slds-truncate" title="Approval Status">Product Approval
                                    Status</div>
                                <div class="slds-truncate" title={chimedata.Product_Approval_Status__c}>
                                    {chimedata.Product_Approval_Status__c}
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
            </div>
        </div>
    </template>
</template>