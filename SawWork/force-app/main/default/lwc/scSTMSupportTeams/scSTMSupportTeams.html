<template>
    <!-- Spinner loading conditionally-->
    <template if:true={loadSpinner}>
        <div class="forceModalSpinner testModal" style="z-index: 99 !important">
            <div class="modal-glass" style="opacity: 0.2;">&nbsp;</div>
            <div class="forceInlineSpinner indicatorContainer" aria-hidden="false" role="alert"
                data-aura-class="forceInlineSpinner">
                <div class="forceDotsSpinner" data-aura-class="forceDotsSpinner">
                    <div class="slds-spinner slds-spinner_brand slds-spinner_medium" role="status">
                        <span class="slds-assistive-text">Loading...</span>
                        <div class="slds-spinner__dot-a"></div>
                        <div class="slds-spinner__dot-b"></div>
                    </div>
                </div>
            </div>
        </div>
    </template>
    <lightning-card>
        <div data-id="mainTableDiv">
            <article class="slds-card">
                <div class="slds-page-header"
                    style="background-color: #e0e5ee;border-radius: 5px;margin-left: 5px; margin-right: 5px;">
                    <div class="slds-page-header__row">
                        <div class="slds-page-header__col-title">
                            <div class="slds-media">
                                <div class="slds-media__figure">
                                    <lightning-icon icon-name="standard:groups" alternative-text="Support Team"
                                        size="medium" class="slds-m-top_xxx-small" title="Support Team">
                                    </lightning-icon>
                                </div>
                                <div class="slds-media__body">
                                    <div class="slds-page-header__name">
                                        <div class="slds-page-header__name-title">
                                            <h1>
                                                <span
                                                    class="slds-page-header__title slds-truncate slds-align-middle clip-text slds-line-clamp slds-m-right--xx-small slds-m-top_x-small">Support
                                                    Teams ({filteredList.length})</span>
                                            </h1>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="slds-page-header__col-actions">
                            <div class="slds-page-header__controls">
                                <div class="slds-page-header__control"
                                    style="margin-top: 2px;margin-left: 10px; margin-right: 10px;">
                                    <template if:true={isManager}>
                                        <lightning-button label="New Team" title="Create New Team"
                                            onclick={handleNewTeam} class="slds-m-top_xxx-small"></lightning-button>
                                    </template>
                                </div>
                                <div class="slds-page-header_control"
                                    style="margin-top: 2px;margin-left: 10px; margin-right: 10px;">
                                    <lightning-button-icon icon-name="utility:refresh" class="" onclick={refresh}
                                        variant="brand" name="refreshQueue" alternative-text="Refresh" title="Refresh">
                                    </lightning-button-icon>
                                </div>
                                <div class="slds-page-header_control"
                                    style="margin-top: -8px;margin-left: 10px; margin-right: 10px;">
                                    <div onkeypress={keycheck}>
                                        <lightning-input type="text" placeholder="Search Team..." name="searchTeam"
                                            onblur={handleSearch} value={searchTeamKey}
                                            class="searchText slds-m-left_small"></lightning-input>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </article>
            <c-sc-s-t-m-cell-edit-custom-datatype class="mainTable" key-field="Id" data={currentPageData}
                hide-checkbox-column="true" columns={mainTableColumns} onrowaction={handleRowAction} sorted-by={sortBy}
                sorted-direction={sortDirection} onsort={updateColumnSorting}
                onshowaccountdetail={handleShowTeamDetails}></c-sc-s-t-m-cell-edit-custom-datatype>
            <div class="slds-align_absolute-center" style="margin-top:5px">
                <template if:true={arePagesMoreThanOneMainTable}>
                    <ul class="slds-button-group-row">
                        <li class="slds-button-group-item">
                            <lightning-button variant="neutral" label="First" name="firstMainTable" onclick={onFirst}>
                            </lightning-button>
                        </li>
                        <template if:true={hasPrev}>
                            <li class="slds-button-group-item">
                                <lightning-button variant="neutral" label="Prev" name="prevMainTable" onclick={onPrev}>
                                </lightning-button>
                            </li>
                        </template>
                        <template for:each={pagesList} for:item="pageNumber">

                            <li class="slds-button-group-item" key={pageNumber}>
                                <lightning-button variant="neutral" label={pageNumber} name="mainTablePageButton"
                                    onclick={onPageClick}></lightning-button>
                            </li>
                        </template>
                        <template if:true={hasNext}>
                            <li class="slds-button-group-item">
                                <lightning-button variant="neutral" label="Next" name="nextMainTable" onclick={onNext}>
                                </lightning-button>
                            </li>
                        </template>
                        <li class="slds-button-group-item">
                            <lightning-button variant="neutral" label="Last" name="lastMainTable" onclick={onLast}>
                            </lightning-button>
                        </li>
                    </ul>
                    <span style="margin-left:15px;font-size:15px;color:#1876F2;">Page {pageMainTable} of
                        {pages.length}</span>
                </template>
            </div>
        </div>
        <template if:true={isModalOpen}>
            <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true"
                aria-describedby="modal-content-id-1" class={modalClass}>
                <div class="slds-modal__container">
                    <header class="slds-modal__header">
                        <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse"
                            title="Close" onclick={closeModal}>
                            <lightning-icon icon-name="utility:close" alternative-text="close" variant="inverse"
                                size="small">
                            </lightning-icon>
                            <span class="slds-assistive-text">Close</span>
                        </button>
                        <h2 id="modal-heading-02" class="slds-text-heading_medium slds-hyphenate">{modalMessage}</h2>
                    </header>
                    <template if:true={isDeleteModalOpen}>
                        <div class="slds-modal__content slds-p-around_small" id="modal-content-id-1">
                            <p>Are you sure you want to delete this {deleteMessage}?</p>
                        </div>
                        <footer class="slds-modal__footer">
                            <button class="slds-button slds-button_neutral" onclick={closeModal}
                                title="Cancel">Cancel</button>
                            <button class="slds-button slds-button_brand" onclick={confirmDelete}
                                title="Delete">Delete</button>
                        </footer>
                    </template>
                    <template if:true={isCrEditModalOpen}>
                        <lightning-record-edit-form record-id={recordId} object-api-name={selectedObject}
                            onsuccess={handleSuccess} onerror={handleError}>
                            <div class="slds-modal__content slds-p-around_small" id="modal-content-id-2">
                                <h3 class="slds-section__title slds-theme--shade">
                                    <span class="section-header-title slds-p-horizontal--small slds-truncate">
                                        Information
                                    </span>
                                </h3>
                                <lightning-layout multiple-rows>
                                    <template for:each={sections} for:item="field">
                                        <lightning-layout-item key={field.fieldOrder} size="6"
                                            class="slds-p-horizontal_x-small slds-p-vertical_small">
                                            <template if:true={field.teamDefaultValue}>
                                                <lightning-input-field field-name={field.fieldName} value={selectedTeam}
                                                    required></lightning-input-field>
                                            </template>
                                            <template if:false={field.teamDefaultValue}>
                                                <lightning-input-field field-name={field.fieldName} required>
                                                </lightning-input-field>
                                            </template>

                                        </lightning-layout-item>
                                    </template>
                                </lightning-layout>
                            </div>
                            <footer class="slds-modal__footer">
                                <div class="slds-align_absolute-center">
                                    <lightning-button class="slds-m-horizontal_xx-small" variant="neutral"
                                        label="Cancel" onclick={closeModal}> </lightning-button>
                                    <lightning-button class="slds-m-horizontal_xx-small" variant="brand" type="submit"
                                        label="Save"> </lightning-button>
                                </div>
                            </footer>
                        </lightning-record-edit-form>
                    </template>
                </div>
            </section>
            <div class="slds-backdrop slds-backdrop_open"></div>
        </template>

        <template if:true={showSubTable}>
            <div style="float:right;width:60%">
                <div style="float:left;width:5%">
                    <lightning-button variant="brand" class="expander" label=">>" title="Show Full Screen"
                        onclick={handleExpansion}></lightning-button>
                </div>
                <div style="float:right;width:95%" class="slds-p-horizontal_medium slds-p-right_small">
                    <article class="slds-card">
                        <div class="slds-page-header" style="background-color: #e0e5ee;">
                            <div class="slds-page-header__row">
                                <div class="slds-page-header__col-title">
                                    <div class="slds-media">
                                        <div class="slds-media__figure">
                                            <lightning-icon icon-name="standard:groups" alternative-text="Support Team"
                                                size="medium" class="slds-m-top_xxx-small" title="Support Team">
                                            </lightning-icon>
                                        </div>
                                        <div class="slds-media__body">
                                            <div class="slds-page-header__name">
                                                <div class="slds-page-header__name-title">
                                                    <h1>
                                                        <span>Support Team</span>
                                                        <span
                                                            class="slds-page-header__title slds-truncate slds-align-middle clip-text slds-line-clamp"
                                                            style="font-size:18px;">{selectedTeamName}</span>
                                                    </h1>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </article>
                    <br>
                    <div style="height:30vh">
                        <article class="slds-card">
                            <div class="slds-page-header" style="background-color: #e0e5ee;">
                                <div class="slds-page-header__row">
                                    <div class="slds-page-header__col-title">
                                        <div class="slds-media">
                                            <div class="slds-media__figure">
                                                <lightning-icon icon-name="standard:person_account"
                                                    alternative-text="Support Team Account" size="medium"
                                                    class="slds-m-top_xxx-small" title="Support Team Account">
                                                </lightning-icon>
                                            </div>
                                            <div class="slds-media__body">
                                                <div class="slds-page-header__name">
                                                    <div class="slds-page-header__name-title">
                                                        <h2>
                                                            <span
                                                                class="subHeader slds-page-header__title slds-truncate slds-align-middle clip-text slds-line-clamp slds-m-right--xx-small slds-m-top_x-small">Support
                                                                Team Accounts ({teamAccountList.length})</span>
                                                        </h2>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="slds-page-header__col-actions">
                                        <div class="slds-page-header__controls">
                                            <div class="slds-page-header__control">
                                                <ul class="slds-button-group-list">
                                                    <li>
                                                        <template if:true={isManager}>
                                                            <lightning-button label="New Account"
                                                                title="Create New Account" onclick={handleNewAccount}
                                                                class="slds-m-top_xxx-small"></lightning-button>
                                                        </template>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </article>
                        <lightning-datatable class="slds-m-top_small" key-field="Id" data={teamAccountList}
                            hide-checkbox-column="true" columns={accountTableColumns}
                            onrowaction={handleAccountRowAction}></lightning-datatable>
                    </div>
                    <br>
                    <div style="height:30vh" class="slds-m-top_xx-large">
                        <article class="slds-card">
                            <div class="slds-page-header" style="background-color: #e0e5ee;">
                                <div class="slds-page-header__row">
                                    <div class="slds-page-header__col-title">
                                        <div class="slds-media">
                                            <div class="slds-media__figure">
                                                <lightning-icon icon-name="standard:team_member"
                                                    alternative-text="Support Team Member" size="medium"
                                                    class="slds-m-top_xxx-small" title="Support Team Member">
                                                </lightning-icon>
                                            </div>
                                            <div class="slds-media__body">
                                                <div class="slds-page-header__name">
                                                    <div class="slds-page-header__name-title">
                                                        <h2>
                                                            <span
                                                                class="subHeader slds-page-header__title slds-truncate slds-align-middle clip-text slds-line-clamp slds-m-right--xx-small slds-m-top_x-small">Support
                                                                Team Members ({teamMembersList.length})</span>
                                                        </h2>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="slds-page-header__col-actions">
                                        <div class="slds-page-header__controls">
                                            <div class="slds-page-header__control">
                                                <ul class="slds-button-group-list">
                                                    <li>
                                                        <template if:true={isManager}>
                                                            <lightning-button label="New Member"
                                                                title="Create New Member" onclick={handleNewMember}
                                                                class="slds-m-top_xxx-small"></lightning-button>
                                                        </template>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </article>
                        <lightning-datatable class="slds-m-top_small" key-field="Id" data={teamMembersList}
                            hide-checkbox-column="true" columns={memberTableColumns}
                            onrowaction={handleMemberRowAction}></lightning-datatable>
                    </div>
                </div>
            </div>
            <div style="clear:both"></div>
        </template>
    </lightning-card>
</template>