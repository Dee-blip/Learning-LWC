<template>
    <lightning-card>
        <lightning-spinner if:true={state.displaySpinner} variant="brand" size="medium" data-id="spinner">
        </lightning-spinner>
        <h3 slot="title">
            <lightning-layout>
                <lightning-layout-item class="slds-size_0.5-of-12 slds-p-right_x-small">
                    <lightning-icon icon-name="utility:reassign" size="small">
                    </lightning-icon>
                </lightning-layout-item>
                <lightning-layout-item class="slds-size_11.5-of-12 slds-p-top_xx-small">Technical Support Tier
                </lightning-layout-item>
            </lightning-layout>
        </h3>
        <lightning-button-icon icon-name="utility:edit" data-id="editButton" variant="bare" if:true={isEditAllowed}
            alternative-text="Edit" slot="actions" onclick={toggleState}></lightning-button-icon>
        <div class="slds-border_top slds-p-around_small">
            <lightning-layout if:false={state.hasAccess}>
                <lightning-layout-item size="2" style="margin-top: 10px;">
                    <lightning-icon icon-name="utility:block_visitor" size="large" alternative-text="No Access" title="No Access">
                    </lightning-icon>
                </lightning-layout-item>
                <lightning-layout-item size="10" style="margin-left:-20px;">
                    <lightning-formatted-rich-text
                        value="&lt;h1>You do not have access to modify the support information&lt;/h1>">
                    </lightning-formatted-rich-text>
                </lightning-layout-item>
            </lightning-layout>
            <lightning-record-view-form if:false={isRecordEdit} record-id={recordId} onload={onFormLoaded}
                data-id="recordViewForm" object-api-name="BMCServiceDesk__Incident__c">
                <lightning-layout multiple-rows>
                    <lightning-layout-item size="6">
                        <lightning-layout>
                            <lightning-layout-item>
                                <lightning-output-field field-name="Support_Type__c" data-id="supportLevel">
                                </lightning-output-field>
                            </lightning-layout-item>
                            <lightning-layout-item class="slds-p-top_xx-small slds-p-left_x-small">
                                <c-hd-support-icon support-level={state.supportLevel}></c-hd-support-icon>
                            </lightning-layout-item>
                        </lightning-layout>
                    </lightning-layout-item>
                    <lightning-layout-item size="6">
                        <lightning-output-field field-name="Dev_Resource__c"></lightning-output-field>
                    </lightning-layout-item>
                    <lightning-layout-item size="12">
                        <lightning-output-field field-name="JIRA_Link__c"></lightning-output-field>
                    </lightning-layout-item>
                </lightning-layout>
            </lightning-record-view-form>
            <lightning-record-edit-form onload={onFormLoaded} if:true={isRecordEdit} record-id={recordId}
                data-id="recordEditForm" onsuccess={handleSucess} onsubmit={handleSubmit} onerror={handleError}
                object-api-name="BMCServiceDesk__Incident__c">
                <lightning-messages></lightning-messages>
                <lightning-layout multiple-rows>
                    <lightning-layout-item size="12">
                        <lightning-layout horizontal-align="spread">
                            <lightning-layout-item size="11">
                                <lightning-input-field field-name="Support_Type__c" data-id="supportLevel"
                                    onchange={handleSupportTypeChange}></lightning-input-field>
                            </lightning-layout-item>
                            <lightning-layout-item class="slds-p-top_large" size="1">
                                <c-hd-support-icon support-level={state.supportLevel}></c-hd-support-icon>
                            </lightning-layout-item>
                        </lightning-layout>
                    </lightning-layout-item>
                    <template if:true={state.isDevResourceVisible}>
                        <lightning-layout-item size="12">
                            <lightning-input-field field-name="Dev_Resource__c" data-id="devResource" onchange={handleDevResourceChange}>
                            </lightning-input-field>
                        </lightning-layout-item>
                    </template>
                    <template if:true={state.isJIRAFieldVisible}>
                        <lightning-layout-item size="12">
                            <lightning-input-field field-name="JIRA_Link__c" data-id="jiraLink"></lightning-input-field>
                        </lightning-layout-item>
                    </template>
                    <lightning-layout-item size="12">
                        <lightning-button class="slds-p-left_xx-small" type="submit" label="Update record"
                            data-id="submitButton">
                        </lightning-button>
                    </lightning-layout-item>
                </lightning-layout>
            </lightning-record-edit-form>
        </div>
    </lightning-card>
</template>