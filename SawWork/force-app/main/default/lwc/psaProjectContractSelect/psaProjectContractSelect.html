<template >
    <c-psa-custom-toast auto-close-time="2000"></c-psa-custom-toast>
    <template if:true={spinner}>
        <div class="lwcloading" >
            <div class="slds-modal_large">
                <div role="status" class="slds-spinner slds-spinner_medium slds-spinner_brand">
                    <span class="slds-assistive-text">Loading</span>
                    <div class="slds-spinner__dot-a"></div>
                    <div class="slds-spinner__dot-b"></div>
                </div>
            </div>
        </div>
    </template>
    <lightning-card record-id={recordId} object-api-name="pse__Proj__c" >
        <div class="c-container slds-p-bottom_x-small" style="border-bottom: 1px solid rgb(221, 219, 218);box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.10);" >
            <lightning-layout multiple-rows="true">
                <lightning-layout-item size="1" >

                </lightning-layout-item>
                <lightning-layout-item size="3">
                    <div class="page-section page-left">
                        <div class="slds-p-horizontal_small">
                            <template if:true={options} >
                                <lightning-combobox data-key="filterDate"
                                        name="Status"
                                        label="Status"
                                        value={value}
                                        placeholder="Select Status"
                                        options={options} ></lightning-combobox>
                            </template>
                        </div>
                    </div>
                </lightning-layout-item>
                <lightning-layout-item  size="3">
                    <div class="page-section page-left">
                    </div>
                </lightning-layout-item>
                <lightning-layout-item  size="3">
                    <div class="page-section page-left slds-p-vertical_x-small slds-m-left_x-small">
                        <lightning-input type="text" data-key="filterProduct" value = ""  label="Enter Product Name" ></lightning-input>
                    </div>
                </lightning-layout-item>
                <lightning-layout-item size="12">
                    <lightning-layout>
                        <lightning-layout-item size="6" style=" text-align: right; " >
                            <div class="page-section page-left">
                                <lightning-button label="Filter"  title="Filter" onclick={filter} class="slds-m-left_x-small"></lightning-button>
                            </div>
                        </lightning-layout-item>
                       
                        <lightning-layout-item size="6">
                            <div class="page-section page-left">
                                <lightning-button label="Clear"  title="Clear" onclick={clear} class="slds-m-left_x-small"></lightning-button>
                            </div>
                        </lightning-layout-item>
                    </lightning-layout>
                </lightning-layout-item>

            </lightning-layout>
        </div>

        <div class="slds-m-around_x-small">
            <lightning-layout>
                <lightning-layout-item size="12" >
                    <lightning-layout>
                        <lightning-layout-item size="4" >
                        </lightning-layout-item>
                        <lightning-layout-item size="1" >
                            <div class="page-section page-left">
                                <lightning-button label="Expand All"  title="Expand All" onclick={expandAll} class="slds-m-left_x-small"></lightning-button>
                            </div>
                        </lightning-layout-item>
                        <lightning-layout-item size="1" >
                            <div class="page-section page-left">
                                <lightning-button label="Collapse All"  title="Collapse All" onclick={collapseAll} class="slds-m-left_x-small"></lightning-button>
                            </div>
                        </lightning-layout-item>
                        <lightning-layout-item size="1" >
                            <div class="page-section page-left">
                                <lightning-button label=" Save "  title=" Save " onclick={saveProject} class="slds-m-left_x-small"></lightning-button>
                            </div>
                        </lightning-layout-item>
                        <lightning-layout-item size="1" >
                            <div class="page-section page-left">
                                <lightning-button label="Cancel"  title="Cancel"  onclick={closeQuickAction} class="slds-m-left_x-small"></lightning-button>
                            </div>
                        </lightning-layout-item>
                        <lightning-layout-item size="4" >
                        </lightning-layout-item>

                    </lightning-layout>
                </lightning-layout-item>
            </lightning-layout>
        </div>
        <div class="slds-m-around_x-small scrollContainer" onscroll={handleScroll}>
            <div class="scrollArea"  >
                <template if:true={contractWithDetails}>
                    <table class="slds-table slds-table_cell-buffer slds-table_bordered slds-table_col-bordered contractselectTable" >
                        <thead>
                            <tr class="slds-line-height_reset" >
                                <th class="" scope="col"></th>
                                <th class="" scope="col" >Name</th>
                                <th class="" scope="col" >Account Name</th>
                                <th class="" scope="col" >Opportunity Name</th>
                                <th class="" scope="col" >Revision Effective Start Date</th>
                                <th class="" scope="col" >Effective Start Date</th>
                                <th class="" scope="col" >Effective End Date</th>
                                <th class="" scope="col" >Active</th>
                                <th class="" scope="col" >Parent Contract</th>
                                <th class="" scope="col" >Revision Contract Id</th>
                            </tr>
                            
                        </thead>
                        <tbody>
                            <template for:each={contractWithDetails} for:item="eachAcc" for:index="index" >
                                <tr class="slds-line-height_reset" key={eachAcc.contract.Id}  >
                                    <td key={eachAcc.contract.Id}  > <lightning-button class="lightning-button-custom-class" name={eachAcc.contract.Id} id={eachAcc.contract.Id} label="+"  onclick={hidefunc}></lightning-button> </td>
                                    <td key={eachAcc.contract.Id} style=" white-space: nowrap; " >
                                        <a href={eachAcc.hyperLink} value={eachAcc.contract.Id} >{eachAcc.contract.Name} </a>
                                    </td>
                                    <td key={eachAcc.contract.Id} style=" white-space: nowrap; " >
                                        <a  href={eachAcc.accountLink}>
                                            {eachAcc.contract.Account_Name__r.Name}
                                        </a>
                                    </td>
                                    <td key={eachAcc.contract.Id} >
                                        <template if:true={eachAcc.contract.Opportunity_Name__c} >
                                            {eachAcc.contract.Opportunity_Name__r.Name}
                                        </template>
                                    </td>
                                    <td key={eachAcc.contract.Id} >{eachAcc.contract.Revision_Effective_Start_Date__c}</td>
                                    <td key={eachAcc.contract.Id} >{eachAcc.contract.Effective_Start_Date__c}</td>
                                    <td key={eachAcc.contract.Id} >{eachAcc.contract.Effective_End_Date__c}</td>
                                    <td>
                                        <template if:true={eachAcc.contract.Active__c} >
                                            <lightning-input if:true={eachAcc.contract.Active__c} type="checkbox" checked disabled></lightning-input>
                                        </template>
                                        <template if:false={eachAcc.contract.Active__c} >
                                            <lightning-input if:false={eachAcc.contract.Active__c} type="checkbox" disabled></lightning-input>
                                        </template>
                                    </td>
                                    <td key={eachAcc.contract.Id} >
                                        <template if:true={eachAcc.contract.Parent_Contract__c} >
                                            <a href={eachAcc.parentContractLink} >
                                                {eachAcc.contract.Parent_Contract__r.Name}
                                            </a>
                                        </template>
                                    </td>
                                    <td key={eachAcc.contract.Id}  >{eachAcc.contract.Revision_Contract_Id__c}</td>
                                </tr>
                                <tr key={eachAcc.contract.Id} class="detailRow" data-key={eachAcc.contract.Id} style = "display:none" >
                                    <td colspan="10" >
                                        <div class="detailScrollContainer {eachAcc.contract.Id}"  onscroll={handleDetailScroll} id={index} >
                                            <table class="slds-table slds-table_cell-buffer slds-table_bordered slds-table_col-bordered detailScrollArea"  >
                                                <thead>
                                                    <th></th>
                                                    <th>Product</th>
                                                    <th>Effective Start Date</th>
                                                    <th>Effective End Date</th>
                                                    <th>Unit Price</th>
                                                    <th>Units High</th>
                                                    <th>Units Low</th>
                                                    <th>Record Type</th>
                                                    <th>Unit of Measure</th>
                                                    <th>Detail Id</th>
                                                </thead>
                                                <tbody>
                                                    <template for:each={eachAcc.childObjects} for:item="eachDetail"  for:index="detailIndex" >
                                                        <tr key={eachDetail.contractDetail.Id}>
                                                            <td>
                                                                <template if:true={eachDetail.selected}>
                                                                    <lightning-input type="checkbox" data-item={eachAcc.contract.Id} name={eachDetail.contractDetail.Id} checked data-key={eachDetail.contractDetail.Id} class="custom-checkbox" onclick={uncheckothers} ></lightning-input>
                                                                </template>
                                                                <template if:false={eachDetail.selected}>
                                                                    <lightning-input type="checkbox" data-item={eachAcc.contract.Id} name={eachDetail.contractDetail.Id} unchecked data-key={eachDetail.contractDetail.Id} id={index} data-id={detailIndex} class="custom-checkbox" onclick={uncheckothers} ></lightning-input>
                                                                </template>
                                                            </td>
                                                            <td> {eachDetail.contractDetail.Product__c} </td>
                                                            <td>{eachDetail.contractDetail.Effective_Start_Date__c}</td>
                                                            <td>{eachDetail.contractDetail.Effective_End_Date__c}</td>
                                                            <td>{eachDetail.contractDetail.Unit_Price__c}</td>
                                                            <td>{eachDetail.contractDetail.Units_High__c}</td>
                                                            <td>{eachDetail.contractDetail.Units_Low__c}</td>
                                                            <td>{eachDetail.contractDetail.Record_Type__c}</td>
                                                            <td>{eachDetail.contractDetail.Unit_of_Measure__c}</td>
                                                            <td>
                                                                <a href={eachDetail.hyperLink} > {eachDetail.contractDetail.Name} </a>
                                                            </td>
                                                        </tr>
                                                    </template>
                                                </tbody>
                                            </table>
                                        </div>
                                    </td>
                                </tr>
                            </template>
                            <tr class="headerLoader" style="display: none;" >
                                <td  style="text-align: center;display: table-cell; " colspan="10">
                                    <div class="slds-spinner_container">
                                        <div role="status" class="slds-spinner slds-spinner_medium slds-spinner_brand">
                                          <span class="slds-assistive-text">Loading</span>
                                          <div class="slds-spinner__dot-a"></div>
                                          <div class="slds-spinner__dot-b"></div>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </template>
            </div>
        </div>
        
        
    </lightning-card>
    
</template>