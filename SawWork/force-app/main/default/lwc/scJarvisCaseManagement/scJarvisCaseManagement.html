<template>
    <div class={caseDetailModalCss}>
        <template if:true={showCaseDetailModal}>
            <c-sc-jarvis-case-preview recordid={selectedCaseId} onclosecreateevent={closeCaseDetailModal}> </c-sc-jarvis-case-preview>
        </template>
    </div>

    <div class={caseCreateModalCss}>
        <c-sc-jarvis-case-create if:true={showCaseCreateModal} onclosecreateevent={closeCaseCreateModal} cloneid={cloneId}></c-sc-jarvis-case-create>
    </div>


    <div class={mainSectionCss}>
        <div class="main-section-body">
            <div class="flex">
                <div class="flex flex1">
                    <div class="slds-p-vertical_x-small  slds-p-right_x-large">
                        <lightning-combobox label={label.LB_CASES} options={mainFilterOptions} value={activeMaintab} onchange={handleViewChange}> </lightning-combobox>
                    </div>
                    <div class="slds-p-vertical_x-small slds-p-right_x-large flex" >
                        <c-sc-multiselect-combo label={label.LB_ACCOUNT} variant="standard" placeholder={label.LB_ACC_PLACEHOLDER} options={entitledAccounts}
                            label-all-selected={label.LB_ALL_ACCOUNTS} label-items-selected={label.LB_ACC_SELECTED} selected-items={selectedAccounts}
                            onselect={handleAccountSelection} required filteritems-label={label.LB_SELECTED_ACC} disabled={disableAccountSelection}
                            required-error-message={label.LB_ACCOUNT_REQ_ERROR} done-label={label.LB_APPLY} cancel-label={label.LB_CANCEL}
                            selectall-label={label.LB_SELECT_ALL} unselectall-label={label.LB_CLEAR_ALL}>

                        </c-sc-multiselect-combo>
                        <div style="padding-left:15px; display:flex; align-items: flex-end;" if:true={showAccountFilterToast}>
                            <div class="slds-media slds-media_center slds-has-flexi-truncate">
                                <div style="transform: scale(.9);">
                                    <lightning-icon icon-name="utility:info_alt" size="small"> </lightning-icon>
                                </div>
                                <div class="slds-p-left_xx-small">
                                    {label.LB_ACC_FILTER_ACTIVE}
                                </div>
                                <lightning-button label={label.LB_REMOVE_FILTER} variant="base" onclick={dismissFilterMsgAndselectAllAcc} class="slds-p-left_x-small">
                                </lightning-button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="slds-p-bottom_x-small slds-p-right_x-small newcase">
                    <lightning-button if:true={hasCaseCreateAccess} variant="brand" icon-name="utility:new" label={label.LB_NEW_CASE} title={label.LB_NEW_CASE} onclick={openNewCase} class="createBtn">
                    </lightning-button>
                </div>
            </div>

            <!-- *************************** HEADER **********************************************-->
            <div class="slds-p-top_x-small flex">
                <div>
                    <template if:true={showspinner}>
                        <div style="opacity: 0.7;" class="slds-spinner_container">
                            <lightning-spinner variant="brand" size="medium">
                            </lightning-spinner>
                        </div>
                    </template>
                </div>

                <div class="header-section flex1">
                    <div class="slds-media__body">
                        <div class="slds-page-header__name">
                            <div class="slds-page-header__name-title">
                                <h3>
                                    <span class="slds-text-heading_small slds-truncate">
                                        <b>{headerLabel}</b>
                                    </span>
                                </h3>
                            </div>
                        </div>
                        <p class="slds-page-header__name-meta">{label.LB_REFRESHED} <lightning-relative-date-time value={now}></lightning-relative-date-time>
                        </p>
                    </div>

                </div>

                <div class="slds-p-right_xx-small header-section">
                    <div class="slds-p-around_xx-small header-section">
                        <lightning-input type="search" onchange={handleSearch} placeholder={label.LB_SEARCH_THIS_LIST} style="z-index: 1; width: 17rem;" autocomplete="off">
                        </lightning-input>
                        <div class="colfilter" tabindex="-1">
                            <div class="colfilter-icon" style="display: inline-block;border-left-style: none;border-radius: 2px 0 0 2px;">
                                <button if:false={allColFilter} type="button" class="slds-button slds-button_brand"
                                    style="border-left-style: none; border-radius: 0 3px 3px 0; margin-left: -3px;">
                                    {activeFilterColumns.length}
                                    <lightning-icon icon-name="utility:filterList" size="x-small" class="slds-button__icon slds-button__icon_right" style="transform: scale(.9);"
                                        variant="inverse"></lightning-icon>
                                </button>

                                <button if:true={allColFilter} type="button" class="slds-button slds-button_neutral"
                                    style="border-radius: 3px 3px 3px 3px; background-color: #FFFFFF;">
                                    &nbsp;
                                    <lightning-icon icon-name="utility:filterList" size="x-small" class="slds-button__icon" style="transform: scale(.9);"
                                        variant="standard"></lightning-icon>
                                    &nbsp;
                                </button>
                            </div>

                            <div tabindex="-1" class="slds-dropdown slds-dropdown_right" style="min-width: 170px;">
                                <div class="slds-dropdown__list slds-dropdown_length-with-icon-10 slds-p-horizontal--x-small slds-p-top--x-small" style="width: max-content">
                                    <div>
                                        <h3><b>{label.LB_COLS_SEARCH}</b></h3>
                                    </div>
                                    <div class="slds-p-around--x-small">
                                        <lightning-checkbox-group options={caseFilterOptions} value={activeFilterColumns} onchange={handleColFilterChange} class="searchchkbox">
                                        </lightning-checkbox-group>
                                    </div>

                                    <div class="col-selectall slds-p-bottom_xx-small">
                                        <lightning-button-stateful label-when-off={label.LB_SELECT_ALL} label-when-on={label.LB_CLEAR_ALL} label-when-hover={label.LB_CLEAR_ALL}
                                            icon-name-when-off="utility:check" icon-name-when-on="utility:close" icon-name-when-hover="utility:close" selected={allColFilter}
                                            onclick={handleSelectAllColFilters}>
                                        </lightning-button-stateful>
                                    </div>
                                    <div if:false={activeFilterColumns.length} class="slds-p-bottom_xx-small slds-p-left_x-small invalid-inp">
                                        {label.LB_ERR_SELECT_COLUMN}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div>
                        <div class="slds-p-around_xx-small" style="display: inline-block;">
                            <lightning-button-menu alternative-text={label.LB_EXPORT_LIST} menu-alignment="right" tooltip={label.LB_EXPORT_LIST} icon-name="utility:download">
                                <lightning-menu-item if:false={searchStr} value={activeMaintab} label={downloadLabel} onclick={handleDownload}></lightning-menu-item>
                                <lightning-menu-item if:true={searchStr} value='displayedList' label={downloadDisplayListLabel} onclick={handleDownload}></lightning-menu-item>
                                <lightning-menu-item value="all" label={label.LB_ALL_CASES} onclick={handleDownload}></lightning-menu-item>
                            </lightning-button-menu>
                        </div>

                    </div>

                    <div class="slds-p-around_xx-small">
                        <lightning-button-icon alternative-text={label.LB_REFRESH_LIST} onclick={refreshTable} icon-name="utility:refresh"> </lightning-button-icon>
                    </div>
                </div>
            </div>
            <div class="slds-p-top_xx-small  slds-p-right_x-small">
                <lightning-tabset active-tab-value={activeSubtab} class="recordtypeTab">
                    <lightning-tab label={tabLabels.lbSubTabAll} value="All" onactive={handleActiveTab}>
                    </lightning-tab>

                    <lightning-tab label={tabLabels.lbSubTabTechnical} if:true={recordtypeTabVisibility.technical} value="Technical" onactive={handleActiveTab}>
                    </lightning-tab>

                    <lightning-tab label={tabLabels.lbSubTabSocc} if:true={recordtypeTabVisibility.managedSecurity} value="Managed Security" onactive={handleActiveTab}>
                    </lightning-tab>

                    <lightning-tab label={tabLabels.lbSubTabPs} if:true={recordtypeTabVisibility.profserv} value="Professional Services" onactive={handleActiveTab}>
                    </lightning-tab>

                    <lightning-tab label={tabLabels.lbSubTabAmg} if:true={recordtypeTabVisibility.amg} value="AMG" onactive={handleActiveTab}>
                    </lightning-tab>

                    <lightning-tab label={tabLabels.lbSubTabBilling} if:true={recordtypeTabVisibility.billing} value="Billing" onactive={handleActiveTab}>
                    </lightning-tab>
                </lightning-tabset>
            </div>

            <div class="datatableStyle  slds-p-right_x-small" style="padding-top: 0px; border-radius: 4px; margin-top: -25px;">
                <div class="table-border">
                    <lightning-datatable data={paginatedData} columns={columns} hide-checkbox-column=false key-field=id default-sort-direction='asc' sorted-direction={sortDirection}
                        sorted-by={sortedByColumnName} onsort={onHandleSort} wrap-text-max-lines=2 onrowaction={handleRowActions}></lightning-datatable>
                    {tabResultsMessage}
                </div>
                <div if:true={tableSize} class={paginationCss}>
                    <c-sc-pagination records={tableData} max-pagination-buttons="10" page-size={pageSize} onselect={handlePaginationSelect}></c-sc-pagination>
                </div>
            </div>
        </div>
    </div>
</template>