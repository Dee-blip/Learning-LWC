<template>
    <div if:true={showProgressIndicator} class="slds-theme_default slds-m-top_small slds-is-relative">
        <lightning-spinner if:true={isLoading}></lightning-spinner>
        <div class="slds-grid">
            <lightning-button-icon icon-name={expandCollapseIcon} onclick={onExpandCollapseClicked} style="width: 3%"
                class="slds-p-left_small slds-p-top_small slds-align_absolute-center">
            </lightning-button-icon>
            <lightning-layout multiple-rows class="slds-p-around_small" style="width: 97%">
                <lightning-layout-item size="12">
                    <table class="slds-m-top_x-small" style="table-layout: fixed;">
                        <tr>
                            <template iterator:it={listOfApprovals}>
                                <td key={it.value}>
                                    <div
                                        class="slds-text-align_center slds-truncate slds-text-heading_small slds-p-horizontal_xx-small">
                                        {it.value.displayName}
                                    </div>
                                </td>
                            </template>
                        </tr>
                    </table>
                </lightning-layout-item>
                <lightning-layout-item size="12">
                    <lightning-layout>
                        <lightning-layout-item style={firstColWidth}>
                        </lightning-layout-item>
                        <lightning-layout-item style={secondColWidth}>
                            <lightning-progress-indicator if:true={listOfApprovals} has-error={hasError}
                                current-step={currentStepIndex} type="base" variant="base">
                                <template iterator:it={listOfApprovals}>
                                    <lightning-progress-step class="stepColor" onstepfocus={onStepSelected}
                                        data-id={it.value.processWorkItemId} label={it.value.displayName}
                                        key={it.value.displayName} value={it.value.displayName}>
                                    </lightning-progress-step>
                                </template>
                            </lightning-progress-indicator>
                        </lightning-layout-item>
                    </lightning-layout>
                </lightning-layout-item>
                <lightning-layout-item size="12" if:false={isExpanded}>
                    <table class="slds-m-top_x-small" style="table-layout: fixed;">
                        <tr>
                            <template iterator:it={listOfApprovals}>
                                <td key={it.value}>
                                    <div key={it.value} class="slds-align_absolute-center"
                                        if:true={it.value.isApproved}>
                                        <lightning-icon icon-name="action:approval" size="xx-small"
                                            class="slds-m-right_xxx-small" alternative-text="Approved By">
                                        </lightning-icon>
                                        {it.value.approverName}
                                    </div>
                                    <div key={it.value} class="slds-align_absolute-center"
                                        if:true={it.value.isRejected}>
                                        <lightning-icon icon-name="action:close" size="xx-small"
                                            class="slds-m-right_xxx-small" alternative-text="Rejected By">
                                        </lightning-icon>
                                        {it.value.approverName}
                                    </div>
                                    <div key={it.value} class="slds-align_absolute-center"
                                        if:false={it.value.isApproved}>
                                        <div key={it.value} class="slds-align_absolute-center"
                                            if:false={it.value.isRejected}>
                                            <div key={it.value} class="slds-align_absolute-center"
                                                if:true={it.value.isSubmitted}>
                                            </div>
                                            <div key={it.value} if:false={it.value.isSubmitted}>
                                                <div key={it.value} class="slds-align_absolute-center"
                                                    if:true={it.value.enableApproveForCurrentUser}>
                                                    <lightning-button-icon alternative-text="Approve"
                                                        class="slds-m-right_xx-small approveButton slds-align_absolute-center"
                                                        size="small" variant="bare-inverse" icon-name="action:approval"
                                                        data-id={it.value.processWorkItemId} onclick={onApproveClicked}>
                                                    </lightning-button-icon>
                                                    <lightning-button-icon alternative-text="Reject" size="small"
                                                        variant="bare-inverse"
                                                        class="rejectButton slds-align_absolute-center"
                                                        data-id={it.value.processWorkItemId} onclick={onRejectClicked}
                                                        icon-name="action:reject">
                                                    </lightning-button-icon>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                            </template>
                        </tr>
                    </table>
                </lightning-layout-item>
            </lightning-layout>
        </div>
        <div if:true={isExpanded} class="slds-m-around_small">
            <c-hd_-c-m-r_-approvals_-details_-view selected-step={selectedStep} approval-details={listOfApprovals}
                onapproverejectclick={onChildApproveRejectClicked}>
            </c-hd_-c-m-r_-approvals_-details_-view>
        </div>
    </div>
    <c-hd-modal-popup title={popupTitle} data-id="modalPopup">
        <lightning-textarea name="input1" label="Comments" onchange={onCommentsEntered} class="textAreaHeight">
        </lightning-textarea>
        <div slot="footer" class="slds-float_right">
            <lightning-layout vertical-align="center" horizontal-align="spread" multiple-rows="true"
                class="slds-p-horizontal_medium">
                <lightning-layout-item>
                    <button class="slds-button slds-button_brand"
                        onclick={onModalApproveRejectClicked}>{buttonLabel}</button>
                    <button class="slds-button slds-button_neutral" onclick={onCloseModal}>Cancel</button>
                </lightning-layout-item>
            </lightning-layout>
        </div>
    </c-hd-modal-popup>
</template>