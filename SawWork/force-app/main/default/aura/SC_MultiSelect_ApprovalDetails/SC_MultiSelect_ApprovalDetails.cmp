<!--=====================================================================================================+
    Component name      :   SC_MultiSelect_ApprovalDetails
    Author              :   Vikas
    Created             :   07-Feb-19
    Purpose             :   This is a component to the Approval Details records with Change Status Button and Status picklist

    Last Modified 	Developer	Purpose            
    ============= 	=========	============ 
    07-Feb-19     	Vikas  		Initial Development(JIRA:ESESP-1702)
+=====================================================================================================-->

<aura:component controller = "SC_OrderApprovals_LightningCtrl" implements="force:appHostable,flexipage:availableForAllPageTypes,flexipage:availableForRecordHome,force:hasRecordId,forceCommunity:availableForAllPageTypes,force:lightningQuickAction" access="global" >
    <!--aura init handler , call js "loadApprovalDetails" function on component load, and display approval details data on table-->   
    <aura:handler name="init" value="{!this}" action="{!c.loadApprovalDetails}"/>
    
    <aura:attribute name="approvalDetailsList" type="Approval_Details__c[]" />
    <aura:attribute name="allApprovalDetailsList" type="Approval_Details__c[]" />
    
    <aura:attribute name="selectedCount" type="integer" default="0"/>
    <aura:attribute name="showStatus" type="Boolean" default="false" />
    <aura:attribute name="showStatusBox" type="Boolean" default="false" />
    <aura:attribute name="showRecords" type="Boolean" default="false" />
    <aura:attribute name="disableStatusChange" type="Boolean" default="true" />
    <aura:attribute name="isShowMore" type="Boolean" default="false" />
    <aura:attribute name="isShowLess" type="Boolean" default="false" />
    <aura:attribute name="Spinner" type="Boolean" default="false" />
    <aura:attribute name="isStatusChange" type="Boolean" default="false" />
    
    <aura:attribute name="statusList" type="String[]" />
    <aura:attribute name="selectedStatus" type="String" default="--None--"/>
    <aura:attribute name="ctrlPLValues" type="String" />
    <aura:attribute name="depenPLValues" type="String" />
    <aura:attribute name="totalRecords" type="String" default="0"/> 
    <aura:attribute name="iconValue" type="String"/> 
    <aura:attribute name="tempIconValue" type="String"/>
    <aura:attribute name="deleteRecordId" type="String"/>
    <aura:attribute name="showEscalateCase" type="boolean" default="false" />
    <aura:handler event="lightning:tabRefreshed" action="{!c.loadApprovalDetails}"/>
	<aura:handler event="force:refreshView" action="{!c.loadApprovalDetails}"/>
    
    <force:recordData aura:id="recordHandler"
                      recordId="{!v.deleteRecordId}"
                      fields="Id"
                      recordUpdated="{!c.recordUpdated}"
                      />
    <aura:if isTrue="{!v.Spinner}">
        <div aura:id="spinnerId" class="slds-spinner_container">
            <div class="slds-spinner--brand  slds-spinner slds-spinner--large slds-is-fixed" role="alert">
                <span class="slds-assistive-text">Loading</span>
                <div class="slds-spinner__dot-a"></div>
                <div class="slds-spinner__dot-b"></div>
            </div>
        </div>
    </aura:if>
    
    <!--Header part-->
    <div style = "border: 1px solid rgb(221, 219, 218);border-radius: .25rem;">
        <div class="slds-card__header slds-grid" data-aura-rendered-by="2381:0" style="height: 45px;padding: .75rem 1rem 0;">
            <header class="slds-media slds-media--center slds-has-flexi-truncate" data-aura-rendered-by="2382:0">
                <div class="slds-media__figure" data-aura-rendered-by="2383:0">
                    <div class="extraSmall forceEntityIcon" style="background-color: #6b9ee2;" data-aura-rendered-by="2687:0" data-aura-class="forceEntityIcon" onclick="{!c.refreshDetails}">
                        <span data-aura-rendered-by="2690:0" class="uiImage" data-aura-class="uiImage">
                            <lightning:icon aura:id="icondId" iconName="{!v.iconValue}" size="small" alternativeText="Approval Details" onmouseover="{!c.updateIcon}" onmouseout="{!c.revertIcon}"/>
                        </span>
                    </div>
                </div>
                <div class="slds-media__body" data-aura-rendered-by="2384:0">
                    <h2 id="header_2374:0" data-aura-rendered-by="2385:0">
                        <!--<a class="slds-card__header-link baseCard__header-title-container" data-aura-rendered-by="2386:0" onclick="{!c.openRelatedList}">-->
                        <b>  
                            <span class="slds-card__header-title slds-truncate slds-m-right--xx-small" title="Approval Details" data-aura-rendered-by="2387:0">Approval Details ({!v.totalRecords})
                                <span class="assistiveText" data-aura-rendered-by="3801:0">Approval Details</span>
                            </span>
                        </b>  
                        <!--</a>-->
                    </h2>
                </div>
            </header>
            
            <aura:if isTrue="{!v.showRecords}">
                <div class="slds-grid slds-grid--align-end" style="line-height: 1.5;"> 
                    <aura:if isTrue="{!v.showStatus}">
                        <div style="padding-right: 1rem;">
                            <div style="margin-top: -8.5%;" class="slds-grid slds-wrap">
                                <lightning:select aura:id="selectedStatusId" value="{!v.selectedStatus}" onchange="{!c.statusChanged}">
                                    <aura:iteration items="{!v.statusList}" var="status">
                                        <option value="{!status}">{!status}</option>
                                    </aura:iteration>
                                </lightning:select>
                            </div>                   
                        </div>
                    </aura:if>
                    <lightning:button disabled="{!v.disableStatusChange}" label="Change Status" onclick="{!c.showChangeStatus}"/>
                </div>
            </aura:if>
        </div>
        
        <aura:if isTrue="{!v.showRecords}">
            <table class="slds-table slds-table--bordered slds-table--cell-buffer" style = "table-layout: fixed;">
                <thead>
                    <tr class="slds-text-title--caps">
                        <th style="width:3.25rem;" class="slds-text-align--right">
                            <div class="slds-form-element">
                                <div class="slds-form-element__control">
                                    <label class="slds-checkbox">
                                        <!--header checkbox for select all-->
                                        <ui:inputCheckbox aura:id="box3" change="{!c.selectAll}"/>
                                        <span class="slds-checkbox--faux"></span>
                                        <span class="slds-form-element__label text"></span>
                                    </label>
                                </div>
                            </div>
                        </th>
                        <th style = "width: 13%;">
                            <span class="slds-truncate" title="Approval ID">Approval ID</span>      
                        </th>
                        <th style = "width: 18%;">
                            <span class="slds-truncate" title="Approval Request">Approval Request</span>
                        </th>
                        <th style = "width: 17%;">
                            <div class="slds-truncate" title="Approval Status">Approval Status</div>
                        </th>
                        <th style = "width: 21%;">       
                            <span class="slds-truncate" title="Approval Details/Description">Approval Description</span>
                        </th>
                        <th style = "width: 21%;">
                            <div class="slds-truncate" title="AKAM Modified Date">AKAM Modified Date</div>
                        </th>
                    </tr>
                </thead>
                <!--table body start, Iterate contact list as a <tr>-->
                <tbody>
                    <aura:iteration items="{!v.approvalDetailsList}" var="approvalDetail">
                        <tr>
                            <td scope="row" class="slds-text-align--right" style="width:3.25rem;">
                                <div class="slds-form-element">
                                    <div class="slds-form-element__control">
                                        <label class="slds-checkbox">
                                            <ui:inputCheckbox text="{!approvalDetail.Id}" aura:id="boxPack" value="" change="{!c.checkboxSelect}"/>
                                            <span class="slds-checkbox--faux"></span>
                                            <span class="slds-form-element__label text"></span>
                                        </label>
                                    </div>
                                </div>
                            </td>
                            <td scope="row">												
                                <div class="slds-truncate" title="{!approvalDetail.Id}"><a data-id="{!approvalDetail.Id}" onclick="{!c.navigateToDetail}">{!approvalDetail.Name}</a></div>
                            </td>
                            <td scope="row">
                                <div class="slds-truncate" title="{!approvalDetail.Approval_Request__c}">{!approvalDetail.Approval_Request__c}</div>
                            </td>
                            <td scope="row">
                                <div class="slds-truncate" title="{!approvalDetail.Approval_Status__c}">{!approvalDetail.Approval_Status__c}</div>
                            </td>
                            <td scope="row">
                                <div class="slds-truncate" title="{!approvalDetail.Approval_Details_Description__c}">{!approvalDetail.Approval_Details_Description__c}</div>
                            </td>
                            <td scope="row">
                                <div class="slds-truncate" title="{!approvalDetail.AKAM_Modified_Date__c}">{!approvalDetail.AKAM_Modified_Date__c}</div>
                            </td>
                            <td scope="row">
                                <lightning:buttonMenu alternativeText="More options" iconSize="x-small" onselect="{!c.performLineAction}" iconName="utility:down" aura:id="editDelete">
                                    <lightning:menuItem label="Edit" value="{!approvalDetail.Id}"  />
                                    <aura:if isTrue="{!v.showEscalateCase}">
                                        <lightning:menuItem label="Escalate" value="{!approvalDetail.Name}"  />
                                    </aura:if>
                                    <lightning:menuItem label="Clone" value="{!approvalDetail.Id}"  />
                                </lightning:buttonMenu>
                            </td>
                        </tr>
                    </aura:iteration>
                </tbody>
                
                <!--Commented by Vikas. This part of code is used to navigate to related list view -->
                <!--<a data-aura-rendered-by="3797:0" onclick="{!c.openRelatedList}" >
                    <div class="slds-card__footer" data-aura-rendered-by="3798:0" style="width: 1609%;">
                        <span class="view-all-label" data-aura-rendered-by="3799:0">View All
                            <span class="assistiveText" data-aura-rendered-by="3801:0">Approval Details</span>
                        </span>
                    </div>
                </a>-->
                
                <aura:if isTrue="{!v.isShowMore}">
                    <a data-aura-rendered-by="3797:0" onclick="{!c.showMore}" >
                        <div class="slds-card__footer" data-aura-rendered-by="3798:0" style="width: 1408%;">
                            <span class="view-all-label" data-aura-rendered-by="3799:0">
                                Show All
                                <span class="assistiveText" data-aura-rendered-by="3801:0">Approval Details</span>
                            </span>
                        </div>
                    </a>
                </aura:if>
                <aura:if isTrue="{!v.isShowLess}">
                    <a data-aura-rendered-by="3797:0" onclick="{!c.showLess}" >
                        <div class="slds-card__footer" data-aura-rendered-by="3798:0" style="width: 1609%;">
                            <span class="view-all-label" data-aura-rendered-by="3799:0">
                                Show Less
                                <span class="assistiveText" data-aura-rendered-by="3801:0">Approval Details</span>
                            </span>
                        </div>
                    </a>
                </aura:if>
            </table>
        </aura:if>
        
        <aura:if isTrue="{!v.showStatusBox}">
            <div role="dialog" tabindex="-1" aria-labelledby="header43" class="slds-modal slds-fade-in-open" >
                <div class="slds-modal__container" style="width: 50%;height: 37%; margin-top: 15%;">
                    <aura:if isTrue="{!v.Spinner}">
                        <div aura:id="spinnerId" class="slds-spinner_container">
                            <div class="slds-spinner--brand  slds-spinner slds-spinner--large slds-is-fixed" role="alert">
                                <span class="slds-assistive-text">Loading</span>
                                <div class="slds-spinner__dot-a"></div>
                                <div class="slds-spinner__dot-b"></div>
                            </div>
                        </div>
                    </aura:if>
                    <div class="slds-modal__header">
                        <button class="slds-button slds-modal__close slds-button--icon-inverse" title="Close" onclick="{!c.closeModal}">
                            X<span class="slds-assistive-text">Cancel</span>
                        </button>
                        <aura:if isTrue="{!v.isStatusChange}">
                            <h2 id="header43" class="slds-text-heading--medium">
                                Change Status
                            </h2>
                        </aura:if>
                    </div>
                    
                    <div class="slds-modal__content slds-p-around--medium">
                        <aura:if isTrue="{!v.isStatusChange}">
                            <div class="slds-form_stacked">
                                <center><h2 id="header99" >Are you sure you want to change the status?</h2></center>
                            </div>
                        </aura:if>
                    </div>
                    
                    <div class="slds-modal__footer">
                        <aura:if isTrue="{!v.isStatusChange}">
                            <button class="slds-button slds-button--brand" onclick="{!c.changeStatus}">Yes</button>
                        </aura:if>
                        <button class="slds-button slds-button--neutral" onclick="{!c.closeModal}" >No</button>
                    </div>
                </div>
            </div>
            <div class="slds-backdrop slds-backdrop--open"></div>
        </aura:if>
    </div>
</aura:component>