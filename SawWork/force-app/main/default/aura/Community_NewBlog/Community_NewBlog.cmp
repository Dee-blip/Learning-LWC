<aura:component controller="CommunityBlogCtrl" implements="flexipage:availableForRecordHome,force:hasRecordId,forceCommunity:themeLayout,forceCommunity:availableForAllPageTypes">
    
    <aura:attribute name="blog" type="Knowledge__kav" default="{'sobjectType': 'Knowledge__kav',
                                                                    'Title': '',
                                                                    'UrlName': '',
                                                                    'Description__c': '',
                                                                    'IsVisibleInCsp': false,
                                                                    'IsVisibleInPkb': false,
                                                                    'Visibility__c': 'External'
                                                                    }"/>
    <aura:attribute name="action" type="String" access="global"/>
    <aura:attribute name="topicId" type="String" access="global"/>
    <aura:attribute name="recordId" type="String" access="global"/>
    <aura:attribute name="isOpen" type="boolean" default="false"/>
    <aura:attribute name="isNewForm" type="boolean" default="false"/>
    <aura:attribute name="isDeleteForm" type="boolean" default="false"/>
    <aura:attribute name="isCreate" type="boolean" default="false"/>
    <aura:attribute name="isEdit" type="boolean" default="false"/>
    <aura:attribute name="isDel" type="boolean" default="false"/>
    <aura:attribute name="isBlogType" type="boolean" default="false"/>
    <aura:attribute name="isDelete" type="boolean" default="false"/>
    <aura:attribute name="isConfirmDelete" type="boolean" default="false"/>
    <aura:attribute name="isConfirmSave" type="boolean" default="false"/>
    <aura:attribute name="isKbAccess" type="boolean" default="false"/>
    <aura:attribute name="isConfirmKbAccess" type="boolean" default="false"/>
    <aura:attribute name="visibility" type="String" default="Public"/>
    <!--<aura:attribute name="fileName" type="String" default="No File Selected.." />-->
    <aura:attribute name="visibilityOptions" type="List"/>
    <aura:attribute name="communityId" type="String"/>
    
    <aura:attribute name="isUploadFile" type="boolean" default="false"/>
    <aura:attribute name="fileToBeUploaded" type="Object[]"/>
    
    <!-- for loading spinner -->
    <aura:attribute name="Spinner" type="boolean" default="false"/>
    
    <!-- Init Method -->
    <aura:handler name="init" value="{!this}" action="{!c.doInit}"/>

    <!-- Spinner which gets invoked based on event -->
    <aura:if isTrue="{!v.Spinner}">
        <div aura:id="spinnerId" class="slds-spinner_container">
            <div class="slds-spinner--brand  slds-spinner slds-spinner--large slds-is-fixed" role="alert">
                <span class="slds-assistive-text">{!$Label.c.Jarvis_Community_NewBlog_SpinnerAssistiveText}<!--Loading--></span>
                <div class="slds-spinner__dot-a"></div>
                <div class="slds-spinner__dot-b"></div>
            </div>
        </div>
    </aura:if>
    
    <aura:if isTrue="{!v.isCreate}">
        <div aura:id="createBlogButton">
            <lightning:button label="{!$Label.c.Jarvis_Community_NewBlog_Button_Create}" onclick="{!c.showNewBlog}" variant="brand" class="slds-m-top_medium slds-form_stacked buttonStyleCls"/>
        </div>
    </aura:if>
    <aura:if isTrue="{!v.isBlogType}">
        <aura:if isTrue="{!v.isEdit}">
            <div aura:id="uploadFileButton">
                <lightning:button label="{!$Label.c.Jarvis_Community_NewBlog_Button_Upload}" onclick="{!c.showUploadFile}" variant="brand" class="slds-m-top_medium slds-form_stacked buttonStyleCls"/>
            </div>
            <div aura:id="editBlogButton">
                <lightning:button label="{!$Label.c.Jarvis_Community_NewBlog_Button_Edit}" onclick="{!c.showEditBlog}" variant="brand" class="slds-m-top_medium slds-form_stacked buttonStyleCls"/>
            </div>
        </aura:if>
        <aura:if isTrue="{!v.isDel}">
            <div aura:id="delBlogButton">
                <lightning:button label="{!$Label.c.Jarvis_Community_NewBlog_Button_Delete}" onclick="{!c.showDeleteBlog}" variant="brand" class="slds-m-top_medium slds-form_stacked buttonStyleCls"/>
            </div>
        </aura:if>
    </aura:if>
    
    <aura:if isTrue="{!v.isOpen}">
        <!--###### MODAL BOX Start From Here ######--> 
        <div role="dialog" tabindex="-1" aria-labelledby="header99" class="slds-modal slds-fade-in-open ">
            <div class="slds-modal__container">
                <!-- ###### MODAL BOX HEADER Part Start From Here ######-->
                <div class="slds-modal__header">
                    <button class="slds-button slds-modal__close slds-button--icon-inverse" title="Close" onclick="{!c.closeModel}">
                        X
                        <span class="slds-assistive-text">{!$Label.c.Jarvis_Community_NewBlog_Modal_CloseButtonTitle}<!--Close--></span>
                    </button>
                    <aura:if isTrue="{!v.isCreate}">
                        <h2 id="header99" class="slds-text-heading--medium">{!$Label.c.Jarvis_Community_NewBlog_Modal_Header_Create}<!--Create Blog--></h2>
                    </aura:if>
                    <aura:if isTrue="{!v.isEdit}">
                        <h2 id="header99" class="slds-text-heading--medium">{!$Label.c.Jarvis_Community_NewBlog_Modal_Header_Edit}<!--Edit Blog--></h2>
                    </aura:if>
                    <aura:if isTrue="{!v.isDelete}">
                        <h2 id="header99" class="slds-text-heading--medium">{!$Label.c.Jarvis_Community_NewBlog_Modal_Header_Delete}<!--Delete Blog--></h2>
                    </aura:if>
                    <aura:if isTrue="{!v.isUploadFile}">
                        <h2 id="header99" class="slds-text-heading--medium">{!$Label.c.Jarvis_Community_NewBlog_Modal_Header_Upload}<!--Upload Files--></h2>
                    </aura:if>
                </div>
                <!--###### MODAL BOX BODY Part Start From Here ######-->
                <div class="slds-modal__content slds-p-around--medium">
                    <aura:if isTrue="{!v.isNewForm}">
                        <div class="slds-form_stacked">
                            <lightning:input aura:id="blogTitleField" name="Title" label="{!$Label.c.Jarvis_Community_NewBlog_Modal_Body_BlogTitleField}" value="{!v.blog.Title}" required="true" />
                            <br/>{!$Label.c.Jarvis_Community_NewBlog_Modal_Body_BlogDescriptionField} <!--Description--><br/>
                            <lightning:inputRichText aura:id="blogDescField" value="{!v.blog.Description__c}" shareWithEntityId="{!v.communityId}">
                                <lightning:insertImageButton></lightning:insertImageButton>
                            </lightning:inputRichText>
                            <div class="slds-text-body_small slds-text-color--error">{!$Label.c.Jarvis_Community_NewBlog_Modal_ImageSizeRestriction}<!--*Image with size more than 1MB cannot be added in the Description--></div>
                            <!--<br/>Visibility<br/>
                            <br/><ui:inputCheckbox aura:id="blogToCustomer" name="Customers" label="Authenticated" value="{!v.blog.IsVisibleInCsp}"/>
                            <br/><ui:inputCheckbox aura:id="blogToPublic" name="Public" label="Public" value="{!v.blog.IsVisibleInPkb}"/>-->
                            <br/><lightning:radioGroup name="visibility" label="{!$Label.c.Jarvis_Community_NewBlog_Modal_Body_BlogVisibilityField}" options="{!v.visibilityOptions}" value="{!v.visibility}" onchange="{!c.handleVisibilityChange}"/>
                            <!--<lightning:input aura:id="blogToCustomer" name="Customers" label="Visible to Customers" value="{!v.blog.IsVisibleInCsp}"/>
                            <lightning:input aura:id="blogToPublic" name="Public" label="Visible to Public" value="{!v.blog.IsVisibleInPkb}"/>-->
                            <!-- <br/><lightning:input aura:id="fileId" onchange="{!c.handleUploadFinished}" type="file" name="file" label="Upload Attachment" multiple="true"/>
                            <div class="slds-text-body_small .slds-text-color_error">{!v.fileName} &nbsp;&nbsp;&nbsp;<a onclick="{!c.removeAttachment}">x</a></div> -->
                        </div>
                    </aura:if> 
                    <aura:if isTrue="{!v.isDeleteForm}">
                        <div class="slds-form_stacked">
                            <h2 id="header99" >{!$Label.c.Jarvis_Community_NewBlog_Modal_Body_Delete}<!--Are you sure ?--></h2>
                        </div>
                    </aura:if> 
                    <aura:if isTrue="{!v.isKbAccess}">
                        <div class="slds-form_stacked">
                            <h2 id="header99" >{!$Label.c.Jarvis_Community_NewBlog_Modal_Body_InsufficientPermissions}<!--You do not have sufficient permissions to create a blog. Please raise a helpdesk ticket requesting for Knowledge Base user license.--></h2>
                        </div>
                    </aura:if>
                    <aura:if isTrue="{!v.isUploadFile}">
                        <div class="slds-form_stacked">
                            <div class="slds-box">
                                <div class="slds-grid slds-wrap">
                                    <lightning:input aura:id="file-input" type="file"
                                                     files="{!v.fileToBeUploaded}"
                                                     onchange="{!c.onFileUploaded}"
                                                     label="{!$Label.c.Jarvis_Community_NewBlog_Modal_Body_UploadAttachment}"
                                                     name="file" multiple="false"/>
                                </div>
                            </div>
                        </div>
                    </aura:if> 
                </div>
                
                <!--###### MODAL BOX FOOTER Part Start From Here ######-->
                <aura:if isTrue="{!v.isConfirmSave}">
                    <div class="slds-modal__footer">
                        <button class="slds-button slds-button--neutral" onclick="{!c.closeModel}" >{!$Label.c.Jarvis_Community_NewBlog_Modal_Footer_Cancel}<!--Cancel--></button>
                        <button class="slds-button slds-button--brand" onclick="{!c.createBlog}">{!$Label.c.Jarvis_Community_NewBlog_Modal_Footer_Save}<!--Save Blog--></button>
                    </div>
                </aura:if>
                <aura:if isTrue="{!v.isConfirmDelete}">
                    <div class="slds-modal__footer">
                        <button class="slds-button slds-button--neutral" onclick="{!c.closeModel}" >{!$Label.c.Jarvis_Community_NewBlog_Modal_Footer_No}<!--No--></button>
                        <button class="slds-button slds-button--brand" onclick="{!c.deleteBlog}">{!$Label.c.Jarvis_Community_NewBlog_Modal_Footer_Yes}<!--Yes--></button>
                    </div>
                </aura:if>
                <aura:if isTrue="{!v.isConfirmKbAccess}">
                    <div class="slds-modal__footer">
                        <button class="slds-button slds-button--neutral" onclick="{!c.closeModel}" >{!$Label.c.Jarvis_Community_NewBlog_Modal_Footer_OK}<!--OK--></button>
                    </div>
                </aura:if>
            </div>
        </div>
        <div class="slds-backdrop slds-backdrop--open"></div>
        <!--###### MODAL BOX Part END Here ######-->
    </aura:if>
</aura:component>