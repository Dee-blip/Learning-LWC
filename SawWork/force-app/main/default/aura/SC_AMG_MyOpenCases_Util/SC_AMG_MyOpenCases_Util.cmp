<aura:component controller="SC_AMG_Home_Lightning" implements="flexipage:availableForAllPageTypes,flexipage:availableForRecordHome,force:hasRecordId" access="global" extends="c:AuraUtils" >
    
    <lightning:workspaceAPI aura:id="workspace"/>
    <lightning:navigation aura:id="navService"/>
    <lightning:navigation aura:id="navigation"/>
    
    <!--<aura:registerEvent name="appEvent" type="c:aeEvent"/>-->
    
    <!--  <aura:registerEvent name="AppEvent" type="c:RecIdAppEvent" /> -->
    
    <!-- HANDLERS -->
    <aura:handler name="init" value="{!this}" action="{!c.init}"/>
    <aura:handler name="change" value="{!v.filterVal}" action="{!c.updateTable}"/>
    <aura:handler name="destroy" value="{!this}" action="{!c.handleDestroy}"/>
    
    <!-- ATTRIBUTES -->    
    <aura:attribute name="casesCount" type="Integer" access= "global" default="-1"/>
    
    <aura:attribute name="columns" type="List" default="[]"/>
    
    <aura:attribute name="data" type="List" access= "global" default="[]"/>
    <aura:attribute name="dataFiltered" type="List" access= "global" default="[]"/>
    <aura:attribute name="filteredDataCount" type="Integer" default="0"/>
    
    <aura:attribute name="keyField" type="String" default="caseRecId"/>
    <aura:attribute name="caseListToIterate" type="Case" access="global"/>
    <aura:attribute name="fieldsList" type="List" default="[]"/>
    <aura:attribute name="recId" type="Id" />
    <aura:attribute name="loadSpinner" type="Boolean" default="false" />
    
    <aura:attribute name="fieldList" type="String[]" />
    <aura:attribute name="idList" type="String[]" />
    
    <aura:attribute name="filterVal" type="String" default="My Open Cases"/>
    
    <aura:attribute name="sortedBy" type="String" default="slaInMinutes"/>
    <aura:attribute name="sortedDirection" type="String" default="asc"/>
	
    <aura:attribute name="pageReference" type="Object"/>
	
    <aura:attribute name="akachatTranscript" type="String" default="chat"/>
    <aura:attribute name="isModalOpen" type="boolean" default="false"/>
    <aura:attribute name="isBackupModalOpen" type="boolean" default="false"/>
    <aura:attribute name="userAvailable" type="boolean" default="true"/>
    <aura:attribute name="userRecordId" type="String"/>
    <aura:attribute name="backupUser" type="Id"/>
    
    <!-- LOAD MORE DATA ATTRIBUTES -->
    <aura:attribute name="enableInfiniteLoading" type="Boolean" default="true"/>
    <aura:attribute name="initialRows" type="Integer" default="50"/>
    <aura:attribute name="rowsToLoad" type="Integer" default="20"/>
    <aura:attribute name="totalNumberOfRows" type="Integer" default="0"/>
    <aura:attribute name="loadMoreStatus" type="String" default="Scroll down to load more!"/>
    <aura:attribute name="showRowNumberColumn" type="Boolean" default="false"/>
    <aura:attribute name="rowNumberOffset" type="Integer" default="0"/>
    <aura:attribute name="rowsToAdd" type="Integer" default="20"/>
    <aura:attribute name="currentCount" type="Integer" default="50"/>
    
    <aura:attribute name="showSpinner" type="boolean" default="false" />
    
    <aura:handler name="Loading" event="c:Loading" action="{!c.spinnerShow}" />
    <aura:handler name="DoneLoading" event="c:DoneLoading" action="{!c.spinnerHide}" />
    
    <aura:attribute name="showCloneModal" type="Boolean" default="false" />
    <aura:attribute name="recIdtoClone" type="Id" />
    <aura:attribute name="recTypeIdAMG" type="Id" />
    <aura:attribute name="homeURL" type="String"/>
    <aura:attribute name="showCloneMultiModal" type="Boolean" default="false" />
    
    <aura:attribute name="isUserManager" type="Boolean" default="false"/>
    <aura:attribute name="userSelectedId" type="String" default=""/>
    <!--<aura:handler event="aura:waiting" action="{!c.showSpinner}"/>
    <aura:handler event="aura:doneWaiting" action="{!c.hideSpinner}"/>-->
    
    <div class="slds-card">
        <div class="slds-card__header slds-grid slds-gutters">
            <header class="slds-media slds-media_center slds-has-flexi-truncate">
                
                <div>
                    <aura:if isTrue="{!v.loadSpinner}">
                        <div style="opacity: 0.7;" aura:id="spinnerId" class="slds-spinner_container">
                                <lightning:spinner alternativeText="Loading" variant="brand" size="large" />
                        </div>
                    </aura:if>
                </div>
                
                <div class="slds-col">
                    
                    <ul class="slds-list_horizontal slds-media_center">
                        <li>
                            <lightning:icon iconName="standard:user" class="slds-icon" />
                        </li>
                        <li class="">
                            <span style="font-size:17px;padding-left: 10px;">Open Cases <b>({!v.totalNumberOfRows})</b></span>
                        </li>
                    </ul>
                </div>
                
                <div class="slds-col rightAlign">
                    <button class="slds-button" label="Refresh"
                            onclick="{!c.updateTable}">
                        <lightning:icon iconName="action:refresh" alternativeText="Refresh" size="x-small"/>
                    </button>
                </div>
                
            </header>
           
        </div>
        
        <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~ CASES DATATABLE ~~~~~~~~~~~~~~~~~~~~~~~~~~  -->
        
        <div class="slds-card__body slds-card__body_inner" style="height:360px;">
            <aura:if isTrue="{!v.casesCount > 0}">
                <div style="height:340px;">
                    <lightning:datatable 
                                         data="{!v.dataFiltered}" 
                                         columns="{!v.columns}" 
                                         keyField="caseRecId"
                                         aura:Id="datatable"
                                         onsort = "{!c.updateColumnSorting}"
                                         sortedBy="{!v.sortedBy}"  
                                         sortedDirection="{!v.sortedDirection}"
                                         onrowselection="{!c.updateSelectedText}"
                                         onrowaction="{!c.handleRowAction }"
                                         rowNumberOffset="0"
                                         enableInfiniteLoading="{!v.enableInfiniteLoading}"
                                         onloadmore="{!c.handleLoadMoreCases}"
                                         />
                </div>
                <aura:set attribute ="else">
                    <aura:if isTrue="{!v.casesCount == 0}">
                        <div class="slds-text-heading_medium slds-align_absolute-center" style="padding: 30px;">
                            Hurrah! ü•≥ You're all caught up here! üôåüèº
                        </div>
                        
                        <aura:set attribute="else">
                            <div class="slds-text-heading_medium slds-align_absolute-center" style="padding: 30px;">
                                Loading something spectacular... Hang tight!
                            </div>
                        </aura:set>  
                    </aura:if>
                </aura:set>
            </aura:if>
            
        </div>
        <footer class="slds-card__footer"></footer>
    </div>
    <!--Markup ends-->
    
</aura:component>