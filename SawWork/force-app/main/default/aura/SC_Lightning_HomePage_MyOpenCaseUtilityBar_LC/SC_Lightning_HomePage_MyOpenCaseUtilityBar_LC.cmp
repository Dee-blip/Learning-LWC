<!--=====================================================================================================+
    Component name      :   SC_Lighting_HomePage_MyOpenCases 
    Author              :   Sumukh
    Created             :   10-Sep-18
    Purpose             :   Component for lightning Home Page - Showing my open cases in the utility bar
                            
    Last Modified Developer           Purpose            
    ============= ========================  =======
    10-FEB-18     Sumukh  Initial Development(Jira Ticket# ESESP-1900)
+=====================================================================================================--><aura:component implements="flexipage:availableForAllPageTypes,flexipage:availableForRecordHome,force:hasRecordId" controller="SC_Akatec_Lightning_Homepage" access="global" >


<aura:handler name="init" value="{!this}" action="{!c.doInit}"/>
<lightning:utilityBarAPI aura:id="utilitybar" />

<aura:handler event="c:SC_Akatec_MyOpenCases_Refresher" action="{!c.doInit}"/>
<aura:attribute name="OpenCount" type="string"/>  

<aura:attribute name="PayloadOdd" type="string"/>  
<aura:attribute name="PayloadEven" type="string"/>  

<aura:registerEvent name="c:SC_Akatec_MyOpenCases_Refresher" type="c:SC_Akatec_MyOpenCases_Refresher"/>

<aura:attribute name="cometd" type="Object"/>
<!-- Save the reference of current subscription, which can be unsubscribe later on -->
<aura:attribute name="subscription" type="Object"/>
<aura:handler name="destroy" value="{!this}" action="{!c.unsubscribe}"/>
<!-- Must include cometD library -->
<ltng:require scripts="{!$Resource.SC_Akatec_LightningMigration +'/SC_Akatec_Lightning_Resource/cometd314/cometd.js'}" afterScriptsLoaded="{!c.doSubscription}" />    

<aura:attribute name="OpenCase" type="List"/>

<lightning:workspaceAPI aura:id="workspace"/>

<aura:handler event="force:refreshView" action="{!c.doInit}"/>


<div class="slds-box slds-theme_default">
    
    
    
    
    <div class="slds-page-header" style="padding-top: 5px;padding-bottom: 5px;">
        <div class="slds-grid">
            
            <div style="margin-right: 10px;">
                <lightning:icon iconName="standard:case" size="medium"/>
            </div>
            
            <div class="slds-col slds-has-flexi-truncate" >
                <p class="slds-text-title_caps slds-line-height_reset">Cases</p>
                <h1 class="slds-page-header__title slds-m-right_small slds-align-middle slds-truncate">{!v.OpenCount} My Open Cases</h1>
            </div>
         <button  class="slds-button slds-button_success" style="float: right;" onclick="{!c.doInit}">Refresh</button>
        </div>
    </div>
    
    <div class="slds-m-around_medium"  style=" margin-left: 0px;margin-right: 0px; margin-top: 5px;margin-bottom: 5px; ">
        
        <div class="slds-form-element">  
            <div class="slds-grid slds-gutters">
                
                
                <div class="slds-col">
                    
                    
                </div>
                
                <div class="slds-col">
                </div>
                
            </div>
        </div>
        
        
        <table class="slds-table slds-table_cell-buffer slds-table_bordered" style="width:100%">
            <thead>
                <tr class="slds-line-height_reset">
                    
                    <th class="slds-text-title_caps" scope="col" style="width:13%">
                        <div class="slds-truncate" >AKAM Case ID</div>
                    </th>
                    
                    <th class="slds-text-title_caps" scope="col">
                        <div class="slds-truncate" >Account</div>
                    </th>
                    <th class="slds-text-title_caps" scope="col">
                        <div class="slds-truncate" >Subject</div>
                    </th>
                    <th class="slds-text-title_caps" scope="col">
                        <div class="slds-truncate" >Geography</div>
                    </th>
                    <th class="slds-text-title_caps" scope="col">
                        <div class="slds-truncate" >Country</div>
                    </th>
                    <th class="slds-text-title_caps" scope="col">
                        <div class="slds-truncate" >LOE</div>
                    </th>
                    <th class="slds-text-title_caps" scope="col">
                        <div class="slds-truncate" >Work Type</div>
                    </th>
                    <th class="slds-text-title_caps" scope="col">
                        <div class="slds-truncate">Status</div>
                    </th>
                    <th class="slds-text-title_caps" scope="col">
                        <div class="slds-truncate">Severity</div>
                    </th>
                    <th class="slds-text-title_caps" scope="col">
                        <div class="slds-truncate">Support Level</div>
                    </th>
                    <th class="slds-text-title_caps" scope="col">
                        <div class="slds-truncate" >Next Action</div>
                    </th>
                    <th class="slds-text-title_caps" scope="col">
                        <div class="slds-truncate" >SLA</div>
                    </th>
                </tr>
            </thead>
            
            <tbody>
                <aura:iteration items="{!v.OpenCase}" var="case1">
                    <tr class="slds-hint-parent">
                        
                        <aura:if isTrue="{!case1.EachCaseRec.Recent_Update__c==true}">
                            
                            <td style="width:13%;background: orange;"><a id="{!case1.EachCaseRec.Id}" onclick="{!c.openNewTabandClear}">{!case1.EachCaseRec.AKAM_Case_ID__c}</a>
                                
                            </td>
                        </aura:if>
                        <aura:if isTrue="{!case1.EachCaseRec.Recent_Update__c==false}">
                            
                            <td style="width:13%;"><a id="{!case1.EachCaseRec.Id}" onclick="{!c.openNewTab}">{!case1.EachCaseRec.AKAM_Case_ID__c}</a>
                            </td>
                        </aura:if>
                        
                        
                        <td>{!case1.EachCaseRec.Account.Name}</td>
                        <td>{!case1.EachCaseRec.Subject}</td>
                        <td Style="{! 'color:'+case1.GeoColor}">{!case1.EachCaseRec.Support_Geography__c}</td>
                        <td>{!case1.EachCaseRec.Account.BillingCountry}</td>
                        <td>{!case1.EachCaseRec.Task_LOE__c}</td>
                        <td>{!case1.EachCaseRec.Work_Type__c}</td>
                        <td>{!case1.EachCaseRec.Status}</td>
                        <td>{!case1.EachCaseRec.Severity__c}</td>
                        <td>{!case1.EachCaseRec.Support_Level__c}</td>
                        <td>{!case1.EachCaseRec.Next_Action__c}</td>
                        <td style="{!'color:'+case1.SLA_Color}">
                            {!case1.SLA}
                        </td>
                    </tr>
                </aura:iteration>  
            </tbody>
        </table>
        
        
    </div>
</div>
</aura:component>