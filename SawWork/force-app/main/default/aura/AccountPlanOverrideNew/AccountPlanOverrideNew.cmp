<!--
  @description       : override New Account Plan Action
  @author            : apyati
  @group             : L2Q
  @last modified on  : 08-23-2021
  @last modified by  : apyati
  Modifications Log 
  Ver   Date         Author                         Modification
  1.0   06-25-2021   apyati                        Initial Version
-->
<aura:component controller="AccountPlanController"
    implements="lightning:actionOverride,flexipage:availableForRecordHome,force:hasRecordId,lightning:isUrlAddressable"
    access="global">
    
    <lightning:navigation aura:id="navService" />
    <aura:attribute name="recordId" type="string" description="The record id of the request" />
    <aura:attribute name="parentrecordId" type="string" description="The parentrecord id of the request" />
    <aura:attribute name="newPlanLayout" type="boolean" default="false" />
    <aura:attribute name="showAlert" type="boolean" default="false" />
    <aura:attribute name="showSpinner" type="boolean" default="false" />
    <aura:attribute name="alertMessage" type="string" />
    <lightning:overlayLibrary aura:id="overlayLib"/>

    <aura:handler name="init" value="{!this}" action="{!c.doInit}" />
    <!--<aura:handler event="aura:locationChange" action="{!c.destoryCmp}" />-->
    <aura:handler name="change" value="{!v.pageReference}" action="{!c.onPageReferenceChanged}" />


    <aura:html tag="style">
        .slds-modal__container{
        max-width: 100% !important;
        width:60% !important;
        transform: none !important;
        }
        .cuf-content {
        padding: 0 0rem !important;
        }
        .slds-p-around--medium {
        padding: 0rem !important;
        }
        .slds-modal__content{
        overflow-y:hidden !important;
        height:unset !important;
        max-height:unset !important;
        }

    </aura:html>

    <div aura:id="newDialog" role="dialog" tabindex="-1" aria-labelledby="header43"
        class="slds-modal slds-fade-in-open">

        <aura:if isTrue="{!v.showSpinner }">
            <div aura:id="spinnerId" class="slds-spinner_container">
                <div class="slds-spinner--brand  slds-spinner slds-spinner--large slds-is-relative" role="alert">
                    <span class="slds-assistive-text">Loading</span>
                    <div class="slds-spinner__dot-a"></div>
                    <div class="slds-spinner__dot-b"></div>
                </div>
            </div>
        </aura:if>

        <div class="slds-modal__container">
            <button
                class="slds-button slds-button_icon slds-modal__close closeIcon slds-button_icon-bare slds-button_icon-inverse"
                title="Close" onclick="{!c.handleCancel}">
                <lightning:icon iconName="utility:close" alternativeText="Close" title="close" />
            </button>
            <div class="slds-modal__header">
                <h2 class="slds-text-heading--medium">New Account Plan</h2>
            </div>
            <lightning:notificationsLibrary aura:id="notifLib" />
            <aura:if isTrue="{!not(v.newPlanLayout)}">
                <div class="slds-modal__content slds-var-p-around_medium">
                    <div class="slds-align_absolute-center">
                        {!v.alertMessage}
                    </div>
                </div>
                <div class="slds-modal__footer">
                    <lightning:button variant="Neutral" label="No" onclick="{!c.handleCancel}" />
                    <lightning:button variant="brand" label="Yes" onclick="{!c.handleNext}" />
                </div>
            </aura:if>
            <aura:if isTrue="{!v.newPlanLayout}">
                <lightning:recordEditForm aura:id="myRecordForm" objectApiName="Account_Plan__c"
                    onsubmit="{!c.handleSubmit}" onsuccess="{!c.handleSuccess}" onerror="{!c.handleError}">
                    <div class="slds-modal__content slds-var-p-around_medium slds-grid slds-wrap ">
                        <lightning:inputField aura:id="nameField" fieldName="Name" required="true"
                            class="slds-col slds-size_1-of-2 slds-var-p-horizontal_x-small" />
                        <lightning:inputField aura:id="accId" fieldName="Account__c" value="{!v.parentrecordId}"
                            required="true" class="slds-col slds-size_1-of-2 slds-var-p-horizontal_x-small" />
                    </div>
                    <div class="slds-modal__footer slds-align_absolute-center">
                        <lightning:button variant="neutral" name="Cancel" label="Cancel" onclick="{!c.handleCancel}" />
                        <lightning:button variant="brand" label="Save" type="submit" />
                    </div>
                </lightning:recordEditForm>
            </aura:if>
        </div>
    </div>

</aura:component>