<!--
   Author:Rajesh Kumar
   Description : Grid View for Capacity Planning Request
   JIRA # : SFDC-6906
   -->
<aura:component controller="L2Q_CapacityRequestController"
    implements="lightning:isUrlAddressable,force:appHostable,flexipage:availableForAllPageTypes,flexipage:availableForRecordHome,force:hasRecordId,forceCommunity:availableForAllPageTypes,force:lightningQuickAction"
    access="global">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!--Begin Attribute Decalarion-->
    <!--Begin Rajesh Kumar - SFDC-7608 CPR Historical Data-->
    <aura:attribute name="cfilter" type="String" default="" />
    <aura:attribute name="ofilter" type="String" default="" />
    <aura:attribute name="parentaccount" type="String" default="" />
    <aura:attribute name="ishistoricalMode" type="Boolean" default="false" />
    <aura:attribute name="renderslide" type="Boolean" default="false" />
    <!--End Rajesh Kumar - SFDC-7608-->

    <!-- Begin  Rajesh Kumar | SFDC-7368 -->
    <aura:attribute name="isModalOpen" type="Boolean" default="false" />
    <aura:attribute name="parentrecid" type="String" default="" />
    <aura:attribute name="parentuniqueid" type="String" default="" />
    <aura:attribute name="region" type="String" default="" />
    <aura:attribute name="allocatedCapacity" type="String" default="" />
    <aura:attribute name="cprName" type="String" default="" />
    <aura:attribute name="fieldMapping" type="string" default="" />
    <aura:attribute name="forapproval" type="Boolean" default="false" />
    <aura:attribute name="nullclonefield" type="String" default="" />
    <aura:attribute name="uiapprfieldaccess" type="boolean" default="false" />
    <aura:attribute name="countrysplitreadStatus" type="String" default="" />
    <aura:attribute name="readcheck" type="Map" default="{'isreqreadonly':true,'isapprreadonly':false}" />
    <!-- End  Rajesh Kumar | SFDC-7368 -->
    <aura:attribute name="isLoading" type="boolean" default="false" />
    <aura:attribute name="ismetadataLoaded" type="boolean" default="false" />
    <aura:attribute name="schemaMap" type="Map" />
    <aura:attribute name="data" type="Object[]" default="[]" />
    <aura:attribute name="scrollData" type="Object[]" default="[]" />
    <aura:attribute name="objapiName" type="String" />
    <aura:attribute name="whereClause" type="String" />
    <aura:attribute name="hrWidth" type="String" />
    <aura:attribute name="queryFields" type="String" />
    <aura:attribute name="objName" type="String" />
    <aura:attribute name="recordId" type="String" />
    <aura:attribute name="recordName" type="String" />
    <aura:attribute name="recordUniquekey" type="String" />
    <aura:attribute name="schemaDetails" type="Object[]" default="[]" />
    <aura:attribute name="header" type="String" />
    <aura:attribute name="recordLimit" type="Integer" default="100" />
    <aura:attribute name="scrollrecordLimit" type="Integer" default="100" />
    <aura:attribute name="orderby" type="String" />
    <aura:attribute name="readonlyStatus" type="String" />
    <aura:attribute name="uomfd" type="String" />
    <aura:attribute name="fixedWidth" type="string" default="width:16rem;" />
    <aura:attribute name="timeZone" type="string" />
    <aura:attribute name="timeZoneheader" type="string" />
    <aura:attribute name="f2bheaderheader" type="string" />
    <aura:attribute name="mouseStart" type="string" />
    <aura:attribute name="newWidth" type="string" />
    <aura:attribute name="currentEle" type="Object" />
    <!--Modifier Rajesh Kumar SFDC-7069-->
    <aura:attribute name="approvedFieldenabled" type="boolean" default="false" />
    <!--End Attribute Decalarion-->
    <!-- Begin Handler Decalartion  -->
    <aura:handler name="init" value="{!this}" action="{!c.doInit}" />
    <!-- End Handler Decalartion  -->
    <aura:if isTrue="{!v.isLoading}">
        <lightning:spinner alternativeText="Loading" size="large" />
    </aura:if>
    <!-- Begin Page Header  -->

    <aura:if isTrue="{!v.ismetadataLoaded}">
        <div class="announcement slds-theme_shade slds-theme_alert-texture">
            <span class="textSize">
                <lightning:icon iconName="action:info" size="xx-small">
                </lightning:icon>
                &nbsp;<b>Note :</b>
                &nbsp; {!v.timeZoneheader}
                <span><b>{!v.timeZone}</b></span>.&nbsp; <b>|</b>
                <lightning:formattedRichText value="{!v.f2bheaderheader}" />
            </span>
        </div>
    </aura:if>

    <div class="header slds-theme_shade slds-theme_alert-texture"
        style="margin-top:2px;border-top:1px solid rgb(21, 137, 238)">
        <div style="display: inline-block !important;">
            <h1 class="logo">
                <div>
                    <!-- Begin Rajesh Kumar - SFDC-7608 CPR Historical Data-->
                    <lightning:buttonGroup>
                        <aura:if isTrue="{!v.renderslide}">
                            <c:l2q_cprslider schemadetail="{!v.schemaDetails}" onselect="{!c.handleFilter}"
                                aura:id="cprslider">
                            </c:l2q_cprslider>&nbsp;
                        </aura:if>
                    </lightning:buttonGroup>
                    <!-- End Rajesh Kumar - SFDC-7608 -->
                    <span style="margin-left:10px;">
                        <lightning:formattedRichText value="{!v.header}" />
                    </span>
                </div>
            </h1>
        </div>
        <div class="header-right">
            <lightning:button label="BACK" iconName="utility:back" iconPosition="left" variant="brand" class="bgColor"
                onclick="{!c.navigatetoRecord}" />
            <aura:if isTrue="{!v.ismetadataLoaded}">
                <aura:if isTrue="{!not(v.ishistoricalMode)}">
                    <!--Rajesh Kumar - SFDC-7608 -->
                    <lightning:button label="ADD ROW" iconName="utility:add" iconPosition="right" variant="brand"
                        class="bgColor" onclick="{!c.addRow}" />
                </aura:if>
                <lightning:button label="SAVE" iconName="utility:save" iconPosition="right" variant="brand"
                    class="bgColor" onclick="{!c.saveData}" />
            </aura:if>
            <lightning:badge label="{!v.data.length}" iconName="utility:summary" /> <!-- Rajesh Kumar - SFDC-7608 -->
        </div>
    </div>
    <div class="slds-hide">
        <c:l2q_capacityallocation aura:id="l2qcapacityallocation1" />
    </div>
    <!-- End Page Header  -->

    <!-- Begin component body  -->
    <aura:if isTrue="{!v.ismetadataLoaded}">
        <div class="view" onscroll="{!c.handleScroll}">
            <div class="wrapper" onscroll="{!c.handleverticalScroll}" aura:id="scData">
                <table class="table slds-table">
                    <thead>
                        <tr>
                            <aura:if isTrue="{!v.ismetadataLoaded}">
                                <th class="sticky-colhd first-col" title="test" style="z-index:500">
                                    <div class="slds-truncate"># &nbsp;<b>|</b>&nbsp;&nbsp;Action</div>
                                </th>
                            </aura:if>
                            <aura:iteration items="{!v.schemaDetails}" var="eachRow" indexVar="index">
                                <aura:if isTrue="{!eachRow.fieldType == 'MULTIPICKLIST' ? 'true' : 'false'}">
                                    <th scope="col" class="slds-is-resizable" style="width:16rem;">
                                        <span class="slds-truncate" title="{!eachRow.fieldLabel}">
                                            <aura:if isTrue="{!eachRow.isrequired}">
                                                <span class="required">*</span>
                                            </aura:if>
                                            {!eachRow.fieldLabel}
                                        </span>
                                        <aura:if isTrue="{!(eachRow.helptext)? 'true' : 'false'}">
                                            &nbsp;
                                            <lightning:helptext content="{!eachRow.helptext}"
                                                style="padding-bottom:4px" />
                                        </aura:if>
                                    </th>
                                </aura:if>
                                <aura:if isTrue="{!eachRow.fieldType == 'PICKLIST' ? 'true' : 'false'}">
                                    <aura:if
                                        isTrue="{!eachRow.fieldapiName == 'Delivery_Product__c' ? 'true' : 'false'}">
                                        <th class="sticky-colhd1" style="{!'width:'+eachRow.fieldWidth}">
                                            <div title="{!eachRow.fieldLabel}">
                                                <a href="javascript:void(0);" role="button"
                                                    class="slds-th__action slds-text-link_reset">
                                                    <span class="slds-truncate" title="{!eachRow.fieldLabel}">
                                                        <aura:if isTrue="{!eachRow.isrequired}">
                                                            <span class="required">*</span>
                                                        </aura:if>
                                                        {!eachRow.fieldLabel}
                                                    </span>
                                                    <aura:if isTrue="{!(eachRow.helptext)? 'true' : 'false'}">
                                                        &nbsp;
                                                        <lightning:helptext content="{!eachRow.helptext}"
                                                            style="padding-bottom:4px" />
                                                    </aura:if>
                                                </a>
                                            </div>
                                        </th>
                                        <aura:set attribute="else">
                                            <th style="{!'width:'+eachRow.fieldWidth}">
                                                <div title="{!eachRow.fieldLabel}">
                                                    <a href="javascript:void(0);" role="button"
                                                        class="slds-th__action slds-text-link_reset">
                                                        <span class="slds-truncate" title="{!eachRow.fieldLabel}">
                                                            <aura:if isTrue="{!eachRow.isrequired}">
                                                                <span class="required">*</span>
                                                            </aura:if>
                                                            {!eachRow.fieldLabel}
                                                        </span>
                                                        <aura:if isTrue="{!(eachRow.helptext)? 'true' : 'false'}">
                                                            &nbsp;
                                                            <lightning:helptext content="{!eachRow.helptext}"
                                                                style="padding-bottom:4px" />
                                                        </aura:if>
                                                    </a>
                                                </div>
                                            </th>
                                        </aura:set>
                                    </aura:if>
                                </aura:if>
                                <aura:if isTrue="{!eachRow.fieldType == 'DATETIME' ? 'true' : 'false'}">
                                    <th style="{!'width:'+eachRow.fieldWidth}">
                                        <div title="{!eachRow.fieldLabel}">
                                            <a href="javascript:void(0);" role="button"
                                                class="slds-th__action slds-text-link_reset">
                                                <span class="slds-truncate" title="{!eachRow.fieldLabel}">
                                                    <aura:if isTrue="{!eachRow.isrequired}">
                                                        <span class="required">*</span>
                                                    </aura:if>
                                                    {!eachRow.fieldLabel}
                                                </span>
                                                <aura:if isTrue="{!(eachRow.helptext)? 'true' : 'false'}">
                                                    &nbsp;
                                                    <lightning:helptext content="{!eachRow.helptext}"
                                                        style="padding-bottom:4px" />
                                                </aura:if>
                                            </a>
                                        </div>
                                    </th>
                                </aura:if>
                                <aura:if isTrue="{!eachRow.fieldType == 'BOOLEAN' ? 'true' : 'false'}">
                                    <th style="{!'width:'+eachRow.fieldWidth}">
                                        <div title="{!eachRow.fieldLabel}">
                                            <a href="javascript:void(0);" role="button"
                                                class="slds-th__action slds-text-link_reset">
                                                <span class="slds-truncate" title="{!eachRow.fieldLabel}">
                                                    <aura:if isTrue="{!eachRow.isrequired}">
                                                        <span class="required">*</span>
                                                    </aura:if>
                                                    {!eachRow.fieldLabel}
                                                </span>
                                                <aura:if isTrue="{!(eachRow.helptext)? 'true' : 'false'}">
                                                    &nbsp;
                                                    <lightning:helptext content="{!eachRow.helptext}"
                                                        style="padding-bottom:4px" />
                                                </aura:if>
                                            </a>
                                        </div>
                                    </th>
                                </aura:if>
                                <aura:if isTrue="{!eachRow.fieldType == 'TEXTAREA' ? 'true' : 'false'}">
                                    <th style="{!'width:'+eachRow.fieldWidth}">
                                        <div title="{!eachRow.fieldLabel}">
                                            <a href="javascript:void(0);" role="button"
                                                class="slds-th__action slds-text-link_reset">
                                                <span class="slds-truncate" title="{!eachRow.fieldLabel}">
                                                    <aura:if isTrue="{!eachRow.isrequired}">
                                                        <span class="required">*</span>
                                                    </aura:if>
                                                    {!eachRow.fieldLabel}
                                                </span>
                                                <aura:if isTrue="{!(eachRow.helptext)? 'true' : 'false'}">
                                                    &nbsp;
                                                    <lightning:helptext content="{!eachRow.helptext}"
                                                        style="padding-bottom:4px" />
                                                </aura:if>
                                            </a>
                                        </div>
                                    </th>
                                </aura:if>
                                <aura:if isTrue="{!eachRow.fieldType == 'STRING' ? 'true' : 'false'}">
                                    <aura:if isTrue="{!eachRow.fieldapiName == 'Name' ? 'true' : 'false'}">
                                        <th class="sticky-colhd second-col" style="{!'width:'+eachRow.fieldWidth}">
                                            <div title="{!eachRow.fieldLabel}">
                                                <a href="javascript:void(0);" role="button"
                                                    class="slds-th__action slds-text-link_reset">
                                                    <span class="slds-truncate" title="{!eachRow.fieldLabel}">
                                                        <aura:if isTrue="{!eachRow.isrequired}">
                                                            <span class="required">*</span>
                                                        </aura:if>
                                                        {!eachRow.fieldLabel}
                                                    </span>
                                                    <aura:if isTrue="{!(eachRow.helptext)? 'true' : 'false'}">
                                                        &nbsp;
                                                        <lightning:helptext content="{!eachRow.helptext}"
                                                            style="padding-bottom:4px" />
                                                    </aura:if>
                                                </a>
                                            </div>
                                        </th>
                                        <aura:set attribute="else">
                                            <th style="{!'width:'+eachRow.fieldWidth}">
                                                <div title="{!eachRow.fieldLabel}">
                                                    <a href="javascript:void(0);" role="button"
                                                        class="slds-th__action slds-text-link_reset">
                                                        <span class="slds-truncate" title="{!eachRow.fieldLabel}">
                                                            <aura:if isTrue="{!eachRow.isrequired}">
                                                                <span class="required">*</span>
                                                            </aura:if>
                                                            {!eachRow.fieldLabel}
                                                        </span>
                                                        <aura:if isTrue="{!(eachRow.helptext)? 'true' : 'false'}">
                                                            &nbsp;
                                                            <lightning:helptext content="{!eachRow.helptext}"
                                                                style="padding-bottom:4px" />
                                                        </aura:if>
                                                    </a>
                                                </div>
                                            </th>
                                        </aura:set>
                                    </aura:if>
                                </aura:if>
                                <aura:if isTrue="{!eachRow.fieldType == 'PERCENT' ? 'true' : 'false'}">
                                    <th style="{!'width:'+eachRow.fieldWidth}">
                                        <div title="{!eachRow.fieldLabel}">
                                            <a href="javascript:void(0);" role="button"
                                                class="slds-th__action slds-text-link_reset">
                                                <span class="slds-truncate" title="{!eachRow.fieldLabel}">
                                                    <aura:if isTrue="{!eachRow.isrequired}">
                                                        <span class="required">*</span>
                                                    </aura:if>
                                                    {!eachRow.fieldLabel}
                                                </span>
                                                <aura:if isTrue="{!(eachRow.helptext)? 'true' : 'false'}">
                                                    &nbsp;
                                                    <lightning:helptext content="{!eachRow.helptext}"
                                                        style="padding-bottom:4px" />
                                                </aura:if>
                                            </a>
                                        </div>
                                    </th>
                                </aura:if>
                                <aura:if isTrue="{!eachRow.fieldType == 'DOUBLE' ? 'true' : 'false'}">
                                    <th style="{!'width:'+eachRow.fieldWidth}">
                                        <div title="{!eachRow.fieldLabel}">
                                            <a href="javascript:void(0);" role="button"
                                                class="slds-th__action slds-text-link_reset">
                                                <span class="slds-truncate" title="{!eachRow.fieldLabel}">
                                                    <aura:if isTrue="{!eachRow.isrequired}">
                                                        <span class="required">*</span>
                                                    </aura:if>
                                                    {!eachRow.fieldLabel}
                                                </span>
                                                <aura:if isTrue="{!(eachRow.helptext)? 'true' : 'false'}">
                                                    &nbsp;
                                                    <lightning:helptext content="{!eachRow.helptext}"
                                                        style="padding-bottom:4px" />
                                                </aura:if>
                                            </a>
                                        </div>
                                    </th>
                                </aura:if>
                                <aura:if isTrue="{!eachRow.fieldType == 'DATE' ? 'true' : 'false'}">
                                    <th style="{!'width:'+eachRow.fieldWidth}">
                                        <div title="{!eachRow.fieldLabel}">
                                            <a href="javascript:void(0);" role="button"
                                                class="slds-th__action slds-text-link_reset">
                                                <span class="slds-truncate" title="{!eachRow.fieldLabel}">
                                                    <aura:if isTrue="{!eachRow.isrequired}">
                                                        <span class="required">*</span>
                                                    </aura:if>
                                                    {!eachRow.fieldLabel}
                                                </span>
                                                <aura:if isTrue="{!(eachRow.helptext)? 'true' : 'false'}">
                                                    &nbsp;
                                                    <lightning:helptext content="{!eachRow.helptext}"
                                                        style="padding-bottom:4px" />
                                                </aura:if>
                                            </a>
                                        </div>
                                    </th>
                                </aura:if>
                            </aura:iteration>
                        </tr>
                    </thead>
                    <tbody>
                        <aura:iteration items="{!v.data}" var="eachRow" indexVar="index">
                            <tr>
                                <td class="sticky-col first-col">
                                    <span class="slds-badge">{!index+1}.</span>
                                    <aura:if
                                        isTrue="{!and(eachRow.recordId.length != 18 , eachRow.recordId.length !=15) ? 'true' : 'false'}">
                                        <a onclick="{!c.deleteRow}" data-id="{!eachRow.uniqueKey}"
                                            data-record="{!index}">
                                            <lightning:icon iconName="utility:delete" size="small"
                                                alternativeText="Delete" />
                                            <span class="slds-assistive-text">Delete</span>
                                        </a>
                                    </aura:if>
                                    <a onclick="{!c.cloneRecord}" data-id="{!eachRow.uniqueKey}" data-record="{!index}">
                                        <lightning:icon iconName="utility:copy" size="small" alternativeText="Clone" />
                                        <span class="slds-assistive-text">Clone</span>
                                    </a>
                                    <aura:if
                                        isTrue="{!and(eachRow.recordId != '',eachRow.recordId != null,eachRow.recordId !=undefined) ? 'true' : 'false'}">
                                        <a onclick="{!c.handlerecordClick}" data-record="{!eachRow.recordId}">
                                            View
                                        </a>
                                    </aura:if>
                                </td>
                                <aura:iteration items="{!eachRow.fieldArray}" var="eachFields">
                                    <aura:if isTrue="{!eachFields.fieldType == 'PICKLIST' ? 'true' : 'false'}">
                                        <aura:if
                                            isTrue="{!eachFields.fieldapiName == 'Unit_of_Measure__c' ? 'true' : 'false'}">
                                            <td>
                                                <lightning:combobox name="progress" variant="label-hidden"
                                                    value="{!eachFields.fieldapiValue}" placeholder="--None--"
                                                    options="{!eachFields.fieldPicklistvalues}"
                                                    title="{!eachFields.fieldapiValue}"
                                                    required="{!eachFields.isrequired}"
                                                    disabled="{!eachFields.readonly}" />
                                                <!--ITREQ-4855 changed condition for disabled-->
                                            </td>
                                            <aura:set attribute="else">
                                                <!--Begin Rajesh Kumar - SFDC-7608 CPR Historical Data -->
                                                <aura:if
                                                    isTrue="{!eachFields.fieldapiName == 'Status__c' ? 'true' : 'false'}">
                                                    <td>
                                                        <div
                                                            style="display:flex;justify-content: center;align-items: center;width:100%">
                                                            <lightning:combobox variant="label-hidden"
                                                                value="{!eachFields.fieldapiValue}"
                                                                placeholder="--None--"
                                                                options="{!eachFields.fieldPicklistvalues}"
                                                                onchange="{!c.handleChange}"
                                                                required="{!eachFields.isrequired}" label="{!index}"
                                                                name="{!eachFields.fieldapiName}"
                                                                title="{!eachFields.fieldapiValue}"
                                                                disabled="{!eachFields.readonly}" />
                                                        </div>
                                                    </td>
                                                    <aura:set attribute="else">
                                                        <td>
                                                            <lightning:combobox variant="label-hidden"
                                                                value="{!eachFields.fieldapiValue}"
                                                                placeholder="--None--"
                                                                options="{!eachFields.fieldPicklistvalues}"
                                                                onchange="{!c.handleChange}"
                                                                required="{!eachFields.isrequired}" label="{!index}"
                                                                name="{!eachFields.fieldapiName}"
                                                                title="{!eachFields.fieldapiValue}"
                                                                disabled="{!eachFields.readonly}" />
                                                        </td>
                                                    </aura:set>
                                                </aura:if>
                                                <!-- End Rajesh Kumar - SFDC-7608 -->
                                            </aura:set>
                                        </aura:if>
                                    </aura:if>
                                    <aura:if isTrue="{!eachFields.fieldType == 'DATETIME' ? 'true' : 'false'}">
                                        <td>
                                            <lightning:input type="datetime" name="input3"
                                                label="Required Date Time field" variant="label-hidden"
                                                value="{!eachFields.fieldapiValue}" required="{!eachFields.isrequired}"
                                                title="{!eachFields.fieldapiValue}" disabled="{!eachFields.readonly}" />
                                        </td>
                                    </aura:if>
                                    <aura:if isTrue="{!eachFields.fieldType == 'BOOLEAN' ? 'true' : 'false'}">
                                        <td style="text-align: center;">
                                            <lightning:input type="checkbox" label="Checkbox" variant="label-hidden"
                                                name="input2" checked="{!eachFields.fieldapiValue}"
                                                title="{!eachFields.fieldapiValue}" disabled="{!eachFields.readonly}" />
                                        </td>
                                    </aura:if>
                                    <aura:if isTrue="{!eachFields.fieldType == 'TEXTAREA' ? 'true' : 'false'}">
                                        <!--Modifier Rajesh Kumar SFDC-7069-->
                                        <aura:if
                                            isTrue="{!eachFields.fieldapiName == 'Decision_Reason__c' ? 'true' : 'false'}">
                                            <td>
                                                <lightning:textarea name="input3" variant="label-hidden"
                                                    value="{!eachFields.fieldapiValue}"
                                                    required="{!eachFields.isrequired}"
                                                    disabled="{!(eachFields.readonly || not(v.approvedFieldenabled)) }"
                                                    title="{!eachFields.fieldapiValue}" />
                                            </td>
                                            <aura:set attribute="else">
                                                <td>
                                                    <lightning:textarea name="input3" variant="label-hidden"
                                                        value="{!eachFields.fieldapiValue}"
                                                        required="{!eachFields.isrequired}"
                                                        disabled="{!eachFields.readonly}"
                                                        title="{!eachFields.fieldapiValue}" />
                                                </td>
                                            </aura:set>
                                        </aura:if>
                                    </aura:if>
                                    <aura:if isTrue="{!eachFields.fieldType == 'STRING' ? 'true' : 'false'}">
                                        <aura:if isTrue="{!eachFields.fieldapiName == 'Name' ? 'true' : 'false'}">
                                            <td class="sticky-col second-col">
                                                <lightning:input type="text" variant="label-hidden"
                                                    value="{!eachFields.fieldapiValue}"
                                                    required="{!eachFields.isrequired}"
                                                    title="{!eachFields.fieldapiValue}"
                                                    disabled="{!eachFields.readonly}" />
                                            </td>
                                            <aura:set attribute="else">
                                                <td>
                                                    <lightning:input type="text" variant="label-hidden"
                                                        value="{!eachFields.fieldapiValue}"
                                                        required="{!eachFields.isrequired}"
                                                        title="{!eachFields.fieldapiValue}"
                                                        disabled="{!eachFields.readonly}" />
                                                </td>
                                            </aura:set>
                                        </aura:if>
                                    </aura:if>
                                    <aura:if isTrue="{!eachFields.fieldType == 'PERCENT' ? 'true' : 'false'}">
                                        <td>
                                            <lightning:input value="{!eachFields.fieldapiValue}" type="number"
                                                label="Enter a percentage value " formatter="percent-fixed"
                                                variant="label-hidden" required="{!eachFields.isrequired}"
                                                title="{!eachFields.fieldapiValue}" disabled="{!eachFields.readonly}"
                                                maxlength="3" />
                                        </td>
                                    </aura:if>
                                    <aura:if isTrue="{!eachFields.fieldType == 'DOUBLE' ? 'true' : 'false'}">
                                        <!--Modifier Rajesh Kumar SFDC-7069-->
                                        <aura:if
                                            isTrue="{!(eachFields.fieldapiName == 'North_America_Approved_Capacity__c' || eachFields.fieldapiName == 'LATAM_Approved_Capacity__c' || eachFields.fieldapiName =='EMEA_Approved_Capacity__c' || eachFields.fieldapiName =='APJ_Approved_Capacity__c')}">
                                            <!--'OR' Does not work with more than two params https://salesforce.stackexchange.com/questions/178113/lightning-component-or-operator-only-evaluating-first-two-parameters/178119-->
                                            <td>
                                                <div
                                                    style="display: flex;justify-content: center;align-items: center;width:100%">
                                                    <lightning:input value="{!eachFields.fieldapiValue}" type="number"
                                                        variant="label-hidden" required="{!eachFields.isrequired}"
                                                        title="{!eachFields.fieldapiValue}" disabled="true" step="0.001"
                                                        onchange="{!c.handledecimalChange}" min="0" />
                                                    &nbsp;
                                                    <!-- Begin  Rajesh Kumar | SFDC-7368 | Added approved button for each row  -->
                                                    <div onclick="{!c.handleEdit}" data-parent="{!eachRow.recordId}"
                                                        data-id="{!eachRow.uniqueKey}"
                                                        data-record="{!eachFields.fieldapiName}">
                                                        <lightning:buttonIcon iconName="utility:approval"
                                                            disabled="{!(eachFields.readonly || not(v.approvedFieldenabled)) }"
                                                            variant="border-filled" tooltip="Update" />
                                                    </div>
                                                    <div onclick="{!c.handleReset}" data-parent="{!eachRow.recordId}"
                                                        data-id="{!index}" data-record="{!eachFields.fieldapiName}">
                                                        <lightning:buttonIcon iconName="utility:cancel_file_request"
                                                            disabled="{!(eachFields.readonly || not(v.approvedFieldenabled))}"
                                                            variant="border-filled" tooltip="Cancel/NA" />
                                                    </div>
                                                </div>
                                                <!--End SFDC-7368 -->
                                            </td>
                                            <!-- Begin  Rajesh Kumar | SFDC-7368 | Added request button for each row  -->
                                            <aura:set attribute="else">
                                                <aura:if
                                                    isTrue="{!(eachFields.fieldapiName == 'North_America_Capacity__c' || eachFields.fieldapiName == 'EMEA_Capacity__c' || eachFields.fieldapiName =='APJ_Capacity__c' || eachFields.fieldapiName =='LATAM_Capacity__c')}">
                                                    <td>
                                                        <div
                                                            style="display:flex;justify-content: center;align-items: center;width:100%">
                                                            <lightning:input value="{!eachFields.fieldapiValue}"
                                                                type="number" variant="label-hidden"
                                                                required="{!eachFields.isrequired}"
                                                                title="{!eachFields.fieldapiValue}" disabled="true"
                                                                step="0.001" onchange="{!c.handledecimalChange}"
                                                                min="0" />
                                                            &nbsp;
                                                            <!-- Begin  Rajesh Kumar | SFDC-7368 | Added approved button for each row  -->
                                                            <div onclick="{!c.handleEdit}"
                                                                data-parent="{!eachRow.recordId}"
                                                                data-id="{!eachRow.uniqueKey}"
                                                                data-record="{!eachFields.fieldapiName}">
                                                                <lightning:buttonIcon iconName="utility:edit"
                                                                    disabled="{!eachFields.readonly}"
                                                                    variant="border-filled" tooltip="Request" />
                                                            </div>
                                                            <!-- End SFDC-768 -->
                                                        </div>
                                                    </td>
                                                    <aura:set attribute="else">
                                                        <td>
                                                            <lightning:input value="{!eachFields.fieldapiValue}"
                                                                type="number" variant="label-hidden"
                                                                required="{!eachFields.isrequired}"
                                                                title="{!eachFields.fieldapiValue}"
                                                                disabled="{!eachFields.readonly}" step="0.001"
                                                                onchange="{!c.handledecimalChange}" min="0" />
                                                        </td>
                                                    </aura:set>
                                                </aura:if>
                                            </aura:set>
                                        </aura:if>
                                    </aura:if>
                                    <aura:if isTrue="{!eachFields.fieldType == 'DATE' ? 'true' : 'false'}">
                                        <td>
                                            <lightning:input value="{!eachFields.fieldapiValue}" type="date"
                                                label="Enter a percentage value " variant="label-hidden"
                                                onchange="{! c.handleChange }" required="{!eachFields.isrequired}"
                                                title="{!eachFields.fieldapiValue}" disabled="{!eachFields.readonly}" />
                                        </td>
                                    </aura:if>
                                    <aura:if isTrue="{!eachFields.fieldType == 'MULTIPICKLIST' ? 'true' : 'false'}">
                                        <td>
                                            <aura:if isTrue="{!eachFields.readonly}">
                                                <div class="disabled">
                                                    <c:l2qmultiselectdropdown onselect="{!c.handleSelect}"
                                                        uniqueid="{!index}" uniquestring="{!eachFields.fieldapiName}"
                                                        value="{!eachFields.fieldapiValue}"
                                                        title="{!eachFields.fieldapiValue}"
                                                        choice="{!eachFields.fieldPicklistvalues}">
                                                    </c:l2qmultiselectdropdown>
                                                </div>
                                                <aura:set attribute="else">
                                                    <c:l2qmultiselectdropdown onselect="{!c.handleSelect}"
                                                        uniqueid="{!index}" uniquestring="{!eachFields.fieldapiName}"
                                                        value="{!eachFields.fieldapiValue}"
                                                        title="{!eachFields.fieldapiValue}"
                                                        choice="{!eachFields.fieldPicklistvalues}">
                                                    </c:l2qmultiselectdropdown>
                                                </aura:set>
                                            </aura:if>
                                        </td>
                                    </aura:if>
                                </aura:iteration>
                                <td></td>
                            </tr>
                        </aura:iteration>
                    </tbody>
                </table>
            </div>
        </div>
    </aura:if>
    <!-- End component body  -->

    <!-- Begin  Rajesh Kumar | SFDC-7368-->
    <!--Capacity Allocation Modal Comp-->
    <aura:if isTrue="{!v.isModalOpen}">
        <!-- Modal/Popup Box starts here-->
        <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true"
            aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open">
            <div class="slds-modal__container">
                <!-- Begin header -->
                <header class="slds-modal__header">
                    <lightning:buttonIcon iconName="utility:close" onclick="{! c.closeModel }" alternativeText="close"
                        variant="bare-inverse" class="slds-modal__close" />
                    <nav>
                        <span class="links logo">
                            <b>Region : </b> {!v.region} <b> | Event Name : </b> {!v.cprName}
                        </span>
                        <div class="rightSection">
                        </div>
                    </nav>
                </header>
                <!-- End header -->
                <!-- Begin Modal Body  -->
                <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1" style="z-index: 100;">
                    <c:l2q_capacityallocation aura:id="l2qcapacityallocation" region="{!v.region}"
                        parentrecid="{!v.parentrecid}" parentunqid="{!v.parentuniqueid}" forapproval="{!v.forapproval}"
                        inputcountrysplit="{!v.allocatedCapacity}" onchildchanged="{!c.handlecprAllocation}">
                    </c:l2q_capacityallocation>
                </div>
                <!-- End Modal Body  -->
                <footer class="slds-modal__footer">
                    <span style="float:right">
                        <lightning:buttonGroup>
                            <aura:if isTrue="{!(not(v.forapproval)) }">
                                <lightning:button name="ADD ALLOCATIONS" label="ADD" onclick="{!c.addallocations}"
                                    iconName="utility:add" iconPosition="right" />
                                <lightning:button variant="brand" label="UPDATE" title="UPDATE"
                                    onclick="{!c.updateRecords}" class="bgColor" iconName="action:update_status"
                                    iconPosition="right" />
                            </aura:if>
                            <aura:if isTrue="{!v.forapproval}">
                                <lightning:button variant="brand" label="UPDATE" title="ASSIGN CAPACITY"
                                    onclick="{!c.handleApproval}" class="bgColor" iconName="action:update_status"
                                    iconPosition="right" />
                            </aura:if>
                        </lightning:buttonGroup>
                    </span>
                </footer>
            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open"></div>
    </aura:if>
    <!-- End  Rajesh Kumar | SFDC-7368-->
</aura:component>