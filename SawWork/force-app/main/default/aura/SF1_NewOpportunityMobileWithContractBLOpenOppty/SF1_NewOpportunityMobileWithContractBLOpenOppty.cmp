<aura:component controller="SF1_NewOpportunityMobileController">

  <!-- check field : if no open opportunities for selected contracts -->
  <aura:attribute name="noOpenOpportunities" type="Boolean" default="false"/>
  <!-- used to validate if information box for open opportunities should be displayed -->
  <aura:attribute name="openInformation" type="Boolean" default="true"/>
  <!-- used if user decides to proceed with same currency as that of contract -->
  <aura:attribute name="withContractCurrency" type="Boolean" default="false"/>
  <!-- used if user doesn't decide to proceed with same currency as that of contract -->
  <aura:attribute name="withoutContractCurrency" type="Boolean" default="false"/>
  <!-- check field : currencyMismatch for selected contracts -->
  <aura:attribute name="currencyMismatch" type="Boolean" default="false"/>
  <!-- currency for the new Opportunity if created -->
  <aura:attribute name="newCurrency" type="String" default=""/>
  <!-- contract's old Currency-->
  <aura:attribute name="oldCurrency" type="String"/>
  <!-- picklist value for user to select new currency if opted -->
  <aura:attribute name="CurrencyIsoCode" type="List" default="[]"/>
  <!-- details of account recieved from previous component : SF1_NewOpportunityMobileWithContractBL -->
  <aura:attribute name="accountDetails" type="Account"/>
  <!-- Ids of selected Contracts -->
  <aura:attribute name="selectedContractIDs" type="String[]"/>
  <!-- open opportunities -->
  <aura:attribute name="opportunities" type="Opportunity[]"/>
  <!-- Values available in sorting for SF1_NewOpportunityMobileSort component-->
  <aura:attribute name="mapOfFieldNamesForSorting" type="List" default="[
  {'label': 'Name', 'value': 'Name'},
  {'label': 'MRR', 'value': 'MRR__c'},
  {'label': 'Close Date', 'value': 'CloseDate'}
  ]"/>
  <!-- show modal content accordingly -->
  <aura:attribute name="openModalOnClick" type="Boolean" default="false"/>
  <!-- show the particular contracts -->
  <aura:attribute name="contractsToShow" type="List"/>

  <!-- util event for navigation -->
  <aura:registerEvent name="Opportunity Type Identifier" type="c:SF1_NewOpportunityMobileUtilEvent"/>

  <aura:handler name="init" value="{!this}" action="{!c.doInit}"/>
  <!-- util event for Modal -->
  <aura:handler event="c:SF1_NewOpportunityMobileModalEvent" action="{! c.manageModalRendering }"/>
  <!-- sort event -->
  <aura:handler event="c:SF1_NewOpportunityMobileSortEvent" action="{! c.sortOpportunities }"/>

  <header class="slds-docked-composer__header slds-shrink-none" aria-live="assertive">
    <article class="slds-tile slds-tile_board ">
      <div class="slds-grid">
        <div class="slds-col slds-size_1-of-8">
          <lightning:icon iconName="standard:opportunity" size="small" alternativeText="Opportunity"/>
        </div>
        <div class="slds-col slds-size_6-of-8 slds-truncate">
          <h1 class="slds-text-heading--small ">
            <div class="slds-truncate" style="text-align:center; ">Open Opportunities</div>
          </h1>
        </div>
        <div class="slds-col slds-size_1-of-8"></div>
      </div>
    </article>
  </header>
  <c:SF1_CustomLoader />

  <div id="scrollableDiv" class="slds-scrollable_y" style="height: 80vh;">

    <aura:if isTrue="{!v.noOpenOpportunities}">
      <!-- Message when no Opportunities are found for selected contracts -->
      <ui:message title="No Open Opportunities" severity="warning" closable="false">
        for the selected Account, skip to create a new one.
      </ui:message>
    </aura:if>

    <aura:if isTrue="{!v.noOpenOpportunities == false}">
      <!-- Message when Opportunities are found for selected contracts -->

      <aura:if isTrue="{!v.noOpenOpportunities == false? v.openInformation: false}">
        <div>
          <ui:message aura:id="InformationField" title="Information" severity="info" closable="false">
            Below are the open opportunities listed for this account. If you cannot locate your opportunity, skip to create a new one.
          </ui:message>
        </div>
      </aura:if>

      <ul class="slds-has-dividers_around-space ">
        <!-- display opportunities -->
        <aura:iteration items="{!v.opportunities}" var="eachOppty">
          <li class="slds-item slds-color__background_gray-3">
            <c:SF1_NewOpportunityMobileOpptyTile oppty="{!eachOppty}" opptyType="WithContractBL"/>
          </li>
        </aura:iteration>
      </ul>

    </aura:if>
  </div>

  <footer class="slds-docked-composer__footer slds-shrink-none">
    <button type="button" class="slds-button slds-button_neutral" onclick="{!c.moveBack}">Back</button>
    <!-- sorting component -->
    <aura:if isTrue="{! v.noOpenOpportunities == false }">
      <c:SF1_NewOpportunityMobileSort disabled="{! v.noOpenOpportunities }" mapOfFieldNamesForSorting="{! v.mapOfFieldNamesForSorting }"/>
    </aura:if>
    <div class="slds-col_bump-left slds-text-align_right">
      <button type="button" class="slds-button slds-button_brand" onclick="{! c.openCurrencyComponent }">Next</button>
    </div>
  </footer>

  <!-- modal to display contracts -->
  <div class="">
    <div role="dialog" tabindex="-1" aura:id="Modalbox" aria-labelledby="header43" class="slds-modal  slds-modal_large ">
      <div class="slds-modal__container">
        <div class="slds-modal__header">
          <button class="slds-button slds-button--icon-inverse slds-modal__close" onclick="{!c.closeModal}">
            <span>
              <lightning:icon iconName="utility:close" size="medium" alternativeText="close"/>
              <span class="slds-assistive-text">Close</span>
            </span>
          </button>
          <h6 id="modal-heading-01" class="slds-text-heading--small">Associated Contracts</h6>
        </div>
        <div class="slds-modal__content slds-p-around--medium">
          <div>
            <ul class="slds-has-dividers_around-space ">
              <aura:if isTrue="{!v.openModalOnClick }">
                <aura:iteration items="{! v.contractsToShow }" var="eachContract">
                  <li class="slds-item slds-color__background_gray-3">
                    <c:SF1_NewOpportunityMobileContractTile contractType="secondaryContractTile" renewalContract="{! eachContract }"/>
                  </li>
                </aura:iteration>
              </aura:if>
            </ul>
          </div>
        </div>
        <div class="slds-modal__footer">
          <div style="align:">
            <button class="slds-button slds-button--neutral" onclick="{!c.closeModal}">Close</button>
          </div>
        </div>
      </div>
    </div>
    <div class="slds-backdrop" aura:id="ModalClose"></div>
  </div>

</aura:component>