<!--
Author          : Pinkesh / Sumukh SS
Description     : Component for Handler Edit Page. 

Date                 Developer                  JIRA #          Description                                                       
23 Sep 2019         Pinkesh/Sumukh                          SOCC CAR 2 - RunBooks
01 Apr 2021         Tejaswini                 ESESP-4955    Runbooks Phase 2 sprint 2 
25 Jun 2021         Tejaswini                 ESESP-5132    Increasing size of showEscalationContact modal
-->
<aura:component controller="SC_SOCC_EscalationListCtrl" implements="lightning:actionOverride,force:appHostable,flexipage:availableForAllPageTypes,flexipage:availableForRecordHome,force:hasRecordId,forceCommunity:availableForAllPageTypes,force:lightningQuickAction" access="global">
    <!-- List of attributes -->
    <!-- 1. for opening new sub tab -->
    <aura:attribute name="pageReference" type="Object"/>
    <!-- 2. Current record's PD Id -->
    <aura:attribute name="pdId" type="String"/>
    <!-- 3. List of Escalation Lists on this PD (Related List) -->
    <aura:attribute name="lEscalationList" type="Object"/>
    <!-- 4. Escalation List record to be copied -->
    <!-- <aura:attribute name="copiedEscalationListRec" type="Object"/> -->
    <!-- 5. For a particular Escalation List record, list of PD Records available to be copied to -->
    <!-- <aura:attribute name="lPDForCopy" type="Object"/> -->
    <!-- 6. Selected PD Record for copying a particular Escalation List record -->
    <!-- <aura:attribute name="selectedPDIdForCopy" type="String"/> -->
    <!-- 7. Attribute to show/hide Copy PD modal -->
    <!-- <aura:attribute name="isCopyPDModal" type="boolean" default="false"/> -->
    <!-- 8. Attribute to show/hide Delete An Escalation List modal -->
    <aura:attribute name="isDelEscListModal" type="boolean" default="false"/>
    <!-- 9. Escalation List Id to be deleted -->
    <aura:attribute name="delEscalationId" type="String"/>
    <!-- 10. List of Handlers associated to the deleted Escalation List-->
    <aura:attribute name="lHandler" type="Object"/>
    <!-- 11. If any Handler is associated to the deleted EL-->
    <aura:attribute name="isHandlerAssociated" type="boolean" default="false"/>
    <!-- 12. Spinner show/hide attribute -->
    <aura:attribute name="mainSpinner" type="boolean" default="false"/>
    <!-- 10. To check/uncheck all checkboxes -->
    <!-- <aura:attribute name="isSelectAll" type="boolean" default="false"/> -->
    <!-- 11. Attribute to show/hide Delete An Escalation List modal -->
    <!-- <aura:attribute name="isBulkDelEscListModal" type="boolean" default="false"/> -->
    
    <!-- init method to trigger event and pass parameters -->
    <aura:handler name="init" value="{! this }" action="{! c.init }"/>
    <aura:html tag="style">
        #showEscModal{
            width: 85% !important;
            max-width: 85% !important;
        }
    </aura:html>
    <aura:attribute name="showEscalationContact" type="boolean" default="false"/>

    <!-- workspace -->
    <lightning:workspaceAPI aura:id="workspace"/>
    <lightning:navigation aura:id="navService"/>
    
    <aura:if isTrue="{!v.showEscalationContact}">
        <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open slds-modal_medium">
            <div id="showEscModal" class="slds-modal__container">
                <header class="slds-modal__header">
                    <lightning:buttonIcon iconName="utility:close"
                                          onclick="{!c.closeEscContactModal}"
                                          alternativeText="close"
                                          variant="bare-inverse"
                                          class="slds-modal__close"/>
                </header>
                <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1">
                    
                <c:SC_SOCC_EscalationContact_Edit aura:id="escalationContactEditSections" /> 
                </div>
            </div>
        </section>
                        <div class="slds-backdrop slds-backdrop_open"></div>            
    </aura:if>
    <!--loading spinner start... style=Brand Medium (blue dots)-->
    <aura:if isTrue="{!v.mainSpinner}">
        <div aura:id="spinnerId" class="slds-spinner_container" style="z-index: 9999;">
            <div class="slds-spinner--brand  slds-spinner slds-spinner--large slds-is-relative" role="alert">
                <span class="slds-assistive-text">Loading</span>
                <div class="slds-spinner__dot-a"></div>
                <div class="slds-spinner__dot-b"></div>
            </div>
        </div>
    </aura:if>
    <!-- Loading spinner end-->
    
    <!-- Section Heading -->
    <div class="slds-grid slds-gutters">
        <div class="slds-col slds-float_left">
            <span><h2 class="sectionHeading">{!v.lEscalationList.length} Escalation Lists <lightning:helptext
        content="1. Click on the pencil icon to Edit the Escalation List.
                 2. Click on the copy icon to Clone an Escalation List.
                 3. Click on the bin icon to Delete an Escalation List.
                 4. Click on the contact icon to view the associated Escalation Contacts."
    /></h2></span>
        </div>
        <div class="slds-col">
            <!-- button to create new Escalation List - calling component SC_SOCC_EscalationList_CreateEdit -->
            <span class="slds-float_right"><lightning:button variant="brand" label="New Escalation List" onclick="{!c.createEscalationList}"/></span>
            <span class="slds-float_right slds-p-right_xx-small"><button class="slds-button" onclick="{!c.refreshList}"><lightning:icon iconName="action:refresh" size="xx-small" alternativeText="Refresh Data"/></button></span>
        </div>
    </div>
    
    <!--<lightning:input value="{!v.escalationId}" placeholder="Escalation List Id"></lightning:input>-->
    
    <!-- Table to show escalation lists -->
    <div class="slds-p-horizontal_small slds-p-top_small slds-p-bottom_xx-large">
        <table class="slds-table slds-table_cell-buffer slds-table_bordered" style="width:100%" id="escalationListTable">
            <!--Table Header-->
            <thead>
                <tr class="slds-line-height_reset">
                    
                    <th class="slds-text-title_caps" scope="col" style="width: 7%; padding-left: 0.25rem;">
                        <div class="cell-content" >&nbsp;</div>
                    </th>
                    <th class="slds-text-title_caps" scope="col" style="width: 16%;">
                        <div class="cell-content" >Name</div>
                    </th>
                    <th class="slds-text-title_caps" scope="col" style="width: 55%;">
                        <div class="cell-content" >Instructions</div>
                    </th>
                    <th class="slds-text-title_caps" scope="col" style="width: 14%;">
                        <div class="cell-content" >Created By</div>
                    </th>
                    <th class="slds-text-title_caps" scope="col" style="width: 14%;">
                        <div class="cell-content" >Modified By</div>
                    </th>
                </tr>
            </thead>
            <!--Table Body -->
            <tbody>
                <aura:iteration items="{!v.lEscalationList}" var="escListRec">
                    <tr class="slds-hint-parent">
                        
                        <td style="padding-left: 0.25rem;">
                            <div class="slds-grid">
                                <span id="{!'edit_Esc_List_Id-' + escListRec.Id}"  onclick="{!c.editEachEscList}">
                                    <lightning:buttonicon iconName="utility:edit" class="editIcon" variant="bare" title="Edit" alternativeText="Edit" />
                                </span>
                                <span id="{!'copy_Esc_List_Id-' + escListRec.Id}"  onclick="{!c.openCopyEachEscList}">
                                    <lightning:buttonicon iconName="utility:copy" class="copyIcon" variant="bare" title="Copy" alternativeText="Copy" />
                                </span>
                                <span id="{!'del_Esc_List_Id-' + escListRec.Id}"  onclick="{!c.openDelEachEscListModal}">
                                    <lightning:buttonicon iconName="utility:delete" class="delIcon" variant="bare" title="Delete" alternativeText="Delete" />
                                </span>
                                <span id="{!'del_Esc_List_Id-' + escListRec.Id+'-'+escListRec.Policy_Domain__c}"  onclick="{!c.openEscContactModal}">
                                    <lightning:buttonicon iconName="utility:groups" class="ContactIcon" variant="bare" title="View Contacts" alternativeText="View Contacts" />
                                </span>
                            </div>
                        </td>
                        <td>
                            <div class="el-name-cell-content">
                                <a class="a-tag" id="{!'view_Esc_List_Id-' + escListRec.Id}"  onclick="{!c.viewEachEscList}">{!escListRec.Name}</a>
                            </div>
                        </td>
                        
                        <td>
                            <div class="cell-content">
                                <lightning:formattedRichText value="{!escListRec.Instructions__c}"/>
                            </div>
                        </td>
                        <td>
                            <div class="cell-content">
                                {!escListRec.CreatedBy.Name}
                                <br></br>
                                <span style="font-size: x-small;">
                                    <lightning:formattedDateTime value="{!escListRec.CreatedDate}" year="numeric" day="2-digit" month="long" hour="2-digit" minute="2-digit"/>
                                </span>
                            </div>
                        </td>
                        <td>
                            <div class="cell-content">
                                {!escListRec.LastModifiedBy.Name}
                                <br></br>
                                <span style="font-size: x-small;">
                                    <lightning:formattedDateTime value="{!escListRec.LastModifiedDate}" year="numeric" day="2-digit" month="long" hour="2-digit" minute="2-digit"/>
                                </span>
                            </div>
                        </td>
                    </tr>
                </aura:iteration>
            </tbody>
        </table>
    </div>
    
    <!-- Placeholder for modal to copy Escalation to a PD -->
    <div aura:id="EscalationListCopyPlaceHolder">
        {!v.body}
    </div>
    
    <!-- Start of Modal for copy Escalation List to a PD -->
    <!-- <aura:if isTrue="{!v.isCopyPDModal}">
        <div  style="height: 100%;">
            <section role="dialog" tabindex="-1" class="slds-modal slds-fade-in-open slds-modal_small" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1">
                <div class="slds-modal__container">
                    <header class="slds-modal__header">
                        <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" onclick="{!c.closeCopyEscListModal}" title="Close">
                            <lightning:icon class="white slds-icon_small" iconName="utility:close"/>
                            <span class="slds-assistive-text">Close</span>
                        </button>
                        <h2 id="modal-heading-01" class="slds-modal__title slds-hyphenate sectionHeading">Copy Escalation List</h2>
                    </header>
                    <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1">
                        <lightning:recordEditForm objectApiName="SC_SOCC_Escalation_List__c">
                            <div class="slds-grid">
                                <div class="slds-col slds-size_1-of-2">
                                    <lightning:input aura:id="copiedEscalationListName" label="Name" value="{!v.copiedEscalationListRec.Name}" required="true" maxlength="80" messageWhenTooLong="You have exceeded the limit of 80 characters!" variant="label-inline"></lightning:input>
                                </div>
                                <div class="slds-col slds-size_1-of-2">
                                    <lightning:select aura:id="copiedPolicyDomainId" name="copiedPolicyDomainId" label="Policy Domain" value="{!v.selectedPDIdForCopy}" required="true" variant="label-inline" class="slds-form-element_horizontal">
                                        <aura:iteration items="{!v.lPDForCopy}" var="eachPD">
                                            <option value="{!eachPD.Id}">{!eachPD.Name}</option>
                                        </aura:iteration>
                                    </lightning:select>
                                </div>
                            </div> 
                        </lightning:recordEditForm>
                    </div>
                    <footer class="slds-modal__footer">
                        <button class="slds-button slds-button_neutral" onclick="{!c.closeCopyEscListModal}">Cancel</button>
                        <button class="slds-button slds-button_brand" onclick="{!c.saveCopyEachEscList}">Save</button>
                    </footer>
                </div>
            </section>
            <div class="slds-backdrop slds-backdrop_open"></div>
        </div>
    </aura:if> -->
    <!-- End of Modal for copy Escalation List to a PD -->
    
    <!-- Start of Modal delete Escalation List from a PD --> 
    <aura:if isTrue="{!v.isDelEscListModal}">
        <div  style="height: 100%;">
            <section role="dialog" tabindex="-1" class="slds-modal slds-fade-in-open slds-modal_small" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1">
                <div class="slds-modal__container">
                    <header class="slds-modal__header">
                        <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" onclick="{!c.closeDelEscListModal}" title="Close">
                            <lightning:icon class="white slds-icon_small" iconName="utility:close"/>
                            <span class="slds-assistive-text">Close</span>
                        </button>
                        <h2 id="modal-heading-01" class="slds-modal__title slds-hyphenate sectionHeading">Confirmation</h2>
                    </header>
                    <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1">
                        <aura:if isTrue="{!v.isHandlerAssociated}">
                            <p class="slds-text-heading_small">This Escalation List is associated with the following Handlers. Do you still want to continue?</p>
                            <ul class="slds-list--dotted slds-p-around_medium">
                                <aura:iteration items="{!v.lHandler}" var="eachHandler">
                                    <li><b>{!eachHandler.Name}</b></li>
                                </aura:iteration>
                            </ul>
                            <aura:set attribute="else">
                                <p class="slds-text-heading_small" style="text-align: center;">Are you sure you want to delete this Escalation List?</p> 
                            </aura:set>
                        </aura:if>
                    </div>
                    <footer class="slds-modal__footer">
                        <button class="slds-button slds-button_neutral" onclick="{!c.closeDelEscListModal}">No</button>
                        <button class="slds-button slds-button_brand" onclick="{!c.confirmDelEachEscList}">Yes</button>
                    </footer>
                </div>
            </section>
            <div class="slds-backdrop slds-backdrop_open"></div>
        </div>
    </aura:if>
    <!-- End of Modal delete Escalation List from a PD -->
    
    <!-- Start of Modal bulk delete Escalation List from a PD -->
    <!-- <aura:if isTrue="{!v.isBulkDelEscListModal}">
        <div  style="height: 100%;">
            <section role="dialog" tabindex="-1" class="slds-modal slds-fade-in-open slds-modal_small" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1">
                <div class="slds-modal__container">
                    <header class="slds-modal__header">
                        <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" onclick="{!c.closeBulkDelEscListModal}" title="Close">
                            <lightning:icon class="white slds-icon_small" iconName="utility:close"/>
                            <span class="slds-assistive-text">Close</span>
                        </button>
                        <h2 id="modal-heading-01" class="slds-modal__title slds-hyphenate sectionHeading">Confirmation</h2>
                    </header>
                    <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1">
                       <p style="text-align: center;">Are you sure you want to delete these Escalation Lists?</p> 
                    </div>
                    <footer class="slds-modal__footer">
                        <button class="slds-button slds-button_neutral" onclick="{!c.closeBulkDelEscListModal}">No</button>
                        <button class="slds-button slds-button_brand" onclick="{!c.bulkDeleteEscalationList}">Yes</button>
                    </footer>
                </div>
            </section>
            <div class="slds-backdrop slds-backdrop_open"></div>
        </div>
    </aura:if> -->
    <!-- End of Modal bulk delete Escalation List from a PD -->
    
</aura:component>