<aura:component implements="force:hasRecordId,force:lightningQuickAction,lightning:actionOverride" access="global" controller="IW_getRequestWatchers">

    <aura:attribute name="modalContext" type="String" default="New" /> 
    <aura:attribute name="iwDetails" type="Investment_Workbox__c" />
    <aura:attribute name="selectedProdOptions" type="String[]" access="public" default="[]"/>
    <aura:attribute name ="selectedValParm" type="string" default=""/>
    <aura:attribute name="isEditAvailable" type="string" default="true"/>
    <aura:attribute name="status" type="string" default=""/>
    <aura:attribute name="disableBtn" type="boolean" default="false"/>
    <aura:attribute name="recordId" type="string" default=""/>
    <aura:attribute name="availableLoeBud" type="integer" default="0"/>
    <!--show component -->
    <aura:attribute name="showBudget" type="boolean" default="false"/>
    <aura:attribute name="displayOtherField" type="boolean" default="true"/>
    <!--19.5 to display proj lookup based on Account-->
    <aura:attribute name="displayProjectForSecurity" type="boolean" default="false"/>
    <!--19.5 to toggle Account based on Security check-->
    <aura:attribute name="toggleSecurity" type="boolean" default="false"/>
    <aura:attribute name="accountId" type="string"/>
    <aura:attribute name="internalAccountid" type="string"/>
    <aura:attribute name="hasProduct" type="boolean" default="true"/>
    
    <!--For ProjectRec on IW creation used in Lookupcomponent -->
    <aura:attribute Name="projRec" type="object" access="public" />
    <!-- 20.5 for IW Opprtunity lookup-->
    <aura:attribute Name="oppRec" type="object" access="public" />
    <aura:attribute name="AccId" type="string" default=""/><!--19.5-->
    <aura:attribute name="OwnerId" type="string" default=""/>
    
    <aura:attribute name="Geography" type="string" default=""/>
    <aura:attribute name="Region" type="string" default=""/>
    <!-- <aura:attribute name="Division" type="string" default=""/> -->
    <aura:attribute name="Area" type="string" default=""/>
    <aura:attribute name="Zone" type="string" default=""/>
    <aura:attribute name="Territory" type="string" default=""/>
    
    <!-- attributes used for LOE Minutes Picklist -->
    <aura:attribute name="hardcoded" type="string" default="0"/>
    <aura:attribute name="loeMinsPickList" type="string" default="0"/>
    <aura:attribute name="options" type="List" default="[
                                    {'label': '0', 'value': '0'},
                                    {'label': '15', 'value': '15'},
                                    {'label': '30', 'value': '30'},
                                    {'label': '45', 'value': '45'},
                                    ]"/>

    <aura:attribute name="classificationOptions" type="List" access="PRIVATE"/>
    <aura:attribute name="allclassificationOptions" type="List" access="PRIVATE"/>
    <aura:attribute name="productSelectedValue" type="String" access="PRIVATE"/>
    <aura:attribute name="ClassificationOutput" type="String" />
    
    
    <!-- recordUpdated to get values on loading time of the page-->
    <force:recordData aura:id="forceRecord"
                      recordId="{!v.recordId}"
                      targetFields="{!v.iwDetails}"
                      fields="Products__c,Status__c,Account__c,Account__r.Name,Comments__c,
                              Name,Opportunity__c,Opportunity_Name__c, IW_Classification__c , Product_BU__c ,Work_Type__c,Watchers_Name__c,WatchersId__c,Security__c,Project__c,
                              Project_Name__c, Escalated__c,Justification__c,LOE_Hours__c,LOE_Minutes__c,Others__c,IW_Modify__c,
                              Requestor__c,Time_To_Action__c,isProductSelected__c,Potentially_Chargeable__c"
                      mode="EDIT"
                      recordUpdated="{!c.handleRecordUpdated}"
                       />
    
    <aura:handler name="init" value="{!this}" action="{!c.doInit}" />
    <!--    <aura:handler event="aura:waiting" action="{!c.waiting}{!v.HideSpinner}"/>
<aura:handler event="aura:doneWaiting" action="{!c.doneWaiting}"/>-->
    <aura:attribute name="HideSpinner" type="Boolean" default="false"/>
    <aura:renderIf isTrue="{!v.HideSpinner}">
        <div class="slds-spinner_container" style="top: -7rem; height: calc(100% + 8rem);">
            <div class="slds-spinner--brand slds-spinner slds-spinner--large" role="alert">
                <span class="slds-assistive-text"></span>
                <div class="slds-spinner__dot-a"></div>
                <div class="slds-spinner__dot-b"></div>
            </div>
        </div>
    </aura:renderIf>
    
    
    
    <div aura:id="editDialog" role="dialog" tabindex="-1" aria-labelledby="header43" class="slds-modal slds-fade-in-open">
        <div class="slds-modal__container">
            <div class="slds-modal__header">
                <h2 class="slds-text-heading--medium">{!v.modalContext} Record</h2>
            </div>
            <aura:if isTrue="{!v.isEditAvailable}">
                <div class="slds-modal__content slds-p-around--large slds-grid slds-wrap" style="display:flex;min-width:30vw;" >
                    <div class = "slds-grid slds-gutters">
                        
                        <div class="slds-p-horizontal_x-small slds-size--7-of-12" style="min-width:35.5vw;!important;max-width:37vw;!important">
                            
                            <lightning:recordEditForm aura:id="editFormAccount" recordId="{!v.recordId}" objectApiName="Investment_Workbox__c" onsubmit="{!c.onRecordSubmit}" onsuccess="{!c.onRecordSuccess}" onerror="{!c.onRecordError}">
                                
                                <lightning:inputField fieldName="Account__c" aura:id="accountField" onchange="{!c.getLoeBudget}"/>
                                <aura:if isTrue="{!v.accountId}">
                                <!--<aura:if isTrue="false">-->
                                   <!-- <c:IW_AccountDetailsComponent recordId="{!v.accountId}"/><br/>-->
                                    <lightning:card iconName="standard:account" title="Account Details">
                                        <div class="accountDetailTopCls">
                                            <div class="accountDetailLeftSecCls" style="width:17vw;padding:1rem;">
                                                <label style="color:rgb(27, 82, 151);">Owner Id:</label> <i>&nbsp;{!v.OwnerId}</i><br/>
                                                <label style="color:rgb(27, 82, 151);">Region:  </label> <i>&nbsp;{!v.Region}</i><br/>
                                                <label style="color:rgb(27, 82, 151);">Zone: </label> <i>&nbsp;{!v.Zone}</i><br/>
                                            </div>
                                            <div class="accountDetailRightSecCls" style="width:17vw;padding:1rem;">
                                                <label style="color:rgb(27, 82, 151);">Geography: </label> <i>&nbsp;{!v.Geography}</i><br/>
                                                <label style="color:rgb(27, 82, 151);">Area:    </label> <i>&nbsp;{!v.Area}</i><br/>
                                                <label style="color:rgb(27, 82, 151);">Territory: </label> <i>&nbsp;{!v.Territory}</i><br/>
                                            </div>
                                        </div>
                                        
                                    </lightning:card>
                                </aura:if>
                                <!--Added custom combobox to load values dynamicall into field after selecting account-->
                                <lightning:combobox label="IW Classification" class="customRequired block" aura:id="iwClassificationCustom" placeholder="Select an Option" onchange="{! c.handleClassificationChange }" options="{! v.classificationOptions }"  />
                                <!--20.6 Use boolean flag to show the budget-->
                                <aura:if isTrue="{!v.showBudget}">
                                    <!--To be removed-->
                                    <!--<c:IW_AccountDetailsComponent recordId="{!v.accountId}" accountName="Account Details"/><br/>-->
                                    <!-- To be removed-->
                                    <div class="slds-col" style=" padding-top: 8px; padding-left: 0px; " >
                                        <span><b>Available LOE Budget ( </b> {!v.ClassificationOutput} <b> ) :</b>  {!v.availableLoeBud} hrs</span>
                                    </div> <br/>  
                                </aura:if>                                
                                <lightning:inputField fieldName="Opportunity__c" aura:id="opportunityField" style="display: none;"/>
                                <div class="slds-form-element__control" >
                                        <!--<abbr title="required" class="slds-required" >*</abbr>-->
                                        <label class="slds-form-element__label Opportunityy" for="input-id-02">Opportunity</label>
                                        <c:InvWB_Lookup objectName="Opportunity"
                                                        field_API_text="Name"
                                                        field_API_val="Id"
                                                        limit="5"
                                                        field_API_search="Name"
                                                        search_ProjForAcc = "{!v.accountId}"
                                                        lookupIcon="standard:opportunity" 
                                                        selItem="{!v.oppRec}" 
                                                        placeholder="Enter space after text to search Opportunity"
                                                        aura:id="oppLookupId"
                                                        />
                                    </div>
                                
                               <!-- <div style="width: 100%; overflow: hidden;">
                                    <div style="width:6px; float: left;" class="slds-required"> * </div>
                                    <div>
                                    <lightning:inputField fieldName="Requestor__c" aura:id="requestorField"/>
                                    </div>
                                </div>-->
                                <lightning:inputField fieldName="Requestor__c" aura:id="requestorField" class="customRequired block"/>
                                
                                <div style="padding-top: 10px;padding-bottom: 10px;display: none; ">
                                    <lightning:inputField fieldName="IW_Classification__c" aura:id="iwClassification" />
                                </div>

                                <div style="padding-top: 10px;padding-bottom: 10px;">
                                    <lightning:inputField fieldName="Product_BU__c" aura:id="productBU" />
                                </div>

                                

                                <!-- <lightning:select label="Product BU" aura:id="colorId" required="true" value="{!v.ProductselectedValue}">
                                    <aura:iteration items="{!v.productOptions}" var="option">
                                        <option text="{!option.label}" value="{!option.value}" selected="{!option.selected}"/>
                                    </aura:iteration>
                                </lightning:select> -->

                                <!-- <lightning:combobox name="general" label="Product BU"  aura:id="productBUCustom" placeholder="Select an Option" options="{! v.productOptions }" /> -->

                                <!--19.5 showing Geo level Slots and Adding Project to entry when the Security checkbox is checked-->
                                <aura:if isTrue="{!and(v.displayProjectForSecurity, v.toggleSecurity)}">
                                     <!--<div class="slds-col">
                                        <span><b>Available LOE Budget(Security Slots) :</b> {!v.availableLoeBud} hrs</span>-->
                                    <!--</div> <br/>-->
                                    <!--<lightning:inputField fieldName="Project__c" aura:id="ProjectField"/>-->
                                    <div class="slds-form-element__control">
                                        <abbr title="required" class="slds-required" >*</abbr>
                                        <label class="slds-form-element__label" for="input-id-02">Project</label>
                                        <c:InvWB_Lookup objectName="pse__Proj__c"
                                                        field_API_text="Name"
                                                        field_API_val="Id"
                                                        limit="4"
                                                        field_API_search="Name"
                                                        lookupIcon="standard:user" 
                                                        selItem="{!v.projRec}" 
                                                        search_ProjForAcc = "{!v.accountId}"
                                                        search_ProjRecType = "Non-Internal Project"
                                                        placeholder="Enter space after text to search Project"
                                                        aura:id="projLookupId"
                                                        render="false"
                                                        />
                                    </div>
                                    <lightning:inputField fieldName="Project__c" aura:id="projectField" style="display: none;"/>
                                </aura:if>

                                <lightning:inputField fieldName="Justification__c" aura:id="justificationField"/>
                                <lightning:inputField fieldName="Work_Type__c" aura:id="workTypeField" />
                                <!-- <aura:if isTrue="{!v.displayOtherField}">
                                    <lightning:inputField fieldName="Others__c" aura:id="othersField"/>
                                </aura:if> -->
                                <!--19.1 : FFPSA-793 Removing TimeToAction field as part of  -->
                                <!--<lightning:inputField fieldName="Time_To_Action__c" aura:id="timeToActionField"/>-->
                                
                                <lightning:inputField fieldName="WatchersId__c" aura:id="watchersField" style="display: none;"/>
                                <lightning:inputField fieldName="LOE_Hours__c" aura:id="loeHrField" />
                                <!-- converting LOE Minutes to a Picklist -->
                                <lightning:inputField fieldName="LOE_Minutes__c" aura:id="loeMinField" style="display: none;" />
                                <!-- 19.11 Made LOE_Minutes__cPickList invisible as part of FFPSA-1183  -->
                                <lightning:combobox name="LOE_Minutes__cPickList" label="LOE Minutes" value="{! v.hardcoded}" placeholder="" options="{! v.options }" onchange="{! c.handleChange }" style="display: none;"/>
                                
                                <!-- 19.1.2 Added field Program__c as part of FFPSA-798  -->
                                <!-- <lightning:inputField fieldName="Program__c" aura:id="programField" /> -->
                                <lightning:inputField fieldName="Comments__c" aura:id="commentField"/><br/>
                                <lightning:inputField fieldName="Products__c" aura:id="productsField" style="display: none;"/>
                                <lightning:inputField fieldName="Status__c" aura:id="statusField" style="display: none;"/>
                                <lightning:inputField fieldName="isProductSelected__c" aura:id="isProdSelectedField" style="display: none;"/>
                                <lightning:inputField fieldName="IW_Modify__c" aura:id="isModifyField" style="display: none;"/>
                                
                            </lightning:recordEditForm>
                            
                        </div>
                        <div class="slds-modal__content slds-p-around--large slds-grid slds-wrap slds-size--5-of-12" style="display:flex;padding:0.5rem; min-width:35vw;!important;max-width:37vw;!important" >
                            <aura:if isTrue="{! ((v.iwDetails.Products__c || v.recordId == '') || (v.iwDetails.isProductSelected__c))}"> 
                                <c:SearchRecordsCheckboxDisplay queryString="select Product_Name__c from EB_Product__c where EB_ProductType__c = 'Product' group by Product_Name__c limit 10000"
                                                                                                                                                                          fieldAPIName="Product_Name__c"
                                                                                                                                                                          objectType="EB_ProductType__c"
                                                                                                                                                                          objectDisplayName="Products"
                                                                                                                                                                          selectedOpts="{!v.selectedProdOptions}"
                                                                                                                                                                          selectedValuesParam="{!v.iwDetails.Products__c}"
                                                                                                                                                                          
                                                                                                                                                                          />
                            </aura:if>
                        </div>
                    </div>
                </div>
                <div class="slds-modal__footer">
                    <lightning:button variant="neutral" label="Cancel" onclick="{!c.cancelDialog}" aura:id="cancelBtnId" />
                    <lightning:button variant="brand" type="save" value="save" label="Save" onclick="{!c.onRecordSubmit}" aura:id="saveBtnId" disabled ="{!v.disableBtn}"/>
                    <lightning:button variant="brand" type="submit" value = "submit" label="Submit" onclick="{!c.onRecordSubmit}" aura:id="submitBtnId" disabled ="{!v.disableBtn}"/>
                </div>
            </aura:if>
        </div>
        
    </div>
    <div aura:id="overlay" class="slds-backdrop slds-backdrop--open"></div>
</aura:component>