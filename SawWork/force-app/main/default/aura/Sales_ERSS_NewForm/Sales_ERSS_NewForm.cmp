<aura:component implements="force:appHostable,lightning:isUrlAddressable,lightning:actionOverride,force:hasRecordId" 
                controller="Sales_ERSS_FormController">
    <!-- Sales_ERSS_NewForm component
      View/Create new RSS Forms, Publish, Update products, trasfer ownership etc
      Developer Date         Comments
      Saurabh   17/Jan/2020  SFDC-5820 Initial version for Lightning migration of ERSS
 -->   
    
    <aura:attribute name="newERSSForm" type="RSS_Form__c" default="{ 'sobjectType': 'RSS_Form__c','Name': '','Opportunity__c' : null}"/>
    <aura:attribute name="productOptions" type="Survey__c[]" />
    <aura:attribute name="selectedProductOptions" type="String[]" />
    <aura:attribute name="existingOptions" type="String[]" />
    <aura:attribute name="existingRSSForm" type="String" />
    <aura:attribute name="rSSFormRecordTypeId" type="String" />
    <aura:attribute name="isClassic" type="boolean" default = "false"/>
 
    <aura:attribute name="showProducts" type="Boolean" />
    <aura:attribute name="accountInformation" type="Object"/>
    <aura:attribute name="showOppError" type="Boolean" />
    <aura:attribute name="incompleteProducts" type="String[]" />
    <aura:attribute name="showProductError" type="Boolean" />
    <aura:attribute name="published" type="Boolean" />
    <aura:attribute name="permissionMap" type="Object" />
    <aura:attribute name="activeSections" type="List" default="['formdetail','oppsection','productsection','previousversions']" />
    <aura:attribute name="isModalOpen" type="boolean" default="false"/>
    <aura:attribute name="publishModalOpen" type="boolean" default="false"/>
    <aura:attribute name="publishComments" type="String" />
    
    <aura:attribute name="contactList" type="Object" />
    <aura:attribute name="previousForms" type="Object" />
    <aura:attribute name="readOnlyMode" type="boolean"/>
    <aura:attribute name="stage" type="String"/>
    <aura:attribute name="version" type="String"/>
    <aura:attribute name="ownerModalOpen" type="boolean" default="false"/>
    <aura:attribute name="newOwnerId" type="String"/>
    <aura:attribute name="ownerComments" type="String"/>
    <aura:attribute name="updateProductModalOpen" type="Boolean"/>
    <aura:attribute name="diffModalOpen" type="Boolean"/>
    <aura:attribute name="diffText" type="Object" />
    
    
    
    <aura:attribute name="invalidProductTemplates" type="List"/>
    <aura:attribute name="files" type="List"/>
    <aura:attribute name="questionResponse" type="SurveyQuestionResponse__c[]"/>
    
    <aura:attribute name="value" type="Object"/>
    <aura:attribute name="productOptionsView" type="Survey__c[]" />
    <aura:attribute name="loading" type="boolean" default="false"/>
    <aura:attribute name="isMobile" type="boolean" default="false"/>
    
    <!-- Classic fields used on broken lIghtning out -->
    <aura:attribute name="classicToastError" type="String"/>
    <aura:attribute name="classicToastSuccess" type="String"/>
    <aura:attribute name="createdbyClassic" type="String"/>
    <aura:attribute name="ownerIdClassic" type="String"/>
    <aura:attribute name="publishedFormClassic" type="String"/>
    <aura:attribute name="publishedByClassic" type="String"/>
    <aura:attribute name="opportunityClassic" type="String"/>
    
    
    <!-- Init Method -->
    <aura:handler name="init" value="{!this}" action="{!c.doInit}"/>
    
    <lightning:navigation aura:id="navToSelf"/>
    
    <!-- PAGE HEADER --> 
    
    
    
    <div class="{!(v.isMobile?'maintab':'')}">
        <aura:if isTrue="{! and(v.isClassic,v.classicToastError != null)}">
            
            <div class="slds-notify slds-notify_alert slds-theme_alert-texture slds-theme_error" role="alert">
  <span class="slds-assistive-text">error</span>
  <lightning:icon size="x-small" iconName="utility:error" variant ="inverse" />
                 &nbsp;
  <h2>{!v.classicToastError}
    
  </h2>
                
  <div class="slds-notify__close">
    <button class="slds-button slds-button_icon slds-button_icon-small slds-button_icon-inverse" title="Close" onclick="{!c.closeError}">
      <lightning:icon size="x-small" iconName="utility:close" variant ="inverse" />
      <span class="slds-assistive-text">Close</span>
    </button>
  </div>
</div>
        </aura:if>
        
        <aura:if isTrue="{! and(v.isClassic,v.classicToastSuccess != null)}">
            <div class="slds-notify slds-notify_alert slds-theme_alert-texture slds-theme_success" role="alert">
  <span class="slds-assistive-text">Success</span>
  <lightning:icon size="x-small" iconName="utility:success" variant ="inverse" />
                &nbsp;
  <h2>{!v.classicToastSuccess}
    
  </h2>
  <div class="slds-notify__close">
    <button class="slds-button slds-button_icon slds-button_icon-small slds-button_icon-inverse" title="Close" onclick="{!c.closeSuccess}">
      <lightning:icon size="x-small" iconName="utility:close" variant ="inverse" />
      <span class="slds-assistive-text">Close</span>
    </button>
  </div>
</div>
        </aura:if>
        <lightning:tabset  aura:id="mainTab" selectedTabId="formTab" >
            
            <lightning:tab label="Form" id="formTab" class="{!(v.isMobile?'formtabclassmobile':'formtabclass')}" iconName="doctype:gform">
                
                <div class="{!'slds-grid slds-gutters slds-grid_align-center '+' '+(v.isMobile?'form_insidetab_mobile':'form_insidetab')}">
                    
                    
                    <div class="{!(v.isMobile?'slds-box slds-theme--default boxmargin slds-scrollable_y slds-container_fluid mainWrapMobile':'slds-box slds-theme--default boxmargin  slds-scrollable_y slds-container_x-large mainWrap')}">
                        <ui:scrollerWrapper class="{!(v.isMobile?'scrollHeightMobile':'scrollHeight1')}"> 
                            
                            <lightning:recordEditForm aura:id="eRSSCreateForm"
                                                      objectApiName="RSS_Form__c"
                                                      onsubmit="{!c.saveRecord}"
                                                      onsuccess="{!c.handleSuccess}"
                                                      onload="{!c.handleLoad}"
                                                      onerror="{!c.errorForm}"
                                                      recordId="{!v.existingRSSForm}"
                                                      recordTypeId ="{!v.rSSFormRecordTypeId}"
                                                      class="slds-card__body_inner "
                                                      density="comfy"
                                                      >      
                                <lightning:messages />
                                
                                <lightning:accordion
                                                     allowMultipleSectionsOpen="true"
                                                     
                                                     activeSectionName="{! v.activeSections }"
                                                     
                                                     >
                                    <lightning:accordionSection name="formdetail" label="Form" >
                                        <aura:set attribute="body"> 
                                            
                                            <lightning:inputField label="Form Name"
                                                                  name="formName"
                                                                  fieldName="Name"
                                                                  required="true"
                                                                  disabled="{!v.readOnlyMode}"
                                                                  /> 
                                            
                                            <div style="display:none">
                                                <lightning:inputField label="Form Name"
                                                                      aura:id="contactjson"
                                                                      
                                                                      fieldName="Contacts_JSON__c"
                                                                      /> 
                                                
                                                <lightning:inputField label="Account"
                                                                      aura:id="accountInput"
                                                                      
                                                                      fieldName="Account__c"
                                                                      /> 
                                                <lightning:inputField label="TSP"
                                                                      aura:id="tspnameInput"
                                                                      
                                                                      fieldName="TSP__c"
                                                                      /> 
                                                <lightning:inputField label="AEName"
                                                                      aura:id="aenameInput"
                                                                      
                                                                      fieldName="AEName__c"
                                                                      /> 
                                                <lightning:inputField label="Partner Involved"
                                                                      aura:id="partnerinvlolveInput"
                                                                      
                                                                      fieldName="Partner_Involved__c"
                                                                      /> 
                                                <lightning:inputField label="Partner Name"
                                                                      aura:id="partnernameInput"
                                                                      
                                                                      fieldName="Partner_Name__c"
                                                                      /> 
                                                <lightning:inputField label="Form Stage"
                                                                      aura:id="formstageInput"
                                                                      
                                                                      fieldName="Form_Stage__c"
                                                                      /> 
                                                <lightning:inputField label="Form Version"
                                                                      aura:id="formversion"
                                                                      
                                                                      fieldName="Version__c"
                                                                      /> 
                                                
                                                <lightning:inputField label="Form Createdby"
                                                                      aura:id="createdbyClassic"
                                                                      
                                                                      fieldName="CreatedById"
                                                                      /> 
                                                <lightning:inputField label="Form owner"
                                                                      aura:id="ownerIdClassic"
                                                                      
                                                                      fieldName="OwnerId"
                                                                      />
                                                <lightning:inputField label="Form published"
                                                                      aura:id="publishedFormClassic"
                                                                      
                                                                      fieldName="Parent_RSS_Form__c"
                                                                      /> 
                                                <lightning:inputField label="Form publishedby"
                                                                      aura:id="publishedByClassic"
                                                                      
                                                                      fieldName="Published_by__c"
                                                                      /> 
                                                 <lightning:inputField label="Form opportunity"
                                                                      aura:id="opportunityClassic"
                                                                      
                                                                      fieldName="Opportunity__c"
                                                                      /> 
                                                
                                            </div>
                                            
                                            
                                            
                                            <table style="table-layout:fixed">
                                                <tr><td>
                                                     <aura:if isTrue="{! !v.isClassic}">
                                                      <lightning:outputField fieldName="CreatedById" />
                                                    </aura:if>
                                                    <aura:if isTrue="{! v.isClassic}">
                                                        
                                                        <a href="{!'/'+v.createdbyClassic}"><lightning:outputField fieldName="CreatedById"/></a>
                                                    </aura:if>
                                                    </td>
                                                </tr>
                                                <tr><td>
                                                    <aura:if isTrue="{! !v.isClassic}">
                                                    <lightning:outputField label="Owner"
                                                                               name="formOwner"
                                                                               fieldName="OwnerId"
                                                                               /> 
                                                    </aura:if>
                                                    <aura:if isTrue="{! v.isClassic}">
                                                        <a href="{!'/'+v.ownerIdClassic}"> <lightning:outputField label="Owner"
                                                                               name="formOwner"
                                                                               fieldName="OwnerId"
                                                                                                                    /> </a>
                                                    </aura:if>
                                                    </td>
                                                    <aura:if isTrue="{!and(v.accountInformation.ownerTitle != null,v.accountInformation.ownerTitle != '')}">
                                                        <td>
                                                            <div class="slds-form-element__label" style="vertical-align:bottom;">
                                                                <aura:text value="Owner Title"/>
                                                            </div>
                                                            <div class="slds-form-element" style="vertical-align:bottom;">
                                                                <aura:text value="{!v.accountInformation.ownerTitle}"/>
                                                            </div>
                                                        </td>
                                                    </aura:if>
                                                    
                                                </tr>
                                                <tr><td >
                                                    <label class="slds-form-element__label">&nbsp;Version</label>
                                                    <div style="padding-left:1%">
                                                        <span > {!v.version}
                                                            
                                                        </span>
                                                    </div>
                                                    </td>
                                                    <td style="text-align:left">
                                                        <aura:if isTrue="{! v.stage=='Draft'}">
                                                            <lightning:icon size="x-small" iconName="standard:document" alternativeText="Draft" />
                                                        </aura:if>
                                                        <aura:if isTrue="{! v.stage=='Published'}">
                                                            <lightning:icon size="x-small" iconName="standard:task2" alternativeText="Published" />
                                                        </aura:if>
                                                        <aura:if isTrue="{! v.stage=='Voided'}">
                                                            <lightning:icon size="x-small" iconName="standard:first_non_empty" alternativeText="Voided" />
                                                        </aura:if>
                                                        <aura:if isTrue="{! v.stage=='Revised'}">
                                                            <lightning:icon size="x-small" iconName="standard:record_update" alternativeText="Revised" />
                                                        </aura:if>
                                                        <lightning:badge label="{!v.stage}"/>
                                                        <aura:if isTrue="{! v.stage=='Draft'}">
                                                        
                                                        <aura:if isTrue="{! !v.isClassic}">
                                                            
                                                            &nbsp; <sup> <lightning:helptext content="This is a new and unpublished version."/></sup>
                                                        </aura:if>
                                                        <aura:if isTrue="{! v.stage=='Published'}">
                                                            &nbsp; <sup>  <lightning:helptext content="This is the latest version of the form and is readonly."/></sup>
                                                        </aura:if>
                                                        <aura:if isTrue="{! v.stage=='Voided'}">
                                                            &nbsp; <sup> <lightning:helptext content="This version is outdated and is superseded by a new published version."/></sup>
                                                        </aura:if>
                                                        <aura:if isTrue="{! v.stage=='Revised'}">
                                                            &nbsp; <sup>  <lightning:helptext content="This is a revision version of the current latest version."/></sup>
                                                        </aura:if>
                                                        </aura:if>
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                    <td style="padding-left:0%">
                                                        <aura:if isTrue="{!and(and(v.accountInformation.version != 0,v.accountInformation.version != null) ,!(v.accountInformation.published))}">
                                                            
                                                            <label class="slds-form-element__label">&nbsp;Published Form</label>
                                                            <div style="padding-left:1%">
                                                                <aura:if isTrue="{! !v.isClassic}">
                                                                <lightning:outputField fieldName="Parent_RSS_Form__c" variant="label-hidden"/>
                                                                </aura:if>
                                                                <aura:if isTrue="{! v.isClassic}">
                                                                    <a href="{!'/'+v.publishedFormClassic}"><lightning:outputField fieldName="Parent_RSS_Form__c" variant="label-hidden"/></a>
                                                                </aura:if>
                                                            </div>
                                                            
                                                        </aura:if>
                                                        <aura:if isTrue="{!and(v.stage=='Published',!v.accountInformation.revisePermission)}">
                                                            <!-- <label class="slds-form-element__label">&nbsp;Revised Form</label>
                                                <div class="slds-truncate" style="padding-left:1%">
                                                    <a href="{!'/lightning/cmp/c__Sales_ERSS_NewForm?c__id='+v.accountInformation.reviseFormId}" tabindex="-1" target="_blank" >{!v.accountInformation.reviseFormName}</a>
                                                </div> -->
                                                        </aura:if>
                                                    </td>
                                                </tr>
                                                <aura:if isTrue="{!and(v.accountInformation.version != 0,v.accountInformation.version != null)}">
                                                    
                                                    <tr>
                                                        <td >
                                                            <aura:if isTrue="{! !v.isClassic}">
                                                              <lightning:outputField fieldName="Published_by__c" />
                                                            </aura:if>
                                                            <aura:if isTrue="{! v.isClassic}">
                                                                <a href="{!'/'+v.publishedByClassic}"><lightning:outputField fieldName="Published_by__c" /></a>
                                                            </aura:if>
                                                        </td>
                                                        <td >
                                                            <lightning:outputField fieldName="Published_Date__c" />
                                                        </td>        
                                                    </tr>
                                                    <tr>
                                                        <td >
                                                            <lightning:outputField fieldName="Publisher_comments__c" aura:id="pubcomment"/>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td >
                                                            <lightning:outputField fieldName="Ownership_comments__c" aura:id="ownercomment"/>
                                                        </td>
                                                    </tr>
                                                </aura:if>
                                            </table>
                                        </aura:set>
                                    </lightning:accordionSection>                          
                                    <lightning:accordionSection name="oppsection" label="Opportunity"> 
                                        <aura:set attribute="body">
                                            <aura:if isTrue="{!!v.readOnlyMode}">
                                                <div class="slds-form-element" aura:id="oppFieldDiv"> 
                                                    <lightning:inputField  label="Opportunity"
                                                                          aura:id="oppField"
                                                                          name="opportunity"
                                                                          fieldName = "Opportunity__c" 
                                                                          onchange ="{!c.onOpportunitySet}"  
                                                                          disabled="{!v.readOnlyMode}"
                                                                          />
                                                    <aura:if isTrue="{!v.showOppError}">
                                                        <div class="slds-form-element__help" id="form-error-01">This field is required for Publishing the Form</div>
                                                    </aura:if>
                                                </div>
                                            </aura:if>
                                            <aura:if isTrue="{!v.readOnlyMode}">
                                                 <aura:if isTrue="{! !v.isClassic}">
                                                <lightning:outputField  label="Opportunity"
                                                                       name="opportunity"
                                                                       fieldName = "Opportunity__c" 
                                                                       />
                                                </aura:if>
                                                 <aura:if isTrue="{! v.isClassic}">
                                                     <a href="{!'/'+v.opportunityClassic}">
                                                      <lightning:outputField  label="Opportunity"
                                                                       name="opportunity"
                                                                       fieldName = "Opportunity__c" 
                                                                             /> </a>
                                                </aura:if>
                                            </aura:if>
                                            
                                            <aura:if isTrue="{!v.accountInformation}">
                                                <lightning:tile >
                                                    <table >
                                                        <tr><td class="padded">
                                                            <div class="slds-form-element__label">
                                                                <aura:text value="Account:"/>
                                                            </div>
                                                            <aura:if isTrue="{!v.accountInformation.accountId !=null}">
                                                                <div class="slds-form-element__control" style="text-align: justify !important">
                                                                    <a href="{!'/'+v.accountInformation.accountId}" target="_blank"> <ui:outputText value="{!v.accountInformation.accountName}" /> </a>    
                                                                </div>
                                                            </aura:if>
                                                            <aura:if isTrue="{!v.accountInformation.accountId ==null}">
                                                                <div class="slds-form-element__label">
                                                                    <i><aura:text value="-none-"/></i>
                                                                </div>
                                                            </aura:if>
                                                            
                                                            </td>
                                                            <td class="padded">
                                                                <div class="slds-form-element__label">
                                                                    <aura:text value="Partner Involved:"/>
                                                                </div>
                                                                
                                                                <aura:if isTrue="{!v.accountInformation.partnerInvolved =='true'}">
                                                                    <div class="slds-form-element__control" style="text-align: justify !important">
                                                                        <a href="{!'/'+v.accountInformation.partnerId}" target="_blank"> <ui:outputText value="{!v.accountInformation.partnerName}" /> </a>
                                                                        
                                                                    </div>
                                                                </aura:if>
                                                                <aura:if isTrue="{!v.accountInformation.partnerInvolved !='true'}">
                                                                    <div class="slds-form-element__label">
                                                                        <i><aura:text value="-none-"/></i>
                                                                    </div>
                                                                </aura:if> 
                                                            </td>
                                                        </tr>
                                                        <tr><td class="padded">
                                                            
                                                            <div class="slds-form-element__label">
                                                                <aura:text value="Technical Sales Primary:"/>
                                                            </div>
                                                            <aura:if isTrue="{!v.accountInformation.tsp !=null}">
                                                                <div class="slds-form-element__control" style="text-align: justify !important">
                                                                    <a href="{!'/'+v.accountInformation.tsp}" target="_blank">  <ui:outputText value="{!v.accountInformation.tspName}" /></a>
                                                                </div>
                                                            </aura:if>
                                                            <aura:if isTrue="{!v.accountInformation.tsp ==null}">
                                                                <div class="slds-form-element__label">
                                                                    <i><aura:text value="-none-"/></i>
                                                                </div>
                                                            </aura:if>
                                                            </td>
                                                            <td class="padded">
                                                                <div class="slds-form-element__label">
                                                                    <aura:text value="AE Name:"/>
                                                                </div>
                                                                <aura:if isTrue="{!v.accountInformation.ae !=null}">
                                                                    <div class="slds-form-element__control" style="text-align: justify !important">
                                                                        <a href="{!'/'+v.accountInformation.ae}" target="_blank"> <ui:outputText value="{!v.accountInformation.aeName}" /></a>
                                                                    </div>
                                                                </aura:if>
                                                                <aura:if isTrue="{!v.accountInformation.ae ==null}">
                                                                    <div class="slds-form-element__label">
                                                                        <i><aura:text value="-none-"/></i>
                                                                    </div>
                                                                </aura:if>
                                                            </td>
                                                        </tr>
                                                    </table>
                                                    
                                                </lightning:tile>
                                            </aura:if> 
                                        </aura:set>
                                    </lightning:accordionSection>
                                    <!--TBD : PARTNER DETAILS FOR INDIRECT-->
                                    
                                    <lightning:accordionSection name="contactssection" label="Contacts" class="wdth">
                                        <aura:set attribute="actions">
                                            
                                            <lightning:button label="Add" value="addcontact" onclick="{!c.showContactModal}" disabled="{!v.readOnlyMode}"/>
                                            
                                        </aura:set>
                                        <aura:set attribute="body">
                                            
                                            <ul class="slds-has-dividers_bottom-space">
                                                <aura:iteration items="{!v.contactList}" var="contact" indexVar="i"> 
                                                    <li class="slds-item">
                                                        <lightning:tile  label="{!contact.name}">
                                                            
                                                            
                                                            <aura:set attribute="media">
                                                                <aura:if isTrue="{!!v.readOnlyMode}">
                                                                    <a name="{!i}" onclick="{!c.removeContact}"><lightning:icon iconName="standard:first_non_empty" size="x-small"/></a> &nbsp;
                                                                </aura:if>
                                                                <lightning:avatar src="/docs/component-library/app/images/examples/avatar1.jpg" fallbackIconName="standard:contact" alternativeText="Lexee L. Jackson"/>
                                                            </aura:set>
                                                            
                                                            <ul class="slds-list_horizontal slds-has-dividers_right">
                                                                <li class="slds-item"><b>{!contact.type}</b></li>
                                                            </ul>
                                                            
                                                            <ul class="slds-list_horizontal slds-has-dividers_right">
                                                                <li class="slds-item"><span class="slds-pill"><lightning:icon size="x-small" iconName="standard:email_chatter" alternativeText="email" /> &nbsp;{!contact.email}</span></li>
                                                                <li class="slds-item">
                                                                    <span class="slds-pill"><lightning:icon size="x-small" iconName="standard:call" alternativeText="phone" />&nbsp;{!contact.phone}</span></li>
                                                            </ul>
                                                        </lightning:tile>
                                                    </li>
                                                </aura:iteration>
                                            </ul>
                                        </aura:set>
                                    </lightning:accordionSection>
                                    
                                    <!--Customer Section START ===== -->
                                    <lightning:accordionSection name="custsection" label="Customer Details">      
                                        <aura:set attribute="body">
                                            <aura:if isTrue="{!!v.readOnlyMode}">
                                                
                                                <label class="slds-form-element__label">&nbsp;Commitment Type</label>
                                                <aura:if isTrue="{! !v.isClassic}">
                                                <sup>  <lightning:helptext content="Standard, Contract with Out clause, $0 Trial, Event"/></sup>
                                                </aura:if>
                                                <lightning:inputField  
                                                                      fieldName="Commitment_Type_Text__c" 
                                                                      name="commitmentType" 
                                                                      disabled="{!v.readOnlyMode}"
                                                                      id="label_hidden_ct"
                                                                      />
                                            </aura:if>
                                            <aura:if isTrue="{!v.readOnlyMode}">
                                                <lightning:outputField label="Commitment Type" 
                                                                       fieldName="Commitment_Type_Text__c" 
                                                                       name="commitmentType" 
                                                                       class="border"
                                                                       
                                                                       />
                                                <br/>
                                            </aura:if>
                                            
                                            <aura:if isTrue="{!!v.readOnlyMode}">
                                                <label class="slds-form-element__label">&nbsp;Integration Management Type</label>
                                                <aura:if isTrue="{! !v.isClassic}">
                                                  <sup>  <lightning:helptext content="Standard, Managed , Emergency, Self-Service Integration, Custom" /></sup>
                                                </aura:if>
                                                <lightning:inputField label="Integration Management Type"
                                                                      fieldName="Type_of_Integration_text__c" 
                                                                      name="integration" 
                                                                      disabled="{!v.readOnlyMode}"
                                                                      id="label_hidden_int"
                                                                      />
                                            </aura:if>
                                            <aura:if isTrue="{!v.readOnlyMode}">
                                                <lightning:outputField label="Integration Management Type"
                                                                       fieldName="Type_of_Integration_text__c" 
                                                                       name="integration" 
                                                                       class="border"
                                                                       
                                                                       />
                                                <br/>
                                            </aura:if>
                                            
                                            <aura:if isTrue="{!!v.readOnlyMode}">
                                                <lightning:inputField label="Customer Business Objective" 
                                                                      fieldName="Customer_Business_Objective_Text__c" 
                                                                      name="customerBusinessObjective" 
                                                                      disabled="{!v.readOnlyMode}"/>
                                            </aura:if>
                                            <aura:if isTrue="{!v.readOnlyMode}">
                                                <lightning:outputField label="Customer Business Objective" 
                                                                       fieldName="Customer_Business_Objective_Text__c" 
                                                                       name="customerBusinessObjective" 
                                                                       class="border"
                                                                       
                                                                       />
                                                <br/>
                                            </aura:if>
                                            <aura:if isTrue="{!!v.readOnlyMode}">
                                                <lightning:inputField label="Customer Risk" 
                                                                      fieldName="Customer_Risk_Text__c" 
                                                                      name="customerRisk" 
                                                                      disabled="{!v.readOnlyMode}"/>
                                            </aura:if>
                                            <aura:if isTrue="{!v.readOnlyMode}">
                                                
                                                <lightning:outputField label="Customer Risk" 
                                                                       fieldName="Customer_Risk_Text__c" 
                                                                       name="customerRisk" 
                                                                       class="border"
                                                                       />
                                                
                                            </aura:if>
                                        </aura:set>
                                    </lightning:accordionSection>
                                    
                                    <!--Customer Section END   =====-->
                                    <lightning:accordionSection name="othersection" label="Other Details">
                                        <aura:set attribute="body">
                                            <lightning:inputField label="Level Of Effort (LOE)" 
                                                                  fieldName="LOE_Text__c"
                                                                  name="loe"
                                                                  disabled="{!v.readOnlyMode}"/>
                                        </aura:set>
                                    </lightning:accordionSection>
                                    
                                    <!--PRODUCTS START   =====-->
                                    <lightning:accordionSection name="productsection" label="Add Products" class="duallbClass">
                                        <aura:set attribute="body">
                                            <div class="slds-form-element" aura:id="productsBox"> 
                                                
                                                <lightning:dualListbox name="product"
                                                                       label="Products"
                                                                       sourceLabel="Available"
                                                                       selectedLabel="Selected"
                                                                       required ="true"
                                                                       options="{!v.productOptions}"
                                                                       value="{!v.selectedProductOptions}" 
                                                                       onchange="{!c.handleChange }"
                                                                       disabled="{!v.readOnlyMode}"/>
                                                <aura:if isTrue="{!v.showProductError}">
                                                    <div class="slds-form-element__help" id="form-error-01">This field is required</div>
                                                </aura:if>
                                            </div>
                                        </aura:set>
                                    </lightning:accordionSection>
                                    
                                    <lightning:accordionSection name="attachments" label="Attachments">
                                        <aura:set attribute="body"> 
                                            <div class="slds-form-element">
                                                <div class="slds-form-element__control">    
                                                    <lightning:fileUpload label="Upload File" multiple="true" disabled="{!v.readOnlyMode}" recordId="{!v.existingRSSForm}" aura:id="multifileUpload" onuploadfinished="{!c.uploadFile}" />
                                                </div>
                                            </div>
                                            <br/>
                                            <table class="slds-table slds-table_cell-buffer slds-table_bordered" style="table-layout: fixed;">
                                                <thead>
                                                    <tr class="slds-line-height_reset">
                                                        <th class="" scope="col">
                                                            <div class="slds-truncate" title="Form Name">File Name</div>
                                                        </th>
                                                        <th class="" scope="col">
                                                            <div class="slds-truncate" title="Form Name">File Type</div>
                                                        </th>
                                                        <th class="" scope="col">
                                                            <div class="slds-truncate" title="Form Name">Created Date</div>
                                                        </th>
                                                        <th class="" scope="col">
                                                            <div class="slds-truncate" title="Form Name">Created By</div>
                                                        </th>
                                                    </tr>
                                                    
                                                </thead>
                                                <tbody> 
                                                    <aura:iteration items="{!v.files}" var="file" indexVar="i"> 
                                                        <tr class="slds-line-height_reset">
                                                            <td class="slds-truncate" scope="col">
                                                                <a href="{!'/lightning/r/ContentDocument/'+file.ContentDocument.Id+'/view'}" target="_blank">{!file.ContentDocument.Title}</a>
                                                            </td>
                                                            <td class="slds-truncate" scope="col">
                                                                {!file.ContentDocument.FileType}
                                                            </td>
                                                            <td class="slds-truncate" scope="col" data-label="Close Date">
                                                                <lightning:formattedDateTime value="{!file.ContentDocument.CreatedDate }"/>
                                                            </td>
                                                            <td class="slds-truncate" scope="col" data-label="CreatedBy Date">
                                                                <a href="{!'/lightning/r/User/'+file.ContentDocument.CreatedById+'/view'}" target="_blank">{!file.ContentDocument.CreatedBy.Name}</a>
                                                            </td>
                                                        </tr>
                                                    </aura:iteration>
                                                </tbody>
                                            </table> 
                                        </aura:set>
                                    </lightning:accordionSection>
                                    
                                    
                                    <lightning:accordionSection name="previousversions" label="Previous Versions">
                                        <aura:set attribute="body"> 
                                            
                                            <table class="slds-table slds-table_cell-buffer slds-table_bordered" style="table-layout: fixed;">
                                                <thead>
                                                    <tr class="slds-line-height_reset">
                                                        <th class="" scope="col">
                                                            <div class="slds-truncate" title="Form Name">Form Name</div>
                                                        </th>
                                                        <th class="" scope="col">
                                                            <div class="slds-truncate" title="Version">Version</div>
                                                        </th>
                                                        <aura:if isTrue="{!$Browser.formFactor != 'PHONE'}">
                                                            <th class="" scope="col">
                                                                <div class="slds-truncate" title="CreatedDate">Created Date</div>
                                                            </th>
                                                            
                                                            <th class="" scope="col">
                                                                <div class="slds-truncate" title="Owner">Publisher</div>
                                                            </th>
                                                            <!--
                                                    <th class="" scope="col">
                                                        <div class="slds-truncate" title="Owner">Notes</div>
                                                    </th> -->
                                                        </aura:if>
                                                    </tr></thead>
                                                
                                                <tbody> 
                                                    <aura:iteration items="{!v.previousForms}" var="oldForm" indexVar="i"> 
                                                        <tr class="slds-hint-parent">
                                                            <th data-label="Opportunity Name" scope="row">
                                                                <div class="slds-truncate" title="Cloudhub">
                                                                    <a href="{! v.isClassic?'/apex/Sales_ERSS_FormClassicPage?id='+oldForm.Id:'/lightning/cmp/c__Sales_ERSS_NewForm?c__id='+oldForm.Id}" tabindex="-1" target="_blank" >{!oldForm.Name}</a>
                                                                </div>
                                                            </th>
                                                            <td data-label="Account Name">
                                                                <div class="slds-truncate" title="Version">{!oldForm.Version__c}</div>
                                                            </td>
                                                            <aura:if isTrue="{!$Browser.formFactor != 'PHONE'}">
                                                                <td data-label="Close Date">
                                                                    <div class="slds-truncate" title="Date"> <p><lightning:formattedDateTime value="{!oldForm.CreatedDate}"/></p></div>
                                                                </td>
                                                                <!--   <td data-label="Prospecting">
                                                        <a href="{!'/lightning/r/User/'+oldForm.OwnerId+'/view'}" tabindex="-1" target="_blank" >{!oldForm.Owner.Name}</a>
                                                        
                                                    </td> -->
                                                                <td data-label="Prospecting">
                                                                    <a href="{!  v.isClassic?'/'+oldForm.Published_by__c:'/lightning/r/User/'+oldForm.Published_by__c+'/view'}" tabindex="-1" target="_blank" >{!oldForm.Published_by__r.Name}</a>
                                                                    
                                                                </td>
                                                                <!-- <td data-label="Prospecting" style="word-wrap: break-word;white-space: normal;">
                                                            <div title="Version">{!oldForm.Publisher_comments__c}</div>
                                                            
                                                        </td> -->
                                                            </aura:if>
                                                        </tr>
                                                        
                                                    </aura:iteration>
                                                </tbody>
                                            </table> 
                                        </aura:set>
                                    </lightning:accordionSection>
                                    
                                    
                                    
                                    
                                    
                                    
                                </lightning:accordion>                           
                                <br/><br/>
                                <!--PRODUCTS END   ===== -->
                            </lightning:recordEditForm>
                        </ui:scrollerWrapper>
                        <!-- / NEW RSS FORM -->                       
                    </div>
                    
                    
                </div>
                
            </lightning:tab>
            <lightning:tab label="Products" id="productTab" class="(v.isMobile?'formtabclassmobile':'formtabclass')" iconName="standard:product_required">           
                <div class="{!'slds-grid slds-gutters slds-grid_align-center slds-scrollable_y'+' '+(v.isMobile?'form_insidetab_mobile':'form_insidetab')}">
                    
                    
                    <div class="{!(v.isMobile?'slds-box slds-theme--default boxmargin slds-scrollable_y slds-container_fluid mainWrapMobile':'slds-box slds-theme--default boxmargin  slds-scrollable_y slds-container_x-large mainWrap')}">
                        <ui:scrollerWrapper class="{!(v.isMobile?'scrollHeightMobile':'scrollHeight1')}">
                            <aura:if isTrue="{!and(v.invalidProductTemplates !=null,v.invalidProductTemplates.length>0)}">
                                <div class="slds-notify slds-notify_alert slds-theme_alert-texture slds-theme_error" role="alert" style="text-align:left;">
                                    <aura:if isTrue="{!or(v.stage == 'Draft',v.stage == 'Revised')}">
                                        <aura:text value="Following Templates is/are not the latest version. Click on 'Update Product Forms' button to use the latest version" />
                                    </aura:if>
                                    <aura:if isTrue="{!v.stage == 'Published'}">
                                        <aura:text value="Following Templates is/are not the latest version. Click on 'Revise' and then select 'Update Product Forms' button to use the latest version" />
                                    </aura:if>
                                    <aura:if isTrue="{!v.stage == 'Voided'}">
                                        <aura:text value="Following Templates is/are not the latest version." />
                                    </aura:if>    
                                    <br/>
                                    
                                    <aura:iteration items="{!v.invalidProductTemplates}" var="template" indexVar="index">
                                        <aura:text value="{!index+1+'. '+template.Name}"/><br/>
                                    </aura:iteration>
                                </div>
                                <aura:if isTrue="{!!v.readOnlyMode}">
                                    <lightning:button label="Update Product Forms" 
                                                      class="slds-m-top--medium"
                                                      onclick="{!c.showUpdateProductModal}"
                                                      
                                                      
                                                      />
                                </aura:if>
                                
                            </aura:if>
                            <aura:if isTrue="{!v.showProducts}">
                                <lightning:tabset aura:id="productTabs">
                                    
                                    <div>
                                        <aura:iteration items="{!v.productOptionsView}" var="type" indexVar="iprod">
                                            <lightning:tab id="{!type.Name}">
                                                
                                                <aura:iteration items="{!v.questionResponse}" var="q" indexVar="index">
                                                    
                                                    
                                                    <aura:if isTrue="{!q.SurveyTaker__r.Survey__c == type.Id}">
                                                        <aura:if isTrue="{!q.Survey_Question__r.OrderNumber__c == 0}">
                                                            <b style="font-size:100%;"><lightning:icon iconName="utility:chevrondown" size="x-small" alternativeText="Approved" />{!q.Survey_Question__r.Survey_Question_Group__r.Name}</b>
                                                        </aura:if>
                                                        <div class="slds-p-left_large">
                                                            <aura:if isTrue="{! q.Survey_Question__r.Type__c == 'Single Select--Vertical'}">
                                                                <div class="{!and(or(q.Response__c==null,q.Response__c==''),q.error=='true')?'slds-form-element slds-has-error':'slds-form-element'}">
                                                                    <label class="slds-form-element__label"><b><span style="color:#C23934">{!q.Survey_Question__r.Required__c?'* ':''}</span>{!q.Survey_Question__r.OrderNumber__c+1+'. '+q.Survey_Question__r.Question__c}</b></label>
                                                                    <lightning:radioGroup name="{!'ssv'+q.Survey_Question__c}"
                                                                                          options="{! q.Survey_Question__r.Choices__c}"
                                                                                          
                                                                                          value="{!q.Response__c}"
                                                                                          aura:id="question"
                                                                                          class="{!and(or(q.Response__c==null,q.Response__c==''),q.error=='true')?'slds-has-error':''}"
                                                                                          disabled="{!v.readOnlyMode}"
                                                                                          />
                                                                    
                                                                    <aura:if isTrue="{!and(or(q.Response__c==null,q.Response__c==''),q.error=='true')}">
                                                                        <div class="slds-form-element__help " id="form-error-01">Complete this field.</div>
                                                                    </aura:if>
                                                                </div>
                                                            </aura:if>
                                                            
                                                            <aura:if isTrue="{! q.Survey_Question__r.Type__c == 'Multi-Select--Vertical'}">
                                                                <div class="{!and(or(q.Response__c==null,q.Response__c==''),q.error=='true')?'slds-form-element slds-has-error':'slds-form-element'}">
                                                                    <label class="slds-form-element__label"><b><span style="color:#C23934">{!q.Survey_Question__r.Required__c?'* ':''}</span>{!q.Survey_Question__r.OrderNumber__c+1+'. '+q.Survey_Question__r.Question__c}</b></label>
                                                                    <lightning:checkboxGroup  name="{!'checkboxGroup:'+q.Survey_Question__c}"
                                                                                             options="{! q.Survey_Question__r.Choices__c}"
                                                                                             
                                                                                             value="{! q.Survey_Question__r.ResponseArray__c}"
                                                                                             aura:id="question"
                                                                                             disabled="{!v.readOnlyMode}"
                                                                                             onchange="{! c.handleCheckBoxChange }"
                                                                                             class="{!and(or(q.Response__c==null,q.Response__c==''),q.error=='true')?'slds-has-error':''}"
                                                                                             />
                                                                    <aura:if isTrue="{!and(or(q.Response__c==null,q.Response__c==''),q.error=='true')}">
                                                                        <div class="slds-form-element__help " id="form-error-01">Complete this field.</div>
                                                                    </aura:if>
                                                                </div>
                                                            </aura:if>
                                                            
                                                            <aura:if isTrue="{! q.Survey_Question__r.Type__c == 'Free Text'}">
                                                                <div class="{!and(or(q.Response__c==null,q.Response__c==''),q.error=='true')?'slds-form-element slds-has-error':'slds-form-element'}">
                                                                    <label class="slds-form-element__label"><b><span style="color:#C23934">{!q.Survey_Question__r.Required__c?'* ':''}</span>{!q.Survey_Question__r.OrderNumber__c+1+'. '+q.Survey_Question__r.Question__c}</b></label>
                                                                    <lightning:inputRichText  
                                                                                             aura:id="question"
                                                                                             value="{!q.Response__c}" 
                                                                                             disabled="{!v.readOnlyMode}"
                                                                                             class="{!and(or(q.Response__c==null,q.Response__c==''),q.error=='true')?'slds-has-error':''}"
                                                                                             />
                                                                    <aura:if isTrue="{!and(or(q.Response__c==null,q.Response__c==''),q.error=='true')}">
                                                                        <div class="slds-form-element__help " id="form-error-01">Complete this field.</div>
                                                                    </aura:if>
                                                                </div>
                                                            </aura:if>
                                                            
                                                            <aura:if isTrue="{! q.Survey_Question__r.Type__c == 'Single Select--Horizontal'}">
                                                                <div class="{!and(or(q.Response__c==null,q.Response__c==''),q.error=='true')?'slds-form-element slds-has-error':'slds-form-element'}">
                                                                    <label class="slds-form-element__label"><b><span style="color:#C23934">{!q.Survey_Question__r.Required__c?'* ':''}</span>{!q.Survey_Question__r.OrderNumber__c+1+'. '+q.Survey_Question__r.Question__c}</b></label>
                                                                    <lightning:radioGroup name="{!'radioGroup'+q.Survey_Question__c}"
                                                                                          options="{! q.Survey_Question__r.Choices__c}"
                                                                                          
                                                                                          value="{!q.Response__c}"
                                                                                          aura:id="question"
                                                                                          class="{!and(or(q.Response__c==null,q.Response__c==''),q.error=='true')?'hzl slds-has-error':'hzl'}"
                                                                                          
                                                                                          disabled="{!v.readOnlyMode}"
                                                                                          />
                                                                    <aura:if isTrue="{!and(or(q.Response__c==null,q.Response__c==''),q.error=='true')}">
                                                                        <div class="slds-form-element__help " id="form-error-01">Complete this field.</div>
                                                                    </aura:if>
                                                                </div>
                                                            </aura:if>
                                                            
                                                            <aura:if isTrue="{! q.Survey_Question__r.Type__c == 'Picklist'}">
                                                                <div class="{!and(or(q.Response__c==null,q.Response__c==''),q.error=='true')?'slds-form-element slds-has-error':'slds-form-element'}">
                                                                    <label class="slds-form-element__label"><b><span style="color:#C23934">{!q.Survey_Question__r.Required__c?'* ':''}</span>{!q.Survey_Question__r.OrderNumber__c+1+'. '+q.Survey_Question__r.Question__c}</b></label>
                                                                    <lightning:select  name="{!'select'+q.Survey_Question__c}"
                                                                                      value="{!q.Response__c}"
                                                                                      aura:id="question"
                                                                                      disabled="{!v.readOnlyMode}"
                                                                                      class="{!and(or(q.Response__c==null,q.Response__c==''),q.error=='true')?'slds-has-error':''}"
                                                                                      >
                                                                        <aura:iteration items="{!q.Survey_Question__r.Choices__c}" var="option">
                                                                            <option text="{!option.label}" value="{!option.value}" />
                                                                        </aura:iteration>
                                                                    </lightning:select>
                                                                    <aura:if isTrue="{!and(or(q.Response__c==null,q.Response__c==''),q.error=='true')}">
                                                                        <div class="slds-form-element__help " id="form-error-01">Complete this field.</div>
                                                                    </aura:if>
                                                                </div>
                                                            </aura:if>
                                                            <br/>
                                                        </div>
                                                    </aura:if>
                                                    
                                                </aura:iteration>
                                                
                                                <aura:set attribute="label">
                                                    {!type.Name}
                                                </aura:set>
                                                
                                                
                                            </lightning:tab>
                                        </aura:iteration>
                                        
                                        <br/>
                                    </div>
                                    
                                </lightning:tabset>
                            </aura:if>
                        </ui:scrollerWrapper>
                    </div> 
                    
                    
                    
                    
                    
                </div>  
                
            </lightning:tab>
        </lightning:tabset>
        
        
        <div class="slds-docked-form-footer">
            <aura:if isTrue="{!and(v.permissionMap.WriteAccessOfUser,v.permissionMap.profileAccess)}">
                
                <aura:if isTrue="{!!v.readOnlyMode}">                                
                    <aura:if isTrue="{!!v.published}">
                        <lightning:button label="Save" 
                                          class="slds-m-top--medium"
                                          onclick="{!c.saveRecordNew}"
                                          variant="brand"/>
                        
                        <lightning:button label="Publish Form" 
                                          class="slds-m-top--medium"
                                          onclick="{!c.showPublishModal}"
                                          variant="brand"
                                          disabled="{!v.existingRSSForm == null? true:false}"/>
                    </aura:if>
                    
                </aura:if>
                
                <aura:if isTrue="{!v.published}">
                    <lightning:button label="Revise Form" 
                                      class="slds-m-top--medium"
                                      onclick="{!c.reviseForm}"
                                      variant="brand"
                                      disabled="{!v.existingRSSForm == null? true:false}"/>
                </aura:if>
                <aura:if isTrue="{!v.published}">
                    <lightning:button label="Transfer Ownership" 
                                      class="slds-m-top--medium"
                                      onclick="{!c.showOwnerModal}"
                                      variant="brand"
                                      disabled="{!v.existingRSSForm == null? true:false}"/>
                </aura:if>
                
                
                
            </aura:if>
            <aura:if isTrue="{! v.existingRSSForm != null}">
                <lightning:button label="Download PDF" 
                                  class="slds-m-top--medium"
                                  onclick="{!c.pdfDownload}"
                                  variant="brand"
                                  disabled="{!v.existingRSSForm == null? true:false}"/>
                
                
            </aura:if>
            
        </div>
        
        <aura:if isTrue="{!v.isModalOpen}">
            <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open">
                <div class="slds-modal__container">
                    <header class="slds-modal__header">
                        <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick="{!c.hideContactModal}">
                            <lightning:icon size="small" iconName="standard:first_non_empty" alternativeText="Close" />
                            
                        </button>
                        <h2 id="modal-heading-01" class="slds-modal__title slds-hyphenate">Add Contact</h2>
                        <p class="slds-m-top_x-small">Add Customer and Admin contacts. You can add multiple contacts.</p>
                    </header>
                    <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1">
                        
                        <fieldset class="slds-container_medium">
                            
                            <form class="slds-form--stacked">          
                                <lightning:input label="Contact Email"
                                                 
                                                 aura:id="cEmail"
                                                 type="email"
                                                 required="true"/> 
                                <lightning:input label="Name"
                                                 
                                                 aura:id="cName"
                                                 required="true"/> 
                                <lightning:input  label="Contact Phone"
                                                 type="tel"
                                                 pattern="[+]?[0-9]*"
                                                 aura:id="cPhone"
                                                 /> 
                                <lightning:select  aura:id="cType" label="Contact type" required="true">
                                    <option value="">choose one...</option>
                                    <option value="Technical">Technical</option>
                                    <option value="Admin">Admin</option>
                                    <option value="Technical+Admin">Technical+Admin</option>
                                    
                                </lightning:select>
                                <br></br>
                                
                                
                                <footer class="slds-modal__footer">
                                    <button class="slds-button slds-button_neutral" type="button" onclick="{!c.hideContactModal}">Cancel</button>
                                    <button class="slds-button slds-button_brand"  type="button" onclick="{!c.addContact}">Add</button>
                                </footer>
                            </form>
                            
                        </fieldset>
                        
                        
                    </div>
                    
                </div>
            </section>
            <div class="slds-backdrop slds-backdrop_open"></div>
        </aura:if>
        
        <aura:if isTrue="{!v.publishModalOpen}">
            <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open">
                <div class="slds-modal__container">
                    <header class="slds-modal__header">
                        <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick="{!c.hidePublishModal}">
                            <lightning:icon size="small" iconName="standard:first_non_empty" alternativeText="Close" />     
                        </button>
                        <h2 id="modal-heading-01" class="slds-modal__title slds-hyphenate">Are you sure you want to Publish this form?</h2>
                        
                    </header>
                    <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1">
                        
                        <fieldset class="slds-container_medium">
                            <lightning:textarea name="inputPublisherComments" 
                                                label="Add Publisher comments" 
                                                value="{!v.publishComments}" 
                                                required="true"
                                                maxlength="254"/>
                            
                            <br/>
                            
                            
                        </fieldset>
                        <footer class="slds-modal__footer">
                            <button class="slds-button slds-button_neutral" type="button" onclick="{!c.hidePublishModal}">Cancel</button>
                            <button class="slds-button slds-button_brand"  type="button" onclick="{!c.publishRSSForm}" 
                                    disabled="{!or(v.publishComments == null,v.publishComments == '')}">Publish</button>
                        </footer>
                        
                    </div>
                    
                </div>
            </section>
            <div class="slds-backdrop slds-backdrop_open"></div>
        </aura:if>
        
        <aura:if isTrue="{!v.ownerModalOpen}">
            <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open" >
                <div class="slds-modal__container" >
                    <header class="slds-modal__header">
                        <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick="{!c.hideOwnerModal}">
                            <lightning:icon size="small" iconName="standard:first_non_empty" alternativeText="Close" />     
                        </button>
                        <h2 id="modal-heading-01" class="slds-modal__title slds-hyphenate">Change Ownership of this form?</h2>
                        <p class="slds-m-top_x-small">You may lose edit rights with this action</p>
                    </header>
                    <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1" style="height:350px;">
                        
                        <fieldset class="slds-container_medium">
                            <label class="slds-form-element__label">Select new Owner</label>
                            <c:SF1_LookupComponent type="User" 
                                                   value="{!v.newOwnerId}" 
                                                   fieldsToShowInSuggestion="Title" 
                                                   />
                            
                            <br/>
                            
                            <lightning:textarea name="inputOwnerComments" 
                                                label="Comments for new Owner" 
                                                value="{!v.ownerComments}"
                                                required="true"/>
                            
                            
                        </fieldset>
                        
                        
                    </div>
                    <footer class="slds-modal__footer">
                        <button class="slds-button slds-button_neutral" type="button"  onclick="{!c.hideOwnerModal}">Cancel</button>
                        <button class="slds-button slds-button_brand"  
                                type="button" 
                                onclick="{!c.changeOwnerRSSForm}"
                                disabled="{!or(v.ownerComments== null,v.ownerComments== '')}">
                            Submit</button>
                    </footer>
                    
                </div>
            </section>
            <div class="slds-backdrop slds-backdrop_open"></div>
        </aura:if>   
        
        <aura:if isTrue="{!v.updateProductModalOpen}">
            <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open" >
                <div class="slds-modal__container" >
                    <header class="slds-modal__header">
                        
                        <h2 id="modal-heading-01" class="slds-modal__title slds-hyphenate">Are you sure?</h2>
                        <p class="slds-m-top_x-small">You may lose some or all saved responses with this action</p>
                    </header>
                    
                    <footer class="slds-modal__footer">
                        <button class="slds-button slds-button_neutral" type="button"  onclick="{!c.hideUpdateProductModal}">Cancel</button>
                        <button class="slds-button slds-button_brand"  type="button" onclick="{!c.proceedUpdateProductModal}">Update Products</button>
                    </footer>
                    
                </div>
            </section>
            <div class="slds-backdrop slds-backdrop_open"></div>
        </aura:if>   
        
        <aura:if isTrue="{!v.diffModalOpen}">
            <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open" >
                <div class="slds-modal__container" >
                    <header class="slds-modal__header">
                        <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick="{!c.hideDiffModal}">
                            <lightning:icon size="small" iconName="standard:first_non_empty" alternativeText="Close" />     
                        </button>
                        <h2 id="modal-heading-01" class="slds-modal__title slds-hyphenate">Difference</h2>
                        <p class="slds-m-top_x-small">Version {!v.accountInformation.version} vs Version {!v.accountInformation.version-1}</p>
                    </header>
                    <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1" style="height:350px;">
                        
                        <fieldset class="slds-container_large">
                            <aura:if isTrue="{!v.diffText.error == null}">
                                
                                <lightning:tabset aura:id="difftabs">
                                    <lightning:tab label="Form">
                                        
                                        <lightning:formattedRichText aura:id="diffTextForm" value="{!v.diffText.form}"/>
                                    </lightning:tab>
                                    <lightning:tab label="Products">
                                        
                                        <lightning:formattedRichText aura:id="diffTextProduct" value="{!v.diffText.products}"/>
                                    </lightning:tab>
                                </lightning:tabset>
                            </aura:if>
                            <aura:if isTrue="{!v.diffText.error != null}">
                                <div class="slds-notify slds-notify_alert slds-theme_alert-texture slds-theme_error" role="alert" style="text-align:left;">
                                    
                                    <aura:text value="{!v.diffText.error}" />
                                </div>
                            </aura:if>
                        </fieldset>
                        
                        
                    </div>
                    
                    
                </div>
            </section>
            <div class="slds-backdrop slds-backdrop_open"></div>
        </aura:if>   
        
        
        <aura:if isTrue="{!v.loading}">
            <div class="demo-only" style="height:6rem">
                <div class="slds-spinner_container">
                    <div role="status" class="slds-spinner slds-spinner_medium">
                        <span class="slds-assistive-text">Loading</span>
                        <div class="slds-spinner__dot-a"></div>
                        <div class="slds-spinner__dot-b"></div>
                    </div>
                </div>
            </div>
        </aura:if>
        
    </div> 
</aura:component>