<!--
  Author : Rajesh Kumar
  JIRA # : 5934
  Description : Lightning component to show list of template and also includes data manipulation.
-->

<aura:component controller="L2Q_eRSSTemplate"
  implements="force:appHostable,flexipage:availableForAllPageTypes,flexipage:availableForRecordHome,force:hasRecordId,forceCommunity:availableForAllPageTypes,force:lightningQuickAction"
  access="global">

  <lightning:navigation aura:id="navService" />
  <!--Navigation Services-->

  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <!-- Begin loading boots strap -->
  <ltng:require styles="{! $Resource.bootstrap441 + '/bootstrap-4.4.1-dist/css/bootstrap.min.css'}" scripts="{!join(',', 
  $Resource.jquery224 , 
  $Resource.bootstrap441 + '/bootstrap-4.4.1-dist/js/bootstrap.min.js')
}" afterScriptsLoaded="{!c.scriptsLoaded}" />
  <!-- End  loading boots strap -->

  <!--Modal Width Handler-->
  <aura:html tag="style">
    .slds-modal__container{
    max-width: 95rem !important;
    width:60% !important;
    }
  </aura:html>

  <!--Begin Attribute Decalarion-->
  <aura:attribute name="data" type="Object" />
  <aura:attribute name="columns" type="List" />
  <aura:attribute name="sortedBy" type="String" default="Name" />
  <aura:attribute name="sortedDirection" type="String" default="asc" />
  <aura:attribute name="pageNumber" type="Integer" default="1" />
  <aura:attribute name="pageSize" type="Integer" default="25" />
  <aura:attribute name="isLastPage" type="Boolean" default="false" />
  <aura:attribute name="dataSize" type="Integer" default="0" />
  <aura:handler name="init" action="{!c.doInit}" value="{!this}" />
  <aura:handler name="init" value="{!this}" action="{!c.doInit}" />
  <aura:attribute type="boolean" name="isloading" default="false" />
  <aura:attribute type="boolean" name="istempMode" default="false" />
  <aura:attribute name="options" type="object[]" default="[]" />
  <aura:attribute type="String" name="usedTemplate" default=" " />
  <aura:attribute name="deleteId" type="String" default="" />
  <aura:attribute name="isDelete" type="boolean" default="false" />
  <aura:attribute name="isViewques" type="boolean" default="false" />
  <aura:attribute name="recordId" type="String" default="" />
  <aura:attribute name="disabledPagin" type="boolean" />
  <aura:attribute name="isSearchEnabled" type="boolean" default="true" />
  <aura:attribute name = "searchResult" type="Integer" default="" />
  <aura:attribute name = "writeAccess" type="boolean" default="false"/>

  <!-- Begin Page Navbar-->
  <aura:if isTrue="{!v.isloading}">
    <lightning:spinner alternativeText="Loading" size="large" />
  </aura:if>
  <div style="position: relative;">
    <div class="navbar navbar-expand-lg navbar-light bg-light"
      style="border-radius: 0.25rem;  border-bottom: 4px solid rgb(0, 109, 204);">
      <span class="navbar-brand">
        <h5>RSS Templates:</h5>
      </span>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav mr-auto">
          <li class="nav-item active">
            <span class="nav-link">
              <aura:if isTrue="{!v.writeAccess}">
              <lightning:button variant="brand" label="Create " name="create" onclick="{!c.createTemp}"
                iconName="utility:insert_template" iconPosition="right" />
              </aura:if>
                <span class="sr-only">(current)</span></span>
          </li>
          <li class="nav-item">
            <span class="nav-link">
              <!-- NAv Item --></span>
          </li>
        </ul>
        <div class="form-inline my-2 my-lg-0">
          <lightning:combobox name="progress" label="Status" aura:id="templatedId" placeholder="Select View"
            variant="label-hidden" options="{! v.options }" onchange="{!c.handletempChange}" /> &nbsp;
          <lightning:button label="Search" name="Search." variant="brand" onclick="{!c.handleSearch}"
            iconName="{!(v.isSearchEnabled ? 'utility:right':'utility:down')}" iconPosition="right" />
        </div>
      </div>
    </div>
    <!-- End Page Navbar-->



    <!--Begin Search Component-->
    <div aura:id="searchForm" class="slds-hide">
      <div class="navbar navbar-expand-lg navbar-light bg-light"
        style="border-radius: 0.25rem;  border: 2px solid rgb(0, 109, 204);">
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
          aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav mr-auto">
            <li class="nav-item active">
              <span class="nav-link">
                <lightning:input aura:id='nameSearch' type="text" name="Name" placeholder="Name..."
                  variant="label-hidden" minlength="3" maxlength="200" /> <span class="sr-only">(current)</span></span>
            </li>
            <li class="nav-item active">
              <span class="nav-link">
                <lightning:input type="text" aura:Id='versionSearch' name="Version__c" placeholder="Version..."
                  variant="label-hidden" minlength="1" maxlength="2" onchange="{!c.verifyNumber}"  /></span>
            </li>
            <li class="nav-item active">
              <span class="nav-link">
                <lightning:input aura:id='ownerSearch' type="text" name="Owner.Name" placeholder="Owner..."
                  variant="label-hidden" minlength="3" maxlength="200" /></span>
            </li>
            <li class="nav-item active">
              <span class="nav-link">
                </span>
            </li>
          </ul>
          <div class="form-inline my-2 my-lg-0">
            <!-- <lightning:slider label="Number of Result" size="x-small" value="{!v.searchResult}" max="25" min="1"/> -->
            <lightning:button label="Search" name="Search" onclick="{!c.applySearch}" iconPosition="left"
              iconName="utility:search" />
            <lightning:button label="Clear" name="Clear" onclick="{!c.handletempChange}" iconPosition="left"
              iconName="utility:clear" />
          </div>
        </div>
      </div>
    </div>
    <!--End Search Component-->

    
      <div class="slds-theme_default" style="border-radius:0.25rem;padding:1px 4px 1px 10px;">
        <div class="slds-m-top_medium">
          <div class="slds-card " style="height:620px;padding:1px 4px 1px 4px;">
            <lightning:datatable aura:id="templatetableId" columns="{!v.columns}" hideCheckboxColumn="true"
              data="{!v.data}" keyField="Id" onrowaction="{!c.handleRowAction}" onsort="{!c.updateColumnSorting}"
              sortedBy="{!v.sortedBy}" sortedDirection="{!v.sortedDirection}" />
          </div>
          <lightning:layoutItem size="12" smallDeviceSize="12" mediumDeviceSize="12" largeDeviceSize="12"
            padding="around-small">
            <div class="{!(v.disabledPagin ? 'slds-hide':'slds-show')}">
              <div class="slds-align_absolute-center">
                <lightning:button label="Prev" iconName="utility:chevronleft" iconPosition="left"
                  onclick="{!c.handlePrev}" disabled="{! v.pageNumber == 1}" />
                <lightning:button label="Next" iconName="utility:chevronright" iconPosition="right"
                  disabled="{! v.isLastPage}" onclick="{!c.handleNext}" />
              </div>
            </div>
          </lightning:layoutItem>
        </div>
      </div>
      <!--Begin Modal Item for Template Save-->
      <aura:if isTrue="{!v.istempMode}">
        <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true"
          aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open">
          <div class="slds-modal__container">
            <header class="slds-modal__header">
              <lightning:buttonIcon iconName="utility:close" onclick="{! c.closeModel }" alternativeText="close"
                variant="bare-inverse" class="slds-modal__close" />
              <h2 id="modal-heading-01" class="slds-text-heading_medium slds-hyphenate">Template</h2>
            </header>
            <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1">
              <lightning:input type="text" label="RSS Template Name" placeholder="Enter template name.."
                aura:id="createTemplateId" required="true" messageWhenValueMissing="Complete this field" />
            </div>
            <footer class="slds-modal__footer">
              <lightning:button onclick="{!c.createNewtemp}" label="Save" iconName="utility:save" variant="brand" />
            </footer>
          </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open"></div>
      </aura:if>

      <!--End Modal Item for Template Save-->

    
  </div>
</aura:component>