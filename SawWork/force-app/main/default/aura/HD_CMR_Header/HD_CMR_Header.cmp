<aura:component implements="flexipage:availableForAllPageTypes,force:hasRecordId" access="global" controller="HD_CMR_ChangeCalendar">
    <aura:attribute name="recordId" type="Id" />
    <aura:attribute name="change" type="BMCServiceDesk__Change_Request__c" default=""/>
  
    <ltng:require scripts="{!$Resource.HD_Error_Logger}" />
    <aura:attribute name="st_hlp" type="String" />
    <aura:attribute name="changeRequestId" type="String" />
    <aura:attribute name="currentStep" type="Integer" />
    <aura:attribute name="approvalsProgress" type="Map" />
    <aura:attribute name="lstKey" type="List"/>
    <aura:attribute name="listOfActions" type="List"/>
     <aura:attribute name="listOfActionsDisplay" type="List"/>
    <aura:attribute name="listOfActionsMenuDisplay" type="List"/>
    <aura:attribute name="flag" type="Integer" /> 
    <aura:attribute name="statusclass" type="String" default="OPENED"/>

    <aura:attribute name="isSpinnerEnabled" type="Boolean" default="false"/>
    <aura:attribute name="showApproval" type="Boolean" default="false"/>
    <aura:attribute name="toggleAppr" type="Boolean" default="false"/>
    <aura:handler name="init" action="{!c.getChangeRequest}" value="{!this}" />
    
    <aura:handler event="c:HD_CMR_PreviewRefreshEvent" action="{!c.refreshPage}" name="refreshPreview"/>
    
    <div class="slds-page-header slds-box">
        <div class="slds-grid">
            <div class="slds-col slds-size_3-of-12 slds-has-flexi-truncate">
                <div class="slds-media slds-no-space slds-grow">
                    <div class="slds-media__figure">
                        <span class="slds-icon_container slds-icon-standard-opportunity" title="Description of icon when needed">
                            <lightning:icon iconName="standard:case_change_status" size="medium" alternativeText="Indicates approval" />
                        </span>
                    </div>
                    <div class="slds-media__body">
                        <nav>
                            <ol class="slds-breadcrumb slds-line-height_reset">
                                <li class="slds-breadcrumb__item">
                                    <span>Change Managment Request</span>
                                </li>
                            </ol>
                        </nav>
                        <h1 class="slds-page-header__title slds-m-right_small slds-align-middle slds-truncate" title="{!v.change.Name}">{!v.change.Name}</h1>
                    </div>
                </div>
            </div>
            <div class="slds-col slds-size_3-of-12 slds-has-flexi-truncate">
               
                <span class="{! 'slds-badge '+ v.statusclass}">{!v.change.HD_Change_Status__c}</span>
            </div>
            <div class="slds-col slds-size_2-of-12 slds-has-flexi-truncate">
                           </div>
            <div class="slds-col slds-size_4-of-12 slds-no-flex slds-align-top slds-float_right " >
                 <c:HD_CMR_ActionButtonGroup listOfActionsDisplay="{!v.listOfActionsDisplay}" listOfActionsMenuDisplay="{!v.listOfActionsMenuDisplay}" change="{!v.change}" isSpinnerEnabled="{!v.isSpinnerEnabled}" isDropDownMenuAvailable="{!v.isDropDownMenuAvailable}" floatClass="slds-float_right"/>  
            </div>
       
   
             
         </div>
           
        <aura:if isTrue="{!v.isSpinnerEnabled}">
                        <div role="status" class="slds-spinner slds-spinner_medium slds-spinner_brand">
                            <span class="slds-assistive-text">Loading</span>
                            <div class="slds-spinner__dot-a"></div>
                            <div class="slds-spinner__dot-b"></div>
                        </div>
                    </aura:if>
        <div class="slds-grid slds-page-header__detail-row">
            <div class="slds-col slds-size_8-of-12">
                <ul class="slds-grid ">
                 <li class="slds-page-header__detail-block">
                <p class="slds-text-title slds-truncate slds-m-bottom_xx-small" title="Field2 (3)">Change Category
                   
                </p>
                <p class="slds-text-body_regular">{!v.change.BMCServiceDesk__Change_Category__c}</p>
            </li>
            
            <li class="slds-page-header__detail-block">
                <p class="slds-text-title slds-truncate slds-m-bottom_xx-small" title="Field2 (3)">Change Priority
                    
                </p>
                <p class="slds-text-body_regular">{!v.change.Change_Priority__c}</p>
            </li>
            
            <li class="slds-page-header__detail-block">
                <p class="slds-text-title slds-truncate slds-m-bottom_xx-small" title="Field2 (3)">Service Impacted
                    
                </p>
                <p class="slds-text-body_regular">{!v.change.HD_Service_Impacted__c}</p>
            </li>
            <li></li>
                <li></li>
                </ul></div>
            
            <div class="slds-col slds-size_4-of-12  slds-truncate">
               <aura:if isTrue="{!v.showApproval}">
                        <div class="slds-progress slds-progress_vertical slds-grid_align-spread slds-scrollable_x slds-float--right">
                          
                                <div  style="cursor: pointer;" onclick="{!c.showApprovalHist}">
                                    <section class="slds-clearfix">
                                        <div class="slds-float--left" >
                                            <lightning:icon  class="slds-hide" aura:id="rightArrow" iconName="utility:up" size="x-small" alternativeText="Indicates add"/>
                                            <lightning:icon  aura:id="downArrow" iconName="utility:down" size="x-small" alternativeText="Indicates dash"/>
                                        </div>
                                        <div class=" slds-m-left--large ">Approval Progress Indicator</div>
                                         
                                    </section>
                                </div>
                   
                          </div>
                    
                           <table aura:id='ApprTable' class="slds-hide slds-table slds-no-row-hover">
                                   <tbody>
                                                            
                                <tr>
                                    <td scope="row" data-label="APPROVAL STATUS">
                                        <div class="slds-progress slds-progress_vertical">
                                            <ol class="slds-progress__list">
                                                <aura:iteration items="{!v.lstKey}" var="key" indexVar="counter">
                                                  <c:HD_CMR_ChildMapValue map="{!v.approvalsProgress}" key="{!key}" flag="{!v.flag}" index="{!counter}" change="{!v.change}" showDetails="true"/> 
                                                </aura:iteration>
                                                
                                            </ol>
                                            <div aria-valuemin="0" aria-valuemax="100" aria-valuenow="25" role="progressbar">
                                                <span class="slds-assistive-text">Progress: 25%</span>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                </aura:if>
            </div>
       
        </div>
     
    </div>
    
    
</aura:component>