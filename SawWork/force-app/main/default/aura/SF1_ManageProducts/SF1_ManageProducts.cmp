<aura:component controller="SF1_ManageProductsController" 
                implements="force:hasRecordId,force:lightningQuickAction" 
                access="global" >
	<aura:attribute name="recordId" type="Id" />
    <aura:attribute name="from" type="String" />
    <aura:attribute name="oppLineObjId" type="Id" />
    <aura:attribute name="oppObj" type="Opportunity"/>
    <aura:attribute name="MRRValue" type="String" default="false"/>
    <aura:attribute name="MRRObjValue" type="String" default="false"/>
    <aura:attribute name="EMRIPositive" type="String" default="false"/>
    <aura:attribute name="EMRIValue" type="String"/>
    <aura:attribute name="ContractValue" type="String" default="Yes"/>
    <aura:attribute name="myCurr" type="Integer" default="50"/>
    <aura:attribute name="CurrencyOppValue" type="String"/>
    <aura:attribute name="contractEndedValues" type="String[]"/>
    <aura:attribute name="contractEndedValue" type="String"/>
    <aura:attribute name="oppCategoryValues" type="String[]"/>
    <aura:attribute name="oppCategoryValue" type="String"/>
    <aura:attribute name="oppSubCategoryValues" type="String[]"/>
    <aura:attribute name="oppSubCategoryValue" type="String"/>
    <aura:attribute name="oppCancellationLostValues" type="String[]"/>
    <aura:attribute name="oppCancellationLostValue" type="String"/>
    <aura:attribute name="additionalLossDetail" type="String"/>
    <aura:attribute name="aggregationPartnerValues" type="String[]"/>
    <aura:attribute name="aggregationPartnerValue" type="String"/>
    <aura:attribute name="competitorValues" type="String[]"/>
    <aura:attribute name="competitorValue" type="String"/>
    <aura:attribute name="accountName" type="String" />
    <aura:attribute name="categoryToCancelLossReasonMap" type="Map" default="{}"/>
    <aura:attribute name="missingProductFeature" type="String" />
    <aura:attribute name="initialOutClause" type="String" />
    <aura:attribute name="consolidationAccount" type="String" />
    <aura:attribute name="unacceptableTermsAndConditions" type="String" />
    <aura:attribute name="termRequired" type="Boolean" default="false"/>
    <aura:attribute name="AdditionalLossDetailRequired" type="Boolean" default="false"/>
        <!--SFDC-5573-->
    <aura:attribute name="oppForecastCategory" type="String"/>
    <aura:attribute name="oppCloseDate" type="String"/>
    <aura:registerEvent name="productDetailInvokeInit" type="c:invokeProductDetailInit"/>
    <aura:registerEvent name="addProductInvokeInit" type="c:invokeAddProductInit"/>
    <aura:handler event="c:goToProductDetail" 
                  action="{!c.handleproductDetailViewEvent}"/>
    <aura:handler event="c:invokeOppProdDetailsInit" 
                  action="{!c.handleOppProdDetailsEvent}"/>
    <aura:handler event="aura:waiting" action="{!c.showSpinner}"/>
    <aura:handler event="aura:doneWaiting" action="{!c.hideSpinner}"/>
    <div>
    <center><lightning:spinner variant="brand" size="large" aura:id="ltngSpinner" class="slds-hide"/></center>
    </div>
    
    <aura:handler name="init" value="{!this}" action="{!c.doInit}"/>
        <div class="slds-tabs--scoped slds-show" aura:Id = "mainTabId">
        	<div class="slds-hide" aura:id="oppBackBtnId">
        		<lightning:button variant="brand" label="Opportunity" 
                              	  iconName="utility:back" iconPosition="left" 
                              	  onclick="{!c.navigateToOpp}" />
                <p>&nbsp;</p>
        	</div> 
            <ul class="slds-tabs--scoped__nav" role="tablist">
                <li class="slds-tabs--scoped__item slds-active" title="Item One" role="presentation"
                    aura:id="OppDetId" onclick="{!c.OppDetailsActive}">
                    <a class="slds-tabs--scoped__link" href="javascript:void(0);" role="tab" tabindex="0" 
                       aria-selected="true" aria-controls="tab-scoped-1" id="tab-scoped-1__item">
                        Opportunity Details
                    </a>
                </li>
                <li class="slds-tabs--scoped__item" title="Item Two" role="presentation"
                    aura:id="prodDetId" onclick="{!c.prodDetailsActive}">
                    <a class="slds-tabs--scoped__link" href="javascript:void(0);" role="tab"
                       tabindex="-1" aria-selected="false" aria-controls="tab-scoped-2" 
                       id="tab-scoped-2__item">
                        Product Details
                    </a>
                </li>
            </ul>
            
            <div aura:id="oppDetBodyId" class="slds-tabs--scoped__content slds-show" role="tabpanel" 
                 aria-labelledby="tab-scoped-1__item">
                <ui:scrollerWrapper class="scrollerSize">
                <div class="slds-panel slds-grid slds-grid_vertical slds-nowrap" aura:id="oppDetailViewId">
                    <div class="slds-panel__section slds-show" aura:id="readOnlyOpptyOppInfoId">
                        <h3 class="slds-text-heading_small slds-m-bottom_medium">Opportunity Information</h3>
                            <ul>
                                <li class="slds-form-element slds-hint-parent slds-border_bottom">
                                    <span class="slds-form-element__label">Account Name</span>
                                    <div class="slds-form-element__control">
                                        <span class="slds-form-element__static">
                                            <ui:outputText value="{!v.accountName}"/>
                                        </span>
                                    </div>
                                </li>
                            </ul>
                            <ul>
                                <li class="slds-form-element slds-hint-parent slds-border_bottom">
                                    <span class="slds-form-element__label">Opportunity Name</span>
                                    <div class="slds-form-element__control">
                                        <span class="slds-form-element__static">
                                            <ui:outputText value="{!v.oppObj.Name}"/>
                                        </span>
                                    </div>
                                </li>
                            </ul>
                    </div>
                    <div class="slds-panel__section slds-show" aura:id="readOnlyForecastingOppInfoId">
                        <h3 class="slds-text-heading_small slds-m-bottom_medium">Forecasting Information</h3>
                            <ul>
                                <li class="slds-form-element slds-hint-parent slds-border_bottom">
                                    <span class="slds-form-element__label">MRR</span>
                                    <div class="slds-form-element__control">
                                        <span class="slds-form-element__static"
                                              style="{!if(v.MRRValue == 'true','color:red','color:black')}">
                                            <ui:outputText value="{!v.MRRObjValue}"/>
                                        </span>
                                    </div>
                                </li>
                            </ul>
                            <ul>
                                <li class="slds-form-element slds-hint-parent slds-border_bottom">
                                    <span class="slds-form-element__label">Forecast Category</span>
                                    <div class="slds-form-element__control">
                                        <span class="slds-form-element__static">
                                            <ui:outputText value="{!v.oppForecastCategory}"/>
                                        </span>
                                    </div>
                                </li>
                            </ul>
                            <ul>
                                <li class="slds-form-element slds-hint-parent slds-border_bottom">
                                    <span class="slds-form-element__label">Close Date</span>
                                    <div class="slds-form-element__control">
                                        <span class="slds-form-element__static">
                                            <ui:outputText value="{!v.oppCloseDate}"/>
                                        </span>
                                    </div>
                                </li>
                            </ul>
                            <ul>
                                <li class="slds-form-element slds-hint-parent slds-border_bottom">
                                    <span class="slds-form-element__label">EMRI</span>
                                    <div class="slds-form-element__control">
                                        <span class="slds-form-element__static"
                                              style="{!if(v.EMRIPositive == 'true','color:red','color:black')}">
                                            <ui:outputText value="{!v.EMRIValue}"/>
                                        </span>
                                    </div>
                                </li>
                            </ul>
                            <ul>
                                <li class="slds-form-element slds-hint-parent slds-border_bottom">
                                    <span class="slds-form-element__label">EMRI Comments</span>
                                    <div class="slds-form-element__control">
                                        <span class="slds-form-element__static">
                                            {!v.oppObj.EMRI_Comments__c}
                                        </span>
                                    </div>
                                </li>
                            </ul>
                    </div>
                    <div class="slds-panel__section slds-show" aura:id="readOnlyCanAndLossOppInfoId">
                        <h3 class="slds-text-heading_small slds-m-bottom_medium">Cancellation and Loss Information</h3>
                            <ul>
                                <li class="slds-form-element slds-hint-parent slds-border_bottom">
                                    <span class="slds-form-element__label">Loss Category</span>
                                    <div class="slds-form-element__control">
                                        <span class="slds-form-element__static">
                                            {!v.oppObj.Opportunity_Category__c}
                                        </span>
                                    </div>
                                </li>
                            </ul>
                            <ul>
                                <li class="slds-form-element slds-hint-parent slds-border_bottom">
                                    <span class="slds-form-element__label">Loss Reason</span>
                                    <div class="slds-form-element__control">
                                        <span class="slds-form-element__static">
                                            {!v.oppObj.Loss_Reason__c}
                                        </span>
                                    </div>
                                </li>
                            </ul>
                            <ul>
                                <li class="slds-form-element slds-hint-parent slds-border_bottom">
                                    <span class="slds-form-element__label">Additional Loss Detail</span>
                                    <div class="slds-form-element__control">
                                        <span class="slds-form-element__static">
                                            {!v.oppObj.Loss_Cancellation_Description__c}
                                        </span>
                                    </div>
                                </li>
                            </ul>
                            <ul>
                                <li class="slds-form-element slds-hint-parent slds-border_bottom">
                                    <span class="slds-form-element__label">New/Churn</span>
                                    <div class="slds-form-element__control">
                                        <span class="slds-form-element__static">
                                            {!v.oppObj.New_Churn__c}
                                        </span>
                                    </div>
                                </li>
                            </ul>
<!--                             <ul>
                                <li class="slds-form-element slds-hint-parent slds-border_bottom">
                                    <span class="slds-form-element__label">Opportunity Sub-Category</span>
                                    <div class="slds-form-element__control">
                                        <span class="slds-form-element__static">
                                            {!v.oppObj.Opportunity_Sub_Category__c}
                                        </span>
                                    </div>
                                </li>
                            </ul> -->
                            <ul>
                                <li class="slds-form-element slds-hint-parent slds-border_bottom">
                                    <span class="slds-form-element__label">Aggregation Partner</span>
                                    <div class="slds-form-element__control">
                                        <span class="slds-form-element__static">
                                            {!v.oppObj.Aggregation_Partner__c}
                                        </span>
                                    </div>
                                </li>
                            </ul>
                            
                            <ul>
                                <li class="slds-form-element slds-hint-parent slds-border_bottom">
                                    <span class="slds-form-element__label">Consolidation Account</span>
                                    <div class="slds-form-element__control">
                                        <span class="slds-form-element__static">
                                            {!v.oppObj.Consolidation_Account__r.Name}
                                        </span>
                                    </div>
                                </li>
                            </ul>
                            <ul>
                                <li class="slds-form-element slds-hint-parent slds-border_bottom">
                                    <span class="slds-form-element__label">Competitor</span>
                                    <div class="slds-form-element__control">
                                        <span class="slds-form-element__static">
                                            {!v.oppObj.Competitor__c}
                                        </span>
                                    </div>
                                </li>
                            </ul>
                            <ul>
                                <li class="slds-form-element slds-hint-parent slds-border_bottom">
                                    <span class="slds-form-element__label">Contract Ended - No Paper</span>
                                    <div class="slds-form-element__control">
                                        <span class="slds-form-element__static">
                                            {!v.ContractValue}
                                        </span>
                                    </div>
                                </li>
                            </ul>
                        </div>
                        <div class="slds-panel__section slds-show" aura:id="readOnlyAddInfoOppInfoId">
                            <h3 class="slds-text-heading_small slds-m-bottom_medium">Additional Information</h3>
                            <ul>
                                <li class="slds-form-element slds-hint-parent slds-border_bottom">
                                    <span class="slds-form-element__label">Carrier Application</span>
                                    <div class="slds-form-element__control">
                                        <span class="slds-form-element__static">
                                            {!v.oppObj.Carrier_Application__c}
                                        </span>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    <br/>
                    </div>
                </ui:scrollerWrapper>
                </div>

            

            <div aura:id="prodDetBodyId" class="slds-tabs--scoped__content slds-hide" role="tabpanel" 
                 aria-labelledby="tab-scoped-2__item">
                <div class="slds-panel slds-grid slds-grid_vertical slds-nowrap" aura:id="productsTileId">
                    <div class="slds-show" aura:id="mainButtonWithDownId">
                        <div class="slds-button-group slds-m-top_small" role="group">
                            <button aura:id="AddProdBtnId" 
                                    class="slds-button slds-button_neutral slds-grow"
                                    onclick="{!c.addProductAction}">
                                    Add Product
                            </button>
                            <button class="slds-button slds-button_icon slds-button_icon-border-filled" 
                                    aria-haspopup="true" title="More Actions" 
                                    onclick="{!c.downAction}">
                                    <lightning:icon iconName="utility:down" size="small"/>
                                <span class="slds-assistive-text">More Actions</span>
                            </button>
                        </div>
                    </div>
                    <div class="slds-hide" aura:id="mainButtonWithUpId">
                        <div class="slds-button-group slds-m-top_small" role="group">
                            <button aura:id="AddProdBtnId" 
                                    class="slds-button slds-button_neutral slds-grow"
                                    onclick="{!c.addProductAction}">
                                    Add Product
                            </button>
                            <button class="slds-button slds-button_icon slds-button_icon-border-filled" 
                                    aria-haspopup="true" title="More Actions" 
                                    onclick="{!c.upAction}">
                                    <lightning:icon iconName="utility:up" size="small"/>
                                <span class="slds-assistive-text">More Actions</span>
                            </button>
                        </div>
                    </div>
                    <div aura:id="ContractChangesId" class="slds-hide">
                        <div class="slds-button-group slds-m-top_small" role="group">
                            <button aura:id="AddProdBtnId" 
                                    class="slds-button slds-button_neutral slds-grow"
                                    onclick="{!c.noContractChangesAction}">
                                            No Contract Changes
                            </button>
                        </div>
                        <div  class="slds-button-group slds-m-top_small" role="group">
                                <button aura:id="AddProdBtnId" 
                                        class="slds-button slds-button_neutral slds-grow"
                                        onclick="{!c.churnCancelAction}">
                                            Churn/Cancel Contract
                                </button>
                        </div>
                    </div>
                    <br/>        
                    <ui:scrollerWrapper class="scrollerSize">
                        <aura:iteration var="oppLineItemObj" items="{!v.oppObj.OpportunityLineItems}">
                            <span>
                                <c:SF1_ProductView oppLineItem="{!oppLineItemObj}" parent_oppty_id="{!v.oppObj.Id}"/>
                            </span>
                            <br/>
                        </aura:iteration>
                     </ui:scrollerWrapper>
                </div>
            </div>
        </div>
        
        <div class="slds-hide" aura:id="productDetailViewTabId">
        <c:SF1_ProductDetailView OppLineItemId="{!v.oppLineObjId}" opportunityObj="{!v.oppObj}" termRequired="{!v.termRequired}" />
        </div>

        <div class="slds-hide" aura:id="addProductDetailId">
        <c:SF1_AddProduct opportunityObj="{!v.oppObj}" termRequired="{!v.termRequired}" AdditionalLossDetailRequired="{!v.AdditionalLossDetailRequired}"/>
        </div>
        
        <div class="demo-only slds-hide" style="height:120px;" aura:id ="modalNoContractChangesId" >
            <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" 
                     aria-describedby="modal-content-id-1" class="slds-modal slds-slide-up-saving">
                <div class="slds-modal__container">
                    <header class="slds-modal__header">
                    	<h2 id="modal-heading-01" class="slds-text-heading_medium slds-hyphenate">
                            No Contract Changes
                        </h2>
                    </header>
                    <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1">
                        <p> Please note that MRR and EMRI would become Zero. 
                            Please confirm if you want to proceed.
                        </p>
                    </div>
                    <footer class="slds-modal__footer">
                        <button class="slds-button slds-button_neutral"  
                                onclick="{!c.hideModalNoContractChanges}"> 
                           		Cancel
                        </button>
                        <button class="slds-button slds-button_brand" 
                                onclick="{!c.hideModalNoContractChangesAndSaveAction}">
                            	Yes
                        </button>
                    </footer>
                </div>
            </section>
            <div class="slds-backdrop slds-backdrop_open" aura:id="backDropId"/>
        </div>
        
        <div class="demo-only slds-hide" style="height:120px;" aura:id ="modalContractEndedFieldId" >
            <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" 
                     aria-describedby="modal-content-id-1" class="slds-modal slds-slide-up-saving">
                <div class="slds-modal__container">
                    <header class="slds-modal__header">
                    	<h2 id="modal-heading-01" class="slds-text-heading_medium slds-hyphenate">
                            Contract Ended - No Paper
                        </h2>
                    </header>
                    <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1">
                    	<div class="slds-hide" style="color:red;" aura:id="addOppErrorContractMessageId">
                            	<p> Please select a valid value</p>
                    	</div>
                    	<lightning:select aura:id="competitorPickId" 
                                              value="{!v.contractEndedValue}">
                                <option text="--none--" label = "--None--"/>
                                <aura:iteration items="{!v.contractEndedValues}" 
                                                var="val">
                                    <option text="{!val}" label="{!val}"/>
                                </aura:iteration>
                    	</lightning:select>
                    </div>
                    <footer class="slds-modal__footer">
                        <button class="slds-button slds-button_neutral"  
                                onclick="{!c.hideModalContractEndedField}"> 
                           		Cancel
                        </button>
                        <button class="slds-button slds-button_brand" 
                                onclick="{!c.hideModalContractEndedFieldAndSaveAction}">
                            	Save
                        </button>
                    </footer>
                </div>
            </section>
            <div class="slds-backdrop slds-backdrop_open" aura:id="backDropId"/>
        </div>
        
        <div class="demo-only slds-hide" style="height:120px;" aura:id ="addOppMainDetailsId" 
             aria-hidden="false">
            <section role="document" tabindex="-1" aria-labelledby="modal-heading-01"
                     aria-describedby="modal-content-id-1" class="slds-modal slds-slide-up-saving">
                <div class="slds-modal__container">
                    <header class="slds-modal__header">
                    	<h2 id="modal-heading-01" class="slds-text-heading_medium slds-hyphenate">
                            Opportunity Details
                        </h2>
                    </header>
                    <div class="slds-modal__content slds-p-around_small slds-show"
                         id="modal-content-id-1"
                         aura:id="oppPicklistDetailsId">
                        <div class="slds-hide" style="color:red;" aura:id="addOppErrorMessageId">
                            <p> Please select a valid picklist value for all the fields</p>
                        </div>
    					<lightning:select aura:id="oppCategoryId" onchange="{!c.oppCategorySelection}"
                                          value="{!v.oppCategoryValue}" 
                                          label="Loss Category"
                                          required="true">
                        		<aura:iteration items="{!v.oppCategoryValues}" var="val">
                                	<option text="{!val}" label="{!val}"/>
                            	</aura:iteration>
                        </lightning:select>
                        <br/>

                        <lightning:select aura:id="oppCategoryId"
                                          value="{!v.oppCancellationLostValue}"
                                          label="Loss Reason"
                                          required="true">
                            <option text="--None--" label = "--None--"/>
                        	<aura:iteration items="{!v.oppCancellationLostValues}" var="val">
                                	<option text="{!val}" label="{!val}"/>
                            </aura:iteration>
                        </lightning:select>
                        <br/>

                        <div aura:id="additionalLossDetail">
                            <lightning:textarea name="myTextArea"
                                                value="{!v.additionalLossDetail}" 
                                                label="Additional Loss Detail"/>
                        <br/><br/>
                        </div>

                    </div>
                    <div class="slds-modal__content slds-p-around_medium slds-hide"
                         id="modal-content-id-2"
                         aura:id="cancellationFieldsId">
                         <div class="slds-hide" style="color:red;"
                              aura:id="cancellationErrorMessageId">
                            <p> Please enter a valid value for all the fields</p>
                        </div>
                        <lightning:select aura:id="competitorContractPickId" 
                                          value="{!v.contractEndedValue}"
                                          label="Contract Ended - No Paper">
                                <option text="--none--" label = "--None--"/>
                                <aura:iteration items="{!v.contractEndedValues}" 
                                                var="val">
                                    <option text="{!val}" label="{!val}"/>
                                </aura:iteration>
                    	</lightning:select>
                        <br/>
                     <!--    <div class="slds-hide" aura:id="missingProductFeatureId">
                            <lightning:textarea name="myTextArea"
                                                value="{!v.missingProductFeature}" 
                                                label="Missing Product Feature"/>
                        <br/><br/>
                        </div>
                        
                        <div class="slds-hide" aura:id="initialOutClauseId">
                            <lightning:textarea name="myTextArea"
                                                value="{!v.initialOutClause}" 
                                                label="Initial Out Clause Description"/>
                        <br/><br/>           
                        </div> -->
                        
                        <div class="slds-hide" aura:id="aggregationPartnerId">
                            <lightning:select aura:id="aggregationPartnerPickId"
                                                          onchange="{!c.oppAggregationSelection}"
                                                          value="{!v.aggregationPartnerValue}"
                                                          label="Aggregation Partner">
                                            <option text="--none--" label = "--None--"/>
                                                <aura:iteration items="{!v.aggregationPartnerValues}"
                                                                var="val">
                                                    <option text="{!val}" label="{!val}"/>
                                                </aura:iteration>
                                        </lightning:select>
                        <br/>            
                        </div>
                        
                        <div class="slds-hide" aura:id="consolidationAccountId">
                           <span class="slds-form-element__label">Consolidation Account</span>
                                <c:SF1_LookupComponent placeholderText="Consolidation Account"
                                                               type="Account"
                                                               value="{!v.consolidationAccount}"
                                                               fieldsToShowInSuggestion="Account_Name__c" 
                                                               />
                                    
                                <br/><br/><br/><br/><br/><br/><br/><br/><br/>
                            
                        </div>
                        
                        <div class="slds-hide" aura:id="oppCompetitorId">
                            <lightning:select aura:id="competitorPickId"
                                                          value="{!v.competitorValue}" 
                                                          label="Competitor">
                                            <option text="--none--" label = "--None--"/>
                                                <aura:iteration items="{!v.competitorValues}"
                                                                var="val">
                                                    <option text="{!val}" label="{!val}"/>
                                                </aura:iteration>
                                        </lightning:select>
                        <br/>            
                        </div>
                        
<!--                         <div class="slds-hide" aura:id="unacceptableTermsandConditionsId">
                            <lightning:textarea name="myTextArea"
                                                            value="{!v.unacceptableTermsAndConditions}" 
                                                            label="Unacceptable Terms and Conditions"/>
                                    
                        </div>
                        <br/> -->
                    </div>
                    <div aura:id="nextFooterId" class="slds-show">
                        <footer class="slds-modal__footer">
                            <button class="slds-button slds-button_neutral"
                                    onclick="{!c.addOppDetailsCancelAction}"
                                    aura:id="cancelButtonId">
                                    Cancel
                            </button>
                            <button class="slds-button slds-button_brand"
                                    onclick="{!c.addOppDetailsNextAction}"
                                    aura:id="nextButtonId">
                                    Next
                            </button>
                        </footer>
                    </div>
                    <div aura:id="saveAfterNextFooterId" class="slds-hide">
                        <footer class="slds-modal__footer">
                            <button class="slds-button slds-button_neutral"
                                    onclick="{!c.addOppDetailsBackAction}"
                                    aura:id="backButtonId">
                                    Back
                            </button>
                            <button class="slds-button slds-button_brand"
                                    onclick="{!c.addOppDetailsSaveAction}"
                                    aura:id="saveButtonId">
                                    Save
                            </button>
                        </footer>
                    </div>
                </div>
            </section>
            <div class="slds-backdrop slds-backdrop_open" aura:id="backDropId"/>
        </div>
</aura:component>