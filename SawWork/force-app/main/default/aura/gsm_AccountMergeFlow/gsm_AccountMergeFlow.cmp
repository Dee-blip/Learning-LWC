<aura:component controller="gsm_AccountMergeFlowController"
                implements="flexipage:availableForAllPageTypes,flexipage:availableForRecordHome,force:hasRecordId,force:lightningQuickAction" 
                access="global" >
	<aura:attribute name="recordId" type="Id" />
    <aura:attribute name="accName" type="String" />
    <aura:attribute name="options" type="List" 
                    default="[{'label': 'Winning Account', 'value': 'winning'},
                             {'label': 'Losing Account', 'value': 'losing'}]"/>
    <aura:attribute name="typeSelected" type="String" default="option1"/>
    <aura:attribute name="searchKeyword" type="String" description="use for store user search input"/>
    <aura:attribute name="accountData" type="object"/>
    <aura:attribute name="accountReqData" type="object"/>
    <aura:attribute name="accountColumns" type="object"/>
    <aura:attribute name="sortedBy" type="string" default="Name"/>
  	<aura:attribute name="sortedDirection" type="string" default="asc"/>
    <aura:attribute name="errorMessage" type="String"/>
    <aura:attribute name="typeSelectionErrorMessage" type="String"/>
    <aura:attribute name="successMessage" type="String"/>
    <aura:attribute name="accountTypeMessage" type="String"/>
    <aura:attribute name="selectedAccountIds" type="List"/>
    <aura:attribute name="losingAccountConfirmMessage" type="String"/>
    <aura:attribute name="userThemeValue" type="String"/>
    <aura:attribute name="losingActiveMessage" type="String" />
    <aura:attribute name="accountReqColumns" type="object"/>
    <aura:handler event="aura:waiting" action="{!c.showSpinner}"/>
    <aura:handler event="aura:doneWaiting" action="{!c.hideSpinner}"/>
    <div>
        <center>
            <lightning:spinner variant="brand" size="large" aura:id="ltngSpinner" class="slds-hide"/>
        </center>
    </div>
    <aura:handler name="init" value="{!this}" action="{!c.doInit}"/>
    <div class="slds-form slds-theme_shade slds-show" aura:id="accountTypeSelectionId">
        <lightning:card iconName="standard:account" class="slds-align_absolute-center">
            <aura:set attribute="title">
                <strong>
                    Account Merge Request: <a href="{!'/'+v.recordId}" target="_blank" >{!v.accName}</a>
                </strong>
            </aura:set>
        </lightning:card>
        <br/>
        <div class="slds-hide slds-form-element" 
             style="color:red;" aura:id="typeSelectionErrorId">
        	<ui:outputText value="{!v.typeSelectionErrorMessage}" 
                           class="slds-align_absolute-center"/>
            <br/>
		</div>
        <div class="slds-form-element  slds-align_absolute-center">
                <lightning:radioGroup aura:id="accountTypeId" name="accountTypeSelection" 
                                      label="Select Account Type" options="{! v.options }" 
                                      value="{! v.typeSelected }"/>
                <br/>
            <br/>
        </div>
        <br/>
        <div class="slds-form-element  slds-align_absolute-center"> 
                <lightning:button variant="neutral" label="Back" onclick="{! c.redirectToAccount }" 
                                          iconName="standard:account" iconPosition="left"
                                          type="submit"/>
                <lightning:button variant="neutral" label="Proceed" onclick="{! c.afterTypeSelection }" 
                                  iconName="standard:sales_path" iconPosition="left"
                                  type="submit"/>
    	</div>
   	</div>
  
    
    
    <div aura:id="accountSelectionId" class="slds-hide">
        <lightning:card iconName="standard:account">
            <aura:set attribute="title">
                <strong>
                    Account Merge Request: <a href="{!'/'+v.recordId}" target="_blank" >{!v.accName}</a>
                </strong>
            </aura:set>
            <aura:set attribute="actions">
                <button type="button" class="slds-button slds-button_brand" 
                        onclick="{! c.checkActiveAccounts }" 
                        disabled="{! v.selectedAccountIds.length == 0 }" aura:id="submitBtnId">
                    Submit Request
                </button>
                <button type="button" class="slds-button slds-button_neutral" 
                        onclick="{! c.redirectToAccount }" aura:id="cancelBtnId">
                    Cancel
                </button>
            </aura:set>
            <div class="slds-align_absolute-center" aura:id="searchId">
                <lightning:input type="search" name="search" value="{! v.searchKeyword }"/> 
                &nbsp;&nbsp;&nbsp;
               	<aura:if isTrue="{! v.userThemeValue == 'Theme4d' }">
                    <div style="padding-top: 16px !important;">
                        <button type="button" onclick="{! c.searchAccount }" 
                                class="slds-button slds-button_brand" disabled="{!v.searchKeyword == null || v.searchKeyword == '' ? true : false}">
                            Search
                        </button>
                    </div>
               	<aura:set attribute="else">
                    <button type="button" onclick="{! c.searchAccount }" 
                            class="slds-button slds-button_brand" disabled="{!v.searchKeyword == null || v.searchKeyword == '' ? true : false}">
                    	Search
                	</button>
                </aura:set>
				</aura:if>
            </div>
            <br/>
                <div class="slds-hide" aura:id="mergeRequestErrorId">
                    <ui:message title="Error:" severity="error" closable="false">
                        {!v.errorMessage}    
                    </ui:message>
                </div>
            
            <!--<div class="slds-box slds-theme_shade slds-hide" 
                 style="color:green;" aura:id="accountTypeMessageId">
                <p>{!v.accountTypeMessage}</p>
			</div>-->
            <div class="slds-hide" aura:id="accountTypeMessageId">
                <ui:message title="Note:" severity="info" closable="false">
                    {!v.accountTypeMessage}    
                </ui:message>
            </div>
            <div class="slds-box slds-theme_shade slds-theme_alert-texture slds-hide" 
                 style="color:green;" aura:id="mergeRequestSuccessId">
                <p><strong>{!v.successMessage} </strong>
                    You are getting redirected to the Account Merge Request..</p>
			</div>
            <div class="slds-box slds-theme_shade slds-hide" 
                 style="color:green;" aura:id="mergeRequestMultiSuccessId">
                <p><strong>{!v.successMessage} </strong>
                    Below list contains all the merge requests for the winning account.</p>
            </div>
            <div class="slds-hide" aura:id="winningAccountSearchId">
            	<aura:if isTrue="{! v.accountData.length != 0 }">
                <br/>
    			<lightning:datatable data="{! v.accountData }"
                    columns="{! v.accountColumns }"
                    onsort="{!c.updateColumnSorting}"
                    sortedBy="{!v.sortedBy}"
                    sortedDirection="{!v.sortedDirection}"
                    onrowselection="{!c.getSelectedName}"
                    keyField="Id"/>
    			<br/>
                <aura:set attribute="else">
                    No Accounts to display
                </aura:set>
				</aura:if>    
            </div>
            <div class="slds-hide" aura:id="losingAccountSearchId">
            	<aura:if isTrue="{! v.accountData.length != 0 }">
                <br/>
    			<lightning:datatable data="{! v.accountData }"
                    columns="{! v.accountColumns }"
                    onsort="{!c.updateColumnSorting}"
                    sortedBy="{!v.sortedBy}"
                    sortedDirection="{!v.sortedDirection}"
                    onrowselection="{!c.getSelectedName}"
                    maxRowSelection="1"                 
                    keyField="Id"/>
                <br/>
                <aura:set attribute="else">
                    No Accounts to display
                </aura:set>
				</aura:if>
            </div>

            <div class="slds-hide" aura:id="accountMergeReqsId">
                <aura:if isTrue="{! v.accountReqData.length != 0 }">
                <br/>
                <lightning:datatable data="{! v.accountReqData }"
                    columns="{! v.accountReqColumns }"
                    onsort="{!c.updateColumnSorting}"
                    sortedBy="{!v.sortedBy}"
                    sortedDirection="{!v.sortedDirection}"
                    onrowselection="{!c.getSelectedName}"
                    hideCheckboxColumn="true"
                    keyField="Id"/>
                <br/>
                <aura:set attribute="else">
                    No Accounts to display
                </aura:set>
                </aura:if>    
            </div>

        </lightning:card>
    </div>
    
    <div class="slds-hide" style="height: 640px;" aura:id ="losingAccountConfirmId">
        <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" 
                 aria-describedby="modal-content-id-1" class="slds-modal slds-slide-up-saving">
            <div class="slds-modal__container">
            	<div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1">
                    <p>{!v.losingAccountConfirmMessage}</p>    
                </div>
                <footer class="slds-modal__footer">
        			<button class="slds-button slds-button_neutral" 
                            onclick="{!c.hideLosingAccountModal}">
                    	Cancel
                    </button>
        			<button class="slds-button slds-button_brand" 
                            onclick="{!c.proceedLosingAccountActive}">
                    	Confirm
                    </button>
      			</footer>
            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open" aura:id="backDropId"/>         
    </div>
    
    <div class="slds-hide" style="height: 640px;" aura:id ="losingActiveAccountsConfirmId">
        <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" 
                 aria-describedby="modal-content-id-1" class="slds-modal slds-slide-up-saving">
            <div class="slds-modal__container">
            	<div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1">
                    <p>{!v.losingAccountConfirmMessage}</p>    
                </div>
                <footer class="slds-modal__footer">
        			<button class="slds-button slds-button_neutral" 
                            onclick="{!c.hideLosingActiveAccountsModal}">
                    	Cancel
                    </button>
        			<button class="slds-button slds-button_brand" 
                            onclick="{!c.proceedLosingActiveAccounts}">
                    	Confirm
                    </button>
      			</footer>
            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open" aura:id="backDropId"/>         
    </div>
    
</aura:component>