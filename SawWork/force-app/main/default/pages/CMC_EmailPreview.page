<!--
    Author   : Vamsee Surya S
    Date     : 28th Feb 2017
    Purpose  : This page will be used to display Email Preview before sending the email.
               This is implemented as part of CMC project (CR 3426181)
-->
<apex:page controller="CMC_EmailPreviewCtrl" standardStylesheets="false" showHeader="false" action="{!FetchEmailBody}" Title="Mailer Preview">
<apex:includeScript value="/support/console/28.0/integration.js" />
<apex:includeScript value="{!$Resource.JQuery_New}" />
    <style>
    .emailPreviewSection{
        overflow: auto;
        width: 60%;
        height: 80%;
        margin-left: 20%;
        background-color: rgb(222, 222, 222);;
        position:absolute;
    }
    .buttonSection{
        width: 60%;
        height: 20%;
        margin-left: 20%;
        background-color: rgb(222, 222, 222);;
        margin-top: 80vh;
        position:absolute;
        text-align: center;
    }
    h4{
        margin-left:2%;
    }
    
    .outputText{
        position: absolute;
        background-color: #FFFFFF;
        margin-left: 2%;
        width: 95%;
    }
    .outputTextDiv{
        position: absolute;
        background-color: #FFFFFF;
        margin-left: 2%;
        width: 95%;
        min-height: 60%;
     }
        
     .buttonStyle {
        height: 25%;
        text-align: centre;
        padding: 0.1em 1em;
        color: #111;
        background-color: #FFF;
        border-radius: 10px;
        display: inline-grid;
        border: solid 1px #CCC;
        cursor: pointer;
        position: 50px 50px;
        margin-right: 10px;
        margin-top: 30px;
     }   
    </style>
    
    
    <apex:form >
    <apex:actionFunction name="PostMailer" action="{!PostMailer}" rerender=""/>
        <apex:pageBlock >
        <div class ="emailPreviewSection">
            <h4>Subject : </h4>
            <apex:outputText styleClass="outputText" value="{!subject}"/><br/><br/>
            <h4>Body : </h4>
            <div class ="outputTextDiv">
                <apex:outputText value="{!htmlBody}" rendered="{!IF(isTextEmail,false,true)}" escape="false"></apex:outputText> 
                    <apex:repeat value="{!textBody}" var="body" rendered="{!isTextEmail}">
                        <apex:outputText value="{!body}"/><br/>
                    </apex:repeat>
            </div><br/>
        </div>
        <div class ="buttonSection">
            <apex:commandButton id="sendMailerId" onclick="sendResponseToParentWindow(this.value);" styleClass="buttonStyle" html-data-value="sendMailerId" value="Send Mailer" />
            <apex:commandButton value="Cancel" onclick="sendResponseToParentWindow(this.value);" html-data-value="CancelId" styleClass="buttonStyle"/>
        </div>
            </apex:pageBlock>
    </apex:form>
    
    <script type="text/javascript">
    //function to send response back to parent window
    function sendResponseToParentWindow(clickedId) {  
        try {
            if(clickedId === "Send Mailer"){
                PostMailer();
                window.opener.HandlePopupResult('sendMailerId'); 
            }
        }
        catch (err) {
            alert(err);
        }
        window.close();
        return false;
    }
    
    </script>
    
</apex:page>