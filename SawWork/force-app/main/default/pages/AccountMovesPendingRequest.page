<apex:page controller="AccountMovesPendingRequestController" showHeader="true" sidebar="true" tabStyle="Account_Reassignment__c" >
<apex:includeScript value="{!URLFOR($Resource.Jquery_1_11,'js/jquery-1.11.3.min.js')}"/>  





    
<style type="text/css">
        .custPopup{
            background-color: white;
            border-width: 2px;
            border-style: solid;
            z-index: 9999;
            left: 50%;
            padding:10px;
            position: absolute;
            
            width: 600px;
            height: 150px;
            margin-left: -250px;
            top:100px;
        }
        .popupBackground{
            background-color:black;
            opacity: 0.20;
            filter: alpha(opacity = 20);
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 9998;
        }

</style>

    

    

    <script>

    //Redirect URL from homepage to Mass Approve/Reject/Reassign
    function detailPageURL() {
        this.parent.location.href ='/apex/AccountMovesPendingRequest?pageId=detailPage';
        }

    //Function to Check/Uncheck all the Requests at once
    /*function checkAll(cb){
            //var inputElem = document.getElementsByTagName("input");
            var inputElem2 = document.getElementsByClassName("primaryCheckboxes2");

            for(var i=0; i<inputElem2.length; i++){
                if(inputElem2[i].id.indexOf("checkedone")!=-1)
                    inputElem2[i].checked = cb.checked;
            }

        }

        function checkAllOne(cb1){
            var inputElem1 = document.getElementsByClassName("primaryCheckboxes1");
            for(var i=0; i<inputElem1.length; i++){
                if(inputElem1[i].id.indexOf("checkedone")!=-1)
                    inputElem1[i].checked = cb1.checked;
            }

        }*/
    //Function to allow checking only one at a time
    function allowOnePrimary(checkbox) {
            var checkboxes = document.getElementsByClassName('primaryCheckboxes');
            for(var i=0; i<checkboxes.length; i++){
                checkboxes[i].checked = false;
            }
            checkbox.checked = true;
            }
    //Function to check multiple checkboxes
    /*var j$ = jQuery.noConflict();

    function checkboxChanged(checkbox1) {
  
             // Get the name of the checkbox which changed
        var changedCheckboxId = j$(checkbox1).attr('name'); 
        j$(this).attr('checked', true);           
          }   
    */

    function selectAllCheckboxes(obj,receivedInputID){
            //var inputCheckBox = document.getElementsByTagName("input1");  
            var inputCheckBox = document.getElementsByClassName('myCheckboxes');
               
            for(var i=0; i<inputCheckBox.length; i++){          
                if(inputCheckBox[i].id.indexOf(receivedInputID)!=-1){                                     
                    inputCheckBox[i].checked = obj.checked;
                }
            }
        }
    function selectAllDCheckboxes(obj,receivedInputID){
            //var inputCheckBox = document.getElementsByTagName("output");
            var inputCheckBox = document.getElementsByClassName('myDelCheckboxes');
                  
            for(var i=0; i<inputCheckBox.length; i++){          
                if(inputCheckBox[i].id.indexOf(receivedInputID)!=-1){                                     
                    inputCheckBox[i].checked = obj.checked;
                }
            }
        }

    </script>

        <apex:pageMessages />


    <apex:form id="formId">
  
        <apex:outputpanel >
            <apex:actionstatus id="showSpinner">
              <apex:facet name="start">
                <div class="waitingSearchDiv" id="el_loading" style="background-color: #d3d3d3; height: 100%;opacity:0.90;width:100%;">
                  <div class="waitingHolder" style="top: 74.2px; width: 100px;">
                    <img class="waitingImage" src="/img/loading.gif"  title="Please Wait..." />
                    <span  class="waitingDescription" style="height: 40px; width: 100px; color:darkred;" >Please Wait...</span>
                  </div>
                </div>
              </apex:facet>
           </apex:actionstatus>
        </apex:outputpanel>

        <apex:pageblock >

            <!--apex:messages style="color:red;"/-->
            
            <apex:outputLabel value="Note: You can view only the Most Recently Submitted Approvals here. Click 'Manage All' button to access all the pending approvals" rendered="{!showButtonsManageAll}" />
            <apex:outputLabel value="Approval Requests are being processed,please refresh the page in sometime to see the latest changes.You will be recieving an email in case of any failures." rendered="{!showApproveRejectMsg}" />
            <apex:outputLabel value="Reassign Requests are processed successfully, please refresh the page to see the latest changes." rendered="{!showReassignMsg}" />
            <apex:outputPanel id="buttonRefresh" rendered="{!!showReAssignSection}">
                <div align="center" draggable="false"  >
                    <apex:commandButton value="Manage All" action="{!redirectToNewPage}" oncomplete="detailPageURL();" reRender="selectColumn" rendered="{!showButtonsManageAll}"/>
                    
                    
                   <apex:commandButton id="B" value="Reassign" action="{!showReassignSectionMethod}"  rendered="{!!showButtonsManageAll}" style="margin-right:8px; "/>
                        
                    <apex:commandButton id="C" value="Approve/Reject" action="{!showPopup}"  rendered="{!!showButtonsManageAll}"/>

                </div>
            </apex:outputPanel>
            
            <apex:pageBlockSection title="Requires My Approval" columns="1" rendered="{!!showReAssignSection}">
            


                <apex:pageBlockTable value="{!my_items_to_approve}" var="my_item_to_approve"  rendered="{!IF(my_items_to_approve.size>0,true,false)}"  headerClass="header"  styleClass="dataTable"   rows="{!rowNum}">

                    
                    <apex:column headerValue="Select" width="5%"  rendered="{!selectCheckbox}">
                        <apex:facet name="header">
                            <apex:inputCheckbox onclick="selectAllCheckboxes(this,'input')" />
                        </apex:facet>
                        <!--apex:inputCheckbox value="{!my_item_to_approve.Checkbox}" id="checkedone"  html-data-cbType="mainContactCheckbox"> <!--styleClass="primaryCheckboxes1">
                            <apex:actionSupport event="onclick"   action="{!inputCheckForSelectRequest}" onsubmit="checkboxChanged(this)" />
                        </apex:inputCheckbox-->
                       <apex:inputCheckbox value="{!my_item_to_approve.CheckBox}" id="input"  styleClass="myCheckboxes"/>
                    </apex:column>

                    <apex:column headerValue="Action" width="12%" >
                        <apex:commandLink target="_top" value="Reassign |" action="{!REASSIGNnavigation}" style="text-decoration:none;color: #015ba7;" ><!-- styleClass="cactionLink"-->
                            <apex:param name="myParam" value="{!my_item_to_approve.approvalid }" />
                        </apex:commandLink>

                        <apex:commandLink target="_top" value=" Approve / Reject" action="{!ApproveRejectnavigation}" style="text-decoration:none;color: #015ba7;"  >
                            <apex:param name="myParam" value="{!my_item_to_approve.approvalid }" />
                        </apex:commandLink>

                    </apex:column>

                    <apex:column headerValue="Request ID" width="8%" >
                        <apex:outputlink value="/{!my_item_to_approve.requestId}"  styleClass="header" target="_blank">{!my_item_to_approve.requestName}</apex:outputlink>
                    </apex:column>

                    <apex:column headerValue="Submitted Date" width="11%" >
                        <apex:outputText styleClass="header">
                            {!my_item_to_approve.submittedDate}
                        </apex:outputText> 
                    </apex:column>

                    <apex:column headerValue="Account" width="10%">
                        <apex:outputlink value="/{!my_item_to_approve.accountId}" target="_blank">{!my_item_to_approve.accountName}</apex:outputlink>
                    </apex:column>

                    <apex:column headerValue="Target Category"  width="8%">
                        <apex:outputText styleClass="header">
                            {!my_item_to_approve.targetCategory}
                        </apex:outputText>
                    </apex:column>
                    <apex:column headerValue="Account Status"  width="8%">
                        <apex:outputText styleClass="header">
                            {!my_item_to_approve.accountStatus}
                        </apex:outputText>
                    </apex:column>

                    <apex:column headerValue="Account Owner"  width="8%">
                        <apex:outputlink value="/{!my_item_to_approve.accountOwnerId}" target="_blank">{!my_item_to_approve.accountOwner}</apex:outputlink>
 
                    </apex:column>
                    <apex:column headerValue="Assign To" width="11%">
                        <apex:outputlink value="/{!my_item_to_approve.assignToUserId}" target="_blank"> {!my_item_to_approve.assignToUser}</apex:outputlink>
 
                    </apex:column>
                    <apex:column headerValue="Change Level" width="5%">
                        <apex:outputText >
                            {!my_item_to_approve.changeLevel}
                        </apex:outputText> 
                    </apex:column>
                    <apex:column headerValue="Reason Code" width="10%">
                        <apex:outputText >
                            {!my_item_to_approve.reasonCode}
                        </apex:outputText> 
                    </apex:column>
                    <apex:column headerValue="Reason For Change" width="12%">
                        <apex:outputText >
                            {!my_item_to_approve.reasonForChange}
                        </apex:outputText>
                    </apex:column>

                </apex:pageBlockTable>
                <apex:outputText rendered="{!IF(my_items_to_approve.size>0,false,true)}" >No pending requests to display</apex:outputText>
            </apex:pageBlockSection>


            <apex:pageBlockSection title="Requires Delegated Approval" columns="1" rendered="{!!showReAssignSection}">


                <apex:pageBlockTable value="{!del_items_to_approve}" var="del_item_to_approve"  rendered="{!IF(del_items_to_approve.size>0,true,false)}" styleClass="dataTable" rows="{!rowNum}" >

                    <apex:column headerValue="Select" width="5%"  rendered="{!selectCheckbox}">
                        <apex:facet name="header">
                            <apex:inputCheckbox onclick="selectAllDCheckboxes(this,'output')" />
                        </apex:facet>
                        <!--apex:inputCheckbox value="{!my_item_to_approve.Checkbox}" id="checkedone"  html-data-cbType="mainContactCheckbox"> <!--styleClass="primaryCheckboxes1">
                            <apex:actionSupport event="onclick"   action="{!inputCheckForSelectRequest}" onsubmit="checkboxChanged(this)" />
                        </apex:inputCheckbox-->
                       <apex:inputCheckbox value="{!del_item_to_approve.CheckBox}" id="output" styleClass="myDelCheckboxes" />

                    </apex:column>

                    

                    <apex:column headerValue="Action" width="12%">
                        <apex:commandLink target="_top" value="Reassign |" action="{!REASSIGNnavigation}" style="text-decoration:none;color: #015ba7;" ><!--styleClass="cactionLink"-->
                            <apex:param name="myParam" value="{!del_item_to_approve.approvalid }" />
                        </apex:commandLink>

                        <apex:commandLink target="_top" value=" Approve / Reject" action="{!ApproveRejectnavigation}" style="text-decoration:none;color: #015ba7;"  >
                            <apex:param name="myParam" value="{!del_item_to_approve.approvalid }" />
                        </apex:commandLink>

                    </apex:column>

                    <apex:column headerValue="Request ID" width="8%" >
                        <apex:outputlink value="/{!del_item_to_approve.requestId}" target="_blank">{!del_item_to_approve.requestName}</apex:outputlink>
                    </apex:column>
                    
                    <apex:column headerValue="Submitted Date" width="11%">
                        <apex:outputText >
                            {!del_item_to_approve.submittedDate}
                        </apex:outputText> 
                    </apex:column>

                    <apex:column headerValue="Account" width="10%" >
                        <apex:outputlink value="/{!del_item_to_approve.accountId}" target="_blank">{!del_item_to_approve.accountName}</apex:outputlink>
                    </apex:column>
                    <apex:column headerValue="Target Category" width="8%" >
                        <apex:outputText >
                            {!del_item_to_approve.targetCategory}
                        </apex:outputText>
                    </apex:column>
                    <apex:column headerValue="Account Status"  width="8%">
                        <apex:outputText styleClass="header">
                            {!del_item_to_approve.accountStatus}
                        </apex:outputText>
                    </apex:column>
                    <apex:column headerValue="Account Owner" width="8%">
                        <apex:outputlink value="/{!del_item_to_approve.accountOwnerId}" target="_blank">{!del_item_to_approve.accountOwner}</apex:outputlink>
 
                    </apex:column>
                    <apex:column headerValue="Assign To" width="11%">
                        <apex:outputlink value="/{!del_item_to_approve.assignToUserId}" target="_blank">{!del_item_to_approve.assignToUser}</apex:outputlink>
 
                    </apex:column>
                    <apex:column headerValue="Actual Approver" width="11%">
                        <apex:outputlink value="/{!del_item_to_approve.originalActorId}" target="_blank">{!del_item_to_approve.originalActor}</apex:outputlink>
 
                    </apex:column>
                    <apex:column headerValue="Change Level" width="5%">
                        <apex:outputText >
                            {!del_item_to_approve.changeLevel}
                        </apex:outputText> 
                    </apex:column>
                    <apex:column headerValue="Reason Code" width="10%">
                        <apex:outputText >
                            {!del_item_to_approve.reasonCode}
                        </apex:outputText> 
                    </apex:column>
                    <apex:column headerValue="Reason For Change" width="12%">
                        <apex:outputText >
                            {!del_item_to_approve.reasonForChange}
                        </apex:outputText>
                    </apex:column>
                    


                </apex:pageBlockTable>
                    <apex:outputText rendered="{!IF(del_items_to_approve.size>0,false,true)}">No delegated pending requests to display</apex:outputText>


            </apex:pageBlockSection>

            


        


      <apex:pageBlockSection rendered="{!!showReAssignSection}" id="popupSection">
            <apex:outputPanel id="approveRejpopup" rendered="{!displayPopUp}">
                    <apex:outputPanel styleClass="popupBackground" layout="block" rendered="{!displayPopUp}"/>
                    <apex:outputPanel styleClass="custPopup" layout="block" rendered="{!displayPopUp}">
                        <div align="center" draggable="false"  >
                        <apex:outputlabel value="Approve/Reject Comments" style="font-weight:bold; margin-right:20px;vertical-align:top;  "></apex:outputlabel>

                        <apex:inputTextarea id="comment" label="Approve/Reject Comments" value="{!approveRejectComment}" style="width:250px; height:70px;"/> <p/><p/>
                        
                            <div  draggable="false" style="margin-left:30%;" >
                                <apex:commandButton value="Approve" action="{!approveSelected}" reRender="formId" status="showSpinner" oncomplete="detailPageURL();"/>
                                <apex:CommandButton value="Reject" action="{!rejectSelected}" reRender="formId" status="showSpinner" oncomplete="detailPageURL();"/>
                                <apex:commandButton value="Cancel" action="{!closePopup}" oncomplete="detailPageURL();" />
                            </div> 
                        </div>
                    </apex:outputPanel>
            </apex:outputPanel>

<!-- vertical-align:top;-->


        </apex:pageBlockSection>

      

        <apex:pageBlockSection rendered="{!showReAssignSection}" columns="1">

                <apex:outputPanel id="page" layout="block" style="margin:5px;padding:10px;padding-top:2px;">

              <!-- SEARCH  -->

                        <apex:actionRegion >  
                            <apex:outputPanel id="top" >
                                <apex:outputLabel value="Search Approver" style="font-weight:bold; margin-right:15px; vertical-align:top;" for="txtSearch"/>
                                <apex:inputText id="txtSearch" value="{!searchString}" />
                                <span style="padding-left:5px">
                                    <apex:commandButton id="btnGo" value="Go" action="{!Search}" rerender="searchResults"></apex:commandButton>
                                </span>
                            </apex:outputPanel>

                            <apex:outputPanel id="pnlSearchResults" style="margin:10px;height:200px;overflow-Y:auto;">  
                                <apex:pageBlock id="searchResults"> 
                                    <apex:pageBlockTable value="{!userList}" var="a" id="tblResults">
                                        <apex:column >
                                        <apex:facet name="header">
                                                <apex:outputPanel >Select</apex:outputPanel>
                                            </apex:facet>
                                            <apex:inputCheckbox value="{!a.selectCheckBox}" styleClass="primaryCheckboxes">
                                                <apex:actionSupport event="onclick"   action="{!inputCheckForSelectUser}"  onSubmit="allowOnePrimary(this);"/>
                                            </apex:inputCheckbox>
                                        </apex:column>

                                        <apex:column >
                                            <apex:facet name="header">
                                                <apex:outputPanel >Name</apex:outputPanel>
                                            </apex:facet>
                                            <apex:outputlink value="/{!a.userId}" target="_blank">{!a.userName}</apex:outputlink>
                                        </apex:column>

                                    </apex:pageBlockTable>
                                </apex:pageBlock>
                            </apex:outputPanel>
                        </apex:actionRegion>


              
          </apex:outputPanel>

          <!--apex:outputPanel id="page2" layout="block" style="margin:5px;padding:10px;padding-top:2px;">

                        <!--apex:outputlabel value="Reassign Comment" style="font-weight:bold; margin-right:15px; vertical-align:top;" />

                        <!--apex:inputTextarea id="comment" label="Reassign Comment" value="{!reassignComment}" style="width:250px; height:70px;"/>
        </apex:outputPanel-->
        <p/><p/>
        <apex:outputPanel id="page3" layout="block" style="margin:5px;padding:10px;padding-top:2px;">
            <apex:commandButton value="Save" action="{!massReassignRequests}"/>
            <apex:commandButton value="Cancel"  action="{!closePopup}"/><!--oncomplete="detailPageURL();"/-->
        </apex:outputPanel>


        </apex:pageBlockSection>
                
    </apex:pageblock>

        

</apex:form>


<apex:stylesheet value="{!URLFOR($Resource.jQueryDataTableZip, 'jQueryDataTablesZip/css/jquery.dataTables.css')}"/>
<style type="text/css">
.sorting {
    background: #f2f3f3 url('{! URLFOR($Resource.jQueryDataTableZip, 'jQueryDataTablesZip/images/sort_both.png') }') no-repeat center right !important;
    padding-right: 20px !important;
}
.sorting_asc {
    background: #f2f3f3 url('{! URLFOR($Resource.jQueryDataTableZip, 'jQueryDataTablesZip/images/sort_asc.png') }') no-repeat center right !important;
    padding-right: 20px !important;
}
.sorting_desc {
    background: #f2f3f3 url('{! URLFOR($Resource.jQueryDataTableZip, 'jQueryDataTablesZip/images/sort_desc.png') }') no-repeat center right !important;
    padding-right: 20px !important;
}
.sorting_asc_disabled {
    background: #f2f3f3 url('{! URLFOR($Resource.jQueryDataTableZip, 'jQueryDataTablesZip/images/sort_asc_disabled.png') }') no-repeat center right !important;
    padding-right: 20px !important;
}
.sorting_desc_disabled {
    background: #f2f3f3 url('{! URLFOR($Resource.jQueryDataTableZip, 'jQueryDataTablesZip/images/sort_desc_disabled.png') }') no-repeat center right !important;
    padding-right: 20px !important;
}
table.dataTable tr.odd { background-color: white; }
table.dataTable tr.even { background-color: white; }
table.dataTable tr.odd td.sorting_1 { background-color: white; }
table.dataTable tr.odd td.sorting_2 { background-color: white; }
table.dataTable tr.odd td.sorting_3 { background-color: white; }
table.dataTable tr.even td.sorting_1 { background-color: white; }
table.dataTable tr.even td.sorting_2 { background-color: white; }
table.dataTable tr.even td.sorting_3 { background-color: white; }
.dataTables_length, .dataTables_filter, .dataTables_info ,.dataTables_paginate{
    padding: 3px;
}
</style>
 

 
<apex:includeScript value="{!URLFOR($Resource.jQueryDataTableZip, 'jQueryDataTablesZip/js/jquery.js')}"/>  
<apex:includeScript value="{!URLFOR($Resource.jQueryDataTableZip, 'jQueryDataTablesZip/js/jquery.dataTables.js')}"/>  







<script type="text/javascript" language="javascript">
var jj$ = jQuery.noConflict();
jj$('table.dataTable').dataTable({
    sPaginationType: "full_numbers"
});
</script>
</apex:page>