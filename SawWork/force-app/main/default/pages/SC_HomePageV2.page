<!--
=====================================================================================================+
|  MODIFICATION HISTORY  |                                                                            

|  DATE           DEVELOPER   CR            DESCRIPTION                                                       

|  ===========    =========   =======       =========== 
04-Dec-2015    Sonia       CR 3242401 -  Home Screen Changes for First Update       
25-Jan-2016    Deepak      CR 3249741 -  Changes for CCare Life Cycle part 2 
10-May-2016    Vamsee      CR 3172971 -  Changes for Case Transition 
27-Jun-2016    Vamsee      CR 3396571 -  Changes for Support Geography
25-Jul-2016    Vamsee      CR 3310901 -  Removing the unexpected content on subject field.
09-Jan-2016    Pinkesh     CR 3528581 -  Update CCare queue label prefixes from CC to ATS (Akamai Technical Support)
02-Aug-2017    Aditya      ESESP-671  -  Akapedia- Home 2.0 KSC icon color change implementation
22-Nov-2017    Pinkesh     ESESP-746  -  KCS: Enhancements and Fixes for Akapedia Dashboard
|25-Jun-2018  Vandhana    ESESP-319  -  OLA for Escalations (Renamed Engagement Requests to Escalations)
|10-Sep-2018  Himanshu 	  ESESP-1529 -  Changed new Case button js to make it work in Lightning Service console
											+ Font size changes in style tag
											+ Open in primary tab for hyperlinks - Lightning Service console
|26-Feb-2020  Harshil     ESESP-2917  - Changed AMER Filter to NORTHAM for Exceda Migration
|24-APR-2020  Harshil     ESESP-3386  - Added LATAM Filter
|19-May-2022  Vamsee	  ESESP-7250 -  Service Incident Lightning Migration

+=====================================================================================================
-->
<apex:page controller="SC_HomePageCtrlV2" showHeader="false" sidebar="false">
    <apex:includeScript value="/support/console/43.0/integration.js"/>
    <script src="{!URLFOR($Resource.SCNewHomePage, '/js/bootstrap_jquerydatatables.js')}"></script>
    <apex:stylesheet value="{!URLFOR($Resource.SCNewHomePage,'css/bootstrap_jquerydatatable.css')}"/>
        <apex:stylesheet value="{!URLFOR($Resource.SCNewHomePage,'css/Inline_Styles.css')}"/>
            <style>
            td { font-size: 11px; }
    select {font-size:11px;}
    input {font-size:10px !Important;}
    </style>   
    
    <!-- Checking if the home page is opened in lightning or classic mode  
    Theme = Theme4d(For Lightning Non Console), Theme = Theme4u(For Lightning Console)-->
        
        <apex:variable var="lightningDesktop" value="{! $User.UIThemeDisplayed == 'Theme4d' || $User.UIThemeDisplayed == 'Theme4u'}"/>
            
            <apex:form style="height:100%">
                <apex:inputHidden value="{!lQCaseERjson}" id="hiddenFieldQueueList"/>
                    <apex:inputHidden value="{!lMCaseERjson}" id="hiddenFieldMyList"/>
                        <apex:inputHidden value="{!pickFlag}" id="hiddenPickFlag"/>
                            <apex:inputHidden value="{!kcsFlagRed}" id="KCSLevelRedId"/>
                                <apex:pagemessages id="errorMessages"/>
                                    
                                    <!--To get the case ID to clear case update-->
    <apex:inputHidden value="{!hiddenCaseId}" id="hiddenCaseIdForUpdating_home"/>
        
        <!--QueueTable Refresh on Picking Case/ER-->
            <apex:actionFunction name="pickCaseERaction" action="{!pickCaseER}" reRender="hiddenFieldQueueList,hiddenPickFlag,qPanelHeader" onComplete="pick_reConstructQTable(),refreshMyTablePeriodic()" status="actQStatusId">     
                <apex:param name="passRecId" value=""  assignTo="{!passRecId}"/>
                    </apex:actionFunction>
                
                <!-- action functions on change of select list option-->
                    <apex:actionFunction name="refreshMyTable" action="{!populateMyTable}" reRender="hiddenFieldMyList" oncomplete="reConstructMTable()" status="actMStatusId"/>
                        <apex:actionFunction name="refreshQTable" action="{!populateQTable}" reRender="hiddenFieldQueueList" oncomplete="reConstructQTable()" status="actQStatusId"/>
                            <apex:actionFunction name="refreshDashboard" action="{!updateDashboard}" reRender="Oone,Otwo,Othree,Ofour,Ofive" oncomplete="colorOvals()" status="actDStatusId"/>
                                <apex:actionFunction name="refreshSITables" action="{!populateSITable}" reRender="SIPanel,SIFoot" status="actSIStatusId"/>
                                    <apex:actionFunction name="saveSelectedGeos" action="{!updateUserPreference}" reRender="hiddenFieldQueueList" oncomplete="reConstructQTable()" status="actQStatusId"/>
                                        
                                        
                                        <!-- Action function for Case update -->
                                            <apex:actionFunction name="supressCaseUpdateApex_home" action="{!suppressCaseUpdate_homectrl}" oncomplete="refreshMyTable_fire()" />
                                            <apex:actionFunction name="refreshMyTable_fire" action="{!populateMyTable}" reRender="hiddenFieldMyList" oncomplete="reConstructMTable(),fireClearCaseFromHomePage()" status="actMStatusId"/>
                                            
                                            
                                            <!--periodic refresh for QueueTable and MyTable-->
                                            <apex:actionFunction name="refreshMyTablePeriodic" action="{!populateMyTable}" reRender="hiddenFieldMyList" oncomplete="reConstructMTable()"/>
                                            <apex:actionPoller interval="120" oncomplete="refreshMyTablePeriodic();"/>
                                            
                                            <apex:actionFunction name="refreshQTablePeriodic" action="{!populateQTable}" reRender="hiddenFieldQueueList" oncomplete="reConstructQTable()"/>
                                            <apex:actionPoller interval="120" oncomplete="refreshQTablePeriodic();"/>
                                            
                                            <!--periodic refresh of Dashboard and LOE-->
                                            <apex:actionFunction name="refreshDashboardPeriodic" action="{!updateDashboard}" reRender="Oone,Otwo,Othree,Ofour,Ofive" oncomplete="colorOvals()"/>
                                            <apex:actionPoller interval="300" oncomplete="refreshDashboardPeriodic()"/>
                                            <apex:actionFunction name="refreshLOEPeriodic" action="{!updateLOE}" reRender="LOEPanel"/>
                                            <apex:actionPoller interval="120" rendered="{!enableLOEPolling}" oncomplete="refreshLOEPeriodic()"/>
                                            
                                            <!--periodic refresh of SI Table-->
                                            <apex:actionFunction name="refreshSITablesPeriodic" action="{!populateSITable}" reRender="SIPanel,SIFoot" />
                                            <apex:actionPoller interval="300" rendered="{!enableSIPolling}" oncomplete="refreshSITablesPeriodic()"/>
                                            
                                            <!--To call Controller methods that return Dashboard,SI and Table Data-->
                                            <apex:actionFunction name="populateQTable" action="{!populateQTable}" reRender="hiddenFieldQueueList" onComplete="constructQTable()" />
                                            <apex:actionFunction name="populateMyTable" action="{!populateMyTable}" reRender="hiddenFieldMyList" onComplete="constructMTable()"/>
                                            
                                            <apex:actionFunction name="refreshKCSOval" action="{!isKCSLevelRed}" reRender="Ovfive,KCSLevelRedId" oncomplete="changeKCSOvalColor()"/>
                                            <apex:actionPoller interval="300" oncomplete="refreshKCSOval()"/>    
                                            
                                            <div class="container-fluid setmargin setheight">
                                            <div class="row"  id="section1">
                                            <!--Start of Dashboard-->
                                            <div class="col-md-5 col-sm-5 col-xs-5 rowclass" style="min-width:444px">
                                            <div class="panel panel-default setheight">
                                            <!--action status-->
                                            <apex:actionStatus id="actDStatusId" >
                                            <apex:facet name="start">
                                            <div class="statusOuter">   
                                            <div class="statusInner">        
                                            <img src="/img/loading.gif" />       
                                            </div>             
                                            </div>
                                            </apex:facet>            
                                            </apex:actionStatus>
                                            <!--heading-->
                                            <div class="panelheadtopsection">        
                                            <h5>Mini Dashboard&nbsp;&nbsp;</h5>
                                            <apex:selectList value="{!DashboardFilter}" size="1" style="margin-right: 10px;" onchange="refreshDashboard()">
                                            <apex:selectOption itemLabel="This Month" itemValue="This Month"/>
                                            <apex:selectOption itemLabel="Quarter" itemValue="Quarter"/>
                                            <apex:selectOption itemLabel="Year" itemValue="Year"/>
                                            </apex:selectList>
                                            </div>
                                            <!--body-->
                                            <div class="panelbodytopsection" style="cursor: pointer;">
                                            <!--Same Day-->
                                            <div class="rowclass col-md-5th tablediv" onClick="openConsoleCaseERAcc('{!reportId}?cancelURL=%2F{!reportId}','CCare TSE Case Metrics by Month');" title="Go to Report" >
                                            <div class="celldiv">
                                            <div class="oval" id="Ovone">
                                            <h3><apex:outputPanel id="Oone">{!If(totalCnt==0 ,"N/A",TEXT(sameDay)+"%")}</apex:outputPanel></h3>
                                                </div>
                                            <div class="ovalLabel" style="font-size:10px;">
                                                Same Day
                                                </div>
                                                </div> 
                                                </div>
                                                <!--Same Week-->
                                                    <div class="rowclass col-md-5th tablediv" onClick="openConsoleCaseERAcc('{!reportId}?cancelURL=%2F{!reportId}','CCare TSE Case Metrics by Month');" title="Go to Report" >
                                                        <div class="celldiv">
                                                            <div class="oval" id="Ovtwo">
                                                                <h3><apex:outputPanel id="Otwo">{!If(totalCnt==0 ,"N/A",TEXT(sameWeek)+"%")}</apex:outputPanel></h3>
                                                                    </div>
                                                                <div class="ovalLabel" style="font-size:10px;">                  
                                                                    Same Week              
                                                                    </div>  
                                                                    </div>                      
                                                                    </div>
                                                                    <!--IR-->
                                                                        <div class="rowclass col-md-5th tablediv" onClick="openConsoleCaseERAcc('{!reportId}?cancelURL=%2F{!reportId}','CCare TSE Case Metrics by Month');" title="Go to Report" >
                                                                            <div class="celldiv">
                                                                                <div class="oval" id="Ovthree">
                                                                                    <h3><apex:outputPanel id="Othree">{!If(totalIRCnt==0 ,"N/A",TEXT(IR)+"%")}</apex:outputPanel></h3>
                                                                                        </div>
                                                                                    <div class="ovalLabel" style="font-size:10px;">                  
                                                                                        IR Compliance
                                                                                        </div>
                                                                                        </div>  
                                                                                        </div>
                                                                                        <!--resSum-->
                                                                                            <div class="rowclass col-md-5th tablediv" onClick="openConsoleCaseERAcc('{!reportId}?cancelURL=%2F{!reportId}','CCare TSE Case Metrics by Month');" title="Go to Report" >
                                                                                                <div class="celldiv">
                                                                                                    <div class="oval" id="Ovfour">
                                                                                                        <h3><apex:outputPanel id="Ofour">{!If(totalResCnt==0 ,"N/A",TEXT(resSum)+"%")}</apex:outputPanel></h3>
                                                                                                            </div>
                                                                                                        <div class="ovalLabel" style="font-size:10px;">                  
                                                                                                            Res Sum
                                                                                                            </div>
                                                                                                            </div>  
                                                                                                            </div>
                                                                                                            
                                                                                                            <!-- KBAR -->
                                                                                                                <div class="rowclass col-md-5th tablediv" onClick="redirectAkapediaTab();" title="Go to Akapedia Dashboard" style="cursor: pointer;">
                                                                                                                    <div class="celldiv"> 
                                                                                                                        <div class="oval" id="Ovfive">
                                                                                                                            <!-- KCS Level replaces KBAR -->
                                                                                                                                <!--
                                                                                                                                <h3><apex:outputPanel id="Ofive">{!If(totalCnt==0 ,"N/A",TEXT(kb)+"%")}</apex:outputPanel></h3>
                                                                                                                                    -->
                                                                                                                                    <h3><apex:outputPanel id="Ofive">{!If(kcsLevel=='' ,"N/A",kcsLevel)}</apex:outputPanel></h3>
                                                                                                                                        <!-- <h3><apex:outputPanel id="Ofive">{!kcsLevel}</apex:outputPanel></h3> -->
                                                                                                                                            </div>
                                                                                                                                        <div class="ovalLabel" style="font-size:10px;">
                                                                                                                                            KCS Level
                                                                                                                                            </div>
                                                                                                                                            </div>  
                                                                                                                                            </div>
                                                                                                                                            </div>
                                                                                                                                            <!--End of Dashboard-->
                                                                                                                                                </div>
                                                                                                                                            </div>
                                                                                                                                            
                                                                                                                                            <!--LOE Hours-->
                                                                                                                                                <div class="col-md-1 col-sm-1 col-xs-1 rowclass" style="min-width:92px">
                                                                                                                                                    <div class="panel panel-default setheight" onClick="openConsoleCaseERAcc('{!loeReportId}?cancelURL=%2F{!loeReportId}','LOE');" title="Go to LOE Report" style="cursor: pointer;">
                                                                                                                                                        <div class="panelheadtopsection">
                                                                                                                                                            <h5>LOE Today</h5>       
                                                                                                                                                            </div>
                                                                                                                                                            <div class="panelbodytopsection LOE">
                                                                                                                                                                <div class="tablediv" style="height:100%">
                                                                                                                                                                    <div class="celldiv"> 
                                                                                                                                                                        <apex:OutputPanel id="LOEPanel">
                                                                                                                                                                            <apex:image url="{!URLFOR($Resource.SCNewHomePage,'SCNewHomeScreenicons/1Sleeping.png')}" rendered="{!(sumLOE[1]=='a')}" />
                                                                                                                                                                                <apex:image url="{!URLFOR($Resource.SCNewHomePage,'SCNewHomeScreenicons/2Quiet.png')}" rendered="{!(sumLOE[1]=='b')}" />
                                                                                                                                                                                    <apex:image url="{!URLFOR($Resource.SCNewHomePage,'SCNewHomeScreenicons/3Taunt.png')}" rendered="{!(sumLOE[1]=='c')}" />
                                                                                                                                                                                        <apex:image url="{!URLFOR($Resource.SCNewHomePage,'SCNewHomeScreenicons/5Happy.png')}" rendered="{!(sumLOE[1]=='d')}"/>
                                                                                                                                                                                            <apex:image url="{!URLFOR($Resource.SCNewHomePage,'SCNewHomeScreenicons/6Cool.png')}" rendered="{!(sumLOE[1]=='e')}" />
                                                                                                                                                                                                <div class="LOELabel">
                                                                                                                                                                                                    <b>{!sumLOE[0]}</b><br></br>
                                                                                                                                                                                                        <span style="color:grey;font-size:10px;">This Week:{!sumLOE[2]}</span>
                                                                                                                                                                                                        </div>
                                                                                                                                                                                                        </apex:OutputPanel> 
                                                                                                                                                                                                        </div>
                                                                                                                                                                                                        </div>         
                                                                                                                                                                                                        </div>
                                                                                                                                                                                                        </div>
                                                                                                                                                                                                        </div>
                                                                                                                                                                                                        
                                                                                                                                                                                                        <!--SI-->
                                                                                                                                                                                                            <div class="col-md-6 col-sm-6 col-xs-6 rowclass" style="min-width:350px">
                                                                                                                                                                                                                <div class="panel panel-default setheight">
                                                                                                                                                                                                                    <!--action status-->
                                                                                                                                                                                                                        <apex:actionStatus id="actSIStatusId" >
                                                                                                                                                                                                                            <apex:facet name="start">
                                                                                                                                                                                                                                <div class="statusOuter">   
                                                                                                                                                                                                                                    <div class="statusInner">        
                                                                                                                                                                                                                                        <img src="/img/loading.gif" />       
                                                                                                                                                                                                                                            </div>             
                                                                                                                                                                                                                                        </div>
                                                                                                                                                                                                                                        </apex:facet>            
                                                                                                                                                                                                                                        </apex:actionStatus>
                                                                                                                                                                                                                                        <div class="panelheadtopsection" >
                                                                                                                                                                                                                                            <h5>Service Incidents&nbsp;&nbsp;</h5>
                                                                                                                                                                                                                                            <apex:selectList value="{!SIFilter}" size="1" style="margin-right: 10px;" onchange="refreshSITables()">
                                                                                                                                                                                                                                                <apex:selectOption itemLabel="24 Hours" itemValue="24 Hours"/>
                                                                                                                                                                                                                                                    <apex:selectOption itemLabel="7 Days" itemValue="7 Days"/>
                                                                                                                                                                                                                                                        <apex:selectOption itemLabel="Unmitigated" itemValue="Unmitigated"/>
                                                                                                                                                                                                                                                            <apex:selectOption itemLabel="All Open" itemValue="All Open"/>
                                                                                                                                                                                                                                                                </apex:selectList>
                                                                                                                                                                                                                                                            </div>         
                                                                                                                                                                                                                                                            <div class="panelbodytopsection" style="overflow:auto">
                                                                                                                                                                                                                                                                <table id="SITablehead" class="table table-striped" >
                                                                                                                                                                                                                                                                    <thead style="font-size:10px;">
                                                                                                                                                                                                                                                                        <th style="width:15%;">Incident#</th>
                                                                                                                                                                                                                                                                        <th style="width:25%;">Title</th>
                                                                                                                                                                                                                                                                        <th style="width:20%;">Status</th>
                                                                                                                                                                                                                                                                        <th style="width:25%;">Incident Start</th>
                                                                                                                                                                                                                                                                        <th style="width:15%;">Impact (Severity)</th>
                                                                                                                                                                                                                                                                        </thead>       
                                                                                                                                                                                                                                                                        </table>        
                                                                                                                                                                                                                                                                        <apex:outputPanel id="SIPanel">
                                                                                                                                                                                                                                                                            <apex:outputPanel id="SIFoot" layout="block">
                                                                                                                                                                                                                                                                                <apex:outputPanel rendered="{!(lSI.size==0)}" layout="block" style="background-color:#f9f9f9;padding:3px;">
                                                                                                                                                                                                                                                                                    <p style="text-align:center;margin-bottom:0px;font-size:11px;">No Service Incidents Reported</p>
                                                                                                                                                                                                                                                                                    </apex:outputPanel>
                                                                                                                                                                                                                                                                                    </apex:outputPanel>              
                                                                                                                                                                                                                                                                                    <table id="SITable" class="table table-striped SITableClass" style="white-space: nowrap;table-layout: fixed;">
                                                                                                                                                                                                                                                                                        <tbody >
                                                                                                                                                                                                                                                                                        <apex:repeat value="{!lSI}" var="SIrec">
                                                                                                                                                                                                                                                                                            <tr>
                                                                                                                                                                                                                                                                                            <td style="width:15%;">
                                                                                                                                                                                                                                                                                                <a  class="truncate" onClick="openConsoleCaseERAcc('{!SIrec.Id}','{!SIrec.Name}')" >{!SIrec.Name}</a>
                                                                                                                                                                                                                                                                                                </td>
                                                                                                                                                                                                                                                                                                <td style="width:25%;">
                                                                                                                                                                                                                                                                                                    <p  class="truncate">{!SIrec.Title__c}</p>
                                                                                                                                                                                                                                                                                                    </td>
                                                                                                                                                                                                                                                                                                    <td style="width:20%;">
                                                                                                                                                                                                                                                                                                        <p  class="truncate">{!SIrec.Status__c}</p>
                                                                                                                                                                                                                                                                                                        </td> 
                                                                                                                                                                                                                                                                                                        <td style="width:25%;">
                                                                                                                                                                                                                                                                                                            <p  class="truncate">{!SIrec.Impact_Started__c}</p>
                                                                                                                                                                                                                                                                                                            </td>             
                                                                                                                                                                                                                                                                                                            <td style="width:15%;">
                                                                                                                                                                                                                                                                                                                <p  class="truncate">{!SIrec.Severity__c}</p>
                                                                                                                                                                                                                                                                                                                </td> 
                                                                                                                                                                                                                                                                                                                </tr>
                                                                                                                                                                                                                                                                                                                </apex:repeat>
                                                                                                                                                                                                                                                                                                                </tbody>
                                                                                                                                                                                                                                                                                                                </table> 
                                                                                                                                                                                                                                                                                                                </apex:outputPanel> 
                                                                                                                                                                                                                                                                                                                </div>
                                                                                                                                                                                                                                                                                                                </div>
                                                                                                                                                                                                                                                                                                                </div>                   
                                                                                                                                                                                                                                                                                                                </div>
                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                <!--My Work section-->
                                                                                                                                                                                                                                                                                                                    <div class="row" style="float:left;" id="section2">
                                                                                                                                                                                                                                                                                                                        <div class="panel panel-default setheight"> <!--action status-->
                                                                                                                                                                                                                                                                                                                            <apex:actionStatus id="actMStatusId" >
                                                                                                                                                                                                                                                                                                                                <apex:facet name="start">
                                                                                                                                                                                                                                                                                                                                    <div class="statusOuter">   
                                                                                                                                                                                                                                                                                                                                        <div class="statusInner">        
                                                                                                                                                                                                                                                                                                                                            <img src="/img/loading.gif" />       
                                                                                                                                                                                                                                                                                                                                                </div>             
                                                                                                                                                                                                                                                                                                                                            </div>
                                                                                                                                                                                                                                                                                                                                            </apex:facet>            
                                                                                                                                                                                                                                                                                                                                            </apex:actionStatus>
                                                                                                                                                                                                                                                                                                                                            <div class="panelheadtopsection">
                                                                                                                                                                                                                                                                                                                                                <h4>My Cases &amp; Escalations
                                                                                                                                                                                                                                                                                                                                                <apex:outputPanel id="myPanelHeader"></apex:outputPanel> 
                                                                                                                                                                                                                                                                                                                                                &nbsp;&nbsp;         
    </h4>
    <apex:selectList value="{!MyFilter}" size="1" style="margin-right: 10px;" onchange="refreshMyTable()">
        <apex:selectOption itemLabel="My Work" itemValue="My Work"/>
            <apex:selectOption itemLabel="Hide Pending" itemValue="Hide Pending"/>
                <apex:selectOption itemLabel="Followed" itemValue="Followed"/>
                    </apex:selectList>
                <span id="myExpand" class="fa fa-caret-square-o-left fa-2x"></span>                                                
                </div>
                
                <div id="myTopPanel" class="panelbodytopsection">
                    <apex:outputPanel id="myPanel" styleClass="setwidth setheight">   
                        <table id="myTable" class="table table-striped" style="white-space: nowrap;table-layout: fixed;width:100%">
                            <thead style="font-size:10px;">
                                <tr style="height:25px;">
                                    <!--start of changes for CR 3242401-->
                                        <th style="width:2%;" class="nosor nosort"></th>
                                        <th style="width:7%;">Id</th>
                                        <th style="width:17.5%;">Account Name</th>
                                        <th style="width:20.5%;">Subject</th>
                                        <th style="width:8%;">Support Level</th>
                                        <th style="width:7%;">Status</th>
                                        <th style="width:4.5%;">Severity</th>
                                        <th style="width:5%;">Age(Days)</th>
                                                                  <th style="width:3.5%;">Alert</th>
                                                                  <th style="width:5%;">SLA</th>
                                                                  <th style="width:5%;">Update</th>
                                                                  <th style="width:5.5%;">LOE(Hours)</th>
                                        <th style="width:4.5%;">Res Sum</th>
                                        <th style="width:5%;">Related</th>
                                        <!--end of changes for CR 3242401-->
                                            </tr> 
                                            </thead>
                                            </table>
                                            </apex:outputPanel>         
                                            </div> 
                                            
                                            </div>
                                            </div>
                                            
                                            
                                            
                                            <!-- Queue View-->
                                            <div class="row" style="margin-top:10px;float:left;" id="section3">
                                            <div class="panel panel-default setheight">
                                            <!--action status-->
                                            <apex:actionStatus id="actQStatusId" >
                                            <apex:facet name="start">
                                            <div class="statusOuter">   
                                            <div class="statusInner">        
                                            <img src="/img/loading.gif" />       
                                            </div>             
                                            </div>
                                            </apex:facet>            
                                            </apex:actionStatus>
                                            <div class="panelheadtopsection">
                                            <h4>Queue View 
                                            <apex:outputPanel id="qPanelHeader"></apex:outputPanel>
                                            &nbsp;&nbsp;        
                                            </h4>
                                            <apex:selectList value="{!QFilter}" size="1" style="margin-right: 10px;" onchange="refreshQTable()">
                                            <apex:selectOption itemLabel="My Queues" itemValue="My Queues"/>
                                            <apex:selectOption itemLabel="All AkaTec Queues - Cases" itemValue="All CCare Queues - Cases"/>
                                            <apex:selectOption itemLabel="All AkaTec Queues - Escalations" itemValue="All CCare Queues - Escalations"/>
                                            <apex:selectOption itemLabel="All AkaTec Queues - Cases & Escalations" itemValue="All CCare Queues - Cases & Escalations"/>
                                            <apex:selectOption itemLabel="Transition Queue" itemValue="ATS_Transition_Queue"/>
                                            </apex:selectList>
                                            <span id="qExpand" class="fa fa-caret-square-o-left fa-2x"></span>
                                            <apex:commandButton style="background:rgb(195, 222, 241);padding:3px" onClick="Open_new_Case_Classic_Lightning();" value="New Case" />
                                            <!--Changes by: Harshil-->
                                            <!--Changed AMER to NORTHAM as a part of Exceda SC Migration - ESESP-2917-->
                                            <apex:outputLabel style="margin-left: 25px;color: orange;font-size:10px;" value="NORTHAM"><apex:inputCheckbox onchange="refreshQTable()" style="margin-left: 5px;" value="{!NORTHAMCheckBox}" /> </apex:outputLabel>
											<!--ESESP-3386-->
                                            <apex:outputLabel style="margin-left: 25px;color: grey;font-size:10px;" value="LATAM"><apex:inputCheckbox onchange="refreshQTable()" style="margin-left: 5px;" value="{!LATAMCheckBox}" /> </apex:outputLabel>
                                            <apex:outputLabel style="margin-left: 25px;color: green;font-size:10px;" value="EMEA"><apex:inputCheckbox onchange="refreshQTable()" style="margin-left: 5px;" value="{!EMEACheckBox}" /> </apex:outputLabel>
                                            <apex:outputLabel style="margin-left: 25px;color: purple; font-size:10px;" value="APJ"><apex:inputCheckbox onchange="refreshQTable()" style="margin-left: 5px;" value="{!APJCheckBox}" /> </apex:outputLabel>
                                            <apex:commandButton style="background:rgb(195, 222, 241);padding:3px;margin-left: 25px;" onClick="saveSelectedGeos();return false;" value="Save selected Geos" />
                                            </div>
                                            <div id="qPanel" Class="panelbodytopsection" >                              
                                            <table id="QueueTable" class="table table-striped" style="white-space: nowrap;table-layout: fixed;width:100%">   
                                            <thead style="font-size:10px;">
                                            <tr style="height:25px">
                                            <th style="width:4%;" class="nosort"></th> 
                                            <th style="width:7%;">Id</th>
                                            <th style="width:14%;">Account Name</th>
                                            <th style="width:19%;">Subject</th>
                                            <th style="width:9%;">Support Level</th>
                                            <th style="width:6%">Geo</th>
                                            <th style="width:4.5%;">Severity</th>
                                            <th style="width:6.5%;">TSE-Primary</th>                        
                                            <th style="width:9%;">Created</th>
                                            <th style="width:4%;">SLA</th>
                                            <th style="width:6%;">Product</th>
                                            <th style="width:6%;">Related</th>
                                            <th style="width:10%;">Queue</th>
                                            </tr> 
                                            </thead>                     
                                            </table>
                                            </div>                
                                            </div>
                                            </div>
                                            </div>
                                            
                                            <script type="text/javascript">
                                            var qTable=null;
                                            var mTable=null;    
                                            var userId = '{!$User.Id}'; 
                                            
                                            function changeKCSOvalColor(){
                                                var isRedFlag = $("[id*='KCSLevelRedId']").val();
                                                if(isRedFlag == 'true'){
                                                $('#Ovfive')[0].style.backgroundColor = "Red";
                                            }
                                                                        else{
                                                                        $('#Ovfive')[0].style.backgroundColor = "rgb(30, 109, 237)";
    }                        
    }                               
    
    function redirectAkapediaTab(){
        var KCSLevel='{!KCSLevel}';
        var kbarReportId = '{!kbarReportId}';
        var kbarReportName = '{!kbarReportName}';
        var callback = function (result) { 
            var id;
            if (result.success) { 
                var tempItem = JSON.parse(result.items);
                for (var i = 0, len = tempItem.length; i < len; i++) {
                    if(tempItem[i].label == "Akapedia Dashboard") {
                        sforce.console.setSelectedNavigationTab(null,tempItem[i].navigationTabId);
                        sforce.console.focusNavigationTab(null,tempItem[i].navigationTabId);
                    }
                }
            }
            else {                 
                alert('Something went wrong. Please refresh the page.');
            }
        };
        
        var openPrimarySuccess = function openPrimarySuccess(result) {
            if (result.success == false) 
                sforce.console.openPrimaryTab(null, '/'+kbarReportId, true, kbarReportName, openPrimarySuccess, kbarReportName);
        };
        
        if(KCSLevel == "KCS Coach" || KCSLevel == "KCS KDE")
            sforce.console.getNavigationTabs(callback);
        else{
            sforce.console.focusPrimaryTabByName(kbarReportName, openPrimarySuccess);
        }
        
    }
    
    
    function openConsoleCaseERAcc(SF_Id,Numb) {
        Tab_Id = Numb;
        if({!lightningDesktop}==true) //checking if the theme is of lightning
        {
            sforce.one.navigateToSObject(SF_Id); // Opening new tab in lightning
        }
        else
        {
            sforce.console.generateConsoleUrl(['/'+SF_Id], openConsoleUrl);
        }
    }   
    
    var openConsoleUrl = function(result){
        sforce.console.openConsoleUrl(null, result.consoleUrl,true,[Tab_Id],null,openSuccess);        
    }
    
    var openSuccess = function(result) {
        //Report whether opening the new tab was successful
        if (result.success == false)
            alert('The corresponding tab is already opened');
    };
    
    $("#myExpand").click(function(){        
        $("#section3").toggleClass("myToggleClass");
        $("#section2").toggleClass("toggleExpander");
        $("#myExpand").toggleClass("fa-caret-square-o-down");
        $("#qExpand").toggle();
    });   
    
    $("#qExpand").click(function(){        
        $("#section2").toggleClass("myToggleClass");
        $("#section3").toggleClass("toggleExpander");
        $("#qExpand").toggleClass("fa-caret-square-o-down");
        $("#myExpand").toggle();
    });
    
    function openCaseER(Id) {
        window.prompt("Copy to clipboard!",  window.location.protocol + '//' + window.location.host + '/'+Id);
    }
    
    
    
    function minsToDay(tm) {
        var D= Math.floor(tm/1440) +'d';
        if(tm%1440 !=0)
            return (D+' '+minsToHrs(tm%1440));
        else
            return D;
    }
    
    function minsToHrs(tm) {
        var H = Math.floor(tm/60) +'h';
        var m = tm%60+'m';
        if(tm%60 == 0)
            return H;
        else if(tm/60== 0)
            return m;
            else
                return (H+' '+m);
    }
    
    
    //To open a new case in Service Console. Supports both lightning and classic .
    function Open_new_Case_Classic_Lightning(){
        
        if({!lightningDesktop}==false){
			sforce.console.openPrimaryTab(null, '/setup/ui/recordtypeselect.jsp?ent=Case&retURL=%2F500%2Fl&save_new_url=%2F500%2Fe%3FretURL%3D%252F500%252Fl', true);
        }
        else{
            //sforce.one.createRecord('Case');  
            sforce.one.navigateToURL('/one/one.app#/sObject/Case/new', false);
            //sforce.one.navigateToURL('https://akamai--l2cdev2.lightning.force.com/lightning/o/Case/new?count=1&rs=1', false);
            
        }
        return false;
    }
    
    function colorOvals() 
    {
        var num1 = $('#Ovone h3').text();
        if(num1=='N/A') 
        {
            // $("#Ovone,#Ovtwo,#Ovfive").css({"color":"white","background-color":"rgb(211, 207, 207)"});
            $("#Ovone,#Ovtwo").css({"color":"white","background-color":"rgb(211, 207, 207)"});
        }
        else 
        {
            num1=num1.substring(0,num1.indexOf("%"));
            
            if(num1<50) 
            {
                $("#Ovone").css({"background-color":"#CC3333","color":"white"});
            }
            else if(num1<=59) 
            {
                $("#Ovone").css({"background-color":"#FF9933","color":"white"});
            }
                else  
                {
                    $("#Ovone").css({"background-color":"#66CC66","color":"white"}); 
                    $("#Ovone p").css("color","white");
                }
            
            num1 = $('#Ovtwo h3').text();
            num1=num1.substring(0,num1.indexOf("%"));
            
            if(num1<80) 
            {
                $("#Ovtwo").css({"background-color":"#CC3333","color":"white"});
                $("#Ovtwo p").css("color","white");
            }
            else if(num1<=89) 
            {
                $("#Ovtwo").css({"background-color":"#FF9933","color":"white"});
            }
                else  
                {
                    $("#Ovtwo").css({"background-color":"#66CC66","color":"white"}); 
                } 
            
            // num1 = $('#Ovfive h3').text();
            // $("#Ovfive").css({"background-color":"blue","color":"red"}); 
            // //num1=num1.substring(0,num1.indexOf("%"));
            // if(num1<55) 
            // {
            //     $("#Ovfive").css({"background-color":"rgb(211, 207, 207)","color":"white"});
            // }           
            // else  
            //{
            //$("#Ovfive").css({"background-color":"blue","color":"white"}); 
            //}
            
        } 
        
        num1 = $('#Ovthree h3').text();
        if(num1=='N/A') 
        {
            $("#Ovthree").css({"color":"white","background-color":"rgb(211, 207, 207)"});
        }
        else 
        {    
            num1=num1.substring(0,num1.indexOf("%"));
            <!--IR-->
                if(num1<95) {
                    $("#Ovthree").css({"background-color":"#CC3333","color":"white"});
                }
            else if(num1<=99) {
                $("#Ovthree").css({"background-color":"#FF9933","color":"white"});
            }
                else  {
                    $("#Ovthree").css({"background-color":"#66CC66","color":"white"}); 
                }
        }
        
        num1 = $('#Ovfour h3').text();        
        if(num1=='N/A') 
        {
            $("#Ovfour").css({"color":"white","background-color":"rgb(211, 207, 207)"}); 
        }
        else 
        {
            num1=num1.substring(0,num1.indexOf("%"));
            <!--Res Sum-->
                if(num1<95) {
                    $("#Ovfour").css({"background-color":"#CC3333","color":"white"});
                }
            else if(num1<=99) {
                $("#Ovfour").css({"background-color":"#FF9933","color":"white"});
            }
                else  {
                    $("#Ovfour").css({"background-color":"#66CC66","color":"white"}); 
                }
        }
        
        // changes by Vandhana
        // added styling for KCS Level
        num1 = $('#Ovfive h3').text();
        if(num1 == 'N/A')
        {
            $("#Ovfive").css({"color":"white","background-color":"rgb(211, 207, 207)"});
        }
        else
        {
            $("#Ovfive").css({"background-color":"#1e6ded","color":"white"}); 
        }
        
    }
    
    function pickCaseER(id,type) {
        if(type=='case') {
            if(confirm('Are you sure you want to take this Case?')) {
                pickCaseERaction(id);
            }
        }
        else {
            if(confirm('Are you sure you want to take this Escalation?')) {
                pickCaseERaction(id);
            }
        }
    }
    
    
    function supressRecentUpdateFlag(caseId){
        document.getElementById('{!$Component.hiddenCaseIdForUpdating_home}').value = caseId;
        supressCaseUpdateApex_home();
        
    } 
    
    function fireClearCaseFromHomePage(){
        sforce.console.fireEvent('ClearCaseFromHomePage','ClearCaseFromHomePage');
    }
    
    
    function constructQTable() {
        var datas = JSON.parse(document.getElementById('{!$Component.hiddenFieldQueueList}').value);
        
        qTable=  $('#QueueTable').DataTable( {
            "data": datas,
            <!--image-->
            "columns": [
            { "data": "qList.0",
            "mRender" : function(data,type,full) {
            var hasCaseTransitionClass = '';
            if(full.hasActiveTransition){
            hasCaseTransitionClass = 'transitionImage';
        }
                                            if(full.qList[9]=='case')
        return '<div class="'+ hasCaseTransitionClass + ' caseImage imageIcons" onclick="openCaseER(\''+full.qList[1]+'\')"></div>'+
            '<div class="cursorHandImage imageIcons" onclick="pickCaseER(\'' + full.qList[1] + '\',\'case\')"/>';
        else
            return '<div class="'+hasCaseTransitionClass + ' ERImage imageIcons" onclick="openCaseER(\''+full.qList[1]+'\')"></div>'+
                '<div class="cursorHandImage imageIcons" onclick="pickCaseER(\'' + full.qList[1] + '\',\'er\')"/>';
    }
    },
        <!--Id-->
            <!-- CR 3172971 --- Changing the Onclick for case transition-->
                
            { "data": "qList.0",
                "type": "html",
                "mRender" : function(data,type,full) {
                    if(full.ctObjectId!= null){
                        return '<a  class="truncate" onClick="openConsoleCaseERAcc(\''+full.ctObjectId+'\',\''+data+'\')">'+
                            data+'</a>';
                    }
                    else{
                        return '<a  class="truncate" onClick="openConsoleCaseERAcc(\''+full.qList[1]+'\',\''+data+'\')">'+
                            data+'</a>';
                    }
                }
    },
        <!--Account Name-->    
            { "data": "qList.2",
                "type": "html",
                    "mRender" : function(data,type,full) {
                        return '<a  class="truncate" onClick="openConsoleCaseERAcc(\''+full.qList[3]+'\',\''+data+'\')">'+
                            data+'</a>';
                    }
            },
                <!--Subject-->    
                    { "data": "qList.4",
                        "type": "html",
                            "mRender" : function(data,type,full) {
                                var escapedData = escapeHTML(data);
                                if(full.ctObjectId!= null){
                                    return '<a  class="truncate" onClick="openConsoleCaseERAcc(\''+full.ctObjectId+'\',\''+full.qList[0]+'\')">'+
                                        escapedData+'</a>';
                                }
                                else{
                                    return '<a  class="truncate" onClick="openConsoleCaseERAcc(\''+full.qList[1]+'\',\''+full.qList[0]+'\')">'+
                                        escapedData+'</a>';
                                }
                            }
                    },
                        <!--Support Level-->    
                            { "data": "qList.5",
                                "type": "html",
                                    "mRender" : function(data,type,full) {
                                        return '<p  class="truncate" >'+data+'</p>';
                                    }
                            },
                                <!--Geo-->    
                                    { "data": "qList.16",
                                        "type": "html",
                                            "mRender" : function(data,type,full) {
                                                if(data =='APJ')
                                                    return '<p  style="color:purple" class="truncate" ><b>'+data+'</b></p>';
                                                if(data =='EMEA')
                                                    return '<p  style="color:green" class="truncate" ><b>'+data+'</b></p>';
                                                <!--Changes by Harshil:-->
                                                <!--Changed AMER to NORTHAM as a part of Exceda SC Migration - ESESP-2917-->
                                                
                                                if(data =='NORTHAM')
                                                    return '<p  style="color:orange" class="truncate" ><b>'+data+'</b></p>';
                                                <!--ESESP-3386-->
                                                if(data =='LATAM')
                                                    return '<p  style="color:grey" class="truncate" ><b>'+data+'</b></p>';
                                                return '<p></p>'
                                            }
                                    },
                                        <!--Severity-->    
                                            { "data": "qList.6",
                                                "type": "html",
                                                    "mRender" : function(data,type,full) {
                                                        return '<p  class="truncate" >'+data+'</p>';
                                                    }
                                            },
                                                <!--TSE-Primary-->    
                                                    { "data": "qList.10", 
                                                        "type": "html",
                                                            "mRender" : function(data,type,full) {
                                                                if(full.qList[9] == 'case') {
                                                                    if(data=='z') {
                                                                        if(type == 'sort') 
                                                                            return data;
                                                                        return '';
                                                                    }
                                                                    else if(data=='multiple') {
                                                                        if(type=='sort')
                                                                            return data;
                                                                        return '<a  class="truncate" onClick="openConsoleCaseERAcc(\''+full.qList[3]+'#'+full.qList[3].substring(0,15) +'_RelatedAccountSalesTeam_target'+'\',\''+full.qList[2]+'\')" >'+
                                                                            'Multiple</a>';
                                                                    }
                                                                        else {
                                                                            if(type=='sort')
                                                                                return data;
                                                                            return '<p  class="truncate" >'+data+'</p>';
                                                                        }
                                                                }
                                                                else {
                                                                    if(type=='sort')
                                                                        return 'Z';
                                                                    return '';
                                                                }  
                                                            }
                                                    },
                                                        <!--Created-->
                                                            { "data": "qList.11",
                                                                "mRender" : function(data,type,full) {
                                                                    if(type=='sort')
                                                                        return data;
                                                                    return '<p  class="truncate">'+full.qList[15]+'</p>';
                                                                }
                                                             
                                                            },
                                                                <!--SLA-->   
                                                                    <!-- CR 3172971 --- Including Case transition SLA for sorting-->
                                                                    { "data": "qList.7",
                                                                        "type": "num",
                                                                        "mRender" : function(data,type,full) {
                                                                            var x = full.caseTransitionDetails; 
                                                                            if(type=='sort') {
                                                                                if(x != null && x != undefined){
                                                                                    if(x.Time_Remaining__c!= undefined) {
                                                                                        return parseInt(x.Time_Remaining__c);
                                                                                    }
                                                                                    return 99999999999999;
                                                                                }
                                                                                else if(data=='z')
                                                                                    return 99999999999999;
                                                                                    else if(data=='y')
                                                                                        return 999999999;
                                                                                return data;
                                                                            }
                                                                            else {
                                                                                if(x != null && x != undefined){
                                                                                    if(x.completed__C){
                                                                                        if(x.violation_check__c) {
                                                                                            return '<p style="color:#CC3333">Miss&nbsp;<span class="glyphicon glyphicon-exclamation-sign"/></p>';
                                                                                        }
                                                                                        else {
                                                                                            return '<p><span class="glyphicon glyphicon-ok" style="color:green"/></p>';
                                                                                        }
                                                                                    }
                                                                                    else {
                                                                                        if(x.Time_Remaining__c != undefined){
                                                                                            if(x.Time_Remaining__c  > 30){
                                                                                                return '<p class="truncate" style="color:green">' + parseInt(x.Time_Remaining__c)   + 'm</p>';
                                                                                            }
                                                                                            else if(x.Time_Remaining__c  > 0){
                                                                                                return '<p class="truncate" style="color:orange">' + parseInt(x.Time_Remaining__c) + 'm</p>';
                                                                                            }
                                                                                                else {
                                                                                                    return '<p style="color:#CC3333">Miss&nbsp;<span class="glyphicon glyphicon-exclamation-sign"/></p>';
                                                                                                }
                                                                                        }
                                                                                        else{
                                                                                            return '';
                                                                                        }
                                                                                    }    
                                                                                }   
                                                                                else if(data=='z')
                                                                                    return '';
                                                                                    else if(data=='y')
                                                                                        return '<p><span class="glyphicon glyphicon-ok" style="color:green"/></p>';
                                                                                        else if(data<0)
                                                                                            return '<p style="color:#CC3333">Miss&nbsp;<span class="glyphicon glyphicon-exclamation-sign"/></p>';
                                                                                            else if(data<=15) {
                                                                                                return '<p class="truncate" style="color:#CC3333">'+data+'m</p>';
                                                                                            }
                                                                                                else if(data<45) {
                                                                                                    return '<p class="truncate" style="color:orange">'+data+'m</p>';
                                                                                                }
                                                                                                    else if(data<60) {
                                                                                                        return '<p class="truncate" style="color:green">'+data+'m</p>';
                                                                                                    }
                                                                                //day
                                                                                                        else if(data>=1440) {
                                                                                                            return '<p class="truncate" style="color:green">'+minsToDay(data)+'</p>';
                                                                                                        }
                                                                                                            else {
                                                                                                                return '<p class="truncate" style="color:green">'+minsToHrs(data)+'</p>';
                                                                                                            } 
                                                                            }
                                                                        }
    },
        <!-- CR 3172971 --- Changes Ends here-->
            <!--Product-->    
                { "data": "qList.12",
                    "type": "html",
                        "mRender" : function(data,type,full) {
                            return '<p  class="truncate" >'+data+'</p>';
                        }            
                },
                    <!--Related-->    
                        <!-- CR 3172971 --- Displaying the Target Shift for Case Transition-->
                        { "data": "qList.8",
                            "type": "html",
                            "mRender": function(data,type,full) {
                                if(full.qList[16] == undefined){
                                    return '<p>'+data+'</p>';
                                }
                                else{
                                    return '<a  class="truncate" onClick="openConsoleCaseERAcc(\''+full.qList[16]+'\',\''+data+'\')">'+
                                        data+'</a>';
                                }
                            }
    },
        <!--Queue/Owner-->    
            { "data": "qList.13",
                "type": "html",
                    "mRender": function(data,type,full) {
                        return '<a  class="truncate" onClick="openConsoleCaseERAcc(\'p/own/Queue/d?id='+full.qList[14]+'\',\''+data+'\')">'+
                            data+'</a>  ';
                    }
            },
                ],
                    'order': [7,'asc'],
                        'paging' : false,
                            'stateSave': true,
                                'searching' : false,
                                    'aoColumnDefs': [{ 'bSortable': false, 'aTargets': ['nosort'] }],
                                        'bInfo':false,
                                            'bRedraw':false,
                                                'autoWidth':false            
    } );
    document.getElementById('{!$Component.qPanelHeader}').innerHTML = '('+qTable.data().length+')';
    }
    
    function constructMTable() {
        var mdatas = JSON.parse(document.getElementById('{!$Component.hiddenFieldMyList}').value);          
        
        mTable=  $('#myTable').DataTable( {
            "data": mdatas,
            "columns": [
                {
                    "data": "qList.0",
                    "type": "html",
                    "mRender": function(data,type,full) {
                        var hasCaseTransitionClass = '';
                        if(full.hasActiveTransition){
                            hasCaseTransitionClass = 'transitionImage';
                        }
                        if(full.qList[9]=='case')
                            return '<div class="'+ hasCaseTransitionClass + ' caseImage imageIcons" onclick="openCaseER(\''+full.qList[1]+'\')"/>';
                        else
                            return '<div class="'+ hasCaseTransitionClass + ' ERImage imageIcons" onclick="openCaseER(\''+full.qList[1]+'\')"/>';
                    } 
                },
                <!--Id-->
                { "data": "qList.0",
                "type": "html",
                "mRender" : function(data,type,full) {
                return '<a  class="truncate" onClick="openConsoleCaseERAcc(\''+full.qList[1]+'\',\''+data+'\'); supressRecentUpdateFlag(\''+full.qList[1]+'\')">'+
            data+'</a>';
        }
                                         },
                                         <!--Account Name-->    
                                         { "data": "qList.2",
                                         "type": "html",
                                         "mRender" : function(data,type,full) {
            return '<a  class="truncate" onClick="openConsoleCaseERAcc(\''+full.qList[3]+'\',\''+data+'\')">'+
                data+'</a>';
        }
    },
        <!--Subject-->    
            { "data": "qList.4",
                "type": "html",
                    "mRender" : function(data,type,full) {
                        var escapedData = escapeHTML(data);
                        return '<a  class="truncate" onClick="openConsoleCaseERAcc(\''+full.qList[1]+'\',\''+full.qList[0]+'\'); supressRecentUpdateFlag(\''+full.qList[1]+'\')">'+escapedData+'</a>';
                    }
            },
                <!--Support Level-->    
                    { "data": "qList.5",
                        "type": "html",
                            "mRender" : function(data,type,full) {
                                return '<p  class="truncate" >'+data+'</p>';
                            }
                    },           
                        <!--Status--> 
                            { "data": "qList.10",
                                "type": "html",
                                    "mRender" : function(data,type,full) {
                                        return '<p  class="truncate" >'+data+'</p>';
                                    }             
                            },
                                <!--Severity--> 
                                    { "data": "qList.6" ,
                                        "type": "html",
                                            "mRender" : function(data,type,full) {
                                                return '<p  class="truncate" >'+data+'</p>';
                                            }
                                    },
                                        <!--Age--> 
                                            { "data": "qList.11",
                                                "type": "num",
                                                    "mRender" : function(data,type,full) {
                                                        if(type=='sort')
                                                            return data;
                                                        return '<p  class="truncate" >'+data+'</p>';
                                                    }             
                                            },
                                                <!--Alert--> 
                                                    { "data": "qList.12",
                                                        "type": "html",
                                                            "mRender" : function(data,type,full) {
                                                                if(type=='sort')
                                                                    return data;
                                                                if(data=='1')
                                                                    return '<span class="fa fa-circle fa-fw" style="color:#CC3333"></span>';
                                                                else
                                                                    return '';
                                                            }               
                                                    },
                                                        <!--SLA--> 
                                                            { "data": "qList.7",
                                                                "type": "num",
                                                                    "mRender" : function(data,type,full) {
                                                                        var x = full.caseTransitionDetails;
                                                                        if(x != null && x != undefined){
                                                                            if(x.completed__C){
                                                                                if(x.violation_check__c) {
                                                                                    return '<p style="color:#CC3333">Miss&nbsp;<span class="glyphicon glyphicon-exclamation-sign"/></p>';
                                                                                }
                                                                                else {
                                                                                    return '<p><span class="glyphicon glyphicon-ok" style="color:green"/></p>';
                                                                                }
                                                                            }
                                                                            else {
                                                                                if(x.Time_Remaining__c != undefined){
                                                                                    if(x.Time_Remaining__c  > 0){
                                                                                        return '<p class="truncate" style="color:green">' + x.Time_Remaining__c   + '</p>';
                                                                                    }
                                                                                    else {
                                                                                        return '<p style="color:#CC3333">Miss&nbsp;<span class="glyphicon glyphicon-exclamation-sign"/></p>';
                                                                                    }
                                                                                }    
                                                                            }    
                                                                        }    
                                                                        if(type=='sort') {
                                                                            if(data=='z')
                                                                                return 99999999999999;
                                                                            else if(data=='y')
                                                                                return 999999999;
                                                                            return data;
                                                                        }
                                                                        else {
                                                                            if(data=='z')
                                                                                return '';
                                                                            else if(data=='y')
                                                                                return '<p><span class="glyphicon glyphicon-ok" style="color:green"/></p>';
                                                                                else if(data<0)
                                                                                    return '<p style="color:#CC3333">Miss&nbsp;<span class="glyphicon glyphicon-exclamation-sign"/></p>';
                                                                                    else if(data<=15) {
                                                                                        return '<p class="truncate" style="color:#CC3333">'+data+'m</p>';
                                                                                    }
                                                                                        else if(data<45) {
                                                                                            return '<p class="truncate" style="color:orange">'+data+'m</p>';
                                                                                        }
                                                                                            else if(data<60) {
                                                                                                return '<p class="truncate" style="color:green">'+data+'m</p>';
                                                                                            }
                                                                            //day
                                                                                                else if(data>=1440) {
                                                                                                    return '<p class="truncate" style="color:green">'+minsToDay(data)+'</p>';
                                                                                                }
                                                                                                    else {
                                                                                                        return '<p class="truncate" style="color:green">'+minsToHrs(data)+'</p>';
                                                                                                    }    
                                                                        }
                                                                    }
                                                            },
                                                                <!--start of changes for CR 3242401-->
                                                                    <!--Update--> 
                                                                { "data": "qList.15",
                                                                    "type": "num",
                                                                    "mRender" : function(data,type,full) {
                                                                        if(type=='sort') {
                                                                            if(data=='z')
                                                                                return 99999999999999;
                                                                            else if(data=='y')
                                                                                return 999999999;
                                                                            return data;
                                                                        }
                                                                        else {
                                                                            if(data=='z')
                                                                                return '';
                                                                            else if(data=='y')
                                                                                return '<p><span class="glyphicon glyphicon-ok" style="color:green"/></p>';
                                                                                else {
                                                                                    var sign = '';
                                                                                    var color = 'orange';
                                                                                    var x = Math.abs(data);
                                                                                    if(data<0) {
                                                                                        sign = '-';
                                                                                        color = '#CC3333';
                                                                                    }
                                                                                    if(data>30) {
                                                                                        if(data < 60)
                                                                                            return '<p class="truncate" style="color:green">'+sign+x+'m</p>';
                                                                                        else if(data < 1440)
                                                                                            return '<p class="truncate" style="color:green">'+sign+minsToHrs(x)+'</p>';
                                                                                            else
                                                                                                return '<p class="truncate" style="color:green">'+sign+minsToDay(x)+'</p>';
                                                                                    } 
                                                                                    else if(data <= 30 && data >= 0) {
                                                                                        return '<p class="truncate" style="color:orange">'+sign+x+'m</p>';
                                                                                    }
                                                                                        else if(data < 0){
                                                                                            
                                                                                            if(data > -60)
                                                                                                return '<p class="truncate" style="color:red">'+sign+x+'m</p>';
                                                                                            else if(data > -1440)
                                                                                                return '<p class="truncate" style="color:red">'+sign+minsToHrs(x)+'</p>';
                                                                                                else
                                                                                                    return '<p class="truncate" style="color:red">'+sign+minsToDay(x)+'</p>';
                                                                                        } 
                                                                                }  
                                                                        }
                                                                    }
    },
        <!--end of changes for CR 3242401-->
            <!--LOE--> 
        { "data": "qList.13",
            "type": "num",
            "mRender" : function(data,type,full) {
                if(type=='sort')
                    return data;
                return '<p  class="truncate" >'+data+'</p>';
            }             
    },
        <!--Resolution Sent-->
            { "data": "qList.14",
                "type": "html",
                    "mRender": function(data,type,full) {
                        if(type=='sort') {
                            return data;
                        }
                        if(data=='t')
                            return '<p><span class="glyphicon glyphicon-ok" style="color:green"/></p>';
                        else
                            return '';
                    }
             
            },    
                <!--Related--> 
                    { "data": "qList.8",
                        "type": "html",
                            "mRender": function(data,type,full) {
                                
                                return '<a  class="truncate" onClick="openConsoleCaseERAcc(\''+full.qList[16]+'\',\''+data+'\')">'+
                                    data+'</a>';
                                
                            } 
                    }
    ],
        'order': [7,'asc'],
            'paging' : false,
                'stateSave': true,
                    'searching' : false,
                        'aoColumnDefs': [{ 'bSortable': false, 'aTargets': ['nosort'] }],
                            'bInfo':false,
                                'bRedraw':false,
                                    'autoWidth':false                      
    } );
    document.getElementById('{!$Component.myPanelHeader}').innerHTML = '('+mTable.data().length+')';
    }
    
    function pick_reConstructQTable(){
        if(document.getElementById('{!$Component.hiddenPickFlag}').value == 'false' )
            alert('The Case/ER is taken up by another user');
        reConstructQTable();
    }
    
    function escapeHTML(input){
        var output = input.split("<").join("&lt;");
        return output.split(">").join("&gt;");
    }
    function reConstructMTable(){
        mTable.destroy();
        constructMTable();
    }
    
    function reConstructQTable(){
        qTable.destroy();
        constructQTable();    
    }
    
    var ServiceIncidentGlobalNotification = function(result) {       
        refreshSITablesPeriodic();
    }
    
    var LOEGlobalNotification = function(result) {       
        console.log('LOE');
        refreshLOEPeriodic(); 
    } 
    
    
    $(document).ready(function(){
        colorOvals();
        populateQTable();
        populateMyTable();
        refreshSITablesPeriodic();
        refreshKCSOval();
        sforce.console.addEventListener('ServiceIncidentGlobalNotification', ServiceIncidentGlobalNotification);
        sforce.console.addEventListener('ClearCaseFromCaseNotification', refreshMyTable);
        sforce.console.addEventListener('TaskNotification_'+userId, LOEGlobalNotification);
        sforce.console.addEventListener('GlobalRefreshStreamingNotify', function(){ServiceIncidentGlobalNotification;
                                                                                   LOEGlobalNotification;} );
    });
    
    </script>
</apex:form>
</apex:page>