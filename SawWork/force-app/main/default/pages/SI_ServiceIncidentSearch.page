<!-- Modified by ssawhney for CR 2030311 - Add Incident End Time column to list on main Service Incidents tab-->
<!-- Modified by vkrishna for CR 2070208 - SI: New search option (created by) needed in RF -->
<!-- Modified by ssawhney - CR 2026918 - RF: SI Remove or redirect around leading zeros in url -->
<apex:page controller="SI_ServiceIncidentSearch" sidebar="{!!showDetails}" showHeader="{!showDetails}">
<script type="text/javascript" src="/resource/Jquery/js/jquery-1.7.1.min.js"></script>
<script type="text/javascript" src="/resource/Jquery/js/jquery-ui-1.8.17.custom.min.js"/>
  <link rel="stylesheet" type="text/css" href="/resource/Jquery/css/flick/jquery-ui-1.8.17.custom.css"></link>

  <script type="text/javascript">
  window.load=load();
  function load(){
  var loc ='{!getLocation}';
  // Start of changes for CR 2026918 by ssawhney
  var incNum = '{!inciName}';
  if(loc == '' && incNum != null && incNum != '')
  {
      alert('There is no such Incident Number : {!inciName}');
  }
  //End of changes for CR 2026918 by ssawhney
  else if(loc!='')
  window.location=loc;
 
  }
  
  
  toggleSwitch = false;
  function changebgColormouseover(obj)
  {
      obj.style.backgroundColor="#E9E8E8";
  }
   function changebgColormouseout(obj)
  {
      obj.style.backgroundColor="";
  }
  function toggleSearch()
  {
     //var x = document.getElementsByClassName('HideSearchBarClose');
     //var y = document.getElementsByClassName('HideSearchBarOpen');
     jQuickFilter$ = jQuery.noConflict();
     var x =jQuickFilter$(".HideSearchBarClose");
     var y=jQuickFilter$(".HideSearchBarOpen");
     if(!toggleSwitch)
     {
        for (i=0;i<x.length;i++)
        {
          x[i].style.display="none"; 
        }
        for (i=0;i<y.length;i++)
        {
          y[i].style.display=""; 
        }
          
        
        
     }
     else
     {
       for (i=0;i<y.length;i++)
        {
          y[i].style.display="none"; 
        }
        for (i=0;i<x.length;i++)
        {
          x[i].style.display=""; 
        }
     }
      toggleSwitch=!toggleSwitch;
  }
  
  </script>
<table width="100%" border="0">
  <tr> 
    
    <td width="200" valign="top" class="HideSearchBarOpen" style="display:none;">
     
     <c:EB_Quick_Filter pageController="{!this}" SearchFieldset="{!searchFields}" Status="FilterLoading"  DefaultSortOrderDirection="Desc" DefaultOrderBy="Name" inputQuery="{!InputQuery}" Title="Search" reRenderid="label" Limit="5000" id="component"  />
    <apex:actionStatus id="FilterLoading">
    <apex:facet name="start">
    <c:enhancedActionStatus BackColor="#ffffff" borderColor="#ffffff" borderSize="2" height="50px" width="150px" ImageUrl="/changemgmt/img/spinner24.gif" Message="Filter is Being Applied" messageStyle="color:darkred;font-size:11pt;font-weight:bold;"/>
    </apex:facet>   
    </apex:actionStatus>
    
    </td>
    <td id="HideSearchBar" onmouseover="changebgColormouseover(this);" onmouseout="changebgColormouseout(this);" onclick="toggleSearch();" valign="top" >   
    <img class="HideSearchBarClose" src="/img/sidebar/LNav_twisty_closed.gif"  />
    <img class="HideSearchBarOpen" src="/img/sidebar/LNav_twisty_opened.gif" style="display:none;"/>
    
    </td>
    <td valign="top" style="width:100%">
 <apex:form >
  
    <apex:pageBlock id="label" title="{!ListTitle}">
        
        <table width="100%" cellspacing="5px" >
        <tr>
            <td align="left">
                 <apex:commandButton action="{!redirectToNewPage}" value="Create New Incident" style="font-size:120%;background:#F8BB60"/>
            </td>
            <td style="color:red">
            All date/time fields are displayed in time zone: {!UserTImezone}.  Date format is per your Locale in your  <apex:outputLink value="/{!UserSalesforceId}/e" target="_Blank" style="color:red;"> Personal Settings</apex:outputLink>
            </td>
            <td align="right">
                  <apex:commandLink status="FilterLoading" action="{!first}" > First </apex:commandlink> &nbsp;&nbsp;&nbsp;&nbsp;
            
                  <apex:commandLink action="{!previous}" rendered="{!hasPrevious}" > Previous </apex:commandlink> &nbsp;&nbsp;&nbsp;&nbsp;
           
                  <apex:commandLink action="{!next}" rendered="{!hasNext}" > Next </apex:commandlink> &nbsp;&nbsp;&nbsp;&nbsp;
           
                  <apex:commandLink action="{!last}" > Last </apex:commandlink> 
            </td>
        </tr>
        </table>
       <center>  </center>
        
        
        <apex:pageBlockTable value="{!ServiceIncidents}" var="a">
            <apex:column >
                <apex:facet name="header">
                    <apex:commandLink status="FilterLoading" value="Incident #" action="{!toggleSortOrder}"  rerender="label">
                        <apex:param name="sortField" value="name" assignTo="{!sortField}"/>
                    </apex:commandLink>
                </apex:facet>
                <apex:outputField value="{!a.SI_Incident_Link__c}"/>
            </apex:column>
           
            <apex:column >
                <apex:facet name="header">
                    <apex:commandLink status="FilterLoading" value="Category" action="{!toggleSortOrder}" rerender="label">
                        <apex:param name="sortField" value="BMCServiceDesk__FKCategory__r.Name" assignTo="{!sortField}"/>
                    </apex:commandLink>
                </apex:facet>
                <apex:outputField value="{!a.BMCServiceDesk__FKCategory__r.Name}"/>
            </apex:column>
             <apex:column >
                <apex:facet name="header">
                    <apex:commandLink status="FilterLoading" value="Status (Phase)" action="{!toggleSortOrder}" rerender="label">
                        <apex:param name="sortField" value="BMCServiceDesk__FKStatus__r.Name" assignTo="{!sortField}"/>
                    </apex:commandLink>
                </apex:facet>
                <apex:outputField value="{!a.BMCServiceDesk__FKStatus__r.Name}"/>
            </apex:column> 
            <apex:column >
                <apex:facet name="header">
                    <apex:commandLink status="FilterLoading" value="Impact (Customer Severity)" action="{!toggleSortOrder}" rerender="label">
                        <apex:param name="sortField" value="BMCServiceDesk__FKImpact__r.Name" assignTo="{!sortField}"/>
                    </apex:commandLink>
                </apex:facet>
                <apex:outputField value="{!a.BMCServiceDesk__FKImpact__r.Name}"/>
            </apex:column> 
            <apex:column >
                <apex:facet name="header">
                    <apex:commandLink status="FilterLoading" value="Urgency (Aggregate Severity)" action="{!toggleSortOrder}" rerender="label">
                        <apex:param name="sortField" value="BMCServiceDesk__FKUrgency__r.Name" assignTo="{!sortField}"/>
                    </apex:commandLink>
                </apex:facet>
                <apex:outputField value="{!a.BMCServiceDesk__FKUrgency__r.Name}"/>
            </apex:column> 
            <apex:column >
                <apex:facet name="header">
                     <apex:commandLink status="FilterLoading" value="Title" action="{!toggleSortOrder}" rerender="label">
                        <apex:param name="sortField" value="BMCServiceDesk__Service_Request_Title__c" assignTo="{!sortField}"/>
                    </apex:commandLink>                                   
                </apex:facet>
                <apex:outputField value="{!a.BMCServiceDesk__Service_Request_Title__c }"/>
            </apex:column>
            <apex:column >
                <apex:facet name="header">
                     <apex:commandLink status="FilterLoading" value="Owner (Technical Incident Manager)" action="{!toggleSortOrder}" rerender="label">
                        <apex:param name="sortField" value="Owner.Name" assignTo="{!sortField}"/>
                    </apex:commandLink>                                   
                </apex:facet>
                <apex:outputField value="{!a.Owner.Name}"/>
            </apex:column>
            
            <!-- Start of changes by vkrishna for CR 2070208 - SI: New search option (created by) needed in RF -->
            <apex:column >
                <apex:facet name="header">
                    <apex:commandLink status="FilterLoading" value="Created By" action="{!toggleSortOrder}" rerender="label">
                        <apex:param name="sortField" value="CreatedBy.Name" assignTo="{!sortField}"/>
                    </apex:commandLink>
                </apex:facet>
                <apex:outputField value="{!a.CreatedBy.Name}"/>
            </apex:column>
            <!-- End of changes by vkrishna for CR 2070208 -->
            
            <!-- changes by avidapan to add lookup field for GSS Incident Manager-->
            <apex:column >
                <apex:facet name="header">
                     <apex:commandLink status="FilterLoading" value="GSS Incident Manager / Business Information Lead" action="{!toggleSortOrder}" rerender="label">
                        <apex:param name="sortField" value="SI_GSS_Inc_Manager_BIL__r.Name" assignTo="{!sortField}"/>
                    </apex:commandLink>                                   
                </apex:facet>
                <apex:outputField value="{!a.SI_GSS_Inc_Manager_BIL__r.Name}"/>
            </apex:column>
           
             <apex:column >
                <apex:facet name="header">
                    <apex:commandLink status="FilterLoading" value="Created Date" action="{!toggleSortOrder}" rerender="label">
                        <apex:param name="sortField" value="CreatedDate" assignTo="{!sortField}"/>
                    </apex:commandLink>
                </apex:facet>
                <apex:outputField value="{!a.CreatedDate}"/>
            </apex:column>
            <apex:column >
                <apex:facet name="header">
                    <apex:commandLink status="FilterLoading" value="Impact Started" action="{!toggleSortOrder}" rerender="label">
                        <apex:param name="sortField" value="SI_OutageStart__c" assignTo="{!sortField}"/>
                    </apex:commandLink>
                </apex:facet>
                <apex:outputField value="{!a.SI_OutageStart__c}"/>
            </apex:column>  
            <!-- Start of changes by ssawhney for CR 2030311 - Add Incident End Time column to list on main Service Incidents tab-->
            <apex:column >
                <apex:facet name="header">
                    <apex:commandLink status="FilterLoading" value="Incident Closed" action="{!toggleSortOrder}" rerender="label">
                        <apex:param name="sortField" value="SI_OutageEnd__c" assignTo="{!sortField}"/>
                    </apex:commandLink>
                </apex:facet>
                <apex:outputField value="{!a.SI_OutageEnd__c}"/>
            </apex:column>
            <!-- End of changes by ssawhney for CR 2030311-->           
        </apex:pageBlockTable>

        
     <apex:panelGrid columns="6" width="300px" cellspacing="5px" rendered="false" >
        <apex:commandLink action="{!first}" > First </apex:commandlink>
        <apex:commandLink action="{!previous}" rendered="{!hasPrevious}" > Previous</apex:commandlink>
        <apex:commandLink action="{!next}" rendered="{!hasNext}" >Next </apex:commandlink>
        <apex:commandLink action="{!last}" > Last</apex:commandlink>
        
        </apex:panelGrid>
     <apex:outputLabel value="{!myComponentController.OutputQuery}" rendered="{!DebugRender}"></apex:outputLabel>
    </apex:pageBlock>
  </apex:form>
    </td>
  </tr>
  </table>
</apex:page>