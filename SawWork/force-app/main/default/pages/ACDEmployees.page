<apex:page standardController="User" id="ACDEmployees"  extensions="ACDEmployeeController" recordSetVar="users"  showHeader="false" sidebar="false" standardStylesheets="true">
    <head>
        <apex:includeScript value="{!URLFOR($Resource.JQuery111, 'jquery-1.11.2/dist/jquery.min.js')}"/>
        <apex:includeScript value="{!URLFOR($Resource.JQueryUI111, 'jquery-ui.min.js')}"/>
        
        <apex:includeScript value="{!URLFOR($Resource.bootstrap3, 'dist/js/bootstrap.js')}"/>
        <apex:includeScript value="{!URLFOR($Resource.bootstrap3, 'dist/js/bootstrap.min.js')}"/>
        
        <apex:stylesheet value="{!URLFOR($Resource.bootstrap3, 'dist/css/bootstrap.css')}"/>
        <apex:stylesheet value="{!URLFOR($Resource.bootstrap3, 'dist/css/bootstrap.min.css')}"/>
        
        <apex:stylesheet value="{!URLFOR($Resource.jQueryDataTablesZip, 'jQueryDataTables/css/jquery.dataTables.css')}"/>
        
        <style type="text/css">            
        
            .sorting {
                background: #f2f3f3 url('{!URLFOR($Resource.jQueryDataTablesZip, 'jQueryDataTables/images/sort_both.png') }') no-repeat center right !important;
                padding-right: 20px !important;
            }
            .sorting_asc {
                background: #f2f3f3 url('{!URLFOR($Resource.jQueryDataTablesZip, 'jQueryDataTables/images/sort_asc.png') }') no-repeat center right !important;
                padding-right: 20px !important;
            }
            .sorting_desc {
                background: #f2f3f3 url('{!URLFOR($Resource.jQueryDataTablesZip, 'jQueryDataTables/images/sort_desc.png') }') no-repeat center right !important;
                padding-right: 20px !important;
            }
            .sorting_asc_disabled {
                background: #f2f3f3 url('{!URLFOR($Resource.jQueryDataTablesZip, 'jQueryDataTables/images/sort_asc_disabled.png') }') no-repeat center right !important;
                padding-right: 20px !important;
            }
            .sorting_desc_disabled {
                background: #f2f3f3 url('{!URLFOR($Resource.jQueryDataTablesZip, 'jQueryDataTables/images/sort_desc_disabled.png') }') no-repeat center right !important;
                padding-right: 20px !important;
            }
            table.dataTable tr.odd { background-color: white; }
            table.dataTable tr.even { background-color: white; }
            table.dataTable tr.odd td.sorting_1 { background-color: white; }
            table.dataTable tr.odd td.sorting_2 { background-color: white; }
            table.dataTable tr.odd td.sorting_3 { background-color: white; }
            table.dataTable tr.even td.sorting_1 { background-color: white; }
            table.dataTable tr.even td.sorting_2 { background-color: white; }
            table.dataTable tr.even td.sorting_3 { background-color: white; }
            .dataTables_length, .dataTables_filter, .dataTables_info, .dataTables_paginate {
                padding: 3px;
            }
            body .pbBody table.list tr.dataRow td{
                border-width: 0 0 1.5px 0;
            }
     
        </style>
        <style>
           .textsize {font-size: 8.5pt;}
           .col-height {height: auto;}
           table.dataTable tbody th, table.dataTable tbody td {
    				padding: 8px 10px 0px 6px;}
           .skill-col-height {height: 6px;} 
        </style> 
        <script type="text/javascript">
            $( document ).ready(function() {
                console.log('document ready');
                $("#ACDEmployees\\:form\\:employeeBlock\\:ACDEmpTable\\:tb tr:eq(0) ").click();                
                $("#ACDEmployees\\:form\\:employeeBlock\\:ACDEmpTable\\:0\\:alias").click();
             });
        
            function openNewSkillPopup(){
                var userId = document.getElementById('{!$Component.form.paramUser}').value;
                var new_window = window.open("/apex/TSACDSkillMemberCreate?userid="+userId,
'_blank','height=400,width=1000,left=100,top=100,scrollbars=yes,toolbar=no,status=no');
                new_window.onbeforeunload = function(){getSkills(userId);}
            }
        
         function editSkillPopup(id){ 
             var userId = document.getElementById('{!$Component.form.paramUser}').value;
             var new_window = window.open("/apex/TSACDSkillMemberCreate?id="+id+"&act=Edit",'_blank','height=400,width=1000,left=100,top=100,scrollbars=yes,toolbar=no,status=no');
             new_window.onbeforeunload = function(){getSkills(userId);}
            }
         
        </script>
        <script>
            function myJavascriptFunc()
            {
                alert('Entered Javascript') ;
              
            }
            var lastRow;
            function highlight(elem){
                if(lastRow != undefined){
                    lastRow.children[0].style.backgroundColor = 'white';
                    lastRow.style.backgroundColor = 'white';
                  }  
                elem.style.backgroundColor = '#B0E2FF';
                elem.children[0].style.backgroundColor = '#B0E2FF';
                lastRow = elem;
            }
        </script>
    </head>
    
    <body class="textsize">
        <div class="container-fluid">  
            <apex:form id="form">
               <apex:actionFunction name="getSkills" action="{!getUserSkills}" rerender="skills,paramUser" oncomplete="return false;">
                   <apex:param name="userId" value="" assignTo="{!userId}"/>
               </apex:actionFunction>
               
               <!--apex:actionPoller action="{!getUserSkillsPoll}" rerender="skills" oncomplete="return false;" interval="5"/-->
               <apex:actionFunction name="refresh" action="{!refresh}" />
               
                
                <apex:pageBlock id="employeeBlock">
                    <apex:panelGrid columns="1" style="margin-left:auto; margin-right:auto">
                        <apex:commandButton value="Refresh" styleClass="btn btn-default" onclick="refresh();" rerender="employeeBlock"/>
                    </apex:panelGrid>
                    <span style="cursor:pointer;">
                    <apex:pageBlockTable id="ACDEmpTable" value="{!userList}" var="u" styleClass="dataTable table table-striped" onrowClick="highlight(this)">
                        <apex:column style="width:7%" headerValue="Action" onclick="getSkills('{!u.Id}');" rendered="{!IF($Profile.Name =='System Administrator'||$Profile.Name =='Support - Tech Support Manager'||$Profile.Name =='Support - Tech Support Manager with Customer Notification', true , false)}">
                            <div class="col-height">
                                <apex:outputLink onclick="window.open('/apex/TSAgentIdCreate?id={!u.Id}', '_blank','height=400,width=800,left=100,top=100,scrollbars=yes,toolbar=no,status=no'); return false;">
                                    <apex:outputText value="Edit Agent ID" styleClass="text-primary"/>
                                </apex:outputLink>
                            </div>
                        </apex:column>
                        <apex:column id="alias" headerValue="Login Name" onclick="getSkills('{!u.Id}');">
                            <div class="col-height">{!u.Alias}</div>
                        </apex:column>
                        <apex:column headerValue="Last Name" onclick="getSkills('{!u.Id}');">
                            <div class="col-height">{!u.LastName}</div>
                        </apex:column>
                        <apex:column headerValue="First Name" onclick="getSkills('{!u.Id}');">
                            <div class="col-height">{!u.FirstName}</div>
                        </apex:column>                        
                        <apex:column headerValue="Email" style="width:15%" onclick="getSkills('{!u.Id}');">         
                            <div class="col-height">
                            	<apex:outputLink style="color:#428bca" value="mailto:{!u.Email}">{!u.Email}</apex:outputLink>    
                            </div>
                        </apex:column>
                        <apex:column headerValue="ACD Agent ID" style="width:6%" onclick="getSkills('{!u.Id}');">
                            <div class="col-height">{!u.ACD_Agent_ID__c}</div>
                        </apex:column>
                        <apex:column headerValue="Manager" onclick="getSkills('{!u.Id}');">
                            <div class="col-height">{!u.Manager.Name}</div>
                        </apex:column>
                        <apex:column headerValue="Office Location" onclick="getSkills('{!u.Id}');">
                            <div class="col-height">{!u.Office_Location__c}</div>
                        </apex:column>
                        <apex:column headerValue="Owner Shift" onclick="getSkills('{!u.Id}');">
                            <div class="col-height">{!u.Shift__c}</div>
                        </apex:column>
                        <apex:column headervalue="Team" style="width:12%" onclick="getSkills('{!u.Id}');">
                            <div class="col-height">{!u.Team__c}</div>
                        </apex:column>
                    </apex:pageBlockTable>
                    </span>
                </apex:pageBlock>  

                <apex:inputHidden id="paramUser" value="{!userId}"/>
                <apex:inputHidden id="paramSkillName" value="{!userId}"/>
        
                <apex:pageBlock title="Skills: {!userName}" id="skills">
                    <apex:panelGrid columns="1" style="margin-left:auto; margin-right:auto"> 
                        <apex:commandButton value="Add New Skill" onClick="openNewSkillPopup(); return false;" styleClass="btn btn-default" rendered="{!IF($Profile.Name =='System Administrator'||$Profile.Name =='Support - Tech Support Manager'||$Profile.Name =='Support - Tech Support Manager with Customer Notification', true , false)}" disabled="{!userId==null}"/>  
                    </apex:panelGrid>
                    <apex:outputPanel style="overflow:scroll;height:200px;" layout="block">
                        <apex:pageBlockTable value="{!ts_skills}" var="ts" styleClass="skillsdataTable table table-striped" id="skillsTable">
                            <apex:column headerValue="Action" rendered="{!IF($Profile.Name =='System Administrator'||$Profile.Name =='Support - Tech Support Manager'||$Profile.Name =='Support - Tech Support Manager with Customer Notification', true , false)}">
                                <div class="skill-col-height">
                                    <apex:commandLink onclick="editSkillPopup('{!ts.Id}'); return false;" rerender="none">
                                        <apex:outputText value="Edit" styleClass="text-primary" />
                                    </apex:commandLink>&nbsp;|&nbsp;
                                    <apex:commandLink action="{!deleteSkill}" styleClass="text-primary" onclick="if(!confirm('Are you sure?')) return false;" rerender="skills,paramUser">                                       
                                        <apex:outputText value="Delete" styleClass="text-primary"/>
                                        <apex:param value="{!ts.Id}" name="idToDel" assignTo="{!toBeDelSkill}"/>
                                        <apex:param value="{!userId}" name="userId" assignTo="{!userId}"/>
                                    </apex:commandLink>
                                </div>
                            </apex:column>
                            
                            <apex:column headerValue="Skill Name" id="skillName">
                                <div class="skill-col-height" id = "skillName" name="skillName">{!ts.TS_Product_Skill__r.Product_Skill_Name__c}</div>
                            </apex:column>
                            <apex:column headerValue="Routing Order" id="skillLevel">
                                <div class="skill-col-height" name="skillLevel">{!ts.Skill_Level__c}</div>
                            </apex:column>                      
                        </apex:pageBlockTable>
                    </apex:outputPanel>
                </apex:pageBlock>
            </apex:form> 
        </div> <!-- end of container -->
    </body>
    
    <script type="text/javascript" language="javascript" src="{!URLFOR($Resource.jQueryDataTablesZip, 'jQueryDataTables/js/jquery.js')}"></script>
    <script type="text/javascript" language="javascript" src="{!URLFOR($Resource.jQueryDataTablesZip, 'jQueryDataTables/js/jquery.dataTables.js')}"></script>
    <script type="text/javascript" language="javascript">
    var j$ = jQuery.noConflict();
    j$('table.dataTable').dataTable({
        aaSorting: [],
        sPaginationType: "full_numbers"
    });
    
    function bringBackSorter(){
        j$('table.skillsdataTable').dataTable({
        "sPaginationType": "full_numbers",
           "bredraw":true,
           "bDestroy": true
       });   
    }   
    
    </script>

</apex:page>