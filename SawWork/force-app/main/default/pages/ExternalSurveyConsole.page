<!-- 
Author: Sharath Prasanna
Created Date: June 20 2017
Description: This is the External Survey Page
Ticket: SFDC-1654
 -->

<apex:page id="ExternalSurveyConsole" StandardController="External_Survey_Form__c" extensions="ExternalSurveyConsoleController" showHeader="false" sidebar="false" standardStylesheets="false">

   <script src="{!URLFOR($Resource.BootstrapCommonFiles, '/bootstrap-3.3.2-dist/js/bootstrap.min.js')}"></script>
   <apex:stylesheet value="{!URLFOR($Resource.BootstrapCommonFiles, '/bootstrap-3.3.2-dist/css/bootstrap.min.css')}"/>
   <apex:includeScript value="{!$Resource.JQuery_New}"/>
   <apex:includeScript value="{!URLFOR($Resource.BootstrapCommonFiles, '/bootstrap-3.3.2-dist/js/bootstrap.min.js')}"/>
   <apex:includescript value="{! URLFOR($Resource.LicenseReportStaticResource, 'js/jquery.dataTables.min.js')}" />        
   <apex:stylesheet value="{! URLFOR($Resource.LicenseReportStaticResource, 'css/jquery.dataTables.css')}" />

   <style type="text/css">
        
      html
      {
            background-color:#d6e9c6;
            min-width: 100%;
            min-height: 100%;
      }
      body 
      {
            height: auto;
            background-color: #e8f3cf;
      }

      .form-actions 
      {
            margin: 0;
            background-color: transparent;
            text-align: center;
      }
      
      #tabContainer .nav-tabs > li > a 
      {
           border-radius: 4px 4px 0 0 ;
      }

      #tabContainer .tab-content 
      {
             padding : 5px 15px;
      }

      .width
      {  
            width: 100%;
      }

   </style>
   
   <script type="text/javascript">
      
         $ = jQuery.noConflict();         
          
         var contactsTable;
          
         function queryContactsJS()
         {

               var email = $('#searchText').val();
               

               if(email === undefined || email === '')
               {
                  
                  showMessage('Enter values to search!',false);
                  $('#contactsDiv').hide();
                  return;
               }
               showSpinner();
               var option = $('#searchOption').val();             
               if((!email.includes('@') && option === 'Email') || (email.includes('@') && option != 'Email')) 
               {
                  showMessage('Please select the correct search option!',false);
                  $('#contactsDiv').hide();
                  return;                  
               }

               ExternalSurveyConsoleController.queryContacts(
               email,
               option,
               function(result, event)
               {                 
                  if(event.status && result != undefined && result.length > 0)
                  {
                                           
                     var emailList = email.split('\n');
                     var emailTrimmed = [];
                     for(var i=0; i < emailList.length; i++)
                     {
                        var trimmedOption  = emailList[i].replace(/\s/g, '');
                        if(trimmedOption != '' && emailTrimmed.indexOf(trimmedOption) === -1)
                        {

                            emailTrimmed.push(trimmedOption);
                        }  

                     }                     
                     if(emailTrimmed.length != result.length)
                     {
                        showMessage('Some contacts not found or have opted out!',false);  

                     }
                     contactsTable = $('#contactsTable').dataTable({
                        "data": result,
                        "columns":[
                            {
                                "data": "Id",
                                "type": "html",
                                "bSortable": false,
                                "mRender" : function(data,type,full) {
                                    return '<input style="font-family: Arial, Helvetica, sans-serif;font-size: 12px;text-overflow: ellipsis;word-wrap: break-word;width: auto !important" value = "'+ data + '" id = "'+ data + '" type="checkbox">';
                                }
                            },
                            {
                                "data": "Name",
                                "type": "html",
                                "mRender" : function(data,type,full) {
                                    return '<a style="font-family: Arial, Helvetica, sans-serif;font-size: 14px;text-overflow: ellipsis;word-wrap: break-word; cursor: pointer;width: auto!important" onclick=window.open("/'+full.Id+'")>' + data+ '</a>';
                                }
                            },
                            {
                                "data": "Email",
                                "type": "html",
                                "mRender" : function(data,type,full) {
                                    return '<p style ="font-family: Arial, Helvetica, sans-serif;font-size: 14px;text-overflow: ellipsis;word-wrap: break-word; width: auto!important">' + data+ '</p>';
                                }
                            },
                        {
                            "data": "AKAM_Contact_ID__c",
                            "type": "html",
                            "mRender" : function(data,type,full) {
                                return '<p style ="font-family: Arial, Helvetica, sans-serif;font-size: 14px;text-overflow: ellipsis;word-wrap: break-word; width: auto!important">' + data+ '</p>';
                            }
                        }

                        ],
                        "destroy": true,
                        "pageLength": 25

                     });
                     $('#contactsDiv').show();
                  }
                  else if(event.status && result != undefined && result.length === 0)
                  {                        
                        showMessage('No contacts found!',false);  
                        $('#contactsDiv').hide();  
                  } 
                  else
                  {
                        showMessage(event.message,false);    
                        $('#contactsDiv').hide();
                  }
                  hideSpinner();
                  rerenderIframes();
                });                                                                                                                    
         
         }
        
        function showMessage(text1,success)
        {
            hideSpinner();
            if(!success)
            {  
               $('#invalidFormId').show();
               $('#successMessageId').hide();   
               $('#invalidFormId').html(text1);
            }
            else
            {
               $('#invalidFormId').hide();
               $('#successMessageId').show();   
               $('#successMessageId').html(text1);
            }

            $('#messages').css('display','block');
            $('#messages').modal('show');
                             
        }

        function closeMessage()
        {
            $('#messages').css('display','none');
            $('#messages').modal('hide');
        }

        function addQuestion()
        {
            hideSpinner();
            $('#addQuestion').css('display','block');
            renderOptions();
            $('#addQuestion').modal('show');
        }

        function createEditSurvey()
        {
          
            var invalid = requiredCheck('SurveyPanelDiv');

            var frequency = $("[id$='Frequency__c']").val();
            if(isNaN(frequency))
            {
                 showMessage('Frequency should be a number',false);
                 return;  
            }
            if(!invalid)
            {

               showSpinner();
               saveForm();
               //hideSpinner();
               
            }
            else
            {
                 showMessage('Please Populate the Mandatory Fields!',false);
                 return;                 
            }
        }

        function saveOnComplete()
        {
            hideSpinner();
            var message = $('#surveyFormHidden').val();
            if(message == 'Saved!')
            {
              showMessage(message,true);  
            }
            else if(message != '' && message != undefined)
            {
              showMessage(message,false);   
            }
            $('#surveyFormHidden').removeAttr('value');
        }

        function renderOptions()
        {
            var option = $( "select[id$='Question_Type__c']" ).val();
            if (option === 'Picklist' || option === 'Checkbox'  || option === 'Radio' )
            {
                $('#Question_Options__cGroup').show();
            }
            else
            {
                 $('#Question_Options__cGroup').hide();  
            }  
        }

        function performValidation()
        {
            var type = $( "select[id$='Question_Type__c']" ).val();
            var option = $( "textarea[id$='Question_Options__c']" ).val();

            $('#QuestionFormModalFailure').hide();
            var invalid = requiredCheck('QuestionFormModal')

            if(!invalid)
            {
                 if(type === 'Picklist' || type === 'Checkbox' || type === 'Radio')
                 {
                   if(option === undefined || option === '')
                   {
                        $('#QuestionFormModalFailure').html('Please fill in the required fields');
                        $('#QuestionFormModalFailure').show();
                        invalid = true;
                   }
                 }
            }
            if(!invalid)
            {
               $('#addQuestion').css('display','none');
               $('#addQuestion').modal('hide');
               showSpinner();
               saveQuestion();               
            }

        }

        function requiredCheck(formId)
        {
                 var invalid = false;
                 $('#' + formId + ' .required').each(function(element) {
                        console.log($(this).val());
                       if($(this).val() === undefined || $(this).val() === '')
                       {
                            invalid = true;
                       }
                  });
                  if(invalid)
                  {
                        $('#' + formId + 'Failure').html('Please fill in the required fields');
                        $('#' + formId + 'Failure').show();

                  }
                  return invalid;
        }
        function selectDeselect(allBox)
        {
              $('#contactsTable input:checkbox').not(allBox).prop('checked', allBox.checked);

        }

        function closeSurveyActions()
        {
            $('.centerButtons').hide();
            $("#surveyInputSet").attr("disabled", "disabled");
            $('#SendTab').hide();
            $('#CloseSurveyButton').hide();
            hideSpinner();
            showMessage('Survey is Closed!', true);
        }
        function sendSurvey()
        {
             
            var idsToSend = [];
            $("#contactsTable input:checkbox").each(function(){
                var $this = $(this);
                if($this.is(":checked") && $this.attr("id") != 'AllRows')
                {   
                    console.log(idsToSend);  
                    idsToSend.push($this.attr("id"));
                }
             });       
            $('#contactsTable input:checkbox').prop('checked', false);            
            if(idsToSend != undefined && idsToSend.length > 0)
            {     
                  showSpinner();
                  ExternalSurveyConsoleController.sendMail(idsToSend,
                  '{! surveyForm.Id}',
                  function(result, event)
                  {
                      if(event.status)
                      {
                          if(result === 'Survey Sent Successfully!')
                          {
                            showMessage(result,true);  
                            $('.centerButtons').hide();   
                            $("#surveyInputSet").attr("disabled", "disabled");                           
                          }
                          else
                          {
                              showMessage(result,false);  
                          }
                      }
                      else
                      {                        
                          showMessage(event.message,false);    
                      }
                      hideSpinner(); 
                      rerenderIframes();
                  });    
            }
            else
            {
                showMessage('No Contact Selected',false);    
            }
        }

        function showSpinner()
        {
              $('#status').css('display','block');
              $('#status').modal('show');

        }
        function hideSpinner()
        {
            $('#status').css('display','none');
            $('#status').modal('hide');
          
        }

        function showConfirm()
        {          
              $('#confirmDialog').css('display','block');
              $('#confirmDialog').modal('show');
        }
        function editAddQuestionSpinner()
        {
            showSpinner();
            editAddQuestion();
        }

        function questionFinishActions(action)
        {
            hideSpinner();
            var message = $('#questionFormHidden').val();
            if(message != '' && message != undefined)
            {
              showMessage(message,false);   
            }
            $('#questionFormHidden').removeAttr('value');
            
        }
        $(document).ready(function () {
            
            var newSurvey = {! newSurvey};
            var lockedSurvey = {! lockedSurvey};
            var closeSurvey = {! closeSurvey};

            if(newSurvey)
            {
                  $('#QuestionTab').hide();
                  $('#SendTab').hide();
                  $('#ReportsTab').hide();
                  $('#ReportsTab2').hide();
                  $('#CloseSurveyButton').hide();     
                  $('#centerButtons').hide(); 
                  $('#cloneButton').hide();        
            }            
            else if(closeSurvey)
            {
                closeSurveyActions();
            }
            else if(lockedSurvey)
            {
               $('.centerButtons').hide();
               $("#surveyInputSet").attr("disabled", "disabled");
            }
         });

   </script>


    <div id="messages" style="display:none;" class="modal fade">
      <div class="modal-dialog" >
        <div class="modal-content" >
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
          </div>
          <div class="modal-body" >
            <div class="alert alert-danger" role="alert" style="display:none;text-align:center;font-weight:bold;" id="invalidFormId">Oh snap! This link is invalid.</div>
            <div class="alert alert-success" role="alert" style="display:none;text-align:center;font-weight:bold;" id="successMessageId">This form has been saved successfullly..!</div>

          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal" >Close</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

    <div id="status" style="display:none;height: 100%; width: 100%; opacity: 0.5" class="modal">
      <div class="modal-dialog" style="height: 100%; width: 100%;">
        <div class="modal-content" style="height: 100%; width: 100%;">
          <div class="modal-body" style="height: 100%; width: 100%;">
               
              <c:P2RenhancedActionStatus BackColor="#ffffff" borderColor="#ffffff" borderSize="2" height="50px" width="150px" ImageUrl="/changemgmt/img/spinner24.gif" Message="Please wait..." messageStyle="color:darkred;font-size:11pt;font-weight:bold;"/>

          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

    <div id="confirmDialog" style="display:none;" class="modal fade">
      <div class="modal-dialog" >
        <div class="modal-content" >
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
          </div>
          <div class="modal-body" >
            <div class="alert alert-danger" role="alert" style="text-align:center;font-weight:bold;" id="confirmMessage">Do you want to close the survey?</div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal" onclick="showSpinner();closeSurvey();" >Yes</button>
            <button type="button" class="btn btn-default" data-dismiss="modal" >No</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

    <div id="addQuestion" style="display:none;height: 100%;width: 100%; " class="modal fade">
      <div class="modal-dialog" >
        <div class="modal-content" >
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                <span aria-hidden="true">&times;</span>
                <span class="sr-only">Close</span>             
            </button>
            <h4 class="modal-title" id="myModalLabel">
                Survey Question
            </h4>  

          </div>
           <div class="alert alert-danger" role="alert" style="width:100%;display:none;text-align:center;font-weight:bold;" id="QuestionFormModalFailure">Oh snap! This link is invalid.</div>
           <div class="alert alert-success" role="alert" style="width:100%;display:none;text-align:center;font-weight:bold;" id="QuestionFormModalSuccess">This form has been saved successfullly..!</div>
            
           <div class="modal-body" id="QuestionFormModal">
               <apex:form id="QuestionForm"> 
                   <apex:outputPanel id="questionFormPanel">
                        
                        <div class="form-group" id="Question__cGroup">
                              <div>
                                 <apex:outputLabel for="Question__c" value="Question"/>
                                 <span class="glyphicon glyphicon-asterisk" aria-hidden="true" style="color:red; padding-left: 2px; font-size:small"></span>
                              </div>
                              <div >                     
                                 <apex:inputTextarea style="width: 100%;" id="Question__c" styleClass="required" value="{! surveyQuestion.Question__c}"  />
                              </div>   
                        </div>   

                        <div class="form-group" id="Question_Type__cGroup">
                            <div >
                                  <apex:outputLabel for="Question_Type__c" value="Type"/>
                                  <span class="glyphicon glyphicon-asterisk" aria-hidden="true" style="color:red; padding-left: 2px; font-size:small"></span>
                            </div>
                            <div >                       
                               <apex:inputField id="Question_Type__c" styleClass="required" value="{! surveyQuestion.Question_Type__c}"   onchange="renderOptions();"/>
                            </div>  
                        </div>   
                
                        <div class="form-group" id="Question_Options__cGroup" style="display: none;">
                            <div >
                               <apex:outputLabel for="Question_Options__c" value="Question Options"/>
                               <span class="glyphicon glyphicon-asterisk" aria-hidden="true" style="color:red; padding-left: 2px; font-size:small"></span>
                           </div>
                            <div >                       
                               <apex:inputTextarea id="Question_Options__c" html-placeholder="Each Option should be separated by a new line" style="width: 100%;" styleClass="requiredOptions" value="{! surveyQuestion.Question_Options__c}" />
                           </div>   
                        </div>   
                
                        <div class="form-group" id="Required_Question__cGroup">
                            <div >
                               <apex:outputLabel for="RequiredQuestion" value="Required Question"/>
                            </div>
                            <div >                       
                               <apex:inputField id="RequiredQuestion" styleClass="required" value="{! surveyQuestion.Required_Question__c}" />
                            </div>  
                        
                        </div>   
               
                        <apex:actionFunction name="editAddQuestion" action="{! editAddQuestion}"  oncomplete="addQuestion();" reRender="questionFormPanel,pm">
                           <apex:param name="questionId" id="questionId" value=""/>
                        </apex:actionFunction>

                        <apex:actionFunction name="deleteQuestion" action="{! deleteQuestion}"  reRender="questionsPanel,pm" oncomplete="questionFinishActions('Delete');">
                           <apex:param name="questionDeleteId" id="questionDeleteId" value=""/>
                        </apex:actionFunction>

                        <apex:actionFunction name="saveQuestion" action="{! saveQuestion}"  reRender="questionsPanel,pm" oncomplete="questionFinishActions('Save');">
                        </apex:actionFunction>

         <!--                 <apex:actionFunction name="saveSurveyQuestions" action="{! saveSurveyQuestions}"   reRender="questionsPanel,pm" oncomplete="showMessage('Saved!',true);">
                        </apex:actionFunction>
          -->
                         <apex:actionFunction name="rerenderIframes" rerender="theIframe1Panel,theIframe2Panel" />

               </apex:outputPanel>  
            </apex:form>   
         </div>
         <div class="modal-footer">
               <button type="button" class="btn btn-info" onclick="performValidation();">Save</button>
               <button type="button" class="btn btn-close" data-dismiss="modal" >Close</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

    <nav class="navbar navbar-default navbar-fixed-top" style="text-align:center;border-bottom:none;background-color:#d6e9c6;height: 100px;">
            <h1><small>Survey Design Form</small></h1><h4><span class="label label-default glyphicon glyphicon-home pull-right" style ="margin-right:2%;background-color: #f1f1f1;color:black;cursor:pointer;padding:8px 8px 10px 10px;" onclick = "window.open('/')">&nbsp;Home</span></h4> 
          
          <div id="tabContainer" class="container" >  
               <ul  class="nav nav-tabs">
                    
                    <li id="InfoTab" class="active">
                         <a  href="#1c" data-toggle="tab">Survey Info</a>
                    </li>

                    <li id="QuestionTab">
                         <a  href="#1b" data-toggle="tab">Survey Questions</a>
                    </li>
                    
                    <li id="SendTab">
                         <a href="#2b" data-toggle="tab">Send Survey</a>
                    </li>
                    
                    <li id="ReportsTab">
                         <a href="#3b" data-toggle="tab">Response Report</a>
                    </li>
                    
                    <li id="ReportsTab2">
                        <a href="#4b" data-toggle="tab">Customer Report</a>
                    </li>
               </ul>
       </div>        
   </nav>   
 

      <div class="tab-content clearfix" style="position: absolute;top: 105px;width: 100%;background-color: #e8f3cf;">
        
      <center>
         <apex:outputPanel id="pm">
            <apex:pageMessages />
         </apex:outputPanel>        
      </center>

         <div class="tab-pane" id="1b" >          
            <apex:outputPanel id="questionsPanel" >
               <div class="container" id="questionsPanelDiv" style="width:60%; background-color: white; box-shadow:0px 0px 20px 5px #888888; margin-bottom: 350px">

                   <center style="margin-top: 1%" class="centerButtons">
                     <button type="button" class="btn btn-success" onclick="editAddQuestionSpinner();">Add Question</button>
<!--                    <button type="button" class="btn btn-info" onclick="saveSurveyQuestionsSpinner();">Save</button>  
 -->               </center>
                  
                  <input id="questionFormHidden" type="hidden" value="{! message}"/>  
                   <apex:form id="form"  style="margin-top:25px; margin-bottom:3px;">  
                        <fieldset id="masterFieldSetId" >
                            <apex:variable var="i" value="{!1}"/> 
                            <apex:repeat id="masterRepeat" value="{! questions}" var="surveyData">
                               <div id="masterDiv{!surveyData.question.Question_Type__c+surveyData.sequence}" class="panel panel-success">
                              
                                   <div class="panel-body" >

                                       <div id="editPanel{!surveyData.question.Question_Type__c+surveyData.sequence}" class="pull-right centerButtons">
                                            
                                            <span id="edit{!surveyData.sequence}" class="glyphicon glyphicon-edit" aria-hidden="true" style="padding-left: 2px; font-size:small; cursor: pointer" onclick="editAddQuestion('{!surveyData.question.UniqueName__c}');">                                    
                                            </span>                                 
                                    
                                            <span id="delete{!surveyData.sequence}" class="glyphicon glyphicon-remove" aria-hidden="true" style="color:red; padding-left: 2px; font-size:small;cursor: pointer" onclick="showSpinner();deleteQuestion('{!surveyData.question.UniqueName__c}');">                                    
                                            </span>                                 

                                       </div>   

                                       <apex:outputPanel rendered="true">
                                           <h4>{! i}. {!surveyData.question.Question__c}<apex:outputPanel rendered="{! surveyData.question.Required_Question__c}"><span class="glyphicon glyphicon-asterisk" aria-hidden="true" style="color:red; padding-left: 2px; font-size:small"></span></apex:outputPanel></h4>
                                       </apex:outputPanel>

                                       <apex:outputPanel rendered="{!if(surveyData.question.Question_Type__c = 'Radio',true,false)}">
                                           <div  id="{!surveyData.question.Question_Type__c+surveyData.sequence}{!IF(surveyData.question.Required_Question__c,'RequiredQues','OptQues')}">                                            
                                               <apex:selectRadio disabled="true" layout="pageDirection" >
                                                   <apex:selectOptions value="{!surveyData.options}"/>
                                               </apex:selectRadio>

                                           </div>
                                       </apex:outputPanel>

                                       <apex:outputPanel rendered="{!if(surveyData.question.Question_Type__c = 'Checkbox',true,false)}">
                                           <div  id="{!surveyData.question.Question_Type__c+surveyData.sequence}{!IF(surveyData.question.Required_Question__c,'RequiredQues','OptQues')}">

                                               <apex:selectCheckboxes disabled="true" layout="pageDirection" style="">
                                                   <apex:selectOptions value="{!surveyData.options}"/>
                                               </apex:selectCheckboxes>

                                           </div>
                                       </apex:outputPanel>

                                       <apex:outputPanel rendered="{!if(surveyData.question.Question_Type__c = 'Text',true,false)}">
                                           <div id="{!surveyData.question.Question_Type__c+surveyData.sequence}{!IF(surveyData.question.Required_Question__c,'RequiredQues','OptQues')}">
                                               <apex:inputTextarea rows="5" style="width:100%;" disabled="true"/>
                                           </div>
                                       </apex:outputPanel>

                                       <apex:outputPanel rendered="{!if(surveyData.question.Question_Type__c = 'Picklist',true,false)}">
                                           <div id="{!surveyData.question.Question_Type__c+surveyData.sequence}{!IF(surveyData.question.Required_Question__c,'RequiredQues','OptQues')}">
                                               <apex:selectList multiselect="false" size="1" >
                                                   <apex:selectOptions value="{!surveyData.options}"/>
                                               </apex:selectList>
                                           </div>
                                       </apex:outputPanel>

                                 </div>
                            </div>
                            <apex:variable var="i" value="{! i + 1}"/> 
                        </apex:repeat>
                    </fieldset>
                 </apex:form> 
                <center style="margin-bottom: 1%" class="centerButtons">
                  <button type="button" class="btn btn-success" onclick="editAddQuestionSpinner();">Add Question</button>
<!--                 <button type="button" class="btn btn-info" onclick="saveSurveyQuestionsSpinner();">Save</button>  
 -->            </center>

             </div> 
            </apex:outputPanel>  
         </div>

         <div class="tab-pane" id="2b">

               <div id="searchDiv" class="container">
                                 
                     <div class="row">
                        <div class="col-md-2">
                            <div class="form-group">
                        
                                <label id="searchLabel" for="searchOption">Search Option</label>
                        
                                 <select class="form-control" id="searchOption">
                                    <option value="Email">Email</option>
                                   <option value="AKAM_Contact_ID__c">Akam Contact Id</option>                            
                                </select>                           
                              
                           </div> 
                        </div>
                     </div>
                
                   <div class="row">
                       <div class="col-md-12">
                            <textarea id="searchText" placeholder="Each value should be separated by a new line" clas= "form-control" rows="5" style="width: 100%" cols="50"></textarea>                  
                       </div>
                   </div>                    

                   <div class="row" style="margin-top: 1%;"> 
                       <center>
                           <button type="submit" class="btn btn-primary" onclick="queryContactsJS();">Search</button>    </center>
                   </div>

                  <div id="contactsDiv" class="row" style="display: none;;margin-top: 4%;" >
                         <center>
                             <button type="submit" class="btn btn-primary" onclick="sendSurvey();">Send Survey</button>  
                         </center>
       
                        <div class="col-md-12" >

                              <table id="contactsTable" style="width: 100%" class="display cell-border hover compact" cellspacing="0" >
                                 <thead>
                                    <th ><input  type="Checkbox" id="AllRows" onchange="selectDeselect(this);"/></th>
                                    <th >Name</th>
                                    <th >Email</th>
                                    <th >AKAM Contact ID</th>
                                 </thead>
                                 <tbody>
                                       
                                 </tbody>
                              </table>                  
                        </div>
                       <center>
                           <button type="submit" class="btn btn-primary" onclick="sendSurvey();">Send Survey</button>  
                       </center>
                    
                  </div>      
            </div>
      </div>   
      
      <div class="tab-pane active" id="1c">
              
              <apex:outputPanel id="surveyPanel" >
                  <div class="container" id="SurveyPanelDiv" style="width:60%; background-color: white; box-shadow:0px 0px 20px 5px #888888; margin-bottom: 350px">
                      <center style="margin-top: 1%">
                           <button type="button" class="btn btn-success centerButtons" onclick="createEditSurvey();">Save</button>
                           <button type="button" id="cloneButton" class="btn btn-success" onclick="showSpinner();cloneSurvey();">Clone</button>
                           <button type="button" id="CloseSurveyButton" class="btn btn-info" onclick="showConfirm();">Close Survey</button>  
                       </center>
                        
                      <apex:form id="SurveyForm"  style="margin-top:25px; margin-bottom:3px;">  
                            <apex:actionFunction name="saveForm" action="{! saveForm}" immediate="false" status="savingLoading" reRender="SurveyPanelDivFailure,SurveyPanelDivSuccess,surveyPanel" oncomplete="saveOnComplete();">
                            </apex:actionFunction>

                            <apex:actionFunction name="cloneSurvey" action="{! cloneSurvey}" immediate="false"  reRender="SurveyPanelDivFailure,SurveyPanelDivSuccess,surveyPanel" oncomplete="saveOnComplete();">
                            </apex:actionFunction>

                            <apex:actionFunction name="closeSurvey" action="{! closeSurvey}" immediate="false" status="savingLoading" reRender="pm,surveyPanel" oncomplete="closeSurveyActions();">
                            </apex:actionFunction>
                               
                            <div id="surveyFieldSetDiv" class="panel panel-success">
                              
                                <div class="panel-body" >

                                    <fieldset id="surveyInputSet" >
                     
                                        <div class="form-group" id="NameGroup">
                                          <div >
                                             <apex:outputLabel for="Name" value="Name"/>
                                             <span class="glyphicon glyphicon-asterisk" aria-hidden="true" style="color:red; padding-left: 2px; font-size:small"></span>
                                          </div>
                                           <div >                       
                                              <apex:inputField style="width: 100%;" styleClass="required" id="Name" value="{! surveyForm.Name}" />
                                           </div>  
                                       </div>
                                  
                                     <div class="form-group" id="Frequency__cGroup">
                                       <div >
                                          <apex:outputLabel for="Frequency__c" value="Send Reminder after (no. of days)"/>
                                          <span class="glyphicon glyphicon-asterisk" aria-hidden="true" style="color:red; padding-left: 2px; font-size:small"></span>
                                       </div>
                                       <div >                     
                                          <apex:inputField style="width: 100%;" id="Frequency__c" styleClass="required" value="{! surveyForm.Frequency__c}" />
                                       </div>   
                                    </div>   

                                     <div class="form-group" id="Invitation_Subject__cGroup">
                                       <div >
                                         <apex:outputLabel for="Invitation_Subject__c" value="Survey Invitation Subject"/>
                                         <span class="glyphicon glyphicon-asterisk" aria-hidden="true" style="color:red; padding-left: 2px; font-size:small"></span>

                                       </div>
                                       <div >                    
                                         <apex:inputTextarea rows="3" style="width: 100%;" id="Invitation_Subject__c" styleClass="required" value="{! surveyForm.Invitation_Subject__c}" />
                                       </div>  
                                     </div>  

                                     <div class="form-group" id="Template__cGroup">
                                          <div >
                                             <apex:outputLabel for="Template__c" value="Survey Invitation Template"/>
                                             <span class="glyphicon glyphicon-asterisk" aria-hidden="true" style="color:red; padding-left: 2px; font-size:small"></span>

                                          </div>
                                          <div >                     
                                             <apex:inputTextarea rows="5" style="width: 100%;" id="Template__c" styleClass="required" value="{! surveyForm.Template__c}" />
                                          </div>   
                                    </div>   

                                   <div class="form-group" id="Reminder_Subject__cGroup">
                                       <div >
                                         <apex:outputLabel for="Reminder_Subject__c" value="Reminder Subject"/>
                                         <span class="glyphicon glyphicon-asterisk" aria-hidden="true" style="color:red; padding-left: 2px; font-size:small"></span>

                                        </div>
                                       <div >                    
                                          <apex:inputTextarea rows="3" style="width: 100%;" id="Reminder_Subject__c" styleClass="required" value="{! surveyForm.Reminder_Subject__c}" />
                                       </div>  
                                  </div>  

                                  <div class="form-group" id="ReminderTemplate__cGroup">
                                       <div >
                                         <apex:outputLabel for="Reminder_Template__c" value="Reminder Template"/>
                                         <span class="glyphicon glyphicon-asterisk" aria-hidden="true" style="color:red; padding-left: 2px; font-size:small"></span>

                                       </div>
                                       <div >                    
                                            <apex:inputTextarea rows="5" style="width: 100%;" id="Reminder_Template__c" styleClass="required" value="{! surveyForm.Reminder_Template__c}" />
                                       </div>  
                                  </div>  

                                  <div class="form-group" id="From_Email__cGroup">
                                    <div >
                                       <apex:outputLabel for="From_Email__c" value="From Email"/>
                                       <span class="glyphicon glyphicon-asterisk" aria-hidden="true" style="color:red; padding-left: 2px; font-size:small"></span>
                                    
                                    </div>
                                    <div >                     
                                          <apex:inputField style="width: 100%;" styleClass="required" id="From_Email__c" value="{! surveyForm.From_Email__c}" />
                                    </div>   
                                 </div>   
         
                                  <div class="form-group" id="Requested_By__cGroup" >
                                       <div >
                                          <apex:outputLabel for="Requested_By__c" value="Requested By"/>                                           
                                       </div>
                                       <div >                     
                                          <apex:inputField style="width: 100%;" id="Requested_By__c"  value="{! surveyForm.Requested_By__c}" />
                                       </div>   
                                 </div>   
                           </fieldset>
                           <fieldset disabled="true" id="surveyOutputSet">
                                          
                               <div class="form-group" id="Owner__cGroup">
                                 <div >
                                    <apex:outputLabel for="Owner__c" value="Owner"/>
                                 
                                 </div>
                                 <div >                     
                                    <apex:outputField style="width: 100%;" id="Owner__c" value="{! surveyForm.Owner__c}" />
                                 </div>   
                              </div>   
                              
                              <div class="form-group" id="CreatedByGroup">
                                 <div >
                                    <apex:outputLabel for="CreatedBy" value="Created By"/>
                                 
                                 </div>
                                 <div >                     
                                       <apex:outputField style="width: 100%;" id="CreatedBy" value="{! surveyForm.CreatedBy.Name}" />
                                 </div>   
                              </div>   
                              
                              <div class="form-group" id="LastModifiedByGroup">
                                 <div >
                                    <apex:outputLabel for="LastModifiedBy" value="Last Modified By"/>                               
                                 </div>
                                 <div>                      
                                    <apex:outputField style="width: 100%;" id="LastModifiedBy" value="{! surveyForm.LastModifiedBy.Name}" />
                                 </div>   
                              </div>   
                              
                              <div class="form-group" id="Closed_Date__cGroup">
                                 <div >
                                    <apex:outputLabel for="Closed_Date__c" value="Closed Date"/>
                                 </div>
                                 <div >                     
                                    <apex:outputField style="width: 100%;" id="Closed_Date__c" value="{! surveyForm.Closed_Date__c}" />
                                 </div>   
                              </div>
                                  
                              <input id="surveyFormHidden" type="hidden" value="{! message}"/>  
                        </fieldset>       
                     </div>
                  </div>      
                                 
               </apex:form>
            </div>
        </apex:outputPanel>          
    </div>

    <div class="tab-pane" id="3b">
      <apex:outputPanel id="theIframe1Panel">  
        <apex:iframe src="{! responseReport}" scrolling="true" id="theIframe1"/>
      </apex:outputPanel>  
    </div>

    <div class="tab-pane" id="4b">
      <apex:outputPanel id="theIframe2Panel">  
         <apex:iframe src="{! customerReport}" scrolling="true" id="theIframe2"/>
       </apex:outputPanel>   
    </div>

  </div>
   
   

</apex:page>