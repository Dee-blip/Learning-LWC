<apex:page standardController="TS_Support_Team__c" extensions="TSSupportSingleTeamExtension" sidebar="false" standardStylesheets="true" showHeader="false">
    <head>
        <apex:includeScript value="{!URLFOR($Resource.JQuery111, 'jquery-1.11.2/dist/jquery.min.js')}"/>
        <apex:includeScript value="{!URLFOR($Resource.JQueryUI111, 'jquery-ui.min.js')}"/>
        
        <apex:includeScript value="{!URLFOR($Resource.bootstrap3, 'dist/js/bootstrap.js')}"/>
        <apex:includeScript value="{!URLFOR($Resource.bootstrap3, 'dist/js/bootstrap.min.js')}"/>
        
        <apex:stylesheet value="{!URLFOR($Resource.bootstrap3, 'dist/css/bootstrap.css')}"/>
        <apex:stylesheet value="{!URLFOR($Resource.bootstrap3, 'dist/css/bootstrap.min.css')}"/>
        
        <apex:stylesheet value="{!URLFOR($Resource.jQueryDataTablesZip, 'jQueryDataTables/css/jquery.dataTables.css')}"/>
        
         <style type="text/css">            
        
            .sorting {
                background: #f2f3f3 url('{!URLFOR($Resource.jQueryDataTablesZip, 'jQueryDataTables/images/sort_both.png') }') no-repeat center right !important;
                padding-right: 20px !important;
            }
            .sorting_asc {
                background: #f2f3f3 url('{!URLFOR($Resource.jQueryDataTablesZip, 'jQueryDataTables/images/sort_asc.png') }') no-repeat center right !important;
                padding-right: 20px !important;
            }
            .sorting_desc {
                background: #f2f3f3 url('{!URLFOR($Resource.jQueryDataTablesZip, 'jQueryDataTables/images/sort_desc.png') }') no-repeat center right !important;
                padding-right: 20px !important;
            }
            .sorting_asc_disabled {
                background: #f2f3f3 url('{!URLFOR($Resource.jQueryDataTablesZip, 'jQueryDataTables/images/sort_asc_disabled.png') }') no-repeat center right !important;
                padding-right: 20px !important;
            }
            .sorting_desc_disabled {
                background: #f2f3f3 url('{!URLFOR($Resource.jQueryDataTablesZip, 'jQueryDataTables/images/sort_desc_disabled.png') }') no-repeat center right !important;
                padding-right: 20px !important;
            }
            table.dataTable tr.odd { background-color: white; }
            table.dataTable tr.even { background-color: white; }
            table.dataTable tr.odd td.sorting_1 { background-color: white; }
            table.dataTable tr.odd td.sorting_2 { background-color: white; }
            table.dataTable tr.odd td.sorting_3 { background-color: white; }
            table.dataTable tr.even td.sorting_1 { background-color: white; }
            table.dataTable tr.even td.sorting_2 { background-color: white; }
            table.dataTable tr.even td.sorting_3 { background-color: white; }
            .dataTables_length, .dataTables_filter, .dataTables_info, .dataTables_paginate {
                padding: 3px;
            }
        </style>    
        <style>
           .colstyle {width:50%}
           .textsize {font-size: 8.5pt;}
           .ui-state-active {background-color: #87CEFA;}
           .col-height {height: 6px}
        </style>   
        <script type="text/javascript">
             function highlight(id){
             alert(id);
                 $(.id).css('background-color', 'black');
             } 
             
            function confirmDelete(){
                if(confirm('Are you sure you want to delete?'))
                    return true;
                return false;  
            }
            
            function dummyAlert(){
                Window.alert("Hello");
                return false;
            }
       </script> 
       <script> 
           var lastRow;
          function highlight(elem){
                if(lastRow != undefined){
                    lastRow.children[0].style.backgroundColor = 'white';
                    lastRow.style.backgroundColor = 'white';
                  }  
                elem.style.backgroundColor = '#B0E2FF';
                elem.children[0].style.backgroundColor = '#B0E2FF';
                lastRow = elem;
            }
    </script> 
        
    </head>
    
    <body class="textsize">
        <div class="container-fluid" id="mainContaniner">
        <apex:form >
            <apex:actionFunction name="getMembers" action="{!getTeamMembers}" rerender="members">
                <apex:param name="teamId" value="" assignTo="{!teamId}"/>
            </apex:actionFunction>
            <apex:actionFunction name="getAccounts" action="{!getTeamAccounts}" rerender="accounts">
                <apex:param name="teamId" value="" assignTo="{!teamId}"/>
            </apex:actionFunction>
            
            <apex:pageBlock id="teamDetails">
                <!-- <apex:panelGrid columns="2" style="margin-left:auto; margin-right:auto"> 
                    <apex:commandButton value="Create New Team" onClick="window.open('/apex/TSSupportTeamCreate', '_blank','height=400,width=800,left=100,top=100,scrollbars=yes,toolbar=no,status=no');" reRender="none" styleClass="btn btn-default"/>                            
                    <apex:commandButton value="Refresh" styleClass="btn btn-default" reRender="teamDetails"/>
                 </apex:panelGrid> -->
                 <br/> <br/>
                <apex:outputPanel style="overflow:scroll;height:100px;" layout="block">
                <span style="cursor:pointer;">             
                    <apex:pageBlockTable value="{!selectedTeamObjList}" var="t" styleClass="datatable table table-striped">   
                        <apex:column headerValue="Action" rendered="{!IF($Profile.Name =='System Administrator'||$Profile.Name =='Support - Tech Support Manager'||$Profile.Name =='Support - Tech Support Manager with Customer Notification', true , false)}">
                            <!--<a onclick="window.open('/apex/TSSupportTeamCreate?id={!t.Id}', '_blank','height=400,width=800,left=100,top=100,scrollbars=yes,toolbar=no,status=no');" class="text-primary">
                            Edit Team</a>-->
                            <div class="col-height">
                                <apex:outputLink onclick="window.open('/apex/TSSupportTeamCreate?id={!t.Id}', '_blank','height=400,width=800,left=100,top=100,scrollbars=yes,toolbar=no,status=no');">
                                    <apex:outputText value="Edit Team" styleClass="text-primary"/>
                                </apex:outputLink>
                            </div>
                        </apex:column>
                        <apex:column headerValue="Support Team Name"><!--onclick="getMembers('{!t.Id}');getAccounts('{!t.Id}');"-->
                            <div class="col-height">{!t.Team_Name__c}</div>
                        </apex:column>                        
                        <apex:column headerValue="Team Type">
                            <div class="col-height">{!t.Team_Type__c}</div>
                        </apex:column>
                        <apex:column headerValue="VDN">
                            <div class="col-height">{!t.VDN__c}</div>
                        </apex:column>
                        <apex:column headerValue="Last Modified By">
                            <div class="col-height">{!t.LastModifiedBy.Name}</div>
                        </apex:column>
                        <apex:column headerValue="Last Modified Date">
                            <div class="col-height">{!t.LastModifiedDate}</div>
                        </apex:column>                    
                    </apex:pageBlockTable> 
                    </span>
                </apex:outputPanel>
            </apex:pageBlock>   
            
            <apex:panelGrid columns="2" style="margin-left:auto; margin-right:auto;" id="memacc" width="100%" columnClasses="colstyle">
                <apex:pageblock title="Team Members" id="members">
                    <apex:panelGrid columns="1" style="margin-left:auto; margin-right:auto;"> 
                        <apex:commandButton value="New Team Member" onClick="window.open('/apex/TSTeamMemberEditDetail?teamid={!teamId}',
'_blank','height=400,width=1000,left=100,top=100,scrollbars=yes,toolbar=no,status=no');" reRender="none" onComplete="dummyAlert();" styleClass="btn btn-default" disabled="{!teamId==null}"/>                            
                    </apex:panelGrid><br/>
                    <apex:outputPanel style="overflow:scroll;height:300px;" layout="block">
                        <apex:pageBlockTable value="{!userList}" var="u" styleClass="membersdataTable table table-striped">
                            <apex:column headerValue="Action" rendered="{!IF($Profile.Name =='System Administrator'||$Profile.Name =='Support - Tech Support Manager'||$Profile.Name =='Support - Tech Support Manager with Customer Notification', true , false)}">
                                <div class="col-height">
                                    <apex:outputLink onclick="window.open('/apex/TSTeamMemberEditDetail?id={!u.Id}', '_blank','height=400,width=800,left=100,top=100,scrollbars=yes,toolbar=no,status=no'); return false;">
                                        <apex:outputText value="Edit" styleClass="text-primary"/>
                                    </apex:outputLink>&nbsp;|&nbsp;
                                    <!--<apex:outputLink value="{!URLFOR($Action.TS_TeamMember__c.Delete,u.Id,[retURL='/apex/TS_Support_Team_Detail?teamId={!teamId}'])}" onclick="return confirmDelete()">
                                        <apex:outputText value="Delete" styleClass="text-primary"/>    
                                    </apex:outputLink>-->                                
                                    <apex:commandLink action="{!deleteMember}" styleClass="text-primary" onclick="if(!confirm('Are you sure?')) return false;" rerender="members" oncomplete="bringBackSorter();">                                       
                                        <apex:outputText value="Delete" styleClass="text-primary"/>
                                        <apex:param value="{!u.Id}" name="idToDel" assignTo="{!toBeDelMember}"/>
                                    </apex:commandLink>
                                </div>
                            </apex:column>
                            <apex:column headerValue="Login">
                                <div class="col-height">{!u.Team_Member__r.alias}</div>
                            </apex:column>
                            <apex:column headerValue="First Name">
                                 <div class="col-height">{!u.Team_Member__r.FirstName}</div>
                             </apex:column>
                            <apex:column headerValue="Last Name">
                                <div class="col-height">{!u.Team_Member__r.LastName}</div>
                            </apex:column>
                            <apex:column headerValue="Role Type">
                                <div class="col-height">{!u.Role__c}</div>
                            </apex:column>                      
                        </apex:pageBlockTable>
                    </apex:outputPanel>
                </apex:pageblock>
                
                <apex:pageblock id="accounts" title="Accounts">
                    <apex:panelGrid columns="1" style="margin-left:auto; margin-right:auto;"> 
                        <apex:commandButton value="New Team Account" onClick="window.open('/apex/TSTeamAccountCreateDetail?teamid={!teamId}','_blank','height=400,width=1000,left=100,top=100,scrollbars=yes,toolbar=no,status=no');" reRender="none" styleClass="btn btn-default" disabled="{!teamId==null}"/>                            
                    </apex:panelGrid><br/>
                    <apex:outputPanel style="overflow:scroll;height:300px;" layout="block">
                        <apex:pageBlockTable value="{!accountList}" var="a" styleClass="membersdataTable table table-striped">
                            <apex:column headerValue="Action" rendered="{!IF($Profile.Name =='System Administrator'||$Profile.Name =='Support - Tech Support Manager'||$Profile.Name =='Support - Tech Support Manager with Customer Notification', true , false)}">
                                <div class="col-height">
                                    <apex:commandLink action="{!deleteAcc}" onclick="if(!confirm('Are you sure?')) return false;" rerender="accounts" styleClass="text-primary" oncomplete="bringBackSorter();">
                                        <apex:outputText value="Delete" styleClass="text-primary"/>
                                        <apex:param value="{!a.Id}" name="accidToDel" assignTo="{!toBeDelAcc}"/>
                                    </apex:commandLink>
                                </div>
                            </apex:column>                            
                            <apex:column headerValue="Account Name">
                                <div class="col-height">{!a.Team_Account__r.Name}</div>
                            </apex:column>
                            <apex:column headerValue="ERC">
                                <div class="col-height">{!a.Team_Account__r.ERC_Numeric__c}</div>
                            </apex:column>
                            <apex:column headerValue="Account Id">
                                <div class="col-height">{!a.Team_Account__r.AKAM_Account_ID__c}</div>
                            </apex:column>
                            <apex:column headerValue="Support Level">
                                <div class="col-height">{!a.Team_Account__r.Support_Level__c}</div>
                            </apex:column>
                            <apex:column headerValue="Customer Tier">
                                <div class="col-height">{!a.Team_Account__r.Customer_Tier__c}</div>
                            </apex:column>
                            <apex:column headerValue="Geography">
                                <div class="col-height">{!a.Team_Account__r.Geography_Formula__c}</div>
                            </apex:column>                           
                        </apex:pageBlockTable>
                    </apex:outputPanel>
                </apex:pageblock>
            </apex:panelGrid>
        </apex:form>        
        </div>   <!-- end of container-->
    </body>
    <script type="text/javascript" language="javascript" src="{!URLFOR($Resource.jQueryDataTablesZip, 'jQueryDataTables/js/jquery.js')}"></script>
    <script type="text/javascript" language="javascript" src="{!URLFOR($Resource.jQueryDataTablesZip, 'jQueryDataTables/js/jquery.dataTables.js')}"></script>
    <script type="text/javascript" language="javascript">
    var j$ = jQuery.noConflict();
    j$('table.dataTable').dataTable({
        sPaginationType: "full_numbers"
    });
    j$('table.membersdataTable').dataTable({
            //"sPaginationType": false,
            "paginate": false,
            "filter": false,
            "language": {
                "info": ""
             },
            "bredraw":true,
           "bDestroy": true
       });

    function bringBackSorter(){
 
       j$('table.membersdataTable').dataTable({
            //"sPaginationType": false,
            "paginate": false,
            "filter": false,
            "language": {
                "info": ""
             },
            "bredraw":true,
           "bDestroy": true
       });
       j$('table.accsdataTable').dataTable({
        //"sPaginationType": "full_numbers",
            "paginate": false,
            "filter": false,
            "language": {
                "info": ""
             },
            "bredraw":true,
           "bDestroy": true
        });
    } 
    </script>
</apex:page>