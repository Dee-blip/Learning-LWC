<!-- 
Description: Custom page for Escalation(previously Engagament Request)Creation,Edit and Clone page for External Team
Controller Class: SC_EscalationExtTeam_Ctrlr

Date                  Developer               JIRA #                  Description                                                       
------------------------------------------------------------------------------------------------------------------
17 May 2018      Vandhana Krishnamurthy        ESESP-319          OLAs for Escalation
07 Feb 2019		 Sumukh SS					   ESESP-1780		  Adding lightning console Support for VF page
-->

<apex:page standardcontroller="Engagement_Request__c" extensions="SC_EscalationExtTeam_Ctrlr" standardStylesheets="true">
    
    <apex:includeScript value="/support/console/43.0/integration.js" />
    <apex:includeScript value="{!$Resource.JQuery_New}" />
    <apex:includeScript value="{!URLFOR($Resource.AkapediaStaticResource,'/jquery.js')}" />
    <apex:includeScript value="{!URLFOR($Resource.AkapediaStaticResource,'/typeahead.bundle.min.js')}" />
     <!-- Checking to see if the page is opened in lightning theme -->
    <apex:variable var="isLightning" value="{! $User.UIThemeDisplayed == 'Theme4d' || $User.UIThemeDisplayed == 'Theme4u' }" />

    <apex:sectionHeader title="Escalation Edit" subtitle="{!if(escalation.Id == null, 'New Escalation', escalation.Name)}"/>
    <apex:form id="formId">
       <apex:pageBlock title="{!$ObjectType.Engagement_Request__c.Label} Information" mode="edit">
            
           <apex:pageBlockButtons location="top"> 
                <apex:actionStatus id="mySaveStatus">
                    <apex:facet name="stop">
                        <apex:outputPanel >
                            <apex:commandButton value="Save" action="{!Save}" rerender="msg" status="mySaveStatus"/>
                                                        <!--Classic Cancel Button -->
                            <apex:commandButton value="Cancel" action="{!cancel}" status="mySaveStatus" immediate="true" rendered="{!!isLightning}"/>
                            <!--Lightning Cancel Button -->
                            <apex:commandButton value="Cancel" status="mySaveStatus" immediate="true" rendered="{!isLightning}" onClick="Close_LC();"/>
                            
                        </apex:outputPanel>
                    </apex:facet>
                    <apex:facet name="start">
                        <apex:outputPanel >
                            <img src="/img/loading.gif" width="25" height="25" />
                        </apex:outputPanel>
                    </apex:facet>
                </apex:actionStatus>                          
            </apex:pageBlockButtons>   
           
           <apex:actionFunction name="quickSave" action="{!Save}" rerender="msg" status="mySaveStatus"/>
           
           <apex:actionFunction name="clearFields" action="{!clearValues}" reRender="section2,escArea"/>
           
           <apex:pageMessages id="msg"/>
           
           <apex:pageBlockSection >
               
               <apex:inputField id="escID" required="true" value="{!escalation.ID__c}"/>
               
               <apex:inputField id="escCase" value="{!escalation.Case__c}"/>
               
               <apex:pageBlockSectionItem >
                   <apex:outputLabel for="escSystem">System</apex:outputLabel>
                   <apex:actionRegion >
                       <apex:outputPanel styleClass="requiredInput" layout="block">
                           <apex:outputPanel styleClass="requiredBlock" layout="block"></apex:outputPanel>
                           <apex:selectList id="escSystem" required="true" multiselect="false" size="1" value="{!escalation.System__c}">
                               <apex:actionSupport oncomplete="clearFields();" immediate="false" event="onchange" reRender="section2,escArea" status="mySaveStatus"/>
                               <apex:selectOptions value="{!system}"></apex:selectOptions>
                           </apex:selectList>
                       </apex:outputPanel>
                   </apex:actionRegion>
               </apex:pageBlockSectionItem>
               
               <apex:outputField id="escRT" value="{!escalation.RecordTypeId}"/>
               
               <apex:pageBlockSectionItem >
                   <apex:outputLabel for="escArea">Area</apex:outputLabel>
                   <apex:outputPanel styleClass="requiredInput" layout="block">
                       <apex:outputPanel styleClass="requiredBlock" layout="block"></apex:outputPanel>
                       <apex:selectList id="escArea" multiselect="false" size="1" value="{!escalation.Area__c}">
                           <apex:selectOptions id="new1" value="{!area}"></apex:selectOptions>
                       </apex:selectList>
                   </apex:outputPanel>
               </apex:pageBlockSectionItem>
           </apex:pageBlockSection>
           
           <apex:pageBlockSection id="section2">
               <!--<apex:inputField value="{!escalation.Subject__c}" rendered="{!if(escalation.System__c != 'JIRA',true,false)}"/>-->
               <apex:inputField value="{!escalation.Subject__c}" rendered="{!if(UPPER(escalation.System__c) != 'JIRA',true,false)}"/>
               <apex:inputField value="{!escalation.Escalation_Owner__c}" rendered="{!if(UPPER(escalation.System__c) != 'JIRA',true,false)}"/>
               <apex:inputField value="{!escalation.Description__c}" style="height:100px;width:250px" rendered="{!if(UPPER(escalation.System__c) != 'JIRA',true,false)}"/>
               <apex:outputField value="{!escalation.Escalation_Created_Date__c}" rendered="{!if(UPPER(escalation.System__c) != 'JIRA',true,false)}"/>
               <apex:inputField value="{!escalation.ER_Severity__c}" rendered="{!if(UPPER(escalation.System__c) != 'JIRA',true,false)}"/>
               <apex:outputField value="{!escalation.Escalation_Created_By__c}" rendered="{!if(UPPER(escalation.System__c) != 'JIRA',true,false)}"/>
               <apex:inputField value="{!escalation.Request_Status__c}" rendered="{!if(UPPER(escalation.System__c) != 'JIRA',true,false)}"/>
               <apex:inputField value="{!escalation.Accepted_Date__c}" rendered="{!if(UPPER(escalation.System__c) != 'JIRA',true,false)}"/>
               <apex:outputField value="{!escalation.Escalation_TTR__c}" rendered="{!if(UPPER(escalation.System__c) != 'JIRA',true,false)}"/>
               <apex:outputField value="{!escalation.Escalation_Closed_Date__c}" rendered="{!if(UPPER(escalation.System__c) != 'JIRA',true,false)}"/>
               
           </apex:pageBlockSection>           
        </apex:pageBlock>
    </apex:form> 
        <script type="text/javascript">
    //Closing for lightning
    function Close_LC(){
            sforce.console.getEnclosingTabId(closeSubtab);
        }
        
        var closeSubtab = function closeSubtab(result) {
            var tabId = result.id;
            sforce.console.closeTab(tabId);
        };
    </script>
</apex:page>