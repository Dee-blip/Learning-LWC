<!-- VF Page  created For including the Flow in the Visual Force page along with the other  functionality in the flow-->
<!-- Created For the CR 2801973-->

<apex:page controller="opptyVFpageController" id="page" action="{!flowDetail}">

<!--<script>

alert('hi');
$j12 = jQuery.noConflict();
 alert('buttong');
  $j12(document).ready(function() { 
 $j12(document.getElementById("#page:flow:i:f:pb:pbb:next")).click(function(){
        alert('button');
   });
   });      

</script>-->
<Style>
    .p {
font-size: 20px;
}

</style>
 <div id ='flow'>   
<flow:interview name="Update_Renewal_Opportunity_as_Churn" interview="{!updateChurnFlow}" id="flow" buttonLocation="bottom" finishLocation="{!PageA}" rendered="{!IF(FlowName==$Label.Mark_Opportunity_as_Churn,true,false)}"  />
<flow:interview name="Changing_a_System_Generated_Opportunity_from_a_Churn" interview="{!SysGenOppToChurn}" id="flow2" buttonLocation="bottom" finishLocation="{!pageA}" rendered="{!IF(FlowName==$Label.System_Generated_Oppty_from_Churn,true,false)}"/>
  </div>

<apex:form id="form1" >
<apex:actionStatus id="Opportunitystatus">
    <apex:facet name="start">
    <c:enhancedActionStatus BackColor="#ffffff" borderColor="#ffffff" borderSize="2" height="50px" width="150px" ImageUrl="/changemgmt/img/spinner24.gif" Message="Loading..." messageStyle="color:darkred;font-size:11pt;font-weight:bold;"/>
    </apex:facet>   
    </apex:actionStatus>
<apex:pageMessages id="msg" escape="false"/>
    <apex:pageBlock rendered="{!IF(FlowName==$Label.not_having_auto_renewal_clause,true,false)}"> 
    <apex:outputText >
    <h1>Marking a Customer without an Auto-Renewal Clause as a Churn, AKA No Paper Churn.</h1><br/><br/>
    
•   To do this the Salesforce.com is populating the fields "Loss Category” with “Contract Ended”  and “Opportunity Sub-Category” with “Lost Customer”<br/>
•   There are some fields that require your review and update “Cancelation/Lost Reason” and “Competitor Primary”<br/>
•   Based on your some of the values you pick there may be some additional fields that you are required to populate.<br/>
•   Additionally you will need to review and update MRR on each product.<br/>
•   The field “Contract Ended No Paper” has been checked, this will allow Sales Operations to mark the opportunity as “Closed Contract Ended”<br/>
•   You will need to contact your Sales Operations team the month when the customer in leaving, so they can close the opportunity.  CMG will not process “No Paper” Churns.<br/><br/>
 </apex:outputText>
        <apex:pageBlockSection title="Opportunity" >
            <apex:pageBlockSectionItem >
                <apex:outputLabel value="Loss Category: " style="font-weight:bold"/>
                 <apex:outputText value="Contract Ended" />
                
            </apex:pageBlockSectionItem>
            
            
           <!-- <apex:pageBlockSectionItem >
                <apex:outputLabel value="Opportunity SubCategory: " style="font-weight:bold"/>
                <apex:selectList value="{!Subcategory}" multiselect="false" size="1" required="true">
                    <apex:selectOptions value="{!SubCategoriesOptions}"/>
                    <apex:actionSupport event="onchange" action="{!renderAggregateFlag}" reRender="form1"/>
                </apex:selectList>
            </apex:pageBlockSectionItem>-->
            
            <apex:pageBlockSectionItem >
                <apex:outputLabel value="Opportunity SubCategory: " style="font-weight:bold"/>
                   <apex:outputText value="Lost Customer" /> 
                </apex:pageBlockSectionItem>
            
       
            <apex:pageBlockSectionItem >
              <apex:outputLabel value="Contract Ended No Paper: " style="font-weight:bold"/>
              <Apex:outputText > True</Apex:outputText>
             </apex:pageBlockSectionItem>
        
           
            <apex:pageBlockSectionItem >
                 <apex:outputLabel value="Cancellation/Loss Reason: " style="font-weight:bold"/>
                 <apex:selectList value="{!lossReason}" multiselect="false" size="1"  id="a" required="true">
                     <apex:selectOptions value="{!LossOptions}"/>
                     <apex:actionSupport event="onchange" action="{!checkLossReason}" reRender="form1"/>
                 </apex:selectList>
           </apex:pageBlockSectionItem>
                
            
            <apex:pageBlockSectionItem >
                <apex:outputLabel value="Primary - Competititor :" style="font-weight:bold" />
                <apex:inputField value="{!oppty.Competitor__c}">
                    <!--<apex:actionSupport event="onchange" reRender="AggPartner"/>-->
                </apex:inputField>
            </apex:pageBlockSectionItem>
            
        
            
           <!--  <apex:pageBlockSectionItem rendered="{!AggregatePartnerFlag}" >
              <apex:outputLabel value="Aggregation Partner:" style="font-weight:bold; margin-left: 26px;font-size:11px"  />
                <apex:inputField value="{!oppty.Aggregation_Partner__c}"  / >
            </apex:pageBlockSectionitem>
             
             
            <apex:pageBlockSectionItem rendered="{!ConsolidationAccFlag}">
               <apex:outputLabel value="Consolidated Account:" style="font-weight:bold; margin-left: 26px;font-size:11px" />
                <apex:inputField value="{!oppty.Consolidation_Account__c}" style=" margin-left: 28px;"/ >
            </apex:pageBlockSectionItem>-->
            
            <apex:pageBlockSectionItem rendered="{!MissingFeatureFlag}" >
               <apex:outputLabel value="Missing Product Feature :" style="font-weight:bold; margin-left: 26px;font-size:11px"  />
                <apex:inputField value="{!oppty.Missing_Product_Feature__c}" style=" margin-left: 28px;"  / >
            </apex:pageBlockSectionItem> 
            
             <apex:pageBlockSectionItem rendered="{!UnAcceptableTermFlag}">
               <apex:outputLabel value="Unacceptable Term and Condition:" style="font-weight:bold; margin-left: 26px;font-size:11px" />
                <apex:inputField value="{!oppty.Unacceptable_Terms_and_Conditions__c}" style=" margin-left: 28px;"  / >
            </apex:pageBlockSectionItem>
           
           
           <apex:pageBlockSectionItem rendered="{!InitialOutClauseFlag}">
               <apex:outputLabel value="Initial Out Clause Description:" style="font-weight:bold" />
                <apex:inputField value="{!oppty.Initial_Out_Clause_Description__c}" style=" margin-left: 28px;"  / >
            </apex:pageBlockSectionItem>
        </apex:pageBlockSection>

       
       
    </apex:pageBlock>
    
    <apex:pageBlock id="PageBlock1" rendered="{!!flag}">
        <apex:pageBlockTable value="{!oliList}" var="oli">
            <apex:column headerValue="Product Name">
                <apex:outputText value="{!oli.PricebookEntry.Name}"/>
            </apex:column>
       <!--     <apex:column headerValue="Forecast Category">
                <apex:outputText value="{!oli.Forecast_Group__c}"/>
            </apex:column>  -->
             <apex:column headerValue="MRR" >
                 <apex:inputField value="{!oli.UnitPrice}"/>
             </apex:column>
            <apex:column headerValue="One Time Fee">
                <apex:inputField value="{!oli.NRR__c}"/>
            </apex:column>
        </apex:pageBlockTable>
        <apex:outputPanel rendered="{!VisualFlow6}" >
       <apex:commandButton value="Click to Update MRR  Values" action="{!SaveOli}" rerender="flow,form1"  status="Opportunitystatus"   />
         </apex:outputPanel>
         

        
      <!--<apex:commandButton value="Cancel" action="{!getPageA}"/>-->
    </apex:pageBlock>
    
    <apex:commandButton value="Click to Update Values" action="{!saveOLiAndOppty}" rerender="flow,msg"  status="Opportunitystatus" rendered="{!!VisualFlow6}" />
    <!--Sonali Tandon -CR 2841078 - Visual WF 4.2: Add Opportunity product-->
         <apex:commandButton value="Add Product" action="{!opptyProdRedirect}" rerender="flow,form1" status="Opportunitystatus" rendered="{!IF(FlowName==$Label.System_Generated_Oppty_from_Churn,true,false)}" />
    

     
  </apex:form>  
 
</apex:page>