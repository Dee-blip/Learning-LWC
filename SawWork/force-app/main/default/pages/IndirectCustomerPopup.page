<apex:page standardController="Case" extensions="IndirectCustomerPopupController" showChat="false" showHeader="false" sidebar="false" lightningStylesheets="true">
<apex:includeScript value="/support/console/28.0/integration.js"/>
  <script>
  var tabId;
      function closeWindow() {
        sforce.console.getFocusedPrimaryTabId(showTabId);
      }
      var showTabId = function showTabId(result) {
        tabId = result.id;
        sforce.console.openPrimaryTab(tabId, ['/{!Case.Id}'], true); 
      };
    
    function closePage()
    {
        console.log('HERE HERE');
        window.open('/{!Case.Id}','_self');
    }
  </script>
 
  <apex:form >
      <apex:pageBlock >
        
        <apex:outputpanel >
            <apex:actionstatus id="goStatus">
                <apex:facet name="start">
                    <div class="waitingSearchDiv"
                        style="background-color: #fbfbfb; height: 100%; opacity: 0.65; width: 100%;position:fixed;z-index:1000;">
                    <div class="waitingHolder" style="top: 50%; width: 91px; position: fixed;z-index: 1001; left: 50%;">
                    <img class="waitingImage" src="/img/loading.gif"
                        title="Please Wait.." /> <span class="waitingDescription">Loading..</span>
                    </div>
                    </div>
                </apex:facet>
            </apex:actionstatus>
        </apex:outputpanel>
        <apex:outputPanel id="outerPanel">
        <apex:pageMessages ></apex:pageMessages>
        <apex:outputPanel rendered="{!closeWin}">
        <script>
            closeWindow('/{!Case.Id}');
        </script>
        </apex:outputPanel>
        </apex:outputPanel>
        <apex:pageBlockTable value="{!contractList}" var="contract" rendered="{!contractList.size != 0}">
        <apex:column headerValue="Action">
            <apex:commandButton value="Select" action="{!selectIndirectCustomer}" status="goStatus" oncomplete="closePage();">
                <apex:param name="accId" value="{!contract.Account_Name__r.Id}" assignTo="{!indirectCustomerId}"/>
            </apex:commandButton>
        </apex:column>
        <apex:column value="{!contract.Account_Name__r.Name}" />
        <apex:column value="{!contract.Account_Name__r.Account_Status__c}" />
        <apex:column value="{!contract.Account_Name__r.Owner.Name}" headerValue="Owner"/>
        <apex:column value="{!contract.Account_Name__r.BillingStreet}" />
        <apex:column value="{!contract.Account_Name__r.BillingCity}" />
        <apex:column value="{!contract.Account_Name__r.BillingState}" />
        <apex:column value="{!contract.Account_Name__r.BillingCountry}" />
        </apex:pageBlockTable>
        <apex:outputpanel rendered="{!contractList.size == 0}">
        No Records Found!<br/>
        </apex:outputpanel>
         <apex:commandButton value="Cancel" action="{!cancel}" immediate="true"   style="margin-top:10px;font-weight:bold;font-size:10pt;"
/>
      </apex:pageBlock>
  </apex:form>
  
</apex:page>