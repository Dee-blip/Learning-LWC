<apex:page docType="html-5.0" showHeader="true" Controller="HD_SRM_ServiceRequest_Extension"  sidebar="false" id="apexpageid" cache="true"  applyBodyTag="true" applyHtmlTag="true">

<!----- Applying Stylesheets---->
<!-- Latest compiled and minified CSS -->
<apex:stylesheet value="{!URLFOR($Resource.HDscriptcss,'/bootstrapV3_3_0/css/bootstrap.min.css')}"/>
<style>
      html, body, #map-canvas {
        height: 100%;
        margin: 0px;
        padding: 0px
      }
      #panel {
        position: absolute;
        top: 5px;
        left: 50%;
        margin-left: -180px;
        z-index: 5;
        background-color: #fff;
        padding: 5px;
        border: 1px solid #999;
      }
      .close-glyphicon
      {
      position:relative;
      top: -5px !important;
      right: -12px !important;
      }
      
      #map-canvas{
      height: 450px;
      }
      /* changing the height of tab */
      .nav > li > a{ padding: 6px 15px; }
      
     /* tab color */
    .nav-tabs>li>a {
     border-color: #777777;
     border: 1px solid #ccc;
     margin-right: -14px;
     
     background: #feffff; /* Old browsers */
     background: -moz-linear-gradient(top,  #feffff 0%, #ddf1f9 35%, #a0d8ef 100%); /* FF3.6+ */    
     background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#feffff), color-stop(35%,#ddf1f9), color-stop(100%,#a0d8ef)); /* Chrome,Safari4+ */
     background: -webkit-linear-gradient(top,  #feffff 0%,#ddf1f9 35%,#a0d8ef 100%); /* Chrome10+,Safari5.1+ */
     background: -o-linear-gradient(top,  #feffff 0%,#ddf1f9 35%,#a0d8ef 100%); /* Opera 11.10+ */
     background: -ms-linear-gradient(top,  #feffff 0%,#ddf1f9 35%,#a0d8ef 100%); /* IE10+ */
     background: linear-gradient(to bottom,  #feffff 0%,#ddf1f9 35%,#a0d8ef 100%); /* W3C */
     filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#feffff', endColorstr='#a0d8ef',GradientType=0 ); /* IE6-9 */
                   }
     /* tabcolor active */
         .nav-tabs>li.active>a 
         {  
              border: 1px solid #6495ED;
         }            

/* header rearrangment*/
 table#apexpageid:srmpageblock:srmpageblocktable>thead>tr>th {background-color:red;}
 .table > tbody > tr > td{padding: 4px; line-height: 1.429;font-size:12px;font-family: Arial,Helvetica,sans-serif; }

     </style>
    
    
    <hr></hr>

 <div class="container-fluid">
    <div class="row">
    <div class="col-md-4">
    </div>
    <div class="col-md-2"></div><div class="col-md-2"></div><div class="col-md-2"></div><div class="col-md-2"></div></div>
</div>
<ul class="nav nav-tabs red" role="tablist" id="myTab">
  <li class="active"><a class="" data-toggle="dropdown" href="#srm">Service requests</a>
   </li>
  <li class=""><a href="#help">Help</a></li>
 </ul>

<!-- Tab panes -->
<div class="tab-content">
  <div class="tab-pane active" id="srm">
 <!-- Start of adding list here -->
 <apex:pageBlock id="srmpageblock">
<apex:form id="srmform">
<apex:actionRegion > 
<button type="button" class="btn btn-default btn-lg"  onClick="addTabnewServiceRequest('new');"><span class="glyphicon glyphicon-file"></span> Create New Request</button>&nbsp;

<apex:outputLabel value="Views : "></apex:outputLabel>&nbsp;
<apex:selectList multiselect="false"  size="1" id="srmviews" value="{!FilterId}">
<apex:selectOption itemValue="" itemLabel="Recent"></apex:selectOption>
<apex:selectOptions value="{!IncidentListViews}"></apex:selectOptions>
<apex:actionSupport event="onchange" reRender="srmpageblocktable,pagenumber,pagecount,recordsummary" status="status" action="{!reset}"/>
</apex:selectList>
&nbsp;
<apex:outputLabel value="Records : "></apex:outputLabel>&nbsp;
<apex:selectList multiselect="false"  size="1" id="srmviewssize" value="{!srmviewssize}">
<apex:selectOption itemValue="5" itemLabel="5" ></apex:selectOption>
<apex:selectOption itemValue="10" itemLabel="10"></apex:selectOption>
<apex:selectOption itemValue="20" itemLabel="20" ></apex:selectOption>
<apex:selectOption itemValue="40" itemLabel="40"></apex:selectOption>
<apex:selectOption itemValue="60" itemLabel="60"></apex:selectOption>
<apex:selectOption itemValue="70" itemLabel="70"></apex:selectOption>
<apex:selectOption itemValue="80" itemLabel="80"></apex:selectOption>
<apex:selectOption itemValue="100" itemLabel="100"></apex:selectOption>
<apex:selectOption itemValue="200" itemLabel="200"></apex:selectOption>
<apex:actionSupport event="onchange" reRender="srmpageblocktable,pagecount,recordsummary" status="status"/>
</apex:selectList>&nbsp;
<apex:outputLabel value="Page : "></apex:outputLabel>&nbsp;
<apex:input id="pagenumber" value="{!page_number}" size="2"><apex:actionSupport event="onchange" reRender="srmpageblocktable,recordsummary" status="status"/></apex:input>&nbsp; <span id="pageof">Of</span> &nbsp;<apex:outputText id="pagecount" value="{!number_of_pages}"></apex:outputText>&nbsp;
<apex:commandLink styleClass="glyphicon glyphicon-chevron-left" title="Previous" action="{!previousbutton}" reRender="srmpageblocktable,pagenumber" id="leftpage" status="status"/>
<span class="glyphicon glyphicon-minus"></span>&nbsp;
<apex:commandLink styleClass="glyphicon glyphicon-chevron-right" title="Next" action="{!nextbutton}" reRender="srmpageblocktable,pagenumber" id="rightpage" status="status"/>&nbsp;&nbsp;
<apex:commandLink styleClass="glyphicon glyphicon-refresh" title="Next" action="{!refreshButton}" reRender="srmpageblocktable,pagenumber,recordsummary" id="reloadbutton" status="status"/>&nbsp;&nbsp;
<apex:actionPoller action="{!refreshButton}" reRender="srmpageblocktable,pagenumber,recordsummary" interval="60" status="status" enabled="true"/>
<apex:actionStatus id="status" startText="Loading..." onstop="sorttable();">
<apex:facet name="start"><img src="{!URLFOR($Resource.HDscriptcss,'ajax-loader.gif')}" width="25"></img></apex:facet>
</apex:actionStatus>
<apex:commandLink id="removebtn" action="{!emptySearchString}" styleClass="btn btn-default btn-lg pull-right" reRender="srmpageblocktable,recordsummary,recordsummary"  status="status"><span class="glyphicon glyphicon-remove-circle" aria-hidden="true"></span></apex:commandLink>
<apex:commandLink id="searchbtn" styleClass="btn btn-default btn-lg pull-right" reRender="srmpageblocktable,recordsummary,recordsummary" status="status"><span class="glyphicon glyphicon-search" aria-hidden="true"></span></apex:commandLink>
<apex:input id="searchString" value="{!Search_String}" size="25" styleClass="pull-right"><!--apex:actionSupport event="onchange" reRender="srmpageblocktable,recordsummary,recordsummary" status="status" /--></apex:input>
</apex:actionRegion>
</apex:form>
<br/>
<apex:pageblockTable value="{!SrmList}" var="srm" id="srmpageblocktable" rows="{!srmviewssize}" styleClass="table table-bordered" headerClass="header" style="font-size:0.9em;" >
<apex:column style="color:red;">
<apex:facet name="header">
<apex:outputText styleClass="header" value="Service Request #"><span class='glyphicon glyphicon-resize-vertical'></span></apex:outputText>
</apex:facet>
<a href="#" style="color:#015BA7" onclick="addTab('{!srm.Name}','{!srm.Id}');">{!srm.Name}</a>
</apex:column>

<apex:repeat value="{!$ObjectType.BMCServiceDesk__Incident__c.FieldSets.HD_Service_Request_table_column}" var="srmtablecolumn">
<apex:column >
<apex:facet name="header">
<apex:outputText styleClass="header" value="{!srmtablecolumn.Label}"><span class='glyphicon glyphicon-resize-vertical'></span></apex:outputText>
</apex:facet>
<apex:outputField value="{!srm[srmtablecolumn]}"></apex:outputField>
</apex:column>
</apex:repeat>
</apex:pageblockTable>
<apex:outputLabel value="Total Records : " id="recordsummary">{!Total_records}</apex:outputLabel>&nbsp;
</apex:pageBlock>
 <!-- END of adding list here -->
  
</div>


<div class="tab-pane" id="help"><apex:iframe src="{!URLFOR($Resource.BMCServiceDesk__StdFormHelp, '/wwhelp/wwhimpl/common/html/wwhelp.htm?context=BMC_Remedyforce_help&file=incident_console_list.htm')}"/></div>
</div>



<!-- Latest compiled and minified JavaScript -->
<apex:includeScript value="{!URLFOR($Resource.HDscriptcss,'/jquery-2.1.1.min.js')}" loadOnReady="false"/>
<apex:includeScript value="{!URLFOR($Resource.HDscriptcss,'/bootstrapV3_3_0/js/bootstrap.min.js')}" loadOnReady="false"/>
<apex:includeScript value="{!URLFOR($Resource.HDscriptcss,'/jquery.tablesorter.js')}" loadOnReady="false"/>
<script type="text/javascript">
var $j = jQuery.noConflict();
$j(document).ready(function(){
$j('#myTab a').click(function (e) {
  e.preventDefault()
  $j(this).tab('show')
})

$j(window).keydown(function(event){
    if(event.keyCode == 13) {
      event.preventDefault();
      return false;
    }
  });
  
//calling jquery sortable
sorttable();

  
//popupover functionality
$j('#popover_totalresult').mouseover(function(){$j(this).popover('show','auto');});

//disabling few elements
disableElements();

//remove the string from the search field
$j("[id$=removebtn]").click(function(){
$j("[id$=searchString]").val('');
$j("[id$=srmviews]").prop('disabled', ''); $j("[id$=pagenumber]").prop('disabled', '');$j("[id$=pagecount]").css({'text-decoration':'none'});$j("[id$=pageof]").css({'text-decoration':'none'});$j("[id$=pagenumber]").css({'text-decoration':'none'});
});

//calling auto tab open
gettabQueryVariable('name','recordid');


});//document.ready

//function to enable tablesorter
function sorttable()
{
console.log('sorttable() Method called');
$j("[id$=srmpageblocktable]").tablesorter({cssAsc:"",cssDesc:"",sortList: [[0,1]]}); 
}

//remove the search string from input field and refresh the view
function removeSearchString()
{


}//function removeSearchString()

//disable view select List
function disableElements()
{
$j("[id$=searchString]").prop('placeholder','Search...');

//Conditional disabler for Search
$j("[id$=searchString]").change(function(){ 
var search_fieldvalue = $j("[id$=searchString]").val();
if( search_fieldvalue.length > 1)
{
$j(this).css({'text-decoration':'none'});
$j("[id$=pagenumber]").prop('disabled', 'disabled');
$j("[id$=srmviews]").prop('disabled', 'disabled');
$j("[id$=pagecount]").css({'text-decoration':'line-through'});
$j("[id$=pageof]").css({'text-decoration':'line-through'});
$j("[id$=pagenumber]").css({'text-decoration':'line-through'});
}
else { $j("[id$=srmviews]").prop('disabled', ''); $j("[id$=pagenumber]").prop('disabled', '');$j("[id$=pagecount]").css({'text-decoration':'none'});$j("[id$=pageof]").css({'text-decoration':'none'});$j("[id$=pagenumber]").css({'text-decoration':'none'});}
});

}//function disableElements()

//this function will disable most of the element in pagination 
function disableElementwhileautorefresh()
{
$j(this).css({'text-decoration':'none'});
$j("[id$=pagenumber]").prop('disabled', 'disabled');
$j("[id$=srmviews]").prop('disabled', 'disabled');
$j("[id$=pagecount]").css({'text-decoration':'line-through'});
$j("[id$=pageof]").css({'text-decoration':'line-through'});
$j("[id$=pagenumber]").css({'text-decoration':'line-through'});
}//disableElementwhileautorefresh()


//this fnction will add tab
function addTab(name,id){
var div_id = '#'+name;
//alert(''+$j(div_id).length);
if($j(div_id).length <= 0 )
{
$j("#myTab").append('<li class=""><a href="#'+name+'">#'+name+'&nbsp;<span id="'+name+'sp" class="glyphicon glyphicon-remove close-glyphicon" title="Close"></span></a></li>');
$j(".tab-content").append('<div class="tab-pane" id="'+name+'"><iframe height="800px" id="theIframe" name="theIframe" src="/apex/ServiceRequestdetail?id='+id+'&isdtp=vw" width="100%" frameBorder="0"></iframe></div>');

}//if

$j('#myTab a').click(function (e) {
  e.preventDefault();
  $j(this).tab('show');
})

// adding tooltip 
$j('#myTab li a span').mouseover(function(){ $j(this).tooltip('show');});
//this line removes tab in the page 
$j('#myTab li a span').click(function(e){
e.preventDefault();
var targettabId = $j(this).attr('id').replace('sp','');
$j(".tab-content #"+targettabId).remove();
$j(this).closest('li').remove();
if($j(this).closest('li').hasClass("active"))
{
$j('#myTab li a:first').tab('show');
}//if($j(this).closest('li').hasClass())

});

}//function addTab(name,id)

//this fnction will add tab
function addTabnewServiceRequest(name){
var div_id = '#'+name;
if($j(div_id).length <= 0 )
{
$j("#myTab").append('<li class="" id="'+name+'tab"><a href="#'+name+'">'+name+'&nbsp;<span id="'+name+'sp" class="glyphicon glyphicon-remove close-glyphicon" title="Close"></span></a></li>');
$j(".tab-content").append('<div class="tab-pane" id="'+name+'"><iframe height="800px" id="theIframe" name="theIframe" src="/apex/ServiceRequestCreate" width="100%" frameBorder="0"></iframe></div>');

}//if

$j('#myTab a').click(function (e) {
  e.preventDefault()
  $j(this).tab('show')
})

// adding tooltip 
$j('#myTab li a span').mouseover(function(){ $j(this).tooltip('show');});
//adding focus on new tab
$j('#myTab li#newtab a').tab('show');


//this line removes tab in the page 
$j('#myTab li a span').click(function(e){
e.preventDefault();
var targettabId = $j(this).attr('id').replace('sp','');
$j(".tab-content #"+targettabId).remove()
$j(this).closest('li').remove();
if($j(this).closest('li').hasClass("active"))
{
$j('#myTab li a:first').tab('show');
}//if($j(this).closest('li').hasClass())
});

}//function addTabnewServiceRequest(name)

//focusing on new tab now
$j('#myTab #newtab').tab('show');


//javascript to prevent Enter Key pressing
function stopRKey(evt) { 
  var evt = (evt) ? evt : ((event) ? event : null); 
  var node = (evt.target) ? evt.target : ((evt.srcElement) ? evt.srcElement : null); 
  if ((evt.keyCode == 13) && (node.type=="text"))  {return false;} 
} 

//activating javascript Enter stop
document.onkeypress = stopRKey; 

//javascript for auto tab open
function gettabQueryVariable(name,recordid)
{
  var varname = '';
  var varrecordid = '';
  
  var query = window.location.search.substring(1);
  var vars = query.split("&");
  for (var i=0;i<vars.length;i++) 
  {
    var pair = vars[i].split("=");
    if ( pair[0] == name ) 
    {
      varname = pair[1];   
    }
    if ( pair[0] == recordid )
    {
      varrecordid = pair[1];  
    }
    if( varname && varrecordid )
    {
      console.log('Query Variable  values name=' + varname + ' and recordis='+ varrecordid +' found');
      addTab(varname,varrecordid);
      $j('#myTab a').tab('show');
      return true;
    }    
  }//for 
  console.log('Query parameter Variable ' + name + ' and '+ recordid +' not found');
  return 'false';
}


</script>
</apex:page>