<apex:page id="ProductSkillListPage" standardController="TS_Product_Skill__c" extensions="TSProductSkillListExtension" recordSetVar="newSkills" sidebar="false" standardStylesheets="true" showHeader="false">
    <head>
        <apex:includeScript value="{!URLFOR($Resource.JQuery111, 'jquery-1.11.2/dist/jquery.min.js')}"/>
        <apex:includeScript value="{!URLFOR($Resource.JQueryUI111, 'jquery-ui.min.js')}"/>
        
        <apex:includeScript value="{!URLFOR($Resource.bootstrap3, 'dist/js/bootstrap.js')}"/>
        <apex:includeScript value="{!URLFOR($Resource.bootstrap3, 'dist/js/bootstrap.min.js')}"/>
        
        <apex:stylesheet value="{!URLFOR($Resource.bootstrap3, 'dist/css/bootstrap.css')}"/>
        <apex:stylesheet value="{!URLFOR($Resource.bootstrap3, 'dist/css/bootstrap.min.css')}"/>
        
        <apex:stylesheet value="{!URLFOR($Resource.jQueryDataTablesZip, 'jQueryDataTables/css/jquery.dataTables.css')}"/>
        
         <style type="text/css">            
        
            .sorting {
                background: #f2f3f3 url('{!URLFOR($Resource.jQueryDataTablesZip, 'jQueryDataTables/images/sort_both.png') }') no-repeat center right !important;
                padding-right: 20px !important;
            }
            .sorting_asc {
                background: #f2f3f3 url('{!URLFOR($Resource.jQueryDataTablesZip, 'jQueryDataTables/images/sort_asc.png') }') no-repeat center right !important;
                padding-right: 20px !important;
            }
            .sorting_desc {
                background: #f2f3f3 url('{!URLFOR($Resource.jQueryDataTablesZip, 'jQueryDataTables/images/sort_desc.png') }') no-repeat center right !important;
                padding-right: 20px !important;
            }
            .sorting_asc_disabled {
                background: #f2f3f3 url('{!URLFOR($Resource.jQueryDataTablesZip, 'jQueryDataTables/images/sort_asc_disabled.png') }') no-repeat center right !important;
                padding-right: 20px !important;
            }
            .sorting_desc_disabled {
                background: #f2f3f3 url('{!URLFOR($Resource.jQueryDataTablesZip, 'jQueryDataTables/images/sort_desc_disabled.png') }') no-repeat center right !important;
                padding-right: 20px !important;
            }
            table.dataTable tr.odd { background-color: white; }
            table.dataTable tr.even { background-color: white; }
            table.dataTable tr.odd td.sorting_1 { background-color: white; }
            table.dataTable tr.odd td.sorting_2 { background-color: white; }
            table.dataTable tr.odd td.sorting_3 { background-color: white; }
            table.dataTable tr.even td.sorting_1 { background-color: white; }
            table.dataTable tr.even td.sorting_2 { background-color: white; }
            table.dataTable tr.even td.sorting_3 { background-color: white; }
            .dataTables_length, .dataTables_filter, .dataTables_info, .dataTables_paginate {
                padding: 3px;
            }
        </style>
        <style>
           .textsize {font-size: 8.5pt;}
           .skill-col-height {height: auto;}
           .col-height {height: auto} 
           table.dataTable tbody th, table.dataTable tbody td {
                    padding: 8px 10px 0px 6px;}
           .col1 {width:200px;height:300px}
           .col2 {width:600px;height:300px }
        </style> 
        <script type="text/javascript">
            function CloseAndRefresh(){
            window.opener.location.href="/{!$CurrentPage.parameters.id}";
                  window.top.close();
                
          }
          
          $( document ).ready(function() {
                console.log('document ready');
                $("#ProductSkillListPage\\:form\\:skillsId\\:skillsTable\\:tb tr:eq(0) ").click();                
                $("#ProductSkillListPage\\:form\\:skillsId\\:skillsTable\\:0\\:skillName").click();
             });
          
          var lastRow;
          function highlight(elem){
                if(lastRow != undefined){
                    lastRow.children[0].style.backgroundColor = 'white';
                    lastRow.style.backgroundColor = 'white';
                  }  
                elem.style.backgroundColor = '#B0E2FF';
                elem.children[0].style.backgroundColor = '#B0E2FF';
                lastRow = elem;
            }
            
            function confirmDelete(){
                if(confirm('Are you sure you want to delete?'))
                    return true;
                return false;  
            }

            function openNewSkillMemberPopup(){
                var skillId = document.getElementById('{!$Component.form.paramSkill}').value;
                var new_window = window.open("/apex/TSProductMemberCreate?skillid="+skillId,'_blank','height=400,width=1000,left=100,top=100,scrollbars=yes,toolbar=no,status=no');
                new_window.onbeforeunload = function(){getMembers(skillId);}
            }

            function openEditSkillMemberPopup(member){
                var skillId = document.getElementById('{!$Component.form.paramSkill}').value;
                var new_window = window.open("/apex/TSProductMemberCreate?id="+member+"&act=Edit",'_blank','height=400,width=1000,left=100,top=100,scrollbars=yes,toolbar=no,status=no');
                new_window.onbeforeunload = function(){getMembers(skillId);}
            }

        </script>
    </head>
    
    <body class="textsize">
        <div class="container-fluid">        
        <apex:form id="form">
            <apex:actionFunction name="getMembers" action="{!getSkillMembers}" rerender="members,paramSkill" oncomplete="bringBackSorter(); return false;">
                <apex:param name="skillId" value="" assignTo="{!skillId}"/>
            </apex:actionFunction>
            <!--apex:actionPoller action="{!getSkillMembersPoll}" rerender="members" oncomplete="return false;" interval="5"/-->
            <apex:actionFunction name="refresh" action="{!refresh}" />
            <!--<apex:panelGrid columns="2" columnClasses="col1,col2" width="100%">  -->
                <apex:pageBlock title="Skills" id="skillsId">
                    <apex:panelGrid columns="2" style="margin-left:auto; margin-right:auto"> 
                        <apex:commandButton value="Create New ACD Skill" rendered="{!isRendered}" rerender="none" onClick="window.open('/apex/TSProductSkillCreate','_blank','height=300,width=600,left=100,top=100,scrollbars=yes,toolbar=no,status=no');" styleClass="btn btn-default"/>
                        <apex:commandButton value="Refresh" styleClass="btn btn-default" onclick="refresh();" rerender="skillsId"/>                        
                    </apex:panelGrid>
                        <!--<apex:outputPanel style="overflow:scroll;height:225px;" layout="block">-->
                            <span style="cursor:pointer;">
                            <apex:pageBlockTable id="skillsTable" value="{!skills}" var="s" styleClass="dataTable table table-striped" onRowClick="highlight(this);">
                                <apex:column headerValue="Action" rendered="{!isRendered}" style="width:10%">
                                    <div class="skill-col-height">
                                        <apex:outputLink onclick="window.open('/apex/TSProductSkillCreate?id={!s.Id}', '_blank','height=400,width=800,left=100,top=100,scrollbars=yes,toolbar=no,status=no'); return false;">
                                            <apex:outputText value="Edit Skill" styleClass="text-primary"/>
                                        </apex:outputLink>&nbsp;|&nbsp;
                                        <apex:outputLink value="{!URLFOR($Action.TS_Product_Skill__c.Delete,s.Id,[retURL='/apex/TSProductSkillList'])}" onclick="return confirmDelete()">
                                            <apex:outputText value="Delete" styleClass="text-primary"/>    
                                        </apex:outputLink>
                                    </div>       
                                </apex:column>   
                                <apex:column id="skillName" headerValue="ACD Skill Name" styleClass="col-height" onclick="getMembers('{!s.Id}');" style="width:15%">
                                    <div class="skill-col-height">{!s.Product_Skill_Name__c}</div>
                                </apex:column>  
                                <apex:column headerValue="Description" styleClass="col-height" onclick="getMembers('{!s.Id}');">
                                    <div class="skill-col-height">{!s.Description__c}</div>
                                </apex:column>                 
                            </apex:pageBlockTable>
                            </span>                 
                        <!--</apex:outputPanel>  -->             
                </apex:pageBlock>   
                <apex:inputHidden id="paramSkill" value="{!skillId}"/>
                <!--<apex:outputPanel style="overflow:scroll;height:650px;width:960px" layout="block">-->
                <apex:pageblock title="Skill Members: {!skillName}" id="members">
                        <apex:panelGrid columns="1" style="margin-left:auto; margin-right:auto"> 
                            <apex:commandButton value="New Skill Member" rendered="{!IF($Profile.Name =='System Administrator'||$Profile.Name =='Support - Tech Support Manager'||$Profile.Name =='Support - Tech Support Manager with Customer Notification', true , false)}" rerender="none" onClick="openNewSkillMemberPopup();" styleClass="btn btn-default" disabled="{!skillId==null}"/>  
                        </apex:panelGrid>
                            <apex:outputPanel style="overflow:scroll;height:300px" layout="block">
                            <apex:pageBlockTable value="{!userList}" var="u" styleClass="skillMembersDataTable table table-striped">
                                <apex:column headerValue="Action" rendered="{!IF($Profile.Name =='System Administrator'||$Profile.Name =='Support - Tech Support Manager'||$Profile.Name =='Support - Tech Support Manager with Customer Notification', true , false)}">
                                    <div class="col-height">
                                        <!--apex:outputLink onclick="window.open('/apex/TSProductMemberCreate?id={!u.Id}','_blank','height=400,width=1000,left=100,top=100,scrollbars=yes,toolbar=no,status=no');">
                                            <apex:outputText value="Edit" styleClass="text-primary"/>
                                        </apex:outputLink-->
                                        <apex:commandLink onclick="openEditSkillMemberPopup('{!u.Id}'); return false;" rerender="none">
                                            <apex:outputText value="Edit" styleClass="text-primary"/>
                                        </apex:commandLink>&nbsp;|&nbsp;
                                        <!--apex:outputLink value="{!URLFOR($Action.TS_ProductMember__c.Delete, u.Id,[retURL='/apex/TSProductSkillList'])}" onclick="return confirmDelete()">
                                            <apex:outputText value="Delete" styleClass="text-primary"/>
                                        </apex:outputLink-->
                                        <apex:commandLink action="{!deleteMember}" styleClass="text-primary" onclick="if(!confirm('Are you sure?')) return false;" rerender="members" onComplete="bringBackSorter();">                                       
                                            <apex:outputText value="Delete" styleClass="text-primary"/>
                                            <apex:param value="{!u.Id}" name="idToDel" assignTo="{!toBeDelMember}"/>
                                        </apex:commandLink>
                                    </div>
                                </apex:column>
                                <apex:column headerValue="Login"> 
                                    <div class="col-height">{!u.ProductMember__r.alias}</div>
                                </apex:column>                            
                                <apex:column headerValue="First Name">
                                    <div class="col-height">{!u.ProductMember__r.FirstName}</div>
                                </apex:column>
                                <apex:column headerValue="Last Name">
                                    <div class="col-height">{!u.ProductMember__r.LastName}</div>
                                </apex:column>
                                <apex:column headerValue="Email">    
                                    <div class="col-height">
                                        <apex:outputLink style="color:#428bca" value="mailto:{!u.ProductMember__r.Email}">{!u.ProductMember__r.Email}</apex:outputLink>    
                                    </div>
                                </apex:column>
                                <apex:column headerValue="ACD Agent ID">
                                    <div class="col-height">{!u.ProductMember__r.ACD_Agent_ID__c}</div>
                                </apex:column>
                                <apex:column headerValue="Routing Order">
                                    <div class="col-height">{!u.Skill_Level__c}</div>
                                </apex:column>
                                <apex:column headerValue="HR Manager">
                                    <div class="col-height">{!u.ProductMember__r.Manager.Name}</div>
                                </apex:column>
                                <apex:column headerValue="Office Location">
                                    <div class="col-height">{!u.ProductMember__r.Office_Location__c}</div>
                                </apex:column>
                                <apex:column headerValue="Owner Shift">
                                    <div class="col-height">{!u.ProductMember__r.Shift__c}</div>
                                </apex:column>
                                <apex:column headervalue="Team">
                                    <div class="col-height">{!u.ProductMember__r.Team__c}</div>
                                </apex:column>
                            </apex:pageBlockTable>
                        </apex:outputPanel>
                    </apex:pageblock>
                   <!-- </apex:outputPanel> -->
                <!--</apex:panelGrid>-->
        </apex:form>
        </div>   <!-- end of container-->
    </body>
     <script type="text/javascript" language="javascript" src="{!URLFOR($Resource.jQueryDataTablesZip, 'jQueryDataTables/js/jquery.js')}"></script>
    <script type="text/javascript" language="javascript" src="{!URLFOR($Resource.jQueryDataTablesZip, 'jQueryDataTables/js/jquery.dataTables.js')}"></script>
    <script type="text/javascript" language="javascript">
    var j$ = jQuery.noConflict();
    j$('table.dataTable').dataTable({
        aaSorting: [],
        sPaginationType: "full_numbers"
    });
    function bringBackSorter(){
        j$('table.skillMembersDataTable').dataTable({
                        "sPaginationType": "full_numbers",
            "bredraw":true,
            "bDestroy": true            
        
        });
        
    }
    </script>
</apex:page>