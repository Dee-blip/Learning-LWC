<apex:page standardcontroller="Case" extensions="SuggestedServiceIncidentsController" standardStylesheets="false" showHeader="false" sidebar="false">
	    <!-- Include css and js files for Bootstrap-->
<!--    <script src="/jqueryui/1.9.0/jquery-ui.min.js"></script>-->
    <apex:stylesheet value="{!URLFOR($Resource.bootstrap, '/css/bootstrap.min.css')}"/>
<!--    <script src="{!URLFOR($Resource.bootstrap, '/js/bootstrap.min.js')}"></script>-->
    <!-- script -->
    <apex:includeScript value="/support/console/24.0/integration.js"/>
    
     <style>
        .btn-custom {
          background-color: hsl(206, 71%, 53%) !important;
          background-repeat: repeat-x;
          filter: progid:DXImageTransform.Microsoft.gradient(startColorstr="#3292dc", endColorstr="#3292dc");
          background-image: -khtml-gradient(linear, left top, left bottom, from(#3292dc), to(#3292dc));
          background-image: -moz-linear-gradient(top, #3292dc, #3292dc);
          background-image: -ms-linear-gradient(top, #3292dc, #3292dc);
          background-image: -webkit-gradient(linear, left top, left bottom, color-stop(0%, #3292dc), color-stop(100%, #3292dc));
          background-image: -webkit-linear-gradient(top, #3292dc, #3292dc);
          background-image: -o-linear-gradient(top, #3292dc, #3292dc);
          background-image: linear-gradient(#3292dc, #3292dc);
          border-color: #3292dc #3292dc hsl(206, 71%, 53%);
          color: #fff !important;
          text-shadow: 0 1px 1px rgba(255, 255, 255, 0.00);
          -webkit-font-smoothing: antialiased;
        }
        
        .bPageBlock{ 
            background-color:#FFFFFF !important;
            border-top: 0px !important; 
            border-bottom: 0px !important; 
            border-left: 0px !important; 
            border-radius: 0px 0px 0px 0px;
            border-right: 0px !important; 
        }
       
        .pane-header {
            background: url("{!URLFOR($Resource.PaneHeaderImage)}") repeat-x scroll left 1px #FFFFFF;
            border-radius: 10px 10px 0 0;
        }
    </style>
<script>
	function openSuccess(){
	}   
	function testOpenPrimaryTab(navUrl, name) {
	//Open a new primary tab with the salesforce.com home page in it
	sforce.console.openPrimaryTab(null, navUrl, false,name, openSuccess, 'salesforceTab');
	}
	function CallPopulateCaseIncident(incidentid){
		alert(incidentid);
		PopulateCaseIncident(incidentid);
		return false;
	}
</script>
	<apex:form style="width:100%;">
	   <apex:actionFunction status="goStatus" action="{!PopulateCaseIncident}" name="PopulateCaseIncident" reRender="topBlock">
           <apex:param name="incidentid" value="" assignTo="{!selectedIncident}"/>
        </apex:actionFunction>
        <apex:actionFunction status="goStatus" action="{!SearchedIncident}" name="SearchedIncident" reRender="topBlock"/>
		<apex:pageMessages id="msgs"/>
        <apex:outputpanel >
            <apex:actionstatus id="goStatus">
                <apex:facet name="start">
                    <div class="waitingSearchDiv"
                        style="background-color: #fbfbfb; height: 100%; opacity: 0.65; width: 100%;">
                    <div class="waitingHolder" style="top: 74.2px; width: 91px;">
                    <img class="waitingImage" src="/img/loading.gif"
                        title="Please Wait.." /> <span class="waitingDescription">Loading..</span>
                    </div>
                    </div>
                </apex:facet>
            </apex:actionstatus>
        </apex:outputpanel>
        <apex:pageBlock id="topBlock">
            <table class="table" style="width:100%;">
                <tbody>
             
                    <tr>
                        <td style="width:100%;border:0px;">
                            <apex:panelGroup id="caseSection">
                                <div style="height:520px;border: 1px solid #DDDDDD;border-radius: 10px;">
                                    <apex:outputPanel layout="block" style="height:40px; padding-top:10px;font-weight:bold;" styleClass="pane-header">
                                        <div style="float:left; margin-left:10px; font-size:16px;"> Suggested Incidents </div>
                                        <div class="formLine" style="float:right;">
                                            <apex:inputText value="{!strServiceIncidentsText}" style="margin-left: 10px;margin-right: 10px;" id="txtService"/>
                                            <apex:commandButton value="GO" onClick="SearchedIncident()" styleClass="btn btn-primary btn-custom" style="margin-bottom:10px;"/>                                            
                                        </div>
                                    </apex:outputPanel>
                                    <div style="height:430px; overflow:auto;">
                                        <apex:dataTable value="{!lstIncidents}" var="incident" cellpadding="5" cellspacing="5" 
                                        styleClass="table table-striped" style="margin-bottom:0px;">
                                            <apex:column >
                                                <apex:facet name="header">Incident Name</apex:facet>
                                                <a href="javascript:testOpenPrimaryTab('/{!incident.ID}','{!incident.Name}')" style="cursor: pointer; text-decoration: underline; color:#3597dc;">{!incident.Name}</a>
                                                
                                            </apex:column> 
                                            <apex:column headerValue="Description" >
                                            	{!LEFT(incident.BMCServiceDesk__incidentDescription__c,255)} 
                                            </apex:column>
                                            <apex:column rendered="{!IF(isIncidentAssociated, true, false)}">
                                                <apex:facet name="header"></apex:facet>
												<apex:commandButton value="Link to Case" onClick="javascript:if (window.confirm('There following SI is related to the case: {!incident.Name}. Would you like to overwrite your selection?')) return CallPopulateCaseIncident('{!incident.Id}');" styleClass="btn btn-primary " style="margin-bottom:10px;"/>				
                                            </apex:column>
                                            <apex:column rendered="{!IF(isIncidentAssociated, false,true)}">
                                                <apex:facet name="header"></apex:facet>
												<apex:commandButton value="Link to Case" onClick="return CallPopulateCaseIncident('{!incident.Id}')" styleClass="btn btn-primary " style="margin-bottom:10px;" rerender="none"/>				
                                            </apex:column>
                                        </apex:dataTable>
                                    </div>                                    
                                </div>
                            </apex:panelGroup>
                        </td>
                        
                    </tr>
                    
                </tbody>
            </table>
        </apex:pageBlock>
        
    	
	</apex:form>
</apex:page>