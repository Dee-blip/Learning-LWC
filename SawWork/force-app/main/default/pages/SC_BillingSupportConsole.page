<!--
|  HISTORY  |                                                                            

|  DATE           DEVELOPER   CR          DESCRIPTION                                                       

|  ===========    =========   =======     =========== 
                                                       
|  12-Oct-2015    Deepak      CR 2596476    Home Page for Billing Team
|  29-Jul-2016    Vamsee      CR 3310901    Removing Unexpected Content Loading from Subject column
    
-->
<apex:page controller="SC_BillingSupportConsoleController" showHeader="false" sidebar="false">
    <apex:includeScript value="/support/console/32.0/integration.js"/>
    <script src="{!URLFOR($Resource.SCNewHomePage, '/js/bootstrap_jquerydatatables.js')}"></script>
    <apex:stylesheet value="{!URLFOR($Resource.SCNewHomePage,'css/bootstrap_jquerydatatable.css')}"/>
    <apex:stylesheet value="{!URLFOR($Resource.SCNewHomePage,'css/Inline_Styles.css')}"/>

    <apex:form style="height:100%">
        <apex:inputHidden value="{!lQCaseERjson}" id="hiddenFieldQueueList"/>
        <apex:inputHidden value="{!lMCaseERjson}" id="hiddenFieldMyList"/>
        <apex:inputHidden value="{!lMCaseExtjson}" id="hiddenFieldExtList"/>
        <apex:inputHidden value="{!pickFlag}" id="hiddenPickFlag"/>
        <apex:inputHidden value="{!hiddenCaseId}" id="hiddenCaseId"/>

        <!--QueueTable Refresh on Picking Case/ER-->
        <apex:actionFunction name="pickCaseERaction" action="{!pickCaseER}" reRender="hiddenFieldQueueList,hiddenPickFlag,qPanelHeader" onComplete="pick_reConstructQTable(),refreshMyTablePeriodic()" status="actQStatusId">     
        <apex:param name="passRecId" value=""  assignTo="{!passRecId}"/>
        </apex:actionFunction>


        <!-- action functions on change of select list option-->
        <apex:actionFunction name="refreshMyTable" action="{!populateMyTable}" reRender="hiddenFieldMyList" oncomplete="reConstructMTable()" status="actMStatusId"/>
        <apex:actionFunction name="refreshQTable" action="{!populateQTable}" reRender="hiddenFieldQueueList" oncomplete="reConstructQTable()" status="actQStatusId"/>
        <apex:actionFunction name="refreshDashboard" action="{!updateDashboard}" reRender="Oone,Otwo" oncomplete="colorOvals()" status="actDStatusId"/>
        <apex:actionFunction name="refreshDashboard2" action="{!updateDashboard2}" reRender="Othree,Ofour,Ofive,Osix" oncomplete="colorOvals()" status="actDStatusId2"/>
        <apex:actionFunction name="refreshExtTables" action="{!populateExternalDependencyTable}" reRender="hiddenFieldExtList" status="actSIStatusId" oncomplete="reConstructExtTable()"/>

        <!--periodic refresh for QueueTable and MyTable and External Dependency Table-->
        <apex:actionFunction name="refreshMyTablePeriodic" action="{!populateMyTable}" reRender="hiddenFieldMyList" oncomplete="reConstructMTable()"/>
        <apex:actionPoller interval="30" oncomplete="refreshMyTablePeriodic();"/>

        <apex:actionFunction name="refreshQTablePeriodic" action="{!populateQTable}" reRender="hiddenFieldQueueList" oncomplete="reConstructQTable()"/>
        <apex:actionPoller interval="30" oncomplete="refreshQTablePeriodic();"/>
        
        <apex:actionFunction name="refreshextTablesPeriodic" action="{!populateExternalDependencyTable}" reRender="hiddenFieldExtList" oncomplete="reConstructExtTable()"/>
        <apex:actionPoller interval="30" oncomplete="refreshextTablesPeriodic();"/>

        <!--periodic refresh of Dashboards-->
        <apex:actionFunction name="refreshDashboardPeriodic" action="{!updateDashboard}" reRender="Oone,Otwo" oncomplete="colorOvals()"/>
        <apex:actionPoller interval="30" oncomplete="refreshDashboardPeriodic()"/>
        
        <apex:actionFunction name="refreshDashboardPeriodic2" action="{!updateDashboard2}" reRender="Othree,Ofour,Ofive,Osix" oncomplete="colorOvals()"/>
        <apex:actionPoller interval="30" oncomplete="refreshDashboardPeriodic2()"/>
       
        <!--To call Controller methods that return Dashboard,Ext Dependency and Table Data-->
        <apex:actionFunction name="populateQTable" action="{!populateQTable}" reRender="hiddenFieldQueueList" onComplete="constructQTable()" />
        <apex:actionFunction name="populateMyTable" action="{!populateMyTable}" reRender="hiddenFieldMyList" onComplete="constructMTable()"/>
        <apex:actionFunction name="populateExtTable" action="{!populateExternalDependencyTable}" reRender="hiddenFieldExtList" onComplete="constructExtTable()"/>
        <apex:actionFunction action="{!suppressCaseUpdate}" name="supressCaseUpdateApex" oncomplete="refreshMyTablePeriodic();"/>

        <div class="container-fluid setmargin setheight">
            <div class="row"  id="section1">
            <!--Start of Dashboard-->
                <div class="col-md-3 col-sm-3 col-xs-3 rowclass" style="min-width:100px; min-height:120px">
                    <div class="panel panel-default setheight">
                    <!--action status-->
                        <apex:actionStatus id="actDStatusId" >
                            <apex:facet name="start">
                                <div class="statusOuter">   
                                    <div class="statusInner">        
                                        <img src="/img/loading.gif" />       
                                    </div>             
                                </div>
                            </apex:facet>            
                        </apex:actionStatus>
                        <!--heading-->
                        <div class="panelheadtopsection">        
                            <h5>Billing Support Cases&nbsp;&nbsp;</h5>
                            <apex:selectList value="{!DashboardFilter}" size="1" style="margin-right: 10px;" onchange="refreshDashboard()">
                                <apex:selectOption itemLabel="This Month" itemValue="This Month"/>
                                <apex:selectOption itemLabel="This Quarter" itemValue="This Quarter"/>
                                <apex:selectOption itemLabel="This Year" itemValue="This Year"/>
                            </apex:selectList>
                        </div>
                        <!--body-->
                        <div onClick="openConsoleCaseERAcc('500?fcf={!BillingListViewId}','Billing Support Cases Queue');" title="Go to Billing Support Queue" class="panelbodytopsection" style="cursor: pointer;">
                        <!--Unassigned-->
                            <div class="col-md-6 col-sm-6 col-xs-6 rowclass" style="min-width:100px">
                                    <div class="oval" id="Ovone">
                                        <h3><apex:outputPanel id="Oone">{!If(totalUnassigned==0 ,"N/A",TEXT(totalUnassigned))}</apex:outputPanel></h3>
                                    </div>
                                    <div class="ovalLabel">
                                        Unassigned
                                    </div>
                            </div>
                            <!--Unassigned > 24 hours-->
                            <div class="col-md-6 col-sm-6 col-xs-6 rowclass" style="min-width:100px">
                                    <div class="oval" id="Ovtwo">
                                        <h3><apex:outputPanel id="Otwo">{!If(totalUnassigned2==0 ,"N/A",TEXT(totalUnassigned2))}</apex:outputPanel></h3>
                                    </div>
                                    <div class="ovalLabel">                  
                                    Unassigned > 24hrs              
                                    </div>  
                            </div>
                        </div>
                    </div>
                </div>
                                    
                <div class="col-md-4 col-sm-4 col-xs-4 rowclass" style="min-width:200px; min-height:120px">
                    <div class="panel panel-default setheight">
                    <!--action status-->
                        <apex:actionStatus id="actDStatusId2" >
                            <apex:facet name="start">
                                <div class="statusOuter">   
                                    <div class="statusInner">        
                                        <img src="/img/loading.gif" />       
                                    </div>             
                                </div>
                            </apex:facet>            
                        </apex:actionStatus>
                    <div class="panelheadtopsection">        
                            <h5>My Cases&nbsp;&nbsp;</h5>
                            <apex:selectList value="{!DashboardFilter2}" size="1" style="margin-right: 10px;" onchange="refreshDashboard2()">
                                <apex:selectOption itemLabel="This Month" itemValue="This Month"/>
                                <apex:selectOption itemLabel="This Quarter" itemValue="This Quarter"/>
                                <apex:selectOption itemLabel="This Year" itemValue="This Year"/>
                            </apex:selectList>
                    </div>
                        <!--body-->
                        <div class="panelbodytopsection">
                       
                        <!--Open Cases-->
                        <div class="col-md-3 col-sm-3 col-xs-3 rowclass">
                            <div class="celldiv" onClick="openConsoleCaseERAcc('500?fcf={!MyOpenCaseListViewId}','My Open Cases');" title="Go to My Open Cases" style="cursor: pointer;">
                                <div class="oval" id="Ovthree">
                                    <h3><apex:outputPanel id="Othree">{!If(allOpenMyCases==0 ,"N/A",TEXT(allOpenMyCases))}</apex:outputPanel></h3>
                                </div>
                                <div class="ovalLabel">                  
                                    Open Cases
                                </div>
                            </div>  
                        </div>
                        <!--Initial Response > 24 hours-->
                        <div class="col-md-3 col-sm-3 col-xs-3 rowclass">
                            <div class="celldiv" onClick="openConsoleCaseERAcc('500?fcf={!MyOpenCaseListViewId}','My Open Cases');" title="Go to My Open Cases" style="cursor: pointer;">
                                <div class="oval" id="Ovfour">
                                    <h3><apex:outputPanel id="Ofour">{!If(allCaseswithIRViolated==0 ,"N/A",TEXT(allCaseswithIRViolated))}</apex:outputPanel></h3>
                                </div>
                                <div class="ovalLabel">                  
                                    Initial Response > 24 hours
                                </div>
                            </div>  
                        </div>
                        <!--Missed Resolution SLA-->
                        <div class="col-md-3 col-sm-3 col-xs-3 rowclass">
                            <div class="celldiv" onClick="openConsoleCaseERAcc('500?fcf={!MyOpenCaseListViewId}','My Open Cases');" title="Go to My Open Cases" style="cursor: pointer;"> 
                                <div class="oval" id="Ovfive">
                                    <h3><apex:outputPanel id="Ofive">{!If(allCaseswithResViolated==0 ,"N/A",TEXT(allCaseswithResViolated))}</apex:outputPanel></h3>
                                </div>
                                <div class="ovalLabel">
                                    Missed Resolution SLA
                                </div>
                            </div>  
                        </div>
                        
                        <!--Closed Cases-->
                        <div class="col-md-3 col-sm-3 col-xs-3 rowclass">
                            <div class="celldiv" onClick="openConsoleCaseERAcc('500?fcf={!MyClosedCaseListViewId}','My Closed Cases');" title="Go to My Closed Cases" style="cursor: pointer;"> 
                                <div class="oval" id="Ovsix">
                                    <h3><apex:outputPanel id="Osix">{!If(allClosedMyCases==0 ,"N/A",TEXT(allClosedMyCases))}</apex:outputPanel></h3>
                                </div>
                                <div class="ovalLabel">
                                    Closed Cases
                                </div>
                            </div>  
                        </div>
                    </div>
                    </div>
                    <!--End of Dashboard-->
                </div>
                                
            <!--External Dependency-->
            <div class="col-md-5 col-sm-5 col-xs-5 rowclass" style="min-width:400px; min-height:120px">
                <div class="panel panel-default setheight">
                <!--action status-->
                    <apex:actionStatus id="actSIStatusId" >
                        <apex:facet name="start">
                            <div class="statusOuter">   
                                <div class="statusInner">        
                                    <img src="/img/loading.gif" />       
                                </div>             
                            </div>
                        </apex:facet>            
                    </apex:actionStatus>
                    <div class="panelheadtopsection" >
                        <h5>External Dependency</h5>
                    </div>         
                    <div class="panelbodytopsection" style="overflow:auto">
                        <table id="ExtTablehead" class="table table-striped" style="white-space: nowrap;table-layout: fixed;width:100%" >
                            <thead>
                                <th style="width:17.5%;">Case#</th>
                                <th style="width:24%;">Account</th>
                                <th style="width:18.5%;">Type</th>
                                <th style="width:22%;">Resolution SLA (hrs)</th>
                                <th style="width:18%;">Created Date</th>
                            </thead>       
                        </table>        
                        <apex:outputPanel id="SIPanel">
                            <apex:outputPanel id="SIFoot" layout="block">
                                <apex:outputPanel rendered="{(extListSize==0)}" layout="block" style="background-color:#f9f9f9;padding:3px;">
                                    <p style="text-align:center;margin-bottom:0px;">No Case with External Dependency</p>
                                </apex:outputPanel>
                            </apex:outputPanel>              
                        </apex:outputPanel> 
                    </div>
                </div>
            </div>                   
        </div>

        <!--My Work section-->
        <div class="row" style="float:left;" id="section2">
            <div class="panel panel-default setheight"> <!--action status-->
                <apex:actionStatus id="actMStatusId" >
                    <apex:facet name="start">
                        <div class="statusOuter">   
                            <div class="statusInner">        
                                <img src="/img/loading.gif" />       
                            </div>             
                        </div>
                    </apex:facet>            
                </apex:actionStatus>
            <div class="panelheadtopsection">
                <h4>My Cases
                    <apex:outputPanel id="myPanelHeader"></apex:outputPanel> 
                    &nbsp;&nbsp;         
                </h4>
                <span id="myExpand" class="fa fa-caret-square-o-left fa-2x"></span>                                                
            </div>

            <div id="myTopPanel" class="panelbodytopsection">
                <apex:outputPanel id="myPanel" styleClass="setwidth setheight">   
                    <table id="myTable" class="table table-striped" style="white-space: nowrap;table-layout: fixed;width:100%">
                        <thead>
                            <tr style="height:25px">
                                <th style="width:7%;">Id</th>
                                <th style="width:11%;">Account</th>
                                <th style="width:23%;">Subject</th>
                                <th style="width:8%;">Status</th>
                                <th style="width:7%;">Age</th>
                                <th style="width:5%;">Origin</th>
                                <th style="width:4%;">Alert</th>
                                <th style="width:12%;">Initial Response SLA (hrs)</th>
                                <th style="width:9%;">Resolution SLA (hrs)</th>
                                <!-- <th style="width:8%;">LOE(Hours)</th> -->
                                <th style="width:14%;">External Dependencies</th>
                            </tr> 
                        </thead>
                    </table>
                </apex:outputPanel>         
            </div> 

        </div>
    </div>

    <!-- Queue View-->
    <div class="row" style="margin-top:10px;float:left;" id="section3">
        <div class="panel panel-default setheight">
        <!--action status-->
            <apex:actionStatus id="actQStatusId" >
                <apex:facet name="start">
                    <div class="statusOuter">   
                        <div class="statusInner">        
                            <img src="/img/loading.gif" />       
                        </div>             
                    </div>
                </apex:facet>            
            </apex:actionStatus>
            <div class="panelheadtopsection">
                <h4>Billing Support Queue &nbsp;&nbsp; 
                
                    <apex:outputPanel id="qPanelHeader"></apex:outputPanel>
                    &nbsp;&nbsp;        
                </h4>
                <apex:commandButton style="background:rgb(195, 222, 241);padding:3px" onClick="sforce.console.openPrimaryTab(null, '/setup/ui/recordtypeselect.jsp?ent=Case&retURL=%2F500%2Fl&save_new_url=%2F500%2Fe%3FretURL%3D%252F500%252Fl', true);return false" value="New Case" />
            </div>  
            <div id="qPanel" Class="panelbodytopsection" >                              
                <table id="QueueTable" class="table table-striped" style="white-space: nowrap;table-layout: fixed;width:100%">   
                    <thead >
                        <tr style="height:25px">
                            <th style="width:2%;" class="nosort"></th>
                            <th style="width:5%;">Id</th>
                            <th style="width:19%;">Account</th>
                            <th style="width:25%;">Subject</th>
                            <th style="width:15%;">Contact Name</th>
                            <th style="width:10%;">Created Date</th>
                            <th style="width:7%;">Age</th>
                            <!--<th style="width:12%;">Initial Response SLA (hrs)</th>-->
                        </tr> 
                    </thead>                     
                </table>
            </div>                
        </div>
    </div>
</div>

<script type="text/javascript">

    var qTable=null;
    var mTable=null;
    var extTable=null;
    var userId = '{!$User.Id}';       

    function openConsole(SF_Id,Numb) {
        document.getElementById('{!$Component.hiddenCaseId}').value = SF_Id;
        supressCaseUpdateApex();
        Tab_Id = Numb;
        sforce.console.generateConsoleUrl(['/'+SF_Id], openConsoleUrl);        
    }
    
    function openConsoleCaseERAcc(SF_Id,Numb) {
        Tab_Id = Numb;
        sforce.console.generateConsoleUrl(['/'+SF_Id], openConsoleUrl);        
    }   
    
    var openConsoleUrl = function(result){
        sforce.console.openConsoleUrl(null, result.consoleUrl,true,[Tab_Id],null,openSuccess);        
    }

    var openSuccess = function(result) {
        //Report whether opening the new tab was successful
        if (result.success == false)
            alert('The corresponding tab is already opened');
    };
 
    $("#myExpand").click(function(){        
        $("#section3").toggleClass("myToggleClass");
        $("#section2").toggleClass("toggleExpander");
        $("#myExpand").toggleClass("fa-caret-square-o-down");
        $("#qExpand").toggle();
    });   

    $("#qExpand").click(function(){        
        $("#section2").toggleClass("myToggleClass");
        $("#section3").toggleClass("toggleExpander");
        $("#qExpand").toggleClass("fa-caret-square-o-down");
        $("#myExpand").toggle();
    });

    function openCaseER(Id) {
        window.prompt("Copy to clipboard!",  window.location.protocol + '//' + window.location.host + '/'+Id);
    }

    function minsToDay(tm) {
        var D= Math.floor(tm/1440) +'d';
        if(tm%1440 !=0)
        return (D+' '+minsToHrs(tm%1440));
        else
        return D;
    }

    function minsToHrs(tm) {
        var H = Math.floor(tm/60) +'h';
        var m = tm%60+'m';
        if(tm%60 == 0)
        return H;
        else if(tm/60== 0)
        return m;
        else
        return (H+' '+m);
    }


    function colorOvals() {
        
        <!-- Dashboard Section 1 -->
        var num1 = $('#Ovone h3').text();
        if(num1=='N/A') {
            $("#Ovone,#Ovtwo").css({"color":"white","background-color":"rgb(211, 207, 207)"});
        }
        else {
                $("#Ovone").css({"background-color":"#CC3333","color":"white"});
                
                num1 = $('#Ovtwo h3').text();
                if(num1 == 'N/A'){
                    $("#Ovtwo").css({"color":"white","background-color":"rgb(211, 207, 207)"});
                
                }
                
                else{
                    $("#Ovtwo").css({"background-color":"#CC3333","color":"white"});
                
                }
            
             }
            
            <!-- Dashboard Section 2 -->
            num1 = $('#Ovthree h3').text();
            if(num1=='N/A') {
                $("#Ovthree").css({"color":"white","background-color":"rgb(211, 207, 207)"});
            }
            else{
                $("#Ovthree").css({"background-color":"#CC3333","color":"white"});
            }
            
            num1 = $('#Ovfour h3').text();
            if(num1=='N/A') {
                $("#Ovfour").css({"color":"white","background-color":"rgb(211, 207, 207)"});
            }
            else{
                $("#Ovfour").css({"background-color":"#CC3333","color":"white"});
            }
            
            num1 = $('#Ovfive h3').text();
            if(num1=='N/A') {
                $("#Ovfive").css({"color":"white","background-color":"rgb(211, 207, 207)"});
            }
            else{
                $("#Ovfive").css({"background-color":"#CC3333","color":"white"});
            }
            
            num1 = $('#Ovsix h3').text();
            if(num1=='N/A') {
                $("#Ovsix").css({"color":"white","background-color":"rgb(211, 207, 207)"});
            }
            else{
                $("#Ovsix").css({"background-color":"#CC3333","color":"white"});
            }
            
    }

    function pickCaseER(id) {
            if(confirm('Are you sure you want to take this Case?')) {
                pickCaseERaction(id);
            }
    }
    
    function constructQTable() {
        var datas = JSON.parse(document.getElementById('{!$Component.hiddenFieldQueueList}').value);
        qTable=  $('#QueueTable').DataTable( {
                    "data": datas,
                    "columns": [
                        <!--image-->
                        { "data": "qList.0",
                        "mRender" : function(data,type,full) {
                                        return '<div class="cursorHandImage imageIcons" onclick="pickCaseER(\'' + full.qList[1] + '\')"/>';
                                    }
                        },
                        <!--Id-->
                        { "data": "qList.0",
                        "type": "html",
                        "mRender" : function(data,type,full) {
                                        return '<a  class="truncate" onClick="openConsoleCaseERAcc(\''+full.qList[1]+'\',\''+data+'\')">'+
                                        data+'</a>';
                                    }
                        },
                        <!--Account-->    
                        { "data": "qList.2",
                        "type": "html",
                        "mRender" : function(data,type,full) {
                                        return '<a  class="truncate" onClick="openConsoleCaseERAcc(\''+full.qList[3]+'\',\''+data+'\')">'+
                                        data+'</a>';
                                    }
                        },
                        <!--Subject-->    
                        { "data": "qList.4",
                        "type": "html",
                        "mRender" : function(data,type,full) {
                                        var escapedData = escapeHTML(data);
                                        return '<a  class="truncate" onClick="openConsoleCaseERAcc(\''+full.qList[1]+'\',\''+full.qList[0]+'\')">'+escapedData+'</a>';
                                    }
                        },
                        
                        <!--Contact Name-->
                        { "data": "qList.5",
                        "type": "html",
                        "mRender" : function(data,type,full) {
                                        if(type=='sort')
                                            return data;
                                        return '<p  class="truncate">'+full.qList[5]+'</p>';
                                    }
                        },
                        <!--Created-->
                        { "data": "qList.9",
                        "type": "html",
                        "mRender" : function(data,type,full) {
                                        if(type=='sort')
                                            return data;
                                        return '<p  class="truncate">'+full.qList[9]+'</p>';
                                    }
                        },
                        <!--Age Days-->
                        { "data": "qList.8",
                        "type": "num",
                        "mRender" : function(data,type,full) {
                                        if(type=='sort')
                                            return data;
                                        return '<p  class="truncate">'+minsToDay(data)+'</p>';
                                    }
                        }
                                                
                        
                ],
            'order': [1,'asc'],
            'paging' : false,
            'stateSave': true,
            'searching' : false,
            'aoColumnDefs': [{ 'bSortable': false, 'aTargets': ['nosort'] }],
            'bInfo':false,
            'bRedraw':false,
            'autoWidth':false            
            } );
            //document.getElementById('{!$Component.myPanelHeader}').innerHTML = '('+qTable.data().length+')';
    }
    
    
    function constructMTable() {
        var mdatas = JSON.parse(document.getElementById('{!$Component.hiddenFieldMyList}').value);          

        mTable=  $('#myTable').DataTable( {
                "data": mdatas,
                "columns": [
                    <!--Id-->
                    { "data": "qList.0",
                    "type": "html",
                    "mRender" : function(data,type,full) {
                                    return '<a  class="truncate" onClick="openConsole(\''+full.qList[1]+'\',\''+data+'\')">'+
                                data+'</a>';
                                }
                    },
                    <!--Account Name-->    
                    { "data": "qList.2",
                    "type": "html",
                    "mRender" : function(data,type,full) {
                                    return '<a  class="truncate" onClick="openConsoleCaseERAcc(\''+full.qList[3]+'\',\''+data+'\')">'+
                                    data+'</a>';
                                }
                    },
                    <!--Subject-->    
                    { "data": "qList.4",
                    "type": "html",
                    "mRender" : function(data,type,full) {
                                    var escapedData = escapeHTML(data);
                                    return '<a  class="truncate" onClick="openConsole(\''+full.qList[1]+'\',\''+full.qList[0]+'\')">'+escapedData+'</a>';
                                }
                    },
                    <!--Status--> 
                    { "data": "qList.9",
                    "type": "html",
                    "mRender" : function(data,type,full) {
                                    return '<p  class="truncate" >'+data+'</p>';
                                }             
                    },
                    <!--Age--> 
                    { "data": "qList.8",
                    "type": "num",
                    "mRender" : function(data,type,full) {
                                    if(type=='sort')
                                        return data;
                                    return '<p  class="truncate" >'+minsToDay(data)+'</p>';
                                }             
                    },
                    <!--Origin--> 
                    { "data": "qList.10",
                    "type": "num",
                    "mRender" : function(data,type,full) {
                                    if(type=='sort')
                                        return data;
                                    return '<p  class="truncate" >'+data+'</p>';
                                }             
                    },
                    <!--Alert--> 
                    { "data": "qList.11",
                    "type": "html",
                    "mRender" : function(data,type,full) {
                                    if(type=='sort')
                                        return data;
                                        if(data=='1')
                                            return '<span class="fa fa-circle fa-fw" style="color:#CC3333"></span>';
                                        else
                                            return '';
                                }               
                    },
                    <!--Initial Response SLA--> 
                    { "data": "qList.6",
                    "type": "num",
                    "mRender" : function(data,type,full) {
                                    if(type=='sort') {
                                        if(data=='z')
                                            return 99999999999999;
                                        else if(data=='y')
                                            return 999999999;
                                        return data;
                                    }
                                    else {
                                        if(data=='z')
                                            return '';
                                        else if(data=='y')
                                            return '<p><span class="glyphicon glyphicon-ok" style="color:green"/></p>';
                                        else if(data < 0)
                                            return '<p style="color:#CC3333">Miss&nbsp;<span class="glyphicon glyphicon-exclamation-sign"/></p>';
                                        else
                                            return '<p class="truncate" style="color:green">'+minsToDay(data)+'</p>'; 
                                    }
                                }
                    },
                    <!--Resolution SLA--> 
                    { "data": "qList.12",
                    "type": "num",
                    "mRender" : function(data,type,full) {
                                    if(type=='sort') {
                                        if(data=='z')
                                            return 99999999999999;
                                        else if(data=='y')
                                            return 999999999;
                                        return data;
                                    }
                                    else {
                                        if(data=='z')
                                            return '';
                                        else if(data=='y')
                                            return '<p><span class="glyphicon glyphicon-ok" style="color:green"/></p>';
                                        else if(data < 0)
                                            return '<p style="color:#CC3333">Miss&nbsp;<span class="glyphicon glyphicon-exclamation-sign"/></p>';
                                        else
                                            return '<p class="truncate" style="color:green">'+minsToDay(data)+'</p>';
                                    }
                                }
                    },
                    
                    <!--External Dependency--> 
                    { "data": "qList.14",
                    "type": "html",
                    "mRender": function(data,type,full) {                
                                    return '<a  class="truncate" onClick="openConsoleCaseERAcc(\''+full.qList[1]+'\',\''+data+'\')">'+
                                data+'</a>';
                                } 
                    }
                ],
                'order': [1,'asc'],
                'paging' : false,
                'stateSave': true,
                'searching' : false,
                'aoColumnDefs': [{ 'bSortable': false, 'aTargets': ['nosort'] }],
                'bInfo':false,
                'bRedraw':false,
                'autoWidth':false                      
                } );
                document.getElementById('{!$Component.myPanelHeader}').innerHTML = '('+mTable.data().length+')';
    }
    
    function constructExtTable() {
        var extdatas = JSON.parse(document.getElementById('{!$Component.hiddenFieldExtList}').value);          
        extTable=  $('#ExtTablehead').DataTable( {
                "data": extdatas,
                "columns": [
                    <!--Id-->
                    { "data": "qList.0",
                    "type": "html",
                    "mRender" : function(data,type,full) {
                                    return '<a  class="truncate" style="cursor: pointer;" onClick="openConsoleCaseERAcc(\''+full.qList[1]+'\',\''+data+'\')">'+
                                data+'</a>';
                                }
                    },
                    <!--Account-->    
                    { "data": "qList.2",
                    "type": "html",
                    "mRender" : function(data,type,full) {
                                    return '<a  class="truncate" style="cursor: pointer;" onClick="openConsoleCaseERAcc(\''+full.qList[3]+'\',\''+data+'\')">'+
                                    data+'</a>';
                                }
                    },
                    
                    <!--External Dependency--> 
                    { "data": "qList.4",
                    "type": "html"
                    },
                    
                    <!--Resolution SLA--> 
                    { "data": "qList.5",
                    "type": "num",
                    "mRender" : function(data,type,full) {
                                    if(type=='sort') {
                                        if(data=='z')
                                            return 99999999999999;
                                        else if(data=='y')
                                            return 999999999;
                                        return data;
                                    }
                                    else {
                                        if(data=='z')
                                            return '';
                                        else if(data=='y')
                                            return '<p><span class="glyphicon glyphicon-ok" style="color:green"/></p>';
                                        else if(data < 0)
                                            return '<p style="color:#CC3333">Miss&nbsp;<span class="glyphicon glyphicon-exclamation-sign"/></p>';
                                        else
                                            return '<p class="truncate" style="color:green">'+minsToDay(data)+'</p>';
                                    }
                                }
                    },
                    <!--Created Date--> 
                    { "data": "qList.6",
                    "type": "html",
                    "mRender" : function(data,type,full) {
                                    if(type=='sort')
                                        return data;
                                    return '<p  class="truncate" >'+data+'</p>';
                                    }             
                    }
                ],
                'order': [1,'asc'],
                'paging' : false,
                'stateSave': true,
                'searching' : false,
                'aoColumnDefs': [{ 'bSortable': false, 'aTargets': ['nosort'] }],
                'bInfo':false,
                'bRedraw':false,
                'autoWidth':false                      
                } );
                //document.getElementById('{!$Component.myPanelHeader}').innerHTML = '('+extTable.data().length+')';
    }

    function pick_reConstructQTable(){
        if(document.getElementById('{!$Component.hiddenPickFlag}').value == 'false' )
            alert('The Case/ER is taken up by another user');
        reConstructQTable();
    }

    function reConstructExtTable(){
        extTable.destroy();
        constructExtTable();    
    }

    function reConstructMTable(){
        mTable.destroy();
        constructMTable();
    }

    function reConstructQTable(){
        qTable.destroy();
        constructQTable();    
    }
    function escapeHTML(input){
            var output = input.split("<").join("&lt;");
            return output.split(">").join("&gt;");
    }

    $(document).ready(function(){
        
        colorOvals();
        populateQTable();
        populateMyTable();
        populateExtTable();
    }); 

</script>
</apex:form>
</apex:page>