<apex:page controller="BSScreenPopPageController" lightningStylesheets="true">
 <apex:includeLightning />
 <apex:includeScript value="/support/console/47.0/integration.js"/>
    <script type="text/javascript">
        function testSetTabTitle() {
            sforce.console.getFocusedPrimaryTabId(function(result) {
               sforce.console.setTabTitle('New Call - {!ani}', result.id);
            });
        }
        function navigateToId22(idvr) {
            sforce.one.navigateToSObject(idvr);

        }
        function searchpage(searchQuery) {
    		var stringToEncode = '{"componentDef":"forceSearch:search","attributes":{"term":"'+ searchQuery + '","scopeMap":{"type":"TOP_RESULTS"},"context":{"disableSpellCorrection":false,"SEARCH_ACTIVITY":{"term":"'+ searchQuery + '"}}}}';
        	var encodedString = btoa(stringToEncode);
            //sforce.one.navigateToURL( "/one/one.app?source=alohaHeader#" + encodedString,true);
            window.location = "/one/one.app?source=alohaHeader#" + encodedString;
  		}
    
        testSetTabTitle();
    </script>
<style>
    th {
    font-weight: bold;
    }
    
    thead.fixedHeader tr {
    position: relative;
    }
    
    body thead.fixedHeader tr {
    display: block;
    }
    thead.fixedHeader th {
    font-weight: bold;
    padding: 5px 0px;
    text-align: left;
    font-size: 12px;
    color: #032D60;
    }
    
    body tbody.scrollContent {
    display: block;
    height: 200px;
    overflow: auto;
    width: 100%;
    }
    
    tbody.scrollContent td {
    padding: 5px 0px;
    font-size: 12px
    }
    
</style>

<apex:outputPanel layout="block" style="overflow:auto;width:100%;height:500px" rendered="{!method == 'selectrecord'}" id="searchArea">
  <apex:pageBlock >
  <apex:pageBlockSection collapsible="false" title="Select/Search for Record (Multiple records found)" columns="1">
  <input id='textsel' type="text" value="{!ani}" onkeypress="enterPress(event)"/>
 <input type="button" onclick="runthesearch(document.getElementById('textsel').value)" value="search"/>
 <script>
 
 function runthesearch(valsearch) {
     if (valsearch.length >= 2) {
        updateSearch(valsearch);
     }
     
 }
      
 
      
 </script>
      
<br/><br/>
Contacts:
    <hr/>
  <apex:dataTable value="{!contactarray}" var="cont" id="theTable" border="1"
        rowClasses="odd,even" styleClass="tableClass" width="80%">

        <apex:column style="text-align:right !important;"><apex:facet name="header"> </apex:facet> <input type="button" onclick="runselection('{!cont.id}')" value="Select" style="margin-right: 24px;"/></apex:column>
        <apex:column ><apex:facet name="header">Name</apex:facet><apex:outputText value="{!cont.name}"/></apex:column>
        <apex:column ><apex:facet name="header">Phone</apex:facet><apex:outputText value="{!cont.phone}"/></apex:column>
        <apex:column ><apex:facet name="header">Email</apex:facet><apex:outputText value="{!cont.email}"/></apex:column>
        <apex:column ><apex:facet name="header">City</apex:facet><apex:outputText value="{!cont.mailingcity}"/></apex:column>
        <apex:column ><apex:facet name="header">State</apex:facet><apex:outputText value="{!cont.mailingstate}"/></apex:column>
        <apex:column ><apex:facet name="header">Zip</apex:facet><apex:outputText value="{!cont.mailingpostalcode}"/></apex:column>
    </apex:dataTable>
    
    <apex:outputPanel rendered="{!!contactOnly}">
    Leads:
    <hr/>
         <apex:dataTable value="{!leadarray}" var="cont" id="theTable2" border="1" rowClasses="odd,even" styleClass="tableClass" width="80%">
            <apex:column style="text-align:right !important;"><apex:facet name="header"></apex:facet><input type="button" onclick="runselection('{!cont.id}')" value="Select" style="margin-right: 24px;"/></apex:column>
            <apex:column ><apex:facet name="header">Name</apex:facet><apex:outputText value="{!cont.name}"/></apex:column>    
            <apex:column ><apex:facet name="header">Phone</apex:facet><apex:outputText value="{!cont.phone}"/></apex:column>
            <apex:column ><apex:facet name="header">Email</apex:facet><apex:outputText value="{!cont.email}"/></apex:column>
            <apex:column ><apex:facet name="header">City</apex:facet><apex:outputText value="{!cont.city}"/></apex:column>
            <apex:column ><apex:facet name="header">State</apex:facet><apex:outputText value="{!cont.state}"/></apex:column>
            <apex:column ><apex:facet name="header">Zip</apex:facet><apex:outputText value="{!cont.postalcode}"/></apex:column>
        </apex:dataTable>
    
    </apex:outputPanel>
    
    </apex:pageBlockSection>
    </apex:pageBlock>
    
 </apex:outputPanel>
     
    <div id='akateconeaccountscreen' style="display: block;">
    <apex:outputPanel layout="block" style="overflow:auto;width:100%;" rendered="{!method == 'akateconeaccountscreen'}" id="akatekOneAccountPop">
        <center><table border="2" width="90%">
            <tr>
                <td valign="top" width="40%" style="cellspacing: 20px; padding: 20px;">
                    <table border="0" width="100%">
                        <tr>
                            <td valign="top" style="cellspacing: 20px; padding: 20px;">
                            <b>Account Name:</b> <a href="javascript:void(0)" onclick="navigateToId22('{!matchedAccount.Id}');">{!matchedAccount.Name}</a><br/>
                            <b>Support Level:</b> {!matchedAccount.Support_Level__c}<br/>
                            <b>Geography:</b> {!matchedAccount.Akatec_Geography__c}<br/><br/>
                            <b>Special Instructions:</b> <br/>  <br/>                          
                            <div style="overflow: auto; height: 300px;">
                                
                                <apex:repeat var="thisinstruction" value="{!specialInstructionsArray}">
                                <b>{!thisinstruction.Title__c}</b><br/>
                                <apex:outputText escape="false" value="{!thisinstruction.Instructions__c}"/><br/>
                                <br/>
                                </apex:repeat>                            
                                </div>
                            
                            </td></tr>
                        
                        <tr><td valign="top">
                                                    
                            <br/>
                            <b>Account Team</b><br/>
                            <div id="tableContainer" style = "clear: both;height: 200px;overflow: hidden; width: 100%">
                                <table border="0" cellpadding="0" cellspacing="0" width="100%" class="scrollTable">
                                    <thead class="fixedHeader">
                                        <tr>
                                            <th style="width: 8vw;">Name</th>
                                            <th style="width: 11vw;">Role</th>
                                            <th style="width: 7vw;">Phone</th>
                                            <th style="width: 7vw;">Mobile</th>
                                        </tr>
                                    </thead>
                                    <tbody class="scrollContent">
                                        <apex:repeat rendered="{!IF(accountTeamMemberArray.Size > 0 ,true,false)}" value="{!accountTeamMemberArray}" var="mem">    
                                            <tr>
                                                <td style="width: 8vw;"><apex:outputLink value="/{!mem.UserId}" target="_blank">{!mem.User.Name}</apex:outputLink></td>
                                                <td style="width: 11vw;">{!mem.TeamMemberRole}</td>
                                                <td style="width: 7vw;">{!mem.User.Phone}</td>
                                                <td style="width: 6vw;">{!mem.User.mobilePhone}</td> 
                                            </tr>
                                        </apex:repeat>
                                    </tbody>
                                </table>
                               <!--<apex:repeat var="thismember" value="{!accountTeamMemberArray}"> 
                                   <a href="javascript:void(0)" onclick="navigateToId22('{!thismember.UserId}');" title="{!thismember.TeamMemberRole}">{!thismember.User.Name+': '+thismember.User.Phone}</a>     <br/>                         
                               </apex:repeat>-->
                               
                            </div>
                          
                            </td></tr>
                    </table>
                    
                </td>
                <td valign="top" width="500px">
                    <br/>
                    <center>
                    <div style="float: right;padding-right: 20px;"><input type="button" onclick="createnewcase()" value="New {!lob} Case"/></div>
                    <br/><br/><table width="90%">
                        <tr><th>Case Number</th><th>Severity</th><th>Subject </th><th>Case Owner</th></tr>
                        
                        <apex:repeat var="thiscase" value="{!caseArray}">
                            <tr><td><a href="javascript:void(0);" onclick="navigateToId22('{!thiscase.Id}')" title="{!thiscase.Subject}" >{!thiscase.CaseNumber}</a></td><td>{!thiscase.Severity__c}</td><td>{!LEFT(thiscase.Subject,30)+'...'}</td><td>{!thiscase.Owner.Name}</td></tr>    
                        </apex:repeat>
                                                
                        
                    </table>
                    </center>
                    
                
                </td>
                
            </tr>
            
        </table>
        </center>
   
    </apex:outputPanel>
    
    </div>
    
    
    
    
    <div id='akatecnewcallscreen' style="display: block;">
    <apex:outputPanel layout="block" style="overflow:auto;width:100%;" rendered="{!method == 'akatecnewcallscreen'}" id="akatekPop">
        <center><table border="2" width="90%">
            <tr>
                <td width="40%" style="cellspacing: 20px; padding: 20px;">
                    <table border="0" width="100%">
                        <tr>
                            <td valign="top" style="cellspacing: 20px; padding: 20px;">
                            <b>Account Name:</b> <a href="javascript:void(0)" onclick="navigateToId22('{!matchedContact.AccountId}');">{!matchedContact.Account.Name}</a><br/>
                            <b>Support Level:</b> {!matchedContact.Support_Level__c}<br/>
                            <b>Geography:</b> {!matchedContact.Account.Akatec_Geography__c}<br/><br/>
                            <b>Special Instructions:</b> <br/>  <br/>                          
                            <div style="overflow: auto; height: 300px;">
                                
                                <apex:repeat var="thisinstruction" value="{!specialInstructionsArray}">
                                <b>{!thisinstruction.Title__c}</b><br/>
                                <apex:outputText escape="false" value="{!thisinstruction.Instructions__c}"/><br/>
                                <br/>
                                </apex:repeat>                            
                                </div>
                            
                            </td></tr>
                        
                        <tr><td valign="top">
                            <b>Contact Name:</b> {!matchedContact.Name}<br/>
                            <b>Contact Type:</b> {!matchedContact.Contact_Type__c}<br/>
                            <b>Contact Phone:</b> {!matchedContact.Phone}<br/>
                            <b>Contact Mobile:</b>{!matchedContact.MobilePhone}<br/>
                            <b>Portal Login:</b> {!matchedContact.Active_Portal_Login__c}<br/>
                            
                            <br/>
                            <b>Account Team:</b><br/>
                            <div id="tableContainer" style = "clear: both;height: 200px;overflow: hidden; width: 100%">
                                <table border="0" cellpadding="0" cellspacing="0" width="100%" class="scrollTable">
                                    <thead class="fixedHeader">
                                        <tr>
                                            <th style="width: 8vw;">Name</th>
                                            <th style="width: 11vw;">Role</th>
                                            <th style="width: 7vw;">Phone</th>
                                            <th style="width: 7vw;">Mobile</th>
                                        </tr>
                                    </thead>
                                    <tbody class="scrollContent">
                                        <apex:repeat rendered="{!IF(accountTeamMemberArray.Size > 0 ,true,false)}" value="{!accountTeamMemberArray}" var="mem">    
                                            <tr>
                                                <td style="width: 8vw;"><apex:outputLink value="/{!mem.UserId}" target="_blank">{!mem.User.Name}</apex:outputLink></td>
                                                <td style="width: 11vw;">{!mem.TeamMemberRole}</td>
                                                <td style="width: 7vw;">{!mem.User.Phone}</td>
                                                <td style="width: 6vw;">{!mem.User.mobilePhone}</td> 
                                            </tr>
                                        </apex:repeat>
                                    </tbody>
                                </table>
                               <!--<apex:repeat var="thismember" value="{!accountTeamMemberArray}"> 
                                   <a href="javascript:void(0)" onclick="navigateToId22('{!thismember.UserId}');" title="{!thismember.TeamMemberRole}">{!thismember.User.Name+': '+thismember.User.Phone}</a>     <br/>                         
                               </apex:repeat>-->
                               
                            </div>
                          
                            </td></tr>
                    </table>
                    
                </td>
                <td valign="top" width="500px">
                    <br/>
                    <center>
                    <div style="float: right;padding-right: 20px;"><input type="button" onclick="createnewcase()" value="New {!lob} Case"/></div>
                    <br/><br/><table width="90%">
                        <tr><th>Case Number</th><th>Severity</th><th>Subject </th><th>Case Owner</th></tr>
                        
                        <apex:repeat var="thiscase" value="{!caseArray}">
                            <tr><td><a href="javascript:void(0);" onclick="navigateToId22('{!thiscase.Id}')" title="{!thiscase.Subject}" >{!thiscase.CaseNumber}</a></td><td>{!thiscase.Severity__c}</td><td>{!LEFT(thiscase.Subject,30)+'...'}</td><td>{!thiscase.Owner.Name}</td></tr>    
                        </apex:repeat>
                                                
                        
                    </table>
                    </center>
                    
                
                </td>
                
            </tr>
            
        </table>
        </center>
   
    </apex:outputPanel>
    
    </div>
    
    
    
    
     <div id='akatecmanyaccountscreen' style="display: block;">
    <apex:outputPanel layout="block" style="overflow:auto;width:100%;" rendered="{!method == 'akatecmanyaccountscreen'}" id="akatekMultiPop">
        <center>
        
        
        <table border="0" width="90%">
           
            <tr>
              
                <td colspan="2" valign="top" width="500px">
                    <br/>
                    <center>
                    <table width="60%">
                    <tr><td align="right" colspan="2">
                        <input type="button" onclick="createnewcase()" value="New {!lob} Case"/><br/><br/>
                        </td>
                    </tr></table>
            <table border="1" width="60%">
                            <tr><th>Account Name</th><th>Support Level</th><th>Geo</th></tr>
                            
                   <apex:repeat var="thisAccount" value="{!accountarray}">
                            
                            <tr><td><a href="javascript:void()"  onclick="navigateToId22('{!thisAccount.Id}')">{!thisAccount.Name}</a></td><td>{!thisAccount.Support_Level__c}</td><td>{!thisAccount.Akatec_Geography__c}</td></tr>
                           
                            <br/>
                            
                            
                  </apex:repeat>
                            </table>                     
                        
                 
                    </center>
                    
                
                </td>
                
            </tr>
            
        </table>
        </center>
   
    </apex:outputPanel>
    
    </div>
    
    
    
    
    <div id='akatecmanycontactscreen' style="display: block;">
    <apex:outputPanel layout="block" style="overflow:auto;width:100%;" rendered="{!method == 'akatecmanycontactscreen'}" id="akatekMultiPop2">
        <center>
        
        
        <table border="0" width="90%">
           
            <tr>
              
                <td colspan="2" valign="top" width="500px">
                    <br/>
                    <center>
                    <table width="60%">
                    <tr><td align="right" colspan="2">
                        <input type="button" onclick="createnewcase()" value="New {!lob} Case"/><br/><br/>
                        </td>
                    </tr></table>
            
                   <apex:repeat var="thisContact" value="{!contactarray}">
                            <table border="1" width="60%"><tr><td>
                            
                            <table width="60%">
                            <tr><th>Account Name</th><td><a href="javascript:void()"  onclick="navigateToId22('{!thisContact.AccountId}')">{!thisContact.Account.Name}</a></td><th>Support Level</th><td>{!thisContact.Support_Level__c}</td><th>Geo</th><td>{!thisContact.Account.Akatec_Geography__c}</td></tr>
                            </table>
                            
                            
                                <table border="0" width="100%" style="padding: 4px;">
                                    <tr><th>Contact Name: <a href="javascript:void()"  onclick="navigateToId22('{!thisContact.Id}')">{!thisContact.Name}</a></th></tr>
                                <tr><th>Contact Type: {!thisContact.Contact_Type__c}</th></tr>
                                <tr><th>Contact Phone: {!thisContact.Phone}</th></tr>
                                <tr><th>Portal Login: {!thisContact.Active_Portal_Login__c}</th></tr>
                                </table>
                            
                            </td></tr></table>
                            <br/>
                            
                            
                  </apex:repeat>
                                                
                        
                 
                    </center>
                    
                
                </td>
                
            </tr>
            
        </table>
        </center>
   
    </apex:outputPanel>
    
    </div>
    
    
    
    
    
    
     <div id='helpdeskscreen' style="display: block;">
    <apex:outputPanel layout="block" style="overflow:auto;width:100%;" rendered="{!method == 'helpdeskscreen'}" id="helpdeskscreenpanel">
        <apex:form id="helpdeskform">
        <script>
        
        function updateusersearchcaller(valin) {
            if (valin.length >= 2) {
            
                updateUserSearch(valin);
            
            }
            
        }
        
        
        
        </script>
        
        <center><table border="2" width="90%">
            <tr>
                <td width="15%" style="cellspacing: 20px; padding: 20px;">
                    <table border="0" width="100%">
                        <tr>
                            <td valign="top" style="cellspacing: 20px; padding: 20px;">
                            <b>ACD Call:</b><br/>
                            <!-- Issue on behalf of other user? &nbsp;&nbsp;&nbsp; <apex:inputCheckbox label="" value="{!issueOnBehalf}"/><br/><br/> -->
                                
                            User Name:  <input type="text" value="{!userName}"  onChange='blankUserId()' id="usernamevalue"/>&nbsp;&nbsp;&nbsp;
                                <br/>
                            <input type="button" value="Search" onClick="userIdBlank = false; updateusersearchcaller(document.getElementById('usernamevalue').value)"/><br/><br/>{!searchResult}
                            </td>
                        </tr>
                        
                        <tr>
                            <td valign="top">
                            <script>
                                var theUserId = '';
                                var theUsernameValue = '';
                                
                                var userIdBlank = false;
                         
                                function blankUserId() {
                                 	userIdBlank = true;
                                }
                                
                                function callnewincident() {
                                 	if (document.getElementById('usernamevalue').value == null || document.getElementById('usernamevalue').value == '') {
                                    	theUserId = '';
                                        theUsernameValue ='';
                                        
                                    } else {
                                    	theUserId = '{!userId}';
                                        theUsernameValue = document.getElementById('usernamevalue').value;
                                    }
                            		if (userIdBlank) {
                                        theUserId = '';
                                    }
                                    
                                    newIncident(theUserId,theUsernameValue);
                                    
                                }
                              
                             </script>
                                
                            <input type="button" value="New Incident" onClick="callnewincident()"/><br/><br/>
                                                  
                            </td>
                        </tr>
                          <tr>
                            <td valign="top">
                           
                            <input type="button" value="New Service Request" onClick='newSR()' /> <br/><br/>
                                                  
                            </td>
                        </tr>
                            
                    </table>
                    
                </td>
                <td valign="top" width="500px">
                    <br/>
                    <center>
                   
                    <br/><br/>
                     <!--  Incidents:
                    <table width="90%" border="0" padding="20" style="cellspacing: 20px; padding: 20px;">
                       
                     <tr><th>Ticket Number</th><th>Short Description</th><th>Parent Tree</th><th>Category</th><th>Status</th><th>Priority</th><th>Owner Id</th><th>Opened Date</th></tr>
                        
                      
                      
                        
                        <apex:repeat var="thiscase" value="{!incidentlist}">
                            <tr><td><a href="javascript:void(0);" onclick="navigateToId('{!thiscase.Id}')" >{!thiscase.Name}</a></td><td width="200">{!LEFT(thiscase.BMCServiceDesk__shortDescription__c,30)+'...'}</td><td>{!thiscase.HD_Parent_Tree__c}</td><td>{!thiscase.BMCServiceDesk__FKCategory__r.Name}</td><td>{!thiscase.BMCServiceDesk__FKStatus__r.Name}</td><td>{!thiscase.BMCServiceDesk__FKPriority__r.Name}</td><td>{!thiscase.HD_Owner_user_queue__c}</td><td><apex:outputText value="{0,date,MM'/'dd'/'yyyy}"><apex:param value="{!thiscase.BMCServiceDesk__openDateTime__c}" /></apex:outputText></td></tr>    
                        </apex:repeat>
                        
                        </table> -->
                        
                          <apex:outputPanel id="helpdeskDatatable" style="max-height: 100px; overflow: auto;">
                          
                             <div style="max-height: 300px; overflow: auto;">
                              <apex:dataTable value="{!incidentlist}" var="thiscase" id="theIncTable"
                                rowClasses="odd,even" styleClass="tableClass" style="width: 99%;">
                                <apex:facet name="caption">Incidents</apex:facet>
                                <apex:facet name="header"></apex:facet>
                                <apex:facet name="footer"></apex:facet>
                         
                                <apex:column >
                                    <apex:facet name="header">Ticket Number</apex:facet>
                                   <!-- <apex:facet name="footer">column footer</apex:facet>-->
                                    <a href="javascript:void(0);" onclick="navigateToId2('{!thiscase.Id}')" title="{!thiscase.BMCServiceDesk__shortDescription__c}" >{!thiscase.Name}</a>
                                </apex:column>
                         
                                <apex:column >
                                    <apex:facet name="header">Description</apex:facet>
                                    <!-- <apex:facet name="footer">column footer</apex:facet> -->
                                    <apex:outputText value="{!LEFT(thiscase.BMCServiceDesk__shortDescription__c,30)+'...'}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">Parent Tree</apex:facet>
                                    <!-- <apex:facet name="footer">column footer</apex:facet> -->
                                    <apex:outputText value="{!thiscase.BMCServiceDesk__Feedback__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">Category</apex:facet>
                                    <!-- <apex:facet name="footer">column footer</apex:facet> -->
                                    <apex:outputText value="{!thiscase.BMCServiceDesk__FKCategory__r.Name}"/>
                                </apex:column>
                         
                                <apex:column >
                                    <apex:facet name="header">Status</apex:facet>
                                    <!-- <apex:facet name="footer">column footer</apex:facet> -->
                                    <apex:outputText value="{!thiscase.BMCServiceDesk__FKStatus__r.Name}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">Priority</apex:facet>
                                    <!-- <apex:facet name="footer">column footer</apex:facet> -->
                                    <apex:outputText value="{!thiscase.BMCServiceDesk__FKPriority__r.Name}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">Owner Id</apex:facet>
                                    <!-- <apex:facet name="footer">column footer</apex:facet> -->
                                    <apex:outputText value="{!thiscase.HD_Owner_user_queue__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">Opened Date</apex:facet>
                                    <!-- <apex:facet name="footer">column footer</apex:facet> -->
                                    <apex:outputText value="{0,date,MM'/'dd'/'yyyy}"><apex:param value="{!thiscase.BMCServiceDesk__openDateTime__c}" /></apex:outputText>
                                </apex:column>
                         
                         
                            </apex:dataTable>
                           </div>
                            
                       
                            <br/><br/>
                       
                       
                       
                       <div style="max-height: 500px; overflow: auto;">
                        <apex:dataTable value="{!serviceRequestList}" var="thiscase" id="thesrTable"
                                rowClasses="odd,even" styleClass="tableClass" style="width: 99%;">
                                <apex:facet name="caption">Service Requests</apex:facet>
                                <apex:facet name="header"></apex:facet>
                                <apex:facet name="footer"></apex:facet>
                         
                                <apex:column >
                                    <apex:facet name="header">Ticket Number</apex:facet>
                                   <!-- <apex:facet name="footer">column footer</apex:facet>-->
                                    <a href="javascript:void(0);" onclick="navigateToId2('{!thiscase.Id}')" title="{!thiscase.BMCServiceDesk__shortDescription__c}" >{!thiscase.Name}</a>
                                </apex:column>
                         
                                <apex:column >
                                    <apex:facet name="header">Description</apex:facet>
                                    <!-- <apex:facet name="footer">column footer</apex:facet> -->
                                    <apex:outputText value="{!LEFT(thiscase.BMCServiceDesk__shortDescription__c,30)+'...'}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">Parent Tree</apex:facet>
                                    <!-- <apex:facet name="footer">column footer</apex:facet> -->
                                    <apex:outputText value="{!thiscase.BMCServiceDesk__Feedback__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">Category</apex:facet>
                                    <!-- <apex:facet name="footer">column footer</apex:facet> -->
                                    <apex:outputText value="{!thiscase.BMCServiceDesk__FKCategory__r.Name}"/>
                                </apex:column>
                         
                                <apex:column >
                                    <apex:facet name="header">Status</apex:facet>
                                    <!-- <apex:facet name="footer">column footer</apex:facet> -->
                                    <apex:outputText value="{!thiscase.BMCServiceDesk__FKStatus__r.Name}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">Priority</apex:facet>
                                    <!-- <apex:facet name="footer">column footer</apex:facet> -->
                                    <apex:outputText value="{!thiscase.BMCServiceDesk__FKPriority__r.Name}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">Owner Id</apex:facet>
                                    <!-- <apex:facet name="footer">column footer</apex:facet> -->
                                    <apex:outputText value="{!thiscase.HD_Owner_user_queue__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">Opened Date</apex:facet>
                                    <!-- <apex:facet name="footer">column footer</apex:facet> -->
                                    <apex:outputText value="{0,date,MM'/'dd'/'yyyy}"><apex:param value="{!thiscase.BMCServiceDesk__openDateTime__c}" /></apex:outputText>
                                </apex:column>
                         
                         
                            </apex:dataTable>
                            <br/><br/>
                            
                           </div>
                           
                       
                           <script>
                           function navigateToId2(val) {
                           
                               window.open('/' + val);
                               
                           }
                           
                           </script>
                           
                       
                       
                       
                       
                       
                        </apex:outputPanel>
                        
                        
                        
                        
                        
                        
                    
                    <!-- <br/><br/>
                    Service Requests:
                    <table width="90%">
                       <tr><th>Ticket Number</th><th>Short Description</th><th>Parent Tree</th><th>Category</th><th>Status</th><th>Priority</th><th>Owner Id</th><th>Opened Date</th></tr>
                        <apex:repeat var="thiscase" value="{!serviceRequestList}">
                            <tr><td><a href="javascript:void(0);" onclick="navigateToId22('{!thiscase.Id}')" >{!thiscase.Name}</a></td><td width="200">{!LEFT(thiscase.BMCServiceDesk__shortDescription__c,30)+'...'}</td><td>{!thiscase.HD_Parent_Tree__c}</td><td>{!thiscase.BMCServiceDesk__FKCategory__r.Name}</td><td>{!thiscase.BMCServiceDesk__FKStatus__r.Name}</td><td>{!thiscase.BMCServiceDesk__FKPriority__r.Name}</td><td>{!thiscase.HD_Owner_user_queue__c}</td><td><apex:outputText value="{0,date,MM'/'dd'/'yyyy}"><apex:param value="{!thiscase.BMCServiceDesk__openDateTime__c}" /></apex:outputText></td></tr> 
                        </apex:repeat>
                    </table>
                    
                    -->
                    
                    
                    </center>
                    
                
                </td>
                
            </tr>
            
        </table>
        </center>
        
          <apex:actionFunction action="{!updateUserSearch}" name="updateUserSearch" rerender="helpdeskform,helpdeskDatatable">
           <apex:param name="searchUserterm" assignTo="{!userNameSearch}" value="" />
        </apex:actionFunction>
       </apex:form>
       
    </apex:outputPanel>
    
    </div>
    
    
    
    
    
   <div id='popitem' />
   <div id="popitem2"/>
<div id="servicerequest"/>
    <apex:outputPanel rendered="{!method == 'createobject'}">

    <script>
    
        $Lightning.use('c:BSScreenPopApp', function() {
            $Lightning.createComponent(
                'c:BSScreenPop',
                {lob: '{!lob}', ani: '{!ani}', erc: '{!erc}', method: '{!method}', cti_object: '{!cti_obj}',cti_metadata: '{!cti_data}',cti_recordtype: '{!cti_rt}', defValues: '{!defaultValues}'}, 
                'popitem',
                function(cmp) {
                    console.log('Component is created!');
                    console.log(cmp);
                    $A.eventService.addHandler({ "event": "c:SendDataToVFPage", "handler": retriveEventData });

            });
        });
    
  
        function retriveEventData(event) {
            var operationName = event.getParam("operationName");
            var recordId = event.getParam("recordId");
            console.log('received event!!..');
            console.log(operationName);
            console.log(recordId);
            navigateToId(recordId);
            
        }
    
    </script>

    </apex:outputPanel>
    
<apex:form >
        <apex:outputPanel id="testid"/>
    
      
        <apex:outputPanel id="lcform">
            <script> 
            var popId = '{!idToPop}'; 
            console.log('id to pop is ' + popId);
            if (popId != '') {
                setTimeout(function(){navigateToId(popId)},1000);
                
          
            }
            </script>
        </apex:outputPanel>
     
        <script>
        
       function enterPress(e){
           if(e.keyCode==13){
                if(e.preventDefault){ 
                    e.preventDefault();
                }
                else{
                    e.returnValue=false;
                }
                updateSearch(document.getElementById('textsel').value);
            }        
        }
       </script>
       <apex:actionFunction action="{!navigateToId}" name="navigateToId" reRender="testid">
            <apex:param name="paramIdToPop22" assignTo="{!idToPop}" value=""/>
        </apex:actionFunction>
   
        <apex:actionFunction action="{!updateSearch}" name="updateSearch" rerender="searchArea">
            <apex:param name="paramAdjAni" assignTo="{!ani}" value="" />
        </apex:actionFunction>
        <apex:actionFunction action="{!runSelection}" name="runselection" rerender="searchArea">
            <apex:param name="selectedId" assignTo="{!selectedId}" value="" />
        </apex:actionFunction>
        <apex:actionFunction action="{!updateTaskRecord}" name="updatetaskrecord" rerender="updatetaskrecfinish">
            <apex:param name="updateId" assignTo="{!idToUpdate}" value="" />
            <apex:param name="taskid" assignTo="{!taskid}" value="" />
        </apex:actionFunction>
    	<apex:outputPanel id="updatetaskrec" rendered="{!canUpdateTask}">
    		<script>
            console.log('updating task record..');
            console.log('{!idToUpdate} is the id updating, {!taskid} is the task id');
            
            
            setTimeout(function(){updatetaskrecord('{!idToUpdate}','{!taskid}')},1000);
            
            
            </script>
            
            
        </apex:outputPanel>
    	<apex:outputPanel id="updatetaskrecfinish">
    		
    	</apex:outputPanel>
    
     	

        <script>
        
        function retriveEventData(event) {
            var operationName = event.getParam("operationName");
            var recordId = event.getParam("recordId");
            console.log('received event!!..');
            console.log(operationName);
            console.log(recordId);
            if (recordId == 'close') {
                document.getElementById('akatecnewcallscreen').style.display = 'block';
                document.getElementById('akatecmanyaccountscreen').style.display = 'block';
        		document.getElementById('akatecmanycontactscreen').style.display = 'block';
				document.getElementById('akateconeaccountscreen').style.display = 'block';
        
            } else {
               
                    navigateToId(recordId);
              
                
            }
        }
        
        function createnewcase() {
            document.getElementById('akatecnewcallscreen').style.display = 'none';
            document.getElementById('akatecmanyaccountscreen').style.display = 'none';
        	document.getElementById('akatecmanycontactscreen').style.display = 'none';
        	document.getElementById('akateconeaccountscreen').style.display = 'none';
            
              $Lightning.use('c:BSScreenPopApp', function() {
                $Lightning.createComponent(
                    'c:BSScreenPop',
                    {lob: '{!lob}', ani: '{!ani}', erc: '{!erc}', method: '{!method}', cti_object: 'Case',cti_metadata: '{!cti_data}',cti_recordtype: 'Technical', defValues: '{!defaultValues}'}, 
                    'popitem',
                    function(cmp) {
                        console.log('Component create case is created!');
                        console.log(cmp);
                        $A.eventService.addHandler({ "event": "c:SendDataToVFPage", "handler": retriveEventData });
    
                });
            });
        
        }
        
        
        function newSR() {
            document.getElementById('akatecnewcallscreen').style.display = 'none';
             document.getElementById('akatecmanyaccountscreen').style.display = 'none';
        
              $Lightning.use('c:hdCreateNewIncidentApp', function() {
                $Lightning.createComponent(
                    'c:HD_CreateSRForm',
                    {isScreenPop: true}, //lob: '{!lob}', 
                    'servicerequest',
                    function(cmp) {
                        console.log('Component create case is created!');
                        console.log(cmp);
                        $A.eventService.addHandler({ "event": "c:SendDataToVFPage", "handler": retriveEventData });
    
                });
            });
        
        }
    /*function newIncident() {
            document.getElementById('akatecnewcallscreen').style.display = 'none';
             document.getElementById('akatecmanyaccountscreen').style.display = 'none';
        
              $Lightning.use('c:hdCreateNewIncidentApp', function() {
                $Lightning.createComponent(
                    'c:HD_CreateIncidentForm',
                    {isScreenPop: true}, //lob: '{!lob}', 
                    'servicerequest',
                    function(cmp) {
                        console.log('Component create case is created!');
                        console.log(cmp);
                        $A.eventService.addHandler({ "event": "c:SendDataToVFPage", "handler": retriveEventData });
    
                });
            });
        
        } */
    
        function newIncident(userId,userName) {
            //document.getElementById('akatecnewcallscreen').style.display = 'none';
            //document.getElementById('akatecmanyaccountscreen').style.display = 'none';
        
            /* $Lightning.use('c:hdCreateNewIncidentApp', function() {
                $Lightning.createComponent(
                    'c:HD_CreateIncidentForm',
                    {isScreenPop: true}, //lob: '{!lob}', 
                    'servicerequest',
                    function(cmp) {
                        console.log('Component create case is created!');
                        console.log(cmp);
                        $A.eventService.addHandler({ "event": "c:SendDataToVFPage", "handler": retriveEventData });
    
                });
            });*/                 ///  /apex/ACD2_NavigateToIncident?userName=Himanshu&userId=005G0000003D7MmIAK
            window.open("/apex/ACD2_NavigateToIncident?userId="+userId+"&userName="+userName,'_blank');
                
          }
        
        </script>
        
        
    </apex:form>


    <div style="position: absolute; bottom: 0; display: none;">
        Lob: {!lob} &nbsp;
        Method:  {!method} &nbsp;
        Obj:  {!cti_obj}&nbsp;
        Rt:  {!cti_rt}&nbsp;
        Dat:  {!cti_data}&nbsp;
        Id: {!idToPop} &nbsp;
    
    </div>
    
    
    </apex:page>