<!--=====================================================================================================+
    Page Name          	:   SC_CaseProductWidgetPage 
	Controller			:	SC_CaseProductWidget
    Author              :   Aditya Sonam
    Created             :   10-July-2017 mode="edit"
    Purpose             :   This page works as a widget on console for technical case to add case product.
+=====================================================================================================-->
<apex:page standardcontroller="Case" extensions="SC_CaseProductWidget" sidebar="false" showHeader="true" >
<apex:includeScript value="/support/console/32.0/integration.js"/>
    <apex:form id="caseProductWidgetId" rendered="{!isTechnicalCase}">
     	<apex:outputPanel id="noWidgetMessage" rendered="{!not(isWidgetEnabled)}" styleClass="noWidgetStyleClass" >
        	Case Product Widget is disabled on Case Creation. Save Case to enable it.
        </apex:outputPanel>
		<apex:outputPanel id="noProductOnAccount" rendered="{!AND(isWidgetEnabled,!accountWithProduct)}" styleClass="noWidgetStyleClass" >
        	Account has no product.
        </apex:outputPanel>
        <apex:outputPanel id="noAccount" rendered="{!not(isAccountPopulated)}" styleClass="noWidgetStyleClass" >
        	Account is required to see entitled Case Products.
        </apex:outputPanel>
        	<apex:pageBlock id="caseProductBlock" rendered="{!AND(isWidgetEnabled,accountWithProduct)}" >
                <label><b style="color: #7b8ba4;">Case Product:</b>&nbsp;&nbsp;</label><apex:selectlist value="{!productId}" size="1" styleClass="selectListCls">
                	<apex:selectoptions value="{!productList}"/>
                </apex:selectlist>
                <apex:commandbutton value="Save " action="{!saveCaseProduct}" oncomplete="getEnclosingTabId();return false;" styleClass="btnClass" rerender="updateStatusPanel,updateStatus"/>
        	    <apex:outputPanel id="updateStatusPanel" rendered="true">
                    <br/><apex:outputText style="color:#006cb5;font-style:italic;font-size:9px;" id="updateStatus" value="{!dmlStatusMsg}" rendered="{!isUpdateCall}" styleClass="updateStatusCls"/>
        		</apex:outputPanel> 	
        	</apex:pageBlock>       
     </apex:form>
   <script>
    function getEnclosingTabId() {
            sforce.console.getEnclosingTabId(showTabId);
        }
        var showTabId = function showTabId(result) {
            changeTextColorFailureEvent();
            setTimeout(function(){sforce.console.refreshSubtabById(result.id,true);},3000);
        };
    
    function changeTextColorFailureEvent(){
    	var dmlText = document.getElementsByClassName("updateStatusCls")[0].innerText;
        if(dmlText != 'Save Successful. Refreshing Case Tab.'){
        	document.getElementsByClassName("updateStatusCls")[0].style.color = "#DB555F";
        }
        else{
        	document.getElementsByClassName("updateStatusCls")[0].style.color = "#95CB75";
        }
    };
    </script>
    <style>
    .noWidgetStyleClass{
        font-family: 'SalesforceSans-Regular',Helvetica,Arial,sans-serif;
    	font-size: 12px;
    	color: #8392aa;
    	font-weight: normal;
    	font-style: italic;
     }
    .pbBody{
        background-color: #f4f6f9 !important;
        padding-bottom: 10px !important;
        margin-left: -10px !important;
        padding-left: 10px !important;
        padding-top: 7px !important;
        margin-right: -10px !important;
        border: none !important;
        border-top: 0px !important;
	}
    .caseTab .secondaryPalette, .individualPalette .caseBlock .secondaryPalette {
        border: none;
    }
    .selectListCls{
     	width: 45%;
   	}
        
    .btnClass{
        padding-left: 8px !important;
        margin-left: 20px !important;
        padding-right: 6px !important;           
    }
    
    .bPageBlock{   
        background-color: rgb(244, 246, 249) !important;
        border-bottom: 1px solid rgb(220, 220, 220) !important;
        border-left: 1px solid rgb(234, 234, 234) !important;
        border-right: 1px solid rgb(234, 234, 234) !important;
        border-radius: 4px !important;
        margin-left: -9px !important;
        padding-left: 10px !important;
        margin-bottom: 0px !important;
        margin-right: -9px !important;
        padding-right: 10px !important;
        margin-top: -9px !important;
    }
        
    </style>
</apex:page>